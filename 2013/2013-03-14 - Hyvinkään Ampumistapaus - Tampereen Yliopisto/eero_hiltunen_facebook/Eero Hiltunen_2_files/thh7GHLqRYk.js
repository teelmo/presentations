/*1337859767,176833974*/

if (window.CavalryLogger) { CavalryLogger.start_js(["FoT5H"]); }

__d("ChatHovercard",["AsyncRequest","Hovercard","URI","debounce"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Hovercard'),i=b('URI'),j=b('debounce');function k(p){var q=i('/ajax/hovercard/chat.php');q.addQueryData({type:'chat',id:p});return q.toString();}var l=j(function(p,q){var r=k(p);new g(r).setData({endpoint:r}).setMethod('GET').setReadOnly(true).setHandler(m.curry(p,q,r)).setAllowCrossPageTransition(true).send();},300);function m(p,q,r,s){(function(){var t=h.getDialog(r);t&&q(t);}).defer();}function n(p,q){function r(u){if(p==q.getActiveID())q.showHovercard(p,u);}var s=k(p),t=h.getDialog(s);if(t){r(t);}else l(p,r);}function o(p){var q=p.getHoverController();q.registerDefault(n);}e.exports=o;});
__d("ChatOptions",["Arbiter","ChannelConstants","JSLogger","PresenceState","PresenceUtil","copyProperties","ChatOptionsInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('JSLogger'),j=b('PresenceState'),k=b('PresenceUtil'),l=b('copyProperties'),m=i.create('chat_options'),n={};(function(){var r=c('ChatOptionsInitialData');for(var s in r){var t=r[s];n[s]=!!t;}})();var o=l(new g(),{getSetting:function(r){return n[r];},setSetting:function(r,s,t){if(this.getSetting(r)==s)return;if(t){t='from_'+t;m.log(t,{name:r,new_value:s,old_value:this.getSetting(r)});}n[r]=!!s;g.inform('chat/option-changed',{name:r,value:s});}});function p(r){r.snd=o.getSetting('sound')?1:0;r.not=o.getSetting('browser_notif')?1:0;return r;}function q(r){o.setSetting('sound',!!r.snd,'cookie');o.setSetting('browser_notif',!!r.not,'cookie');}j.registerStateStorer(p);j.registerStateLoader(q);g.subscribe(h.getArbiterType('setting'),function(r,s){var t=s.obj;if(t.window_id===k.getSessionID())return;o.setSetting(t.setting,!!t.value,'channel');});g.inform('chat-options/initialized',o,g.BEHAVIOR_PERSISTENT);e.exports=a.chatOptions||o;});
__d("ChatOrderedListHover",["function-extensions","ArbiterMixin","Class","CSS","DOM","ErrorUtils","LayerFadeOnHide","Parent","copyProperties","setTimeoutAcrossTransitions","tx"],function(a,b,c,d,e,f){b('function-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('CSS'),j=b('DOM'),k=b('ErrorUtils'),l=b('LayerFadeOnHide'),m=b('Parent'),n=b('copyProperties'),o=b('setTimeoutAcrossTransitions'),p=b('tx');function q(t){i.addClass(t,'fetching');}function r(t){i.removeClass(t,'fetching');}function s(t){this._orderedList=t;this._root=t.getRoot();Event.listen(this._root,'mouseover',this._mouseOver.bind(this));Event.listen(this._root,'mouseleave',this._mouseLeave.bind(this));}n(s.prototype,g,{_root:null,_activeItem:null,_hideTimeout:null,_showTimeout:null,_showingDialog:null,_showingID:null,_alreadyShowing:false,_handlers:{},_defaultHandler:null,_mouseOver:function(t){var u=t.getTarget(),v=m.byClass(u,'item');v&&this._setActiveItem(v);},_mouseLeave:function(t){this._setActiveItem(null);},_clearTimeouts:function(){this._showTimeout&&clearTimeout(this._showTimeout);this._showTimeout=null;this._hideTimeout&&clearTimeout(this._hideTimeout);this._hideTimeout=null;},_checkAlreadyShowing:function(){var t=this.getActiveID();if(!t&&!this._showingID)this._alreadyShowing=false;},_hide:function(){if(this._showingDialog){this._showingDialog.enableBehavior(l);this._showingDialog.hide();this._showingDialog=null;this._showingID=null;}this._checkAlreadyShowing();},_show:function(){this._alreadyShowing=true;var t=this.getActiveID(),u=false;if(this._handlers[t]){u=true;k.applyWithGuard(this._handlers[t],{},[t,this]);}else if(this._defaultHandler){u=true;k.applyWithGuard(this._defaultHandler,{},[t,this]);}if(u&&this._showingID!=this.getActiveID())q(this._activeItem);},_setActiveItem:function(t){if(t!=this._activeItem){this._clearTimeouts();this._activeItem&&r(this._activeItem);this._activeItem=null;var u=t?0:100;this._hideTimeout=o(function(){if(this.getActiveID()!=this._showingID)this._hide();}.bind(this),u);if(t){var v=this._orderedList.getUserForNode(t);this._activeItem=t;var w=u+(this._alreadyShowing?75:500);this._showTimeout=o(function(){this._show();}.bind(this),w);this.inform('hover',v);}else this.inform('leave');this._checkAlreadyShowing();}},register:function(t,u){if(!this._handlers[t]){this._handlers[t]=u;return {unregister:function(){if(t==this._showingID)this._hide();delete this._handlers[t];var v=this._orderedList.getAllNodes(),w=v[t];w&&r(w);}.bind(this)};}},registerDefault:function(t){this._defaultHandler=t;},getActiveID:function(){var t=this._activeItem&&this._orderedList.getUserForNode(this._activeItem);return t||null;},showHovercard:function(t,u){if(t==this.getActiveID()&&t!=this._showingID){this._clearTimeouts();r(this._activeItem);this._hide();this._showingDialog=u;this._showingID=t;var v=u.subscribe('mouseenter',this._setActiveItem.bind(this,this._activeItem)),w=u.subscribe('mouseleave',this._setActiveItem.bind(this,null)),x=u.subscribe('hide',function(){v.unsubscribe();w.unsubscribe();x.unsubscribe();});u.setContext(this._activeItem);u.setPosition('left');u.show();u.updatePosition();}}});e.exports=s;});
__d("ChatQuietLinks",["event-extensions","DOM","UserAgent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOM'),h=b('UserAgent'),i={silence:function(j){if(h.firefox()>=4||h.chrome())var k=Event.listen(document,'mousemove',function(){this.removeLinkHrefs(j);k.remove();}.bind(this));},removeLinkHrefs:function(j){var k=g.scry(j,'a');for(var l=0;l<k.length;l++){var m=k[l].getAttribute('href');if(!m||m.charAt(0)=='#')k[l].removeAttribute('href');}}};e.exports=i;});
__d("OrderedFriendsList",["array-extensions","Arbiter","createArrayFrom","ShortProfiles","copyProperties","OrderedFriendsListInitialData"],function(a,b,c,d,e,f){b('array-extensions');var g=b('Arbiter'),h=b('createArrayFrom'),i=b('ShortProfiles'),j=b('copyProperties'),k=[],l={},m=j(new g(),{contains:function(n){return n in l;},compare:function(n,o){var p=m.getRank(n),q=m.getRank(o);if(p!==q)return p-q;var r=i.getNow(n),s=i.getNow(o),t=((r||{}).name||'~').toLowerCase(),u=((s||{}).name||'~').toLowerCase();if(t!==u)return t<u?-1:1;return 0;},getList:function(){var n=h(k);n=n.filter(function(o){var p=window.ShortProfiles&&i.getNow(o);return !p||p.type=="friend";});return n;},getRank:function(n){return n in l?l[n]:k.length;},isReady:function(){return true;}});(function(){var n=c('OrderedFriendsListInitialData');k=n.list.length?n.list:[];k.forEach(function(o,p){l[o]=p;});m.inform('initialized',{},g.BEHAVIOR_PERSISTENT);})();e.exports=a.OrderedFriendsList||m;});
__d("ChatOrderedList",["event-extensions","Animation","Arbiter","ArbiterMixin","AvailableList","AvailableListConstants","ChannelConnection","Chat","ChatConfig","ChatOrderedListHover","ChatQuietLinks","ChatVisibility","Class","CSS","DataStore","Dialog","DOM","HTML","OrderedFriendsList","Parent","PresencePrivacy","ShortProfiles","Tooltip","URI","Vector","XHPTemplate","copyProperties","debounceAcrossTransitions","goURI","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('AvailableList'),k=b('AvailableListConstants'),l=b('ChannelConnection'),m=b('Chat'),n=b('ChatConfig'),o=b('ChatOrderedListHover'),p=b('ChatQuietLinks'),q=b('ChatVisibility'),r=b('Class'),s=b('CSS'),t=b('DataStore'),u=b('Dialog'),v=b('DOM'),w=b('HTML'),x=b('OrderedFriendsList'),y=b('Parent'),z=b('PresencePrivacy'),aa=b('ShortProfiles'),ba=b('Tooltip'),ca=b('URI'),da=b('Vector'),ea=b('XHPTemplate'),fa=b('copyProperties'),ga=b('debounceAcrossTransitions'),ha=b('goURI'),ia=b('tx');function ja(ka,la,ma,na){this._root=ka;this._items={};this._isVisible=false;this._excludedIds={};this._numTopFriends=5;this._hasRendered=false;this._preventRendering=false;this._hoverController=null;this._template=la;this._messageTemplate=ma;this._contextualDialog=na;Event.listen(this._root,'click',this._onClick.bind(this));Event.listen(this._root,'mouseenter',this._mouseEnter.bind(this));Event.listen(this._root,'mouseleave',this._mouseLeave.bind(this));x.subscribe('initialized',this.update.shield(this));j.subscribe(k.ON_AVAILABILITY_CHANGED,this.update.shield(this));z.subscribe('privacy-changed',this.update.shield(this));l.subscribe([l.CONNECTED,l.RECONNECTING,l.SHUTDOWN,l.MUTE_WARNING,l.UNMUTE_WARNING],this.update.shield(this));this.inform('initialized',this,h.BEHAVIOR_PERSISTENT);this.render();}fa(ja.prototype,i,{_getAvailableList:function(){return j.getOnlineIDs().filter(function(ka){return !(ka in this._excludedIds);}.bind(this));},getAllNodes:function(){var ka={},la=v.scry(this._root,'li.item');for(var ma=0;ma<la.length;ma++){var na=t.get(la[ma],'id');if(na)ka[na]=la[ma];}return ka;},getUserForNode:function(ka){return t.get(ka,'id');},getHoverController:function(){if(!this._hoverController)this._hoverController=new o(this,this._contextualDialog);return this._hoverController;},_getListItem:function(ka){var la=this._items[ka];if(la){var ma=j.get(ka),na=z.allows(ka)&&!l.disconnected(),oa={active:false,idle:false,mobile:false,greenphone:false,greenring:false},pa=n.get('chat_mobile_icon_experiment_condition')||'normal';switch(pa){case 'mobile_green_phone':oa.active=ma===k.ACTIVE;oa.greenphone=ma===k.MOBILE;break;case 'mobile_green_circle':oa.active=ma===k.ACTIVE||ma===k.MOBILE;break;case 'mobile_green_ring':oa.active=ma===k.ACTIVE;oa.greenring=ma===k.MOBILE;break;case 'all_green_ring':oa.greenring=ma===k.ACTIVE||ma===k.MOBILE;break;default:oa.active=ma===k.ACTIVE;oa.mobile=ma===k.MOBILE;break;}for(var qa in oa)s.conditionClass(la,qa,oa[qa]&&na);s.conditionClass(la,'invis',!na);}return la;},getRoot:function(){return this._root;},getSortedList:function(ka){var la=x.getList().filter(function(cb){return !(cb in this._excludedIds);}.bind(this));la=la.filter(function(cb){return z.getFriendVisibility(cb)!==z.BLACKLISTED;}.bind(this));var ma=[],na=q.isOnline();if(na){if(z.getOnlinePolicy()===z.ONLINE_TO_WHITELIST){var oa=la,pa={},qa,ra;la=[];for(qa=0;qa<oa.length;++qa){ra=oa[qa];if(z.allows(ra)){pa[ra]=true;la.push(ra);}}var sa=z.getWhitelist();for(qa=0;qa<sa.length;++qa){ra=sa[qa];if(!(ra in pa))la.push(ra);}for(qa=0;qa<oa.length;++qa){ra=oa[qa];if(!z.allows(ra))la.push(ra);}}var ta=n.get('ordered_list.top_friends',0),ua=n.get('ordered_list.available_target',0),va=Math.floor(this._numTopFriends*ua),wa=[];for(var qa=0,xa=la.length;qa<xa&&va>0;qa++){var ra=la[qa],ya=j.get(ra),za=ya===k.ACTIVE;if(n.get('chat_sidebar_mobile_available'))za=za||(ya===k.MOBILE);if(za||qa<ta){ma.push(ra);za&&va--;}else wa.push(ra);}if(qa<xa)Array.prototype.push.apply(wa,la.slice(qa));if(ma.length<this._numTopFriends)Array.prototype.push.apply(ma,wa);}else Array.prototype.push.apply(ma,la);ma=ma.slice(0,this._numTopFriends);if(ma.length===this._numTopFriends){var ab=Object.from(ma),bb=this._getAvailableList().filter(function(cb){return !(cb in ab);}).length;bb&&ma.splice(-1);}ma.sort(this._sort.bind(this));return ma;},hide:function(){if(!this._isVisible)return;this._isVisible=false;s.hide(this._root);this.inform('hide');},_onClick:function(event){var ka=event.getTarget(),la=y.byTag(ka,'li');if(la){if(s.hasClass(la,'blackbirdWhitelist')){var ma=new ca('/ajax/chat/privacy/settings_dialog.php').addQueryData({ref:'whitelist_separator'});new u().setAsyncURL(ma.toString()).show();event.prevent();return false;}var na=t.get(la,'id');if(na){var oa='ordered_list',pa=la;while(la.previousSibling){la=la.previousSibling;if(s.hasClass(la,'separator')){if(s.hasClass(la,'moreOnlineFriends')){oa='more_online_friends';break;}if(s.hasClass(la,'blackbirdWhitelist')){oa='blackbird_offline_section';break;}}}aa.get(na,function(qa){m.openTab(na,qa.name,'friend',oa);});this.inform('click',{id:na});}else if(s.hasClass(la,'separator')&&y.byClass(ka,'inner'))this.scrollTo(la);return false;}},_mouseEnter:function(){this._preventRendering=true;},_mouseLeave:function(){this._preventRendering=false;},setExcludedIds:function(ka){this._excludedIds=Object.from(ka||[]);},setNumTopFriends:function(ka){if(ka!==this._numTopFriends){this._numTopFriends=ka;this.render();}},_sort:function(ka,la){var ma=this._sortByAllowed(ka,la);if(ma!==0)return ma;var na=this._sortAlphabetical(ka,la);if(na!==0)return na;return x.compare(ka,la);},_sortByAllowed:function(ka,la){var ma=z.allows(ka),na=z.allows(la);if(ma!==na)return ma?-1:1;return 0;},_sortAlphabetical:function(ka,la){var ma=aa.getNow(ka),na=aa.getNow(la),oa=((ma||{}).name||'~').toLowerCase(),pa=((na||{}).name||'~').toLowerCase();if(oa!==pa)return oa<pa?-1:1;return 0;},_sortMobile:function(ka,la){var ma=j.get(ka)===k.MOBILE,na=j.get(la)===k.MOBILE;if(ma^na)return na?-1:1;return this._sortAlphabetical(ka,la);},_getOfflineToSectionItems:function(){var ka=v.$N('a',{href:'#'},v.tx._("Muokkaa")),la=[];la.push(w('<li class="separator">'+'<div class="outer">'+'<div class="inner">'+'<span class="text">'+v.tx._("POIS PAIKALTA OLEVAT KAVERIT")+'</span>'+'<div class="dive"><span class="bar"></span></div>'+'</div>'+'</div>'+'</li>'));la.push(w('<li class="separator blackbirdWhitelist">'+'<div class="outer">'+'<div class="inner">'+'<div class="subheader">'+'<span class="subheaderText">'+v.tx._("N\u00e4m\u00e4 kaverit eiv\u00e4t n\u00e4e sinua keskustelussa. {=link}",{'=link':ka})+'</span>'+'</div>'+'</div>'+'</li>'));return la;},render:function(){this.render=ga(function(){if(!this._isVisible||(this._preventRendering&&this._hasRendered))return;this._hasRendered=true;var ka=this.getSortedList(),la=[],ma,na,oa=z.getVisibility()&&z.getOnlinePolicy()==z.ONLINE_TO_WHITELIST;for(var pa=0,qa=ka.length;pa<qa;pa++){ma=ka[pa];if(oa)if(!z.allows(ma)){if(pa+2>=ka.length)break;oa=false;var ra=this._getOfflineToSectionItems();la.push(ra[0]);la.push(ra[1]);qa-=2;}na=this._getListItem(ma);if(na){la.push(na);}else this._renderListItem(ma,this.render.bind(this));}var sa=this._getAvailableList(),ta=Object.from(ka);sa=sa.filter(function(ya){return !(ya in ta);});sa.sort(this._sortMobile.bind(this));if(sa.length&&la.length)la.push(w('<li class="separator moreOnlineFriends">'+'<div class="outer">'+'<div class="inner">'+'<span class="text">'+ia._("{MORE ONLINE FRIENDS} ({=count})",{'MORE ONLINE FRIENDS':"LIS\u00c4\u00c4 PAIKALLA OLEVIA KAVEREITA",'=count':sa.length})+'</span>'+'<div class="dive"><span class="bar"></span></div>'+'</div>'+'</div>'+'</li>'));for(var ua=0,va=sa.length;ua<va;ua++){ma=sa[ua];na=this._getListItem(ma);if(na){la.push(na);}else this._renderListItem(ma,this.render.bind(this));}if(!ka.length&&!sa.length){var wa=this._messageTemplate.render(),xa=ea.getNode(wa,'message');v.setContent(xa,"Ket\u00e4\u00e4n ei ole keskustelussa.");la.push(wa);}if(la.length){v.setContent(this._root,la);this.inform('render',{},h.BEHAVIOR_PERSISTENT);}},300,this);this.render();},_renderListItem:function(ka,la){aa.get(ka,function(ma){if(ma.type==='friend'){var na=this._template.render();p.silence(na);var oa=ea.getNode(na,'profile-photo');oa.setAttribute('src',ma.thumbSrc);var pa=ea.getNode(na,'name');v.setContent(pa,ma.name);var qa=ea.getNode(na,'timeline_icon');if(qa){var ra=ia._("Siirry henkil\u00f6n {name} aikajanalle",{name:ma.firstName});ba.set(qa,ra,'above','center');Event.listen(qa,'click',function(event){event.kill();ha(ma.uri);});}t.set(na,'id',ka);this._items[ka]=na;la&&la(na);}}.bind(this));},show:function(){if(this._isVisible)return;this._isVisible=true;s.show(this._root);this.render();this.inform('show');},isVisible:function(){return this._isVisible;},update:function(){this._hasRendered=false;this.render();},setScrollContainer:function(ka){if(v.contains(ka,this._root))this._scrollContainer=ka;},scrollTo:function(ka){if(!this._scrollContainer)return;var la=this._scrollContainer.scrollHeight,ma=this._scrollContainer.clientHeight,na=this._scrollContainer.scrollTop,oa=Math.min(ka.offsetTop,la-ma);if(na!==oa){var pa=Math.abs(oa-na)/this._scrollContainer.clientHeight*500;g(this._scrollContainer).to('scrollTop',oa).ease(g.ease.end).duration(pa).go();}}});e.exports=ja;});
__d("LiveBarData",["function-extensions","Arbiter","ArbiterMixin","AsyncRequest","ChannelConstants","LayerDestroyOnHide","copyProperties","setTimeoutAcrossTransitions","throttle"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('ChannelConstants'),k=b('LayerDestroyOnHide'),l=b('copyProperties'),m=b('setTimeoutAcrossTransitions'),n=b('throttle'),o=false,p={},q={},r={};function s(z){if((z.expires*1000)-Date.now()>0)return true;return false;}function t(z){var aa=z.payload.actions;if(!(aa&&aa.length))return;var ba;for(var ca=0;ca<aa.length;ca++){ba=aa[ca].actor_id;if(!p[ba]||aa[ca].action_id!=p[ba].action_id)continue;if(aa[ca].delete_action||aa[ca].remove){w(aa[ca]);continue;}}}function u(z){var aa=false;for(var ba=0;ba<z.length;ba++){if(z[ba].delete_action||z[ba].remove){w(z[ba]);continue;}var ca=z[ba].actor_id,da=z[ba].action_id;if(p[ca]){if(p[ca].action_id==da)continue;w(p[ca]);}aa=true;p[ca]=z[ba];v(z[ba]);}if(aa)y.inform('new-actions');}function v(z){var aa=(z.expires*1000)-Date.now();q[z.actor_id]=m(w.curry(z),Math.max(0,aa));}function w(z){if(!p[z.actor_id])return;if(p[z.actor_id].action_id!=z.action_id)return;delete p[z.actor_id];var aa=z.actor_id;if(q[aa]){clearTimeout(q[aa]);delete q[aa];}x(aa);y.inform('remove-action',z);}function x(z){var aa=r[z];if(aa){aa.enableBehavior(k);if(!aa.isShown())aa.destroy();delete r[z];}}g.subscribe(j.getArbiterType('livebar_update'),function(z,aa){u(aa.obj.actions);});var y={};l(y,h,{fetch:function(){if(o)return;var z=[];for(var aa in p){var ba=p[aa];if(!r[ba.actor_id])z.push(p[aa]);}if(z.length>0){o=true;new i().setURI('/ajax/chat/livebar.php').setData({actions:z}).setHandler(t).setFinallyHandler(function(){o=false;}).setAllowCrossPageTransition(true).send();}},addActions:u,getAction:function(z){var aa=p[z];if(aa&&s(aa))return aa;return null;},getDialog:function(z){var aa=this.getAction(z);if(aa&&r[aa.actor_id])return r[aa.actor_id];return null;},setDialog:function(z,aa,ba){var ca=p[z];if(ca&&ca.action_id==aa){x(z);r[z]=ba;y.inform('dialog-fetched',z);}}});e.exports=y;});
__d("LiveBar",["event-extensions","function-extensions","ChatConfig","CSS","LiveBarData","$","copyProperties","ge","setTimeoutAcrossTransitions","tx","ChatOrderedList","ContextualDialogX"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ChatConfig'),h=b('CSS'),i=b('LiveBarData'),j=b('$'),k=b('copyProperties'),l=b('ge'),m=b('setTimeoutAcrossTransitions'),n=b('tx');b('ChatOrderedList');b('ContextualDialogX');var o=g.get('livebar_fetch_defer')||1000;function p(q,r,s){this._orderedList=q;this._root=q.getRoot();this._liveBarTypes=s;this._hoverController=q.getHoverController();this._hoverController.subscribe('hover',this._mouseMove.bind(this));this._hoverController.subscribe('leave',this._mouseLeave.bind(this));q.subscribe('render',this._handleChatListUpdate.shield(this));i.subscribe('new-actions',this._updateIcons.bind(this));i.subscribe('remove-action',this._handleRemoveAction.bind(this));i.subscribe('dialog-fetched',function(t,u){this._setDialogContent(u);}.bind(this));i.addActions(r);}k(p,{setDialog:function(q,r,s){i.setDialog(q,r,s);}});k(p.prototype,{_root:null,_liveBarTypes:null,_hoverController:null,_registrations:{},_renderedIcons:{},_fetchTimer:null,_mouseLeftRoot:false,_chatListRendered:false,_getLiveBarTypes:function(){return this._liveBarTypes;},_handleChatListUpdate:function(){if(!this._chatListRendered){this._chatListRendered=true;this._updateIcons();}},_handleShow:function(q){this._setDialogContent(q);},_mouseMove:function(){if(!this._fetchTimer){this._fetchTimer=m(this._fetch.bind(this),o);this._mouseLeftRoot=false;}},_mouseLeave:function(){this._mouseLeftRoot=true;clearTimeout(this._fetchTimer);this._fetchTimer=null;},_setDialogContent:function(q){var r=i.getDialog(q);if(r)this._hoverController.showHovercard(q,r);},_fetch:function(){if(this._mouseLeftRoot)return;this._fetchTimer=null;i.fetch();},_updateIcons:function(){if(!this._chatListRendered)return;var q=this._orderedList.getAllNodes(),r=this._getLiveBarTypes();for(var s in q){var t=i.getAction(s);if(t&&(!this._renderedIcons[s]||this._renderedIcons[s]!=t.action_id)){for(var u=0;u<r.length;u++)h.removeClass(q[s],r[u]);h.addClass(q[s],t.livebar_type);this._renderedIcons[s]=t.action_id;var v=this._hoverController.register(s,this._handleShow.bind(this));if(v)this._registrations[s]=v;}}},_handleRemoveAction:function(q,r){var s=r.action_id,t=r.actor_id;this._registrations[t]&&this._registrations[t].unregister();delete this._registrations[t];if(this._renderedIcons[t]==s){var u=this._getLiveBarTypes(),v=this._orderedList.getAllNodes();if(v[t])for(var w=0;w<u.length;w++)h.removeClass(v[t],u[w]);delete this._renderedIcons[t];}}});e.exports=p;});
__d("LiveBarDark",["Class","LiveBar","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('LiveBar'),i=b('copyProperties');function j(k,l,m){this.parent.construct(this,k,l,m);}g.extend(j,h);i(j.prototype,{_setupDialogContent:bagofholding,_show:bagofholding,_updateIcons:bagofholding,_handleRemoveAction:function(k){this._removeActionDark(k);},_handleChatListUpdate:bagofholding});e.exports=j;});
__d("legacy:chat-options",["ChatOptions"],function(a,b,c,d){a.chatOptions=a.chatOptions||b('ChatOptions');},3);
__d("ChatSidebarSheet",["function-extensions","ArbiterMixin","ChannelConnection","ChannelConstants","ChatBehavior","ChatConfig","ChatVisibility","Class","CSS","DOM","JSLogger","PresencePrivacy","copyProperties","tx"],function(a,b,c,d,e,f){b('function-extensions');var g=b('ArbiterMixin'),h=b('ChannelConnection'),i=b('ChannelConstants'),j=b('ChatBehavior'),k=b('ChatConfig'),l=b('ChatVisibility'),m=b('Class'),n=b('CSS'),o=b('DOM'),p=b('JSLogger'),q=b('PresencePrivacy'),r=b('copyProperties'),s=b('tx'),t=o.$N,u=p.create('sidebar_sheet');function v(y){switch(y){case i.HINT_AUTH:return "Istuntosi on vanhentunut. Kirjaudu sis\u00e4\u00e4n.";case i.HINT_CONN:return s._("Facebookin {Chat} ei ole juuri nyt k\u00e4ytett\u00e4viss\u00e4.",{Chat:"Keskustelu"});case i.HINT_MAINT:return s._("Facebookin {Chat} on parhaillaan poissa k\u00e4yt\u00f6st\u00e4 yll\u00e4pidon takia.",{Chat:"Keskustelu"});default:return s._("Facebookin {Chat} ei ole juuri nyt k\u00e4ytett\u00e4viss\u00e4.",{Chat:"Keskustelu"});}}function w(y){var z;if(y===null){z="Yhteytt\u00e4 keskusteluun ei voida muodostaa. Tarkista Internet-yhteys.";}else if(y>k.get('warning_countdown_threshold_msec')){var aa=t('a',{href:'#',className:'fbChatReconnectLink'},"Yrit\u00e4 uudelleen");z=o.tx._("Yhteytt\u00e4 keskusteluun ei voida muodostaa. {try-again-link}",{'try-again-link':aa});}else if(y>1000){z=s._("Yhteytt\u00e4 keskusteluun ei voida muodostaa. Yritet\u00e4\u00e4n uudelleen {seconds} sekunnin kuluttua...",{seconds:Math.floor(y/1000)});}else z="Yhteytt\u00e4 keskusteluun ei voida muodostaa. Yritet\u00e4\u00e4n uudelleen...";return z;}function x(y){this._root=y;this._message=o.find(y,'div.fbChatSidebarMessage div.message');h.subscribe([h.CONNECTED,h.SHUTDOWN,h.RECONNECTING],this._handleConnectionChange.bind(this));h.subscribe([h.MUTE_WARNING,h.UNMUTE_WARNING],this._render.bind(this));q.subscribe('privacy-user-presence-changed',this._render.bind(this));j.subscribe(j.ON_CHANGED,this._render.bind(this));this._render();}r(x.prototype,g,{_channelStatus:null,_channelData:null,_handleConnectionChange:function(y,z){this._channelStatus=y;this._channelData=z;this._render();},_showWarningTimeout:null,_warningMsgEventListener:null,_renderChannelDisconnect:function(){if(this._channelStatus===h.SHUTDOWN){return o.setContent(this._message,v(this._channelData));}else if(this._channelStatus===h.RECONNECTING){var y=this._channelData;o.setContent(this._message,w(y));if(y>1000){if(y>k.get('warning_countdown_threshold_msec'))this._warningMsgEventListener=Event.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),'fbChatReconnectLink')){h.reconnect();return false;}});this._showWarningTimeout=setTimeout(this._handleConnectionChange.bind(this,h.RECONNECTING,y-1000),1000,false);}}},_goOnlineEventListener:null,_renderOffline:function(){var y='fbChatGoOnlineLink',z="Siirry paikalle",aa=t('a',{href:'#',className:y},z),ba=o.tx._("{=Go online} ja katso, ket\u00e4 muita on paikalla.",{'=Go online':aa});o.setContent(this._message,ba);this._goOnlineEventListener=Event.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),y)){u.log('sidebar_go_online');l.goOnline();return false;}});},_clear:function(){if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}if(this._warningMsgEventListener){this._warningMsgEventListener.remove();this._warningMsgEventListener=null;}if(this._goOnlineEventListener){this._goOnlineEventListener.remove();this._goOnlineEventListener=null;}n.removeClass(this._root,'offline');n.removeClass(this._root,'error');n.removeClass(this._root,'notice');o.empty(this._message);},_render:function(){this._clear();if(!l.isOnline()){n.addClass(this._root,'offline');this._renderOffline();}else if(h.disconnected()){n.addClass(this._root,'error');this._renderChannelDisconnect();}else if(!j.notifiesUserMessages()){n.addClass(this._root,'notice');o.setContent(this._message,"H\u00e4lytykset ovat pois p\u00e4\u00e4lt\u00e4, kun k\u00e4yt\u00e4t keskustelussa toista asiakasta.");}this.inform('updated');}});e.exports=x;});
__d("ChatTypeaheadBehavior",["Chat","CSS","DOM","Rect","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Chat'),h=b('CSS'),i=b('DOM'),j=b('Rect'),k=b('copyProperties'),l=b('tx');function m(n){this._typeahead=n;}k(m.prototype,{_subscriptions:null,enable:function(){var n=this._typeahead;this._subscriptions=[n.subscribe('focus',function(){n.getData().refreshData();}),n.subscribe('blur',function(o){n.getCore().reset();}),n.subscribe('respond',function(o,p){if(p.value&&p.value===n.getCore().getValue()){if(!p.results.length){var q=i.create('div',{className:'noResults'},"Kaveria ei l\u00f6ydy.");i.setContent(n.getView().getElement(),q);}h.addClass(n.getElement(),'hasValue');}}),n.subscribe('reset',function(){h.removeClass(n.getElement(),'hasValue');}),n.subscribe('select',function(o,p){g.openTab(p.selected.uid,p.selected.text,p.selected.type,'typeahead');}),n.subscribe('highlight',function(o,p){if(p.index>=0){var q=n.getView().getItems()[p.index];if(q){var r=new j(q),s=q.offsetParent,t=r.boundWithin(new j(s)).getPositionVector();r.getPositionVector().sub(t).scrollElementBy(s);}}})];},disable:function(){this._subscriptions.forEach(function(n){this._typeahead.unsubscribe(n);}.bind(this));this._subscriptions=null;}});e.exports=m;});
__d("ChatTypeaheadCore",["event-extensions","function-extensions","Class","Keys","TypeaheadCore","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Class'),h=b('Keys'),i=b('TypeaheadCore'),j=b('copyProperties');function k(l){this.parent.construct(this,l);}g.extend(k,i);j(k.prototype,{handleTab:bagofholding,keydown:function(event){var l=Event.getKeyCode(event);if(l===h.ESC){this.reset.shield(this).defer();return event.kill();}return this.parent.keydown(event);}});e.exports=k;});
__d("ChatTypeaheadDataSource",["Arbiter","AvailableListConstants","Class","DataSource","Env","JSLogger","OrderedFriendsList","Run","ShortProfiles","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableListConstants'),i=b('Class'),j=b('DataSource'),k=b('Env'),l=b('JSLogger'),m=b('OrderedFriendsList'),n=b('Run'),o=b('ShortProfiles'),p=b('copyProperties');function q(r){this.parent.construct(this,r);this.persistOnRefresh=r.persistOnRefresh!==false;this.showOfflineUsers=!!r.showOfflineUsers;this._jslog=l.create('chat_typeahead');this._jslog.log('created');}i.extend(q,j);p(q.prototype,{init:function(){this._jslog.log('init');m.subscribe('initialized',function(){this._jslog.log('ordered_friends_list_init');this.parent.init();var r=g.subscribe(h.ON_AVAILABILITY_CHANGED,this._update.shield(this));this._update();if(!this.persistOnRefresh)n.onLeave(function(){r.unsubscribe();});}.bind(this));},bootstrap:function(){this._jslog.log('bootstrap');this.parent.bootstrap();if(this.showOfflineUsers){this._jslog.log('show_offline_users');this._jslog.log('ensured_short_profiles');if(o.hasAll()){this._update();}else{this._jslog.log('fetch_all_short_profiles');o.fetchAll();this.inform('activity',{activity:true});var r=o.subscribe('updated',function(){this.inform('activity',{activity:false});this._update();}.bind(this));if(!this.persistOnRefresh)n.onLeave(function(){o.unsubscribe(r);});}}},_update:function(){d(['AvailableList'],function(r){var s=this.value;this.dirty();var t=o.getCachedProfileIDs(),u=t.filter(function(w){var x=o.getNow(w);return x.type==='friend';});u.sort(m.compare);var v=[];u.forEach(function(w){if(w==k.user)return;var x=r.get(w);if(!this.showOfflineUsers&&x!==r.ACTIVE)return;var y=o.getNow(w);v.push({uid:w,text:y.name,tokens:y.additionalName,localized_text:y.name,additional_text:y.additionalName,photo:y.thumbSrc,availability:x,type:y.type});}.bind(this));if(v.length)this.addEntries(v);this.value=s;if(s)this.respond(s,this.buildUids(s,[],this._exclusions),true);}.bind(this));},refreshData:function(){d(['AvailableList'],function(r){r.update();}.bind(this));}});e.exports=q;});
__d("ChatTypeaheadRenderer",["AvailableListConstants","ChatConfig","DOM","PresencePrivacy"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('ChatConfig'),i=b('DOM'),j=b('PresencePrivacy');function k(l,m){var n='offline';switch(l.availability){case g.ACTIVE:n='active';break;case g.IDLE:n='idle';break;case g.MOBILE:n='mobile';break;}if(!j.allows(l.uid))n='invis';var o=[];if(l.photo)o.push(i.create('img',{alt:'',src:l.photo}));if(l.text)o.push(i.create('span',{className:'text'},[l.text]));o.push(i.create('i',{className:n}));return i.create('li',{className:'clearfix '+n},o);}e.exports=k;});
__d("ChatSidebar",["Arbiter","createArrayFrom","AsyncRequest","ChatConfig","ChatOptions","ChatHovercard","ChatQuietLinks","ChatSidebarSheet","copyProperties","CSS","DOM","FBDesktopPlugin","debounce","JSLogger","OrderedFriendsList","PresencePrivacy","ScrollableArea","Style","Vector","ChatOrderedList","ChatTypeaheadBehavior","ChatTypeaheadCore","ChatTypeaheadDataSource","ChatTypeaheadRenderer","Typeahead"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('createArrayFrom'),i=b('AsyncRequest'),j=b('ChatConfig'),k=b('ChatOptions'),l=b('ChatHovercard'),m=b('ChatQuietLinks'),n=b('ChatSidebarSheet'),o=b('copyProperties'),p=b('CSS'),q=b('DOM'),r=b('FBDesktopPlugin'),s=b('debounce'),t=b('JSLogger'),u=b('OrderedFriendsList'),v=b('PresencePrivacy'),w=b('ScrollableArea'),x=b('Style'),y=b('Vector');b('ChatOrderedList');b('ChatTypeaheadBehavior');b('ChatTypeaheadCore');b('ChatTypeaheadDataSource');b('ChatTypeaheadRenderer');b('Typeahead');var z,aa=false,ba=false,ca=false,da=false,ea,fa,ga,ha,ia=null,ja=t.create('chat_sidebar'),ka=32;function la(){if(!ra.isVisible()&&da)return;ca=false;ia=null;p.hide(fa);p.removeClass(document.documentElement,'sidebarMode');ea.hide();ga.getCore().reset();ja.rate('sidebar_hide',da);ra.inform('sidebar/hide',ra);g.inform('sidebar/hide',ra);g.inform('reflow');}function ma(){var sa=ra.shouldShowSidebar();p.conditionClass(document.documentElement,'sidebarCapable',sa);if(ra.isEnabled()&&sa){x.set(fa,'height',ha.y+'px');na();var ta=ha.y;h(fa.childNodes).forEach(function(ua){if(ua!==z)ta-=y.getElementDimensions(ua).y;});x.set(z,'height',ta+'px');this._maxItems=Math.floor((ta-8)/ka);ea.setNumTopFriends(this._maxItems);ga.getData().setMaxResults(this._maxItems);ra.inform('sidebar/resized',ra);g.inform('sidebar/resized',ra);g.inform('reflow');}else la();if(!da){qa();da=true;}ia=null;}function na(){if(ra.isVisible())return;ca=true;ia=null;p.show(fa);p.addClass(document.documentElement,'sidebarMode');ea.show();ja.rate('sidebar_show',da);ra.inform('sidebar/show',ra);g.inform('sidebar/show',ra);}function oa(){k.setSetting('sidebar_mode',ra.isEnabled(),'sidebar');new i('/ajax/chat/settings.php').setHandler(bagofholding).setErrorHandler(bagofholding).setData({sidebar_mode:ra.isEnabled()}).setAllowCrossPageTransition(true).send();}function pa(){return u.getList().length<=j.get('sidebar.min_friends');}function qa(){var sa=true;if(!ra.isEnabled()){ja.log('state_not_enabled');sa=false;}if(!ra.isViewportCapable()){ja.log('state_not_shown_viewport');sa=false;}if(ba){ja.log('state_not_shown_hidden');sa=false;}if(pa()){ja.log('state_not_shown_num_friends');sa=false;}if(r.shouldSuppressSidebar()){ja.log('state_not_shown_fbdesktop');sa=false;}ja.log(sa?'state_shown':'state_not_shown');}var ra=o(new g(),{init:function(sa,ta,ua){ra.init=bagofholding;fa=sa;ea=ta;ga=ua;z=q.find(sa,'div.fbChatSidebarBody');if(j.get('chat_sidebar_hovercards'))new l(ta);var va=new n(sa);va.subscribe('updated',ma);ta.setScrollContainer(q.find(z,'div.uiScrollableAreaWrap'));ta.subscribe(['render','show','hide'],s(function(){var wa=ta.getRoot(),xa=w.getInstance(wa);xa&&xa.adjustGripper();}));m.silence(sa);Event.listen(window,'resize',ma);g.subscribe('chat/option-changed',function(wa,xa){if(xa.name=="sidebar_mode"){aa=!!k.getSetting('sidebar_mode');ma();}});ua.subscribe(['respond','reset'],function(wa,xa){if(ca)if(xa&&xa.value&&xa.value===ua.getCore().getValue()&&ua.getView().isVisible()){ea.hide();}else ea.show();});ua.getData().subscribe('beforeQuery',ma);g.subscribe('buddylist-nub/initialized',function(wa,xa){Event.listen(xa.getButton(),'click',function(event){ra.enable();return !ra.shouldShowSidebar();});});aa=!!k.getSetting('sidebar_mode');ja.log('sidebar_vis_init');v.subscribe('privacy-user-presence-changed',ma);ma();ra.inform('sidebar/initialized',ra,g.BEHAVIOR_PERSISTENT);g.inform('sidebar/initialized',ra,g.BEHAVIOR_PERSISTENT);},isInitialized:function(){return da;},disable:function(){if(!ra.isEnabled())return;aa=false;oa();la();},enable:function(){if(ra.isEnabled())return;aa=true;oa();ma();!function(){if(ra.isVisible())ga.getCore().getElement().focus();}.defer();},hide:function(){ba=true;la();},unhide:function(){ba=false;ma();},getBody:function(){return z;},getRoot:function(){return fa;},getVisibleWidth:function(){if(!ca||!fa)return 0;if(ia===null)ia=fa.offsetWidth;return ia;},isEnabled:function(){return aa;},isViewportCapable:function(){ha=y.getViewportDimensions();return ha.x>j.get('sidebar.minimum_width');},shouldShowSidebar:function(){return ra.isViewportCapable()&&!ba&&!pa()&&!r.shouldSuppressSidebar();},isVisible:function(){return ca;},resize:ma,toggle:function(){ra.isEnabled()?ra.disable():ra.enable();}});e.exports=ra;});
function ChatSidebarDropdown(){}copy_properties(ChatSidebarDropdown.prototype,{init:function(a){this._root=a;this._logger=JSLogger.create('blackbird');this._displayBrowserNotificationsIfNeeded();requireLazy(['ChatVisibility'],function(b){this._chatVisibility=b;Selector.listen(a,'select',this._onSelect.bind(this));Selector.listen(a,'toggle',this._onToggle.bind(this));}.bind(this));Arbiter.subscribe('chat/option-changed',this._onOptionChanged.bind(this));},changeSetting:function(a,b){if(this._pendingChange)return false;this._pendingChange=true;var c={};c[a]=b;chatOptions.setSetting(a,b,'sidebar_menu');new AsyncRequest('/ajax/chat/settings.php').setHandler(this._onChangeSettingResponse.bind(this,a,b)).setErrorHandler(this._onChangeSettingError.bind(this,a,b)).setFinallyHandler(this._onChangeFinally.bind(this)).setData(c).setAllowCrossPageTransition(true).send();},_displayBrowserNotificationsIfNeeded:function(){if(window.webkitNotifications){DOM.scry(document,'li.sidebar-browser-notif').forEach(CSS.show);if(window.webkitNotifications.checkPermission()!==0)DOM.scry(document,'li.sidebar-browser-notif').forEach(function(a){CSS.removeClass(a,'checked');});}},_conditionEnabled:function(a,b){var c=Selector.getOption(this._root,a);c&&Selector.setOptionEnabled(c,b);},_onChangeSettingResponse:function(a,b,c){requireLazy(['PresenceState'],function(d){d.doSync();});},_onChangeSettingError:function(a,b,c){chatOptions.setSetting(a,!b,'sidebar_menu_error');},_onChangeFinally:function(){this._pendingChange=false;},_onOptionChanged:function(a,b){var c=b.name,d=b.value;if(c==='sound'||c==='browser_notif'){var e=Selector.getOption(this._root,c);if(d!==Selector.isOptionSelected(e))Selector.setSelected(this._root,c,d);}},_onSelect:function(a){if(this._pendingChange)return false;var b=false,c=false,d=Selector.getOptionValue(a.option);switch(d){case 'sidebar':return this.toggleSidebar();case 'online':if(!this._chatVisibility.isOnline()){this._chatVisibility.goOnline();}else c=true;b=true;break;case 'offline':if(this._chatVisibility.isOnline()){this._chatVisibility.goOffline();}else c=true;b=true;break;case 'advanced_settings':Arbiter.inform('chat/advanced-settings-dialog-opened');b=true;break;}if(c){this._logger.error('sidebar_dropdown_visibility_error',{action:d});}else this._logger.log('sidebar_dropdown_set_visibility',{action:d});if(b){Selector.toggle(this._root);return false;}},_onToggle:function(a){if(this._pendingChange)return false;var b=Selector.getOptionValue(a.option),c=Selector.isOptionSelected(a.option);switch(b){case 'visibility':if(!this._chatVisibility){this._jslogger.error('on_toggle_visibility_undefined');return;}this._chatVisibility.toggleVisibility();this._logger.log('sidebar_dropdown_toggle_visibility',{available:c});break;case 'browser_notif':if(c&&window.webkitNotifications&&window.webkitNotifications.checkPermission()!==0){window.webkitNotifications.requestPermission(function(){this.changeSetting(b,c);}.bind(this));}else this.changeSetting(b,c);break;case 'sound':this.changeSetting(b,c);break;}Selector.toggle(this._root);},_onVisibilityChanged:function(){var a=this._chatVisibility.isOnline(),b=Selector.getOption(this._root,'visibility');if(a!==Selector.isOptionSelected(b))Selector.setSelected(this._root,'visibility',a);},toggleSidebar:function(){Chat.toggleSidebar();Selector.toggle(this._root);return false;}});
__d("ModuleDependencies",[],function(a,b,c,d,e,f){function g(i,j,k){var l=a.require.__debug.modules[k];if(j[k])return;j[k]=true;if(!l){i[k]=true;return;}if(!l.dependencies||!l.dependencies.length)return;l.dependencies.forEach(function(m){g(i,j,m);});}var h={getMissing:function(i){if(a.require.__debug){var j={};g(j,{},i);var k=Object.keys(j);k.sort();return k;}return null;}};e.exports=h;});
__d("legacy:ChatSidebar",["ModuleDependencies","JSLogger"],function(a,b,c,d){d(['ChatSidebar'],function(i){a.ChatSidebar=i;});var e=b('ModuleDependencies'),f=b('JSLogger'),g=f.create('chat_sidebar_load');function h(i){setTimeout(function(){if(!a.ChatSidebar){var j=e.getMissing('ChatSidebar');g.warn('require_'+i,{missing:j});}if(!a.ChatSidebar||!a.ChatSidebar.isInitialized())g.warn('init_'+i,{missing:j});},i);}h(5000);h(10000);h(15000);h(30000);h(60000);},3);
__d("BuddyListNub",["event-extensions","Arbiter","AvailableList","ChannelConnection","ChannelConstants","ChatConfig","ChatVisibility","Class","CSS","Dock","DOM","HTML","Keys","NubController","OrderedFriendsList","PresencePrivacy","Selector","Toggler","Vector","copyProperties","ge","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AvailableList'),i=b('ChannelConnection'),j=b('ChannelConstants'),k=b('ChatConfig'),l=b('ChatVisibility'),m=b('Class'),n=b('CSS'),o=b('Dock'),p=b('DOM'),q=b('HTML'),r=b('Keys'),s=b('NubController'),t=b('OrderedFriendsList'),u=b('PresencePrivacy'),v=b('Selector'),w=b('Toggler'),x=b('Vector'),y=b('copyProperties'),z=b('ge'),aa=b('tx');function ba(ca,da,ea){this.parent.construct(this);ca&&da&&ea&&this.init(ca,da,ea);}m.extend(ba,s);y(ba,{ITEM_HEIGHT:32,TYPEAHEAD_MIN_FRIENDS:10});y(ba.prototype,{init:function(ca,da,ea){this.parent.init(ca);this.root=ca;this.orderedList=da;this.typeahead=ea;this.button=p.find(ca,'a.fbNubButton');this.label=p.find(ca,'span.label');this.body=p.scry(ca,'div.fbNubFlyoutBody')[0];var fa=p.find(ca,'div.fbNubFlyoutTitlebar');w.createInstance(fa).setSticky(false);da.subscribe('render',this.flyoutContentChanged.bind(this));da.setScrollContainer(this.body);h.subscribe('buddylist/availability-changed',this._updateCount.bind(this));g.subscribe('chat/connect',this._handleConnect.bind(this));u.subscribe('privacy-user-presence-changed',this._handleVisibilityChange.bind(this));this.message=p.find(ca,'div.fbDockChatBuddyListNubMessage div.message');this.warningMsgText=null;this.warningMsgEventListener=null;this.showWarningTimeout=null;i.subscribe(i.CONNECTED,this._handleChannelConnected.bind(this));i.subscribe(i.SHUTDOWN,this._handleChannelShutdown.bind(this));i.subscribe(i.RECONNECTING,this._handleChannelReconnecting.bind(this));i.subscribe([i.MUTE_WARNING,i.UNMUTE_WARNING],this._updateView.bind(this));this.subscribe('show',this.onShow.bind(this));this.subscribe('hide',this.onHide.bind(this));this.subscribe('resize',this.onResize.bind(this));Event.listen(ca,'keydown',this._onKeyDown.bind(this));Event.listen(this.button,'click',this.onButtonClick.bind(this));ea.subscribe(['respond','reset'],function(ga,ha){if(this._isOpen){var ia=this.orderedList.isVisible();if(ha&&ha.value&&ha.value===ea.getCore().getValue()&&ea.getView().isVisible()){o.setUseMaxHeight(this.root,false);this.orderedList.hide();}else this._showBuddyList();if(ia!==this.orderedList.isVisible())this.flyoutContentChanged();}}.bind(this));g.subscribe('sidebar/show',this.hide.bind(this));this._orderedListCount=t.getList().length;g.inform('buddylist-nub/initialized',this,g.BEHAVIOR_PERSISTENT);this._handleVisibilityChange();},getButton:function(){return this.button;},getRoot:function(){return this.root;},_handleConnect:function(ca){this._updateView(true);},_getShutdownReason:function(ca){switch(ca){case j.HINT_AUTH:return "Istuntosi on vanhentunut. Kirjaudu sis\u00e4\u00e4n.";case j.HINT_CONN:return aa._("Facebookin {Chat} ei ole juuri nyt k\u00e4ytett\u00e4viss\u00e4.",{Chat:"Keskustelu"});case j.HINT_MAINT:return aa._("Facebookin {Chat} on parhaillaan poissa k\u00e4yt\u00f6st\u00e4 yll\u00e4pidon takia.",{Chat:"Keskustelu"});default:return aa._("Facebookin {Chat} ei ole juuri nyt k\u00e4ytett\u00e4viss\u00e4.",{Chat:"Keskustelu"});}},_getReconnectMsg:function(ca){var da;if(ca===null){da="Yhteytt\u00e4 keskusteluun ei voida muodostaa. Tarkista Internet-yhteys.";}else if(ca>k.get('warning_countdown_threshold_msec')){var ea=p.$N('a',{href:'#',className:'fbChatReconnectLink'},"Yrit\u00e4 uudelleen"),fa=p.$N('div',ea),ga=fa.innerHTML;da=q(aa._("Yhteytt\u00e4 keskusteluun ei voida muodostaa. {try-again-link}",{'try-again-link':ga}));}else if(ca>1000){da=aa._("Yhteytt\u00e4 keskusteluun ei voida muodostaa. Yritet\u00e4\u00e4n uudelleen {seconds} sekunnin kuluttua...",{seconds:Math.floor(ca/1000)});}else da="Yhteytt\u00e4 keskusteluun ei voida muodostaa. Yritet\u00e4\u00e4n uudelleen...";return da;},_resetShowWarningTimeout:function(){if(this.showWarningTimeout){clearTimeout(this.showWarningTimeout);this.showWarningTimeout=null;}},_handleChannelConnected:function(ca){this._resetShowWarningTimeout();if(this.orderedList.isVisible())l.goOnline();this.warningMsgText=null;this._updateView();},_handleChannelShutdown:function(ca,da){this._resetShowWarningTimeout();this.warningMsgText=this._getShutdownReason(da);this._updateView();},_handleChannelReconnecting:function(ca,da){this._resetShowWarningTimeout();this.warningMsgText=this._getReconnectMsg(da);if(da>1000){if(da>k.get('warning_countdown_threshold_msec')){if(this.warningMsgEventListener){this.warningMsgEventListener.remove();this.warningMsgEventListener=null;}this.warningMsgEventListener=Event.listen(this.message,'click',function(event){if(n.hasClass(event.getTarget(),'fbChatReconnectLink')){this._tryReconnect();event.kill();}}.bind(this));}this.showWarningTimeout=setTimeout(this._handleChannelReconnecting.bind(this,ca,da-1000),1000,false);}this._updateView();},_tryReconnect:function(){if(i.disconnected())i.reconnect();},_handleVisibilityChange:function(){this._updateView();if(!l.isOnline())this.hide();},_updateView:function(ca){var da=z('fbDockChat');n.conditionClass(da,'offline',!l.isOnline());n.conditionClass(da,'error',i.disconnected());if(i.disconnected())p.setContent(this.message,this.warningMsgText);if(!l.isOnline()){this._setLabel(aa._("{Chat} (poissa)",{Chat:"Keskustelu"}));}else if(i.disconnected()){this._setLabel(aa._("{Chat} (ei yhteytt\u00e4)",{Chat:"Keskustelu"}));}else{var ea=h.getOnlineCount();if(ea){var fa=aa._("{Chat} {number-available}",{Chat:"Keskustelu",'number-available':['<span class="count">','(<strong>',ea,'</strong>)','</span>'].join('')});this._setLabel(q(fa));}else this._setLabel("Keskustelu",ca);}},onButtonClick:function(){this._conditionallyShowTypeahead();if(n.shown(this.typeahead.getElement())){var ca=this.subscribe('show',function(){this.typeahead.getCore().getElement().focus();}.bind(this));this.unsubscribe.bind(this,ca).defer();}},onHide:function(){this._isOpen=false;if(this._buddyListRenderSubscription)this.orderedList.unsubscribe(this._buddyListRenderSubscription);this.orderedList.hide();this.typeahead.getCore().reset();},_onKeyDown:function(event){var ca=Event.getKeyCode(event);if(ca===r.ESC&&!n.hasClass(this.root,'menuOpened')){this.hide();return false;}},onResize:function(){var ca=x.getElementDimensions(this.body).y-5;this.orderedList.setNumTopFriends(Math.floor(ca/ba.ITEM_HEIGHT));},_showBuddyList:function(){this._buddylistRenderSubscription=this.orderedList.subscribe('render',o.setUseMaxHeight.bind(o,this.root,false));this.orderedList.show();},onShow:function(){this._isOpen=true;if(i.disconnected()){this._tryReconnect();this._showBuddyList();}else l.goOnline(this._showBuddyList.bind(this));},_setLabel:function(ca,da){var ea=this.label.cloneNode(true);p.setContent(ea,ca);p.replace(this.label,ea);this.label=ea;this.throbber&&n.conditionShow(this.throbber,!!da);},_conditionallyShowTypeahead:function(){n.conditionShow(this.typeahead.getElement(),this._orderedListCount>=ba.TYPEAHEAD_MIN_FRIENDS);},_updateCount:function(){this._updateView();this._conditionallyShowTypeahead();}});e.exports=ba;});
__d("TypingIndicator",["Arbiter","AsyncRequest","AvailableList","AvailableListConstants","ChannelManager","ChannelConnection","ChatConfig","ChatVisibility","copyProperties","Keys","ShortProfiles","TypingDetector","PresencePrivacy"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AvailableList'),j=b('AvailableListConstants'),k=b('ChannelManager'),l=b('ChannelConnection'),m=b('ChatConfig'),n=b('ChatVisibility'),o=b('copyProperties'),p=b('Keys'),q=b('ShortProfiles'),r=b('TypingDetector'),s=b('PresencePrivacy');function t(u,v,w,x){this.id=u;this.input=v;this.source=w;this.remoteState=r.INACTIVE;this.notifyTimer=null;x=x||{};this.notifyDelay=x.notifyDelay||this.notifyDelay;this._typingDetector=new r(v);this._typingDetector.init(x);this._typingDetector.subscribe('change',this._stateChange.bind(this));}o(t.prototype,{notifyDelay:1000,setIgnoreEnter:function(u){var v=u?[p.RETURN]:[];this._typingDetector.setIgnoreKeys(v);},resetState:function(){this.remoteState=t.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;},_stateChange:function(u,v){if(v!=r.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=this._notifyState.shield(this,v).defer(this.notifyDelay,false);}else this._notifyState(v,true);},_notifyState:function(u,v){var w=this.id,x=q.getNow(w),y=n.isOnline()&&x&&x.type=="friend"&&s.allows(w);if(y&&u!=this.remoteState){this.remoteState=u;if(l.disconnected())return;var z={typ:u,to:w,source:this.source};new h().setHandler(this._onTypResponse.bind(this,w)).setErrorHandler(bagofholding).setData(z).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous',!v).send();}},_onTypResponse:function(u,v){var w=v.getPayload()||{};if(w.offline)i.set(u,j.OFFLINE,'typing_response');}});e.exports=t;});
__d("VideoCallingTour",["event-extensions","Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Chat'),j=b('ChatSidebar'),k=b('ChatVisibility'),l=b('CSS'),m=b('DOM'),n=b('PresencePrivacy'),o=b('Run'),p=b('Toggler'),q=b('Vector'),r=b('copyProperties'),s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=y.defer();}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=y.defer();}));});x.inform('videocallingtour/start');}});e.exports=x;});
__d("ChatOnlineFriends",["AvailableList","AvailableListConstants","ChannelConnection","Chat","ChatConfig","ChatVisibility","Class","CSS","DataStore","DOM","OrderedFriendsList","Parent","Run","ShortProfiles","TooltipLink","XHPTemplate","copyProperties","createObjectFrom","ChatTypeaheadBehavior","ChatTypeaheadCore","ChatTypeaheadDataSource","ChatTypeaheadRenderer","Typeahead"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('AvailableListConstants'),i=b('ChannelConnection'),j=b('Chat'),k=b('ChatConfig'),l=b('ChatVisibility'),m=b('Class'),n=b('CSS'),o=b('DataStore'),p=b('DOM'),q=b('OrderedFriendsList'),r=b('Parent'),s=b('Run'),t=b('ShortProfiles'),u=b('TooltipLink'),v=b('XHPTemplate'),w=b('copyProperties'),x=b('createObjectFrom');b('ChatTypeaheadBehavior');b('ChatTypeaheadCore');b('ChatTypeaheadDataSource');b('ChatTypeaheadRenderer');b('Typeahead');function y(aa){switch(aa){case h.OFFLINE:return 'chatOffline';case h.IDLE:return 'chatIdle';case h.ACTIVE:return 'chatOnline';case h.MOBILE:return 'chatMobile';}}var z=function(aa,ba,ca,da,ea){if(aa&&ba&&ca&&da&&ea)this.init(aa,ba,ca,da,ea);};w(z.prototype,{chatFriends:{},chatStatuses:['chatOnline','chatIdle','chatMobile','chatOffline'],_availableListSubscribe:function(event,aa){this._arbiterTokens.push(g.subscribe(event,aa));},_channelSubscribe:function(event,aa){this._arbiterTokens.push(i.subscribe(event,aa));},onunload:function(){this._arbiterTokens.forEach(function(aa){aa.unsubscribe();});},_setStatus:function(aa,ba){if(n.hasClass(aa,ba))return;this.chatStatuses.forEach(function(ca){n.conditionClass(aa,ca,ca==ba);});},initTypeahead:function(aa,ba){aa.subscribe('reset',function(){n.show(ba);});aa.subscribe('query',function(ca,da){if(da.value){n.hide(ba);}else n.show(ba);});},init:function(aa,ba,ca,da,ea){this.maxElements=aa;this._faceTmpl=ea;this._arbiterTokens=[];this._root=ca;s.onLeave(this.onunload.bind(this));this.initTypeahead(ba,p.find(ca,'div.fbFriendsOnlineFacepile'));this._facepile=da.firstChild;this._faceFutures&&this._hideAllFaces();this._faceFutures=[];this._orderedFriends=q.getList();this._hashedFriends=x(this._orderedFriends);this._availableListSubscribe(h.ON_AVAILABILITY_CHANGED,this.update.shield(this));this.update.bind(this).defer();this._channelSubscribe(i.CONNECTED,this.update.shield(this));this._channelSubscribe(i.RECONNECTING,this._handleChannelReconnecting.bind(this));this._channelSubscribe(i.SHUTDOWN,this._handleChannelShutdown.bind(this));this._channelSubscribe([i.MUTE_WARNING,i.UNMUTE_WARNING],this.update.shield(this));Event.listen(da,'click',this.clickHandler.bind(this));Event.listen(p.find(ca,'.fbChatGoOnlineLink'),'click',function(event){if(i.disconnected()){j.openBuddyList();}else l.goOnline(j.openBuddyList);event.kill();}.bind(this));Event.listen(p.find(ca,'.fbChatReconnectLink'),'click',function(event){if(i.disconnected())i.reconnect();event.kill();}.bind(this));g.update();},_handleChannelReconnecting:function(aa,ba){var ca=(ba<1000),da=p.find(this._root,'.fbChatReconnectLink'),ea=p.find(this._root,'.fbChatReconnecting');n.conditionShow(da,!ca);n.conditionShow(ea,ca);},_handleChannelShutdown:function(){var aa=p.find(this._root,'.fbChatReconnectLink'),ba=p.find(this._root,'.fbChatReconnecting');n.hide(aa);n.hide(ba);},update:function(){var aa=i.disconnected(),ba=l.isOnline();n.conditionClass(this._root,'disconnected',aa);var ca=p.find(this._root,'.fbFriendsOnlineFacepile');n.conditionShow(ca,ba);if(ba)this._updateFacepile(aa);var da=p.find(this._root,'.typeaheadContainer');n.conditionShow(da,ba);if(k.get('chat_upgrade_link')){var ea=p.find(this._root,'.chatUpgradeLink');n.conditionShow(ea,ba);}var fa=p.find(this._root,'.chatGoOnlineLink');n.conditionShow(fa,!ba);var ga=p.find(this._root,'.chatReconnectLink');n.conditionShow(ga,ba&&aa);},_updateFacepile:function(aa){g.getAvailableIDs().forEach(function(ha){if(!this._hashedFriends[ha]){this._orderedFriends.push(ha);this._hashedFriends[ha]=true;}}.bind(this));var ba=0;for(var ca=0;ca<this._orderedFriends.length;ca++){var da=this._orderedFriends[ca],ea=g.get(da),fa=this._faceFutures[ca],ga=(aa||ea!==h.OFFLINE)&&(ba<this.maxElements);if(ga){if(!fa){fa=this._makeFace(ca);this._faceFutures[ca]=fa;}ba++;}this._updateFace(fa,ga,y(ea));}},_updateFace:function(aa,ba,ca){aa&&aa(function(da){this._setStatus(da,ca);n.conditionShow(da,ba);}.bind(this));},_makeFace:function(aa){var ba=null,ca=null,da=this._orderedFriends[aa];t.get(da,function(ea){ca=this._faceTmpl.render();o.set(ca,'friendID',da);var fa=v.getNode(ca,'img'),ga=fa.cloneNode(false);ga.setAttribute('src',ea.thumbSrc);p.replace(fa,ga);var ha=v.getNode(ca,'anchor');u.setTooltipText(ha,ea.name);ba&&ba(ca);var ia=false;for(var ja=aa+1;ja<this._orderedFriends.length&&!ia;ja++){var ka=this._faceFutures[ja],la=ka&&ka();if(la){this._facepile.insertBefore(ca,la);ia=true;}}if(!ia)this._facepile.appendChild(ca);}.bind(this));return function ea(fa){if(fa)if(ca){fa(ca);}else ba=fa;return ca;};},clickHandler:function(event){var aa=event.getTarget(),ba=r.byClass(aa,'uiFacepileItem');if(ba){var ca=o.get(ba,'friendID');if(ca&&l.isOnline()){j.openTab(ca,null,'friend','online_friends');return false;}}},_hideAllFaces:function(){this._faceFutures.forEach(function(aa){aa&&aa(function(ba){p.remove(ba);});});}});e.exports=z;});
__d("legacy:chat-friends-online",["ChatOnlineFriends"],function(a,b,c,d){b('ChatOnlineFriends');},3);