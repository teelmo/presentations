/*1337674628,169775812*/

if (window.CavalryLogger) { CavalryLogger.start_js(["iyFj7"]); }

function UIServerFriendsSelect(){}copy_properties(UIServerFriendsSelect.prototype,{focusTypeahead:function(a){this._form=ge(a);if(this._form){Form.focusFirst.bind(this,this._form).defer();}else{dialog=ge('platform_dialog_content');typeahead=DOM.scry(dialog,'.uiTypeahead');if(typeahead.length==1){var b=DOM.find(typeahead[0],'.inputtext');(function(c){c.focus();}).bind(this,b).defer();}}},replaceEmptyRequestMessage:function(a,b){Event.listen(a,'blur',function(c){txt_field=ge('requestMessageTextField');if(Input.isEmpty(txt_field))Input.setValue(txt_field,b);});},setReferrer:function(a,b){a.id=b;},setSuccessState:function(a,b){ref=ge(a);if(ref)DOM.replace(ref,b);}});
__d("legacy:ProfileBrowserSelector",["ProfileBrowserSelector"],function(a,b,c,d){a.ProfileBrowserSelector=b('ProfileBrowserSelector');},3);
__d("ProfileChooser",["AsyncRequest","AsyncResponse","Class","CSS","DOM","Input","ProfileBrowser","copyProperties","createObjectFrom","getObjectValues"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('AsyncResponse'),i=b('Class'),j=b('CSS'),k=b('DOM'),l=b('Input'),m=b('ProfileBrowser'),n=b('copyProperties'),o=b('createObjectFrom'),p=b('getObjectValues');function q(){this.parent.construct(this);this.checkedItems={};this.cache={};this.suggested={};this.activeCache=null;this.index=0;this._bootstrapped=false;this._pendingLists=0;}i.extend(q,m);n(q.prototype,{VALUE_DEFAULT:'default',VALUE_SELECTED:'selected',VALUE_DISABLED:'disabled',NUM_PER_PAGE:50,preloadCache:function(r,s){this.suggested=s;this.cache=r;for(var t in this.cache)this.sortSuggested(t);},subscribeListView:function(){this.listView.subscribe('scrollTrigger',function(){if(this.typeahead.getCore().getValue())return;var r=this.index,s=r+this.NUM_PER_PAGE,t=this.cache[this.activeCache].slice(r,s);if(t.length){this.index=s;this.appendToView(t);this.listView.resetScroll();}}.bind(this));this.listView.subscribe('clickedCheckable',function(r,s){var t=j.hasClass(s.item,'selectedCheckable'),u=k.find(s.item,'.checkbox'),v=this.listView.getRoot();if(!t&&j.hasClass(v,'limitReached')){u.checked=false;return;}var w=u.value;this.listView.toggleCheckableItem(s.item,!t);this.setUidValue(w,!t);if(!t){this.appendToCache([w],this.VALUE_SELECTED);}else this.removeFromCache([w],this.VALUE_SELECTED);}.bind(this));},setUidValue:function(r,s){this.setItemValue(r,s);this.typeahead.getCore().hiddenInput.value=JSON.stringify(this.checkedItems);this.updateCheckableCount();var t=this.typeahead.getData().getEntry(r);this.inform('clickedCheckable',{uid:r,entry:t,new_value:s});},subscribeSelector:function(){this.selector.subscribe('changeListEndpoint',function(r,s){this._currentValue=s.value;s.anchor.removeAttribute('data-listendpoint');this.resetTypeahead(s.showTypeahead,s.value);var t=this.queryListEndpoint.bind(this,s.endpoint,s.value);this._pendingLists++;if(this._bootstrapped){t();}else var u=this.typeahead.getData(),v=u.subscribe('bootstrap',function(w,x){if(x.bootstrapping===false){u.unsubscribe(v);t();}});}.bind(this));this.selector.subscribe('changeValue',function(r,s){this._currentValue=s.value;this.resetTypeahead(s.showTypeahead,s.value);if(s.value==this.VALUE_SELECTED){var t=[];for(var u in this.checkedItems)this.checkedItems[u]&&t.push(u);this.cache[s.value]=this.filterInvalidEntries(t);}this.resetView(s.value);}.bind(this));},subscribeTypeahead:function(){var r=this.typeahead.getData();this.typeahead.subscribe('loading',function(s,t){j.conditionClass(this.listView.getRoot(),'queryActive',t.loading);}.bind(this));r.subscribe('preload',function(s,t){t.data_length&&this.listView.swapList(this.typeahead.getView().element);}.bind(this));r.subscribe('bootstrap',function(s,t){if(t.bootstrapping){this.listView.setLoadingState(true);this.listView.swapList(this.typeahead.getView().element);return;}this._bootstrapped=true;this.listView.setLoadingState(this._pendingLists>0);}.bind(this));r.subscribe('fillCache',function(s,t){this.cache[this.VALUE_DEFAULT]=t.alluids;this.sortSuggested(this.VALUE_DEFAULT);this.cache[this.VALUE_DISABLED]=this.filterInvalidEntries(Object.keys(t.disabled));this.cache[this.VALUE_SELECTED]=this.filterInvalidEntries(Object.keys(t.selected));var u=this.VALUE_DEFAULT;if(this.selector){var v=this.selector.getSelectedAnchor();u=this.selector.getSelectedValue();this._currentValue=u;this.typeahead.getView().setIsViewingSelectedItems(u==this.VALUE_SELECTED);if(this.cache[u]){this.resetView(u);}else{var w=v.getAttribute('data-listendpoint');if(w){this._pendingLists++;this.queryListEndpoint(w,u);v.removeAttribute('data-listendpoint');}}}this.checkedItems=t.selected;this.typeahead.getCore().hiddenInput.value=JSON.stringify(this.checkedItems);this.activeCache=u;this.updateCheckableCount();this.inform('bootstrapped');}.bind(this));this.typeahead.subscribe('render',function(s,t){if(!this.typeahead.getCore().getValue()){this.listView.resetScroll();this.index=t.length;}}.bind(this));this.typeahead.subscribe('reset',function(){this.resetView(this.activeCache);}.bind(this));},queryListEndpoint:function(r,s){this.listView.setLoadingState(true);var t=this.typeahead.getData();new g(r).setHandler(function(u){var v=u.getPayload();if(v.additional_datasource_entries)t.addEntries(p(v.additional_datasource_entries));this.cache[s]=this.filterInvalidEntries(v.ids);this.suggested[s]=v.suggested;this.sortSuggested(s);}.bind(this)).setErrorHandler(function(u){this.cache[s]=[];this.suggested[s]=[];h.defaultErrorHandler(u);}.bind(this)).setFinallyHandler(function(){this.resetView(this._currentValue);this._pendingLists--;this.listView.setLoadingState(this._pendingLists>0);}.bind(this)).send();},filterInvalidEntries:function(r){var s=this.typeahead.getData();return r.filter(function(t){return !!s.getEntry(t);});},resetTypeahead:function(r,s){j.conditionShow(this.typeahead.getElement(),r);var t=this.typeahead.getCore();l.reset(t.getElement());r&&t.getElement().focus();t.hiddenInput.value=JSON.stringify(this.checkedItems);if(s==this.VALUE_SELECTED){this.typeahead.getView().setIsViewingSelectedItems(true);}else this.typeahead.getView().setIsViewingSelectedItems(false);},sortSuggested:function(r){var s=this.suggested[r];if(!s)return;var t=this.cache[r],u=o(t),v=s.filter(function(w){if(w in u){t.splice(t.indexOf(w),1);return true;}return false;});this.cache[r]=v.concat(t);},resetView:function(r){this.activeCache=r||this.activeCache;var s=this.typeahead.getData(),t=this.cache[this.activeCache];s.setSuggestedUids(this.suggested[r]||[]);var u,v;if(r===this.VALUE_SELECTED)t=t.sort(function(w,x){u=s.getEntry(w);v=s.getEntry(x);if(!u||!v)return 0;return u.index-v.index;});s.setPrimaryUids(t);s.respond('',t,true);},appendToView:function(r){var s=this.typeahead.getData().buildData(r);this.typeahead.getView().appendResults(s);},appendToCache:function(r,s){var t=this.cache[s];for(var u=0;u<r.length;u++){var v=r[u];t.contains(v)||t.push(v);}},removeFromCache:function(r,s){var t=this.cache[s],u;for(var v=0;v<r.length;v++){u=t.indexOf(r[v]);if(u!==-1)t.splice(u,1);}},getCheckedCount:function(){var r=0;for(var s in this.checkedItems)if(this.checkedItems[s])r++;return r;},updateCheckableCount:function(){var r=this.listView.getRoot(),s=this.getCheckedCount();j.conditionClass(r,'limitReached',s>=this.getSelectionLimit());this.inform('updateCheckableCount',{listview:r.id,count:s});},setItemValue:function(r,s){var t=this.typeahead.getData().getEntry(r);if(t){t.selected=s;this.checkedItems[r]=s?1:0;}},addExclusion:function(r){var s=this.typeahead.getData().getExclusions();s.push(r);this.typeahead.getData().setExclusions(s);},removeEntry:function(r){this.setUidValue(r,false);this.addExclusion(r);for(var s in this.cache){var t=this.cache[s];this.cache[s]=t.filter(function(u){return (u!=r);});}}});e.exports=q;});
__d("legacy:ProfileChooser",["ProfileChooser"],function(a,b,c,d){a.ProfileChooser=b('ProfileChooser');},3);
function ProfileChooserSelector(){this.parent.construct(this);}Class.extend(ProfileChooserSelector,'ProfileBrowserSelector');copy_properties(ProfileChooserSelector.prototype,{handle:function(a){var b=DOM.find(a.option,'a'),c=b.getAttribute('data-listendpoint'),d=Selector.getOptionValue(a.option),e=b.getAttribute('data-typeahead');if(c){this.inform('changeListEndpoint',{anchor:b,endpoint:c,value:d,showTypeahead:e});return;}this.inform('changeValue',{value:d,showTypeahead:e});},initShowMoreItem:function(a,b){var c=b.map($);Event.listen(a,'click',function(){c.forEach(CSS.show);DOM.remove(a);return false;});}});
__d("ProfileChooserDataSource",["array-extensions","Class","DataSource","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){b('array-extensions');var g=b('Class'),h=b('DataSource'),i=b('copyProperties'),j=b('createObjectFrom');function k(l,m,n){this.parent.construct(this,l);this.preloadData=l.preloadData||[];this.selectedEntries=m||{};this.disabledEntries=n||{};this.suggestedUids={};this.primaryUids=[];this.exclusionsObj=j(this.getExclusions());}g.extend(k,h);i(k.prototype,{dirty:function(){this.parent.dirty();this._preloaded=false;},bootstrap:function(){if(this._bootstrapped)return;this.preload();if(!this.bootstrapEndpoint){this._bootstrapped=true;return;}this.fetch(this.bootstrapEndpoint,this.bootstrapData,{value:'',token:this.token});this._bootstrapped=true;this._bootstrapping=true;this.inform('bootstrap',{bootstrapping:true});},preload:function(){if(this._preloaded)return;this.preloadData.length&&this.addEntries(this.preloadData);this.inform('preload',{data_length:this.preloadData.length});this._preloaded=true;},processEntries:function(l,m){var n=this.parent.processEntries(l,m);n=this.removeExclusions(n);n.forEach(function(o){var p=this.getEntry(o);p.selected=o in this.selectedEntries;p.disabled=o in this.disabledEntries;},this);if(!m)this.setPrimaryUids(n);return n;},setPrimaryUids:function(l){this.primaryUids=l;var m=this.getAllEntries();for(var n in m)m[n].primary=false;l.forEach(function(o){this.getEntry(o).primary=true;},this);return this;},buildUids:function(l,m,n){if(!l&&this.primaryUids)return this.primaryUids;return this.parent.buildUids(l,m,n);},buildData:function(l){var m=this.parent.buildData(l),n=this.suggestedUids,o=[];m.forEach(function(p){if(p){o.push(p);p.suggested=(p.uid in n);}});return o;},removeExclusions:function(l){return l.filter(function(m){return !(m in this.exclusionsObj);}.bind(this));},setSuggestedUids:function(l){this.suggestedUids=j(l);},fillCache:function(l){l=this.removeExclusions(l);this.parent.fillCache(l);this.inform('fillCache',{alluids:l,selected:this.selectedEntries,disabled:this.disabledEntries});}});e.exports=k;});
__d("ProfileChooserTypeaheadCore",["Class","TypeaheadCore","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('TypeaheadCore'),i=b('copyProperties');function j(k){this.parent.construct(this,k);}g.extend(j,h);i(j.prototype,{keepFocused:false,initToggle:bagofholding,initView:bagofholding,select:bagofholding,unselect:bagofholding,keyup:function(){this.checkValue();}});e.exports=j;});
__d("ProfileChooserTypeaheadView",["Class","copyProperties","CSS","DOM","StringEscape","tx","TypeaheadView"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('StringEscape'),l=b('tx'),m=b('TypeaheadView');function n(o,p){this.parent.construct(this,o,p);}g.extend(n,m);h(n.prototype,{render:function(o,p,q){var r=this.results[this.index],s=this.autoSelect?0:-1,t=[],u=[],v=[];p.forEach(function(z){if(z.suggested){t.push(z);}else if(z.primary){u.push(z);}else v.push(z);});this.userIsSearching=!!o;var w;if(!p.length){w=this.buildNullstate(o);}else w=this.buildMarkup(o,t,u,v);this.results=p;i.conditionClass(this.element,'hideSummary',!o);j.setContent(this.element,w);this.items=this.getItems();if(r&&q)for(var x=0,y=p.length;x<y;++x)if(r.uid==p[x].uid){s=x;break;}this.highlight(s,false);this.inform('render',p);},buildNullstate:function(o){return j.create('div',{className:'nullstate'},[j.create('span',{className:'nothingFound'},o?l._("Ei tuloksia haulle \"{value}\"",{value:o}):"Ei tuloksia"),j.create('div',{className:'searching'},[j.create('div',null,"Etsii..."),j.create('div',{className:'queryThrobber'})])]);},buildMarkup:function(o,p,q,r){var s=[];if(this.userIsSearching){var t=this.getIsViewingSelectedItems()?q.length:(p.length+q.length+r.length),u;if(t===0){u=l._("Ei tuloksia haulla {search}.",{search:o});}else if(t==1){u=l._("1 tulos haulle: {search}",{search:o});}else u=l._("{count} tulosta haulle: {search}",{count:t,search:o});s.push(j.create('div',{className:'ptm pbs phs mhs'},[u]));}var v=[];if(p.length){v.push(this.buildDivider("Ehdotettu"));v.push(this.buildSection(p));}if(q.length){if(p.length||(o&&!this.getIsViewingSelectedItems())){var w=this.userIsSearching?"Parhaat tulokset":"Lis\u00e4\u00e4 tuloksia";v.push(this.buildDivider(w));}var x=this.buildSection(q);v.push(x);}if(r.length&&!this.getIsViewingSelectedItems()){var y=q.length?"Lis\u00e4\u00e4 tuloksia":"Parhaat tulokset";v.push(this.buildDivider(y),this.buildSection(r));}s.push(j.create('div',{className:'fbProfileBrowserListContainer'},v));return s;},buildSection:function(o){if(!o.length)return null;return j.create('div',{className:'listSection clearfix'},this.buildResults(o));},buildDivider:function(o){return j.create('div',{className:'suggestedDivider clearfix mts'},j.create('span',{className:'fss fcg fwb phs dividerText'},o));},renderer:function(o,p){if(!o)return null;var q=null;if(this._shouldShowPresence())q=this.renderPresence(o);var r=j.create('li',{className:'multiColumnCheckable checkableListItem'},[this.renderInput(o),j.create('a',{className:'anchor',href:'#',tabIndex:-1},[j.create('div',{className:'uiImageBlock clearfix'},[this.renderImageBlock(o),j.create('div',{className:'content uiImageBlockContent'},[j.create('div',{className:'uiInlineBlock uiInlineBlockMiddle spacer'}),j.create('div',{className:'uiInlineBlock uiInlineBlockMiddle'},this.renderTextBlock(o)),q])])])]);i.conditionClass(r,'disabledCheckable',o.disabled);i.conditionClass(r,'selectedCheckable',o.selected);i.conditionClass(r,'presenceIncluded',this._shouldShowPresence());return r;},renderInput:function(o){var p=j.create('input',{type:'checkbox',className:'checkbox',name:'checkableitems[]',value:k.htmlSpecialChars(o.uid),checked:!!o.selected,disabled:!!o.disabled});return p;},_shouldShowPresence:function(){return !!(this.showpresence&&a.AvailableList&&a.AvailableListConstants);},renderPresence:function(o){if(!this._shouldShowPresence())return null;var p=j.create('img',{className:'presenceImg rfloat',src:'/images/spacer.gif'}),q=a.AvailableList.get(o.uid);if(q==a.AvailableListConstants.ACTIVE||q==a.AvailableListConstants.IDLE){i.addClass(p,'active');}else if(q==a.AvailableListConstants.MOBILE)i.addClass(p,'mobile');return p;},renderImageBlock:function(o){var p=null;if(o.photo){p=j.create('img',{src:o.photo,className:'photo uiImageBlockImage img lfloat'});}else if(o.photo_css)p=j.create('span',{},[j.create('i',{className:'img photo',style:{cssText:o.photo_css}})]);return p;},renderTextBlock:function(o){var p=j.create('div',{className:'fcb fwb text'},[o.text]),q=j.create('div',{className:'fcg text subtitle'},[o.suggested?"Ehdotettu":o.category||'']);if(o.text.length>20)i.addClass(p,'long');return [p,q];},highlight:function(o,p){if(o>this.items.length-1){o=-1;}else if(o<-1)o=this.items.length-1;if(o>=0&&this.results[o]&&!this.results[o].disabled){this.selected=this.items[o];}else this.selected=null;this.index=o;if(p!==false)this.inform('highlight',{index:o,selected:this.results[o]});},appendResults:function(o){var p=j.scry(this.element,'.listSection'),q=p[p.length-1];j.appendContent(q,this.buildResults(o));}});e.exports=n;});