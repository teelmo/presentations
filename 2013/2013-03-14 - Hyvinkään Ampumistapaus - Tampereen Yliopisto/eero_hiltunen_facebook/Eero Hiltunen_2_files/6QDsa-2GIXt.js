/*1337567303,169776066*/

if (window.CavalryLogger) { CavalryLogger.start_js(["9Qfg6"]); }

__d("legacy:HoverFlyout",["HoverFlyout"],function(a,b,c,d){a.HoverFlyout=b('HoverFlyout');},3);
var SubscriptionFlyoutController=(function(){var a=null,b,c,d;function e(){var h=EditSubscriptions.getSubscriptions(d);if(h){var i=h.custom_categories;if(i&&i.length===0)Arbiter.inform('UnfollowUser',{profile_id:d,from_hide_flyout:true});}}function f(h,i){d=DataStore.get(i,'profile_id');var j=DataStore.get(i,'loc');EditSubscriptions.init(c,d,j);CSS.addClass(i,'selected');CSS.addClass(i,'uiButtonHover');if(DataStore.get(i,'onclose'))clearTimeout(DataStore.remove(i,'onclosetimeout'));}function g(h,i){d=null;CSS.removeClass(i,'selected');CSS.removeClass(i,'uiButtonHover');if(DataStore.get(i,'onclose'))DataStore.set(i,'onclosetimeout',function(){var j=DataStore.remove(i,'onclose');j&&j();}.defer(1500));}return {init:function(h,i){SubscriptionFlyoutController.init=bagofholding;b=h;c=i;a=new HoverFlyout();a.init(h);a.setShowDelay(100).setHideDelay(150);a.subscribe('show',f);a.subscribe('hide',g);Arbiter.subscribe(['UnfollowUser','UnfollowingUser'],function(j,k){if(!k.from_hide_flyout&&k.profile_id==d){if(window.Hovercard&&Hovercard.contains&&b)if(Hovercard.contains(b.getContext()))Hovercard.hide();a.hideFlyout(true);}});},initNode:function(h,i,j){DataStore.set(h,'profile_id',i);DataStore.set(h,'loc',j);a.initNode(h);},setActiveNode:function(h){a.setActiveNode(h);},show:function(h){a.showFlyout(h,true);},setCloseListener:function(h,i){if(a.getActiveNode()!==h){i();}else DataStore.set(h,'onclose',i);}};})();
var FollowButton=window.FollowButton||(function(){var a=14;function b(e,f,g){CSS.conditionShow(f,g);CSS.conditionShow(e,!g);}function c(e,f){if(f&&CSS.hasClass(e,'enableFriendListFlyout')){FriendListFlyoutController.show(e);}else FriendListFlyoutController.hide();}function d(e,f,g){var h=DOM.scry(e,'.lowIcon')[0],i=DOM.scry(e,'.medIcon')[0],j=DOM.scry(e,'.highIcon')[0];if(!h||!i||!j)return;Arbiter.subscribe('SubscriptionLevelUpdated',function(k,l){if(g===l.profile_id)switch(l.level){case SubscriptionLevels.ALL:Button.setIcon(f,j);break;case SubscriptionLevels.DEFAULT:Button.setIcon(f,i);break;case SubscriptionLevels.TOP:Button.setIcon(f,h);break;}});}return {init:function(e,f,g,h,i,j){if(!CSS.hasClass(g,'enableFriendListFlyout'))SubscriptionFlyoutController.initNode(g,h,i);if(i==a&&CSS.shown(g))SubscriptionFlyoutController.show(g);Event.listen(f,'click',function(){b(f,g,true);SubscriptionFlyoutController.setActiveNode(g);var m=new URI(f.getAttribute('ajaxify')),n={profile_id:h,location:i,source:'follow-button',subscribed_button_id:g.id,xids:m.getQueryData().xids};new AsyncRequest().setURI(j).setData(n).setRelativeTo(g).send();});e&&d(e,g,h);Arbiter.subscribe(['FollowUser','FollowingUser','UnfollowUser','UnfollowingUser'],function(m,n){if(n.profile_id==h)b(f,g,m=='FollowUser'||m=='FollowingUser');c(g,m=='FollowUser');});var k=false;Arbiter.subscribe('UnfollowingUser',function(m,n){if(n.profile_id==h){k=CSS.shown(g);k&&b(f,g,false);}});Arbiter.subscribe('UnfollowUserFail',function(m,n){if(n.profile_id==h&&k)b(f,g,true);});Arbiter.subscribe('FollowUserFail',function(m,n){if(n.profile_id==h&&k)b(f,g,false);});var l=false;Arbiter.subscribe(['FriendRequest/sending','FriendRequest/confirming'],function(m,n){if(n.uid==h){l=CSS.shown(f);l&&b(f,g,true);}});Arbiter.subscribe(['FriendRequest/sendFail','FriendRequest/confirmFail'],function(m,n){if(n.uid==h&&l)b(f,g,false);});Arbiter.subscribe('FriendRequest/unfriend',function(m,n){(n.uid==h)&&b(f,g,false);});}};})();
__d("IframeShim",["DOM","Rect","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Rect'),i=b('copyProperties');function j(k){this._element=k;this._shim=null;}i(j.prototype,{show:function(){this._shim||this._buildShim();return this._updatePosition();},hide:function(){if(this._shim){g.remove(this._shim);this._shim=null;}return this;},_buildShim:function(){this._shim=g.create('iframe',{frameBorder:0,scrolling:'no',src:'about:blank',style:{position:'absolute',filter:'progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)'}});g.prependContent(g.getDocumentBodyElement(),this._shim);},_updatePosition:function(){var k=new h(this._element);k.getPositionVector().setElementPosition(this._shim);k.getDimensionVector().setElementDimensions(this._shim);}});e.exports=j;});
__d("TypeaheadFrameShim",["IframeShim","copyProperties"],function(a,b,c,d,e,f){var g=b('IframeShim'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){this._subscription=this._typeahead.subscribe('init',function(){var j=new g(this._typeahead.getView().getElement());this._typeahead.subscribe(['reset','blur'],j.hide.bind(j));this._typeahead.subscribe(['render','focus'],j.show.bind(j));}.bind(this));},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=i;});
__d("legacy:IE6HacksTypeaheadBehavior",["TypeaheadFrameShim"],function(a,b,c,d){var e=b('TypeaheadFrameShim');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.ie6Hacks=function(f){f.enableBehavior(e);};},3);
function search_selector_onfound(a){var b;if(!(b=ge('n')))return;b.value=a?a.i:-1;}function search_result_selector_onsubmit(a){$('search').init.value=ge('filter_init')?$('filter_init').value:'';$('search').sf.value=ge('filter_sf')?$('filter_sf').value:'';$('search').submit();this.hide();this.advance_focus();}function search_logged_ajax(a){new AsyncRequest().setURI('/ajax/search_log.php').setMethod('POST').setData(a).send();}var SearchDashboardKeyboardHandler=function(){return {right_arrow_key_handler:function(event,a){if(event.ctrlKey){if($('search_dashboard_next_session').href)goURI($('search_dashboard_next_session').href);}else if($('search_dashboard_next_query').href)goURI($('search_dashboard_next_query').href);return false;},left_arrow_key_handler:function(event,a){if(event.ctrlKey){if($('search_dashboard_prev_session').href)goURI($('search_dashboard_prev_session').href);}else if($('search_dashboard_prev_query').href)goURI($('search_dashboard_prev_query').href);return false;},right_arrow_key_filter:function(event,a){return true;}};}();
var SpellCheck={logHandler:function(event){var a=Parent.byClass(event.getTarget(),'search_spell_suggestion');if(a)search_logged_ajax(JSON.parse(DataStore.get(a,'loginfo')));}};
function SearchAdvancedFilters(a,b,c){this._selectors=a;this._fieldsets=b;this._submit_on_remove=c;}copy_properties(SearchAdvancedFilters.prototype,{_form:null,init:function(){var a={},b=this._selectors,c=this._fieldsets,d=[],e;for(var f in b){var g=DOM.find($(f),'.fbSearchAdvancedFiltersRemoveButton');a[f]={remove_button:g};e=b[f];Selector.getOptions(e).forEach(function(l){var m=c[Selector.getOptionValue(l)];m.options.push(l);if(Selector.isOptionSelected(l))a[f].fieldset=m;});Selector.listen(e,'change',this.onSelect.bind(this));Selector.setEnabled(e,true);}var h=Parent.byTag(e,'table'),i=DOM.find(h,'.fbSearchAdvancedFiltersAddButton'),j=this._visible_table=DOM.find(h,'tbody.fbSearchAdvancedFiltersVisible');this._hidden_table=DOM.find(h,'tbody.fbSearchAdvancedFiltersHidden');for(var k in c)c[k].id=k;$A(j.childNodes).forEach(function(l){a[l.id].fieldset.disableOptions();});this._row_info=a;this._add_button_container=Parent.byTag(i,'tr');if(this._submit_on_remove)this._form=Parent.byTag(j,'form');Event.listen(i,'click',this.addRow.bind(this));Event.listen(j,'click',this.removeRow.bind(this));this.updateButtons();},updateButtons:function(){var a=this._visible_table;CSS.conditionShow(this._row_info[a.firstChild.id].remove_button,a.childNodes.length>1);CSS.conditionShow(this._add_button_container,this._hidden_table.childNodes.length>0);},getRowInfo:function(a){return this._row_info[Parent.byTag(a,'tr').id];},onSelect:function(a){var b=a.selector,c=this.getRowInfo(b),d=c.fieldset,e=$(d.id),f=this._fieldsets[Selector.getValue(b)],g=$(f.id),h=this._selectors[Parent.byTag(g,'tr').id],i=e.parentNode;c.fieldset=f;this.getRowInfo(h).fieldset=d;Selector.setSelected(h,d.id,true);d.resetAndEnable(this._form);f.disableOptions();g.parentNode.appendChild(e);i.appendChild(g);},addRow:function(){var a=this._hidden_table.lastChild;if(a){this._row_info[a.id].fieldset.disableOptions();this._visible_table.appendChild(a);this.updateButtons();}},removeRow:function(event){var a=Parent.byClass(event.getTarget(),'fbSearchAdvancedFiltersRemoveButton');if(a&&this._visible_table.childNodes.length>1){var b=Parent.byTag(a,'tr');this._row_info[b.id].fieldset.resetAndEnable(this._form);this._hidden_table.appendChild(b);this.updateButtons();}}});function SearchAdvancedFiltersFieldset(a,b,c){this._typeaheads=a;this._inputs=b;this._selects=c;this.options=[];if(this._typeaheads)this._typeaheads.forEach(function(d){DOM.scry(d.getElement(),'input').forEach(function(e){e.disabled=false;});});}copy_properties(SearchAdvancedFiltersFieldset.prototype,{resetAndEnable:function(a){var b=!!a;this._typeaheads.forEach(function(c){var d=c.getCore();b=b&&!d.getValue();d.reset();});this._inputs.forEach(function(c){b=b&&Input.isEmpty(c);Input.reset(c);});this._selects.forEach(function(c){b=b&&!c.selectedIndex;c.selectedIndex=0;});this.options.forEach(function(c){Selector.setOptionEnabled(c,true);});if(a&&!b)if(a.getAttribute('rel')=='async'){Form.bootstrap(a);}else a.submit();},disableOptions:function(){this.options.forEach(function(a){if(!Selector.isOptionSelected(a))Selector.setOptionEnabled(a,false);});}});
__d("TypeaheadDefaultToText",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._typeahead=i;}g(h.prototype,{_blurSubscription:null,_submitListener:null,enable:function(){var i=this._typeahead.getCore(),j=i.getElement().form;function k(){i.getHiddenValue()||i.setHiddenValue(i.getValue());}this._blurSubscription=i.subscribe('blur',k);if(j)this._submitListener=Event.listen(j,'submit',k);},disable:function(){this._typeahead.getCore().unsubscribe(this._blurSubscription);this._blurSubscription=null;if(this._submitListener){this._submitListener.remove();this._submitListener=null;}}});e.exports=h;});
__d("legacy:DefaultToTextTypeaheadBehavior",["TypeaheadDefaultToText"],function(a,b,c,d){var e=b('TypeaheadDefaultToText');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.defaultToText=function(f){f.enableBehavior(e);};},3);
__d("TypeaheadSubmitOnChange",["copyProperties","Form"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('Form');function i(j){this._typeahead=j;}g(i.prototype,{_subscription:null,enable:function(){var j=this._typeahead.getCore(),k=j.getValue(),l=j.getElement().form;function m(){if(k!=j.getValue()){k=j.getValue();if(l.getAttribute('rel')=='async'){h.bootstrap(l);}else l.submit();}}this._subscription=this._typeahead.subscribe(['blur','select'],m);},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=i;});
__d("legacy:SubmitOnChangeTypeaheadBehavior",["TypeaheadSubmitOnChange"],function(a,b,c,d){var e=b('TypeaheadSubmitOnChange');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.submitOnChange=function(f){f.enableBehavior(e);};},3);
function DetailedSearchFilterPage(a,b){this.hiddenTypeInput=DOM.create('input',{type:'hidden',name:'type',value:a});DOM.insertAfter(ge('q'),this.hiddenTypeInput);if(a=='web'){this.hiddenFormInput=DOM.create('input',{type:'hidden',name:'form',value:b});DOM.insertAfter(ge('q'),this.hiddenFormInput);}this._navigateToken=Arbiter.subscribe('page_transition',this.onPageTransition.bind(this),Arbiter.SUBSCRIBE_NEW);Arbiter.inform('search/typeahead/updateFilter',{filter_type:a},Arbiter.BEHAVIOR_STATE);}copy_properties(DetailedSearchFilterPage.prototype,{onPageTransition:function(a,b){DOM.remove(this.hiddenTypeInput);this.hiddenTypeInput=null;if(this.hiddenFormInput){DOM.remove(this.hiddenFormInput);this.hiddenFormInput=null;}this._navigateToken.unsubscribe();}});
function UIIntentionalStreamSearch(a,b,c,d,e,f){copy_properties(this,{searchSessionId:e,extraSearchParams:f});this.scrollOnPrepend=true;this.parent.construct(this,a,b,c,d);}UIIntentionalStreamSearch.prototype.getValidParams=function(){return UIIntentionalStreamSearch.VALID_PARAMS;};UIIntentionalStreamSearch.prototype.getEndpoint=function(){return UIIntentionalStreamSearch.ENDPOINT;};UIIntentionalStreamSearch.prototype.refresh=function(a,b,c){b.sessionId=this.searchSessionId;this.parent.refresh(a,b,c);};UIIntentionalStreamSearch.prototype.getCurrentParams=function(){params=this.parent.getCurrentParams();copy_properties(params,this.extraSearchParams);return params;};Class.extend(UIIntentionalStreamSearch,'UIIntentionalStream');copy_properties(UIIntentionalStreamSearch,{VALID_PARAMS:null,ENDPOINT:'/ajax/stream/search.php'});
__d("UFICollapsedComment",["event-extensions","CSS"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h={listen:function(i){if(i)Event.listen(i,'click',function(){g.addClass(i,'uiUfiCollapsedCommentToggle');});}};e.exports=h;});