/*1337582197,176832697*/

if (window.CavalryLogger) { CavalryLogger.start_js(["0PovS"]); }

__d("StarsRatable",["AsyncRequest","CSS","copyProperties","DOM","Parent","Run","URI","ge"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('copyProperties'),j=b('DOM'),k=b('Parent'),l=b('Run'),m=b('URI'),i=b('copyProperties'),n=b('ge');function o(p,q,r,s,t,u){this.rootID=p;this.href=q;this.appID=r;this.source=s;this.listeners=[];this.doSubmit=u;if(t)this.start();l.onLeave(this.destroyListeners.bind(this));o._instances[this.rootID]=this;}o._instances={};o.start=function(p){o._instances[p].start();};i(o.prototype,{start:function(){this.root=n(this.rootID);this.stars=j.scry(this.root,'i');this.listeners=[Event.listen(this.root,'click',this._onClick.bind(this)),Event.listen(this.root,'mouseover',this._onMouseOver.bind(this)),Event.listen(this.root,'mouseout',this.setRating.bind(this,0))];},_onClick:function(event){this.destroyListeners();h.addClass(this.root,'uiStarsRated');var p=k.byTag(event.getTarget(),'i');if(p){var q=this.stars.indexOf(p);if(q>=0){this.isRated=true;var r={rating:q+1,app_id:this.appID,source:this.source};this.setRating(q+1,true);if(!this.doSubmit)return true;new g().setURI(new m(this.href)).setData(r).send();}}return false;},_onMouseOver:function(event){var p=k.byTag(event.getTarget(),'i');if(p){var q=this.stars.indexOf(p);if(q>=0)this.setRating(q+1,false);}},setRating:function(p,q){var r=q?'fullStar':'hoverStar',s=q?'hoverStar':'emptyStar';for(var t=0;t<this.stars.length;++t)if(t<p){h.removeClass(this.stars[t],s);h.addClass(this.stars[t],r);}else{h.removeClass(this.stars[t],'hoverStar');h.addClass(this.stars[t],'emptyStar');}},destroyListeners:function(){this.listeners.forEach(function(p){p&&p.remove();});}});a.StarsRatable=e.exports=o;});
__d("legacy:intl-locale",["Locale"],function(a,b,c,d){a.intl_locale_is_rtl=b('Locale').isRTL;},3);
var ReviewsApp={writeReview:false,writeReviewElem:null,ON_RATING_SET:'reviews/on_rating_set',ON_REVIEW_SUBMITTED:'reviews/on_review_submitted',IMAGE_STAR_ON:null,IMAGE_STAR_OFF:null,initialize:function(a,b){ReviewsApp.IMAGE_STAR_ON=a;ReviewsApp.IMAGE_STAR_OFF=b;var c=[a,b];for(var d=0;d<c.length;d++)(new Image()).src=c[d];}};function reviews_show_editor_inline(a){hide('review_editor_status');toggle(ge('reviews_inline_editor'));ReviewsApp.writeReviewElem=a;}function reviews_jump_to_and_open_editor(){var a=ge('reviews_inline_editor');if(a){show(a);$('review_blurb').focus();DOMScroll.scrollTo(a,true,true);}}function reviews_set_rating(a){var b=ge('review_rating');b.value=a;for(var c=1;c<=5;c++){var d=$('review_rating_star'+c).getElementsByTagName('img')[0];if(c<=a){d.src=ReviewsApp.IMAGE_STAR_ON;}else d.src=ReviewsApp.IMAGE_STAR_OFF;}Arbiter.inform(ReviewsApp.ON_RATING_SET,{element:b});return false;}function reviews_hover_rating(a){var b=ge('review_rating');if(!(b.value>0)){for(var c=1;c<=5;c++){var d=$('review_rating_star'+c).getElementsByTagName('img')[0];if(c<=a){d.src=ReviewsApp.IMAGE_STAR_ON;}else d.src=ReviewsApp.IMAGE_STAR_OFF;}}else return false;}function reviews_submit(a,b,c,d){if(c){new Dialog().setTitle(c).setBody(d).setModal(true).setButtons([Dialog.CLOSE]).show();return false;}var e=ge('review_blurb'),f=ge('review_rating'),g=Input.getValue(e),h=f.value,b=$('review_id').value;e.disabled=true;var i=(h<1)||(h>5);if(i){var j="Valitse t\u00e4htiluokitus",k=$('review_editor_error');DOM.setContent(k,HTML(j));show(k);e.disabled=false;return false;}else{var l=function(m){var n="Julkaistu.",o=$('review_editor_status');DOM.setContent(o,HTML(n));if(b>0){var p=ge('review_'+b);p.parentNode.removeChild(p);}var q=ge('new_review_container'),r=m.getPayload();if(r.reload)window.location.reload();if(r.oid)$('review_id').value=parseInt(r.oid);DOM.setContent(q,HTML(r.markup));show(o);setTimeout(function(){hide(o);},3000);hide('review_editor_error');hide('reviews_inline_editor');if(ReviewsApp.writeReview){if(ReviewsApp.writeReviewElem)DOM.setContent(ReviewsApp.writeReviewElem,HTML("P\u00e4ivit\u00e4 arvostelu"));ReviewsApp.writeReview=false;}};new AsyncRequest().setURI('/ajax/applications/reviews/inline/editor.php?of='+a).setData({review_id:b,rating:h,blurb:g}).setHandler(l).send();e.disabled=false;return true;}}
var EditAppSettings={currentTab:undefined,callbackUrl:'/ajax/edit_app_settings.php',statusElement:'edit_app_settings_save_fill',profileHandler:bagofholding,extendedHandler:bagofholding,appID:0,setup:function(a,b,c){this.appID=a;this.profileID=b;this.currentTab=c;return this;},_getCurrentTab:function(){if(!this.currentTab){var a=['profile','bookmark','extended'];for(var b=0;b<a.length;b++)if(ge(this._getTabId(a[b]))){this.currentTab=a[b];break;}}return this.currentTab;},_getTabId:function(a){return a+'_tab_link';},setupHandlers:function(a){this.profileHandler=a.profile||bagofholding;this.extendedHandler=a.extended||bagofholding;},switchTab:function(a){CSS.removeClass(this._getTabId(this._getCurrentTab()),'tab_link_selected');hide('app_settings_'+this._getCurrentTab()+'_tab');CSS.addClass(this._getTabId(a),'tab_link_selected');show('app_settings_'+a+'_tab');this.currentTab=a;},isUiMode:function(){return Dialog.getCurrent();},setExtendedPermission:function(a,b){var c=ge('explanation_'+a);if(c)(b?hide:show)(c);var d=new AsyncRequest().setURI(this.callbackUrl).setHandler(this.extendedHandler.bind(this,this.appID,a)).setData({extended:1,permission:a,allow:b,profile_id:this.profileID,app_id:this.appID});if(this.isUiMode())d.setStatusElement(this.statusElement);d.send();return true;},makeProfileChange:function(a){var b=new AsyncRequest().setURI(this.callbackUrl).setHandler(this.profileHandler.bind(this,this.appID)).setData({profile:1,item:'tab',action:a,app_id:this.appID,profile_id:this.profileID});if(this.isUiMode())b.setStatusElement(this.statusElement);b.send();if(this.isUiMode()){toggleDisplayNone('app_settings_profile_tab_add');toggleDisplayNone('app_settings_profile_tab_remove');CSS.toggleClass($('profile_tab_name_changer'),'hidden_elem');}},removeApplication:function(a){var b=a||bagofholding,c={remove:1,app_id:this.appID,profile_id:this.profileID};new AsyncRequest().setURI(this.callbackUrl).setHandler(b).setData(c).send();},blockApplication:function(a){var b=a||bagofholding;new AsyncRequest().setURI(this.callbackUrl).setHandler(b).setData({block:1,app_id:this.appID,profile_id:this.profileID}).send();},setBlockComposer:function(a,b){new AsyncRequest().setURI(this.callbackUrl).setHandler(b||bagofholding).setData({composer:1,blocked_composer:a,profile_id:this.profileID,app_id:this.appID}).send();},reviveComposerDialog:function(a,b){var c=tx._("Poistetaanko {app-name}-julkaisimen esto?",{'app-name':htmlize(a)}),d='<p>'+"Are you sure you want to allow this application's publisher on your profile? "+'</p>',e="Poista esto";new Dialog().setTitle(c).setBody(d).setButtons([{name:'remove',label:e},Dialog.CANCEL]).setHandler(this.setBlockComposer.bind(this,0,b)).show();}};
function chain(a,b){var c,d=[];for(var e=0;e<arguments.length;e++)d.push(arguments[e]);c=function(event){event=event||window.event;for(var f=0;f<d.length;f++)if(d[f]&&d[f].apply(this,arguments)===false){return false;}else if(event&&event.cancelBubble)return true;return true;};c.toString=function(){return chain._toString(d);};return c;}if(!chain._toString)chain._toString=function(a){var b='chained fns';for(var c=0;c<a.length;c++)b+='\n'+a[c].toString();return b;};
function dropmenu(a){if(this==window){return new dropmenu(a);}else{this.className=null;this.menu=null;this.menuClickArea=null;this.showHandler=null;this.hideHandler=null;this.alignment=null;this.direction=null;this.isShown=false;this.canHide=false;this.show_hooks=[];this.hide_hooks=[];this.clickTarget=$(a);this.displayTarget=$(a);this.id=null;this.rtl=false;this._clickToHide=true;this._markupContentCallback=bagofholding;this.clickHandle=Event.listen(this.clickTarget,'click',this.toggle.bind(this));this.container=ge('dropmenu_container')||this.createContainer();return this;}}dropmenu.ALIGN_RIGHT=1;dropmenu.ALIGN_LEFT=2;dropmenu.DIRECTION_UP=3;dropmenu.DIRECTION_DOWN=4;dropmenu.INSTANCES={};dropmenu.prototype.createContainer=function(){var a=$N('div',{id:'dropmenu_container'});DOM.appendContent(DOM.getDocumentBodyElement(),a);return a;};dropmenu.prototype.setPosition=function(a){this.alignment=a;return this;};dropmenu.prototype.setDirection=function(a){this.direction=a;return this;};dropmenu.prototype.setMenuClickArea=function(a){this.menuClickArea=$(a);return this;};dropmenu.prototype.setDisplayTarget=function(a){this.displayTarget=$(a);return this;};dropmenu.prototype.setClickToHide=function(a){this._clickToHide=a;return this;};dropmenu.prototype.setMarkupContent=function(a,b,c){this.menuContent=c;this.className=b;this.id=a;return this;};dropmenu.prototype.setMarkupContentCallback=function(a){this._markupContentCallback=a;return this;};dropmenu.prototype._getMarkupContent=function(){return this.menuContent||this._markupContentCallback();};dropmenu.prototype.registerHTMLMenu=function(a){this.registered_menu_id=a;return this;};dropmenu.prototype.addHook=function(a,b){this[a+'_hooks'].push(b);return this;};dropmenu.prototype.removeHook=function(a,b){for(var c=0;c<this[a+'_hooks'].length;c++)if(b==this[a+'_hooks'][c]){this[a+'_hooks'].splice(c,1);return true;}return this;};dropmenu.prototype.toggle=function(a){if(!this.isShown){this._show();this.canHide=false;}else this._hide();$E(a).prevent();};dropmenu.prototype.show=function(){this._show();};dropmenu.prototype.hide=function(){if(!this.menu)return;this._hide();};dropmenu.prototype.destroy=function(){if(this.menu&&this.menu.parentNode){this.menu.parentNode.removeChild(this.menu);this.menu=null;}};dropmenu.prototype._buildMenu=function(){if(intl_locale_is_rtl()&&!this.rtl){this.alignment=(this.alignment==dropmenu.ALIGN_RIGHT)?dropmenu.ALIGN_LEFT:dropmenu.ALIGN_RIGHT;this.rtl=true;}if(this.registered_menu_id){this.menu=$(this.registered_menu_id);if(this.alignment||this.direction)this.container.appendChild(this.menu);}else this._buildDynamicMenu();dropmenu.INSTANCES[this.id]=this;this.menuClickArea=this.menuClickArea||DOM.scry(this.menu,'div.menu_content');this.menuClickArea.onclick=chain(this.menuClickArea.onclick,Event.stop);var a=DOM.scry(this.menu,'a');for(var b=0;b<a.length;b++)Event.listen(a[b],'click',function(){if(this._clickToHide)this._hide();}.bind(this));};dropmenu.prototype._buildDynamicMenu=function(){this.menu=document.createElement('div');this.menu.className='dropdown_menu hidden_elem '+(this.className?' '+this.className:'');this.menu.id='dropdown_menu_'+this.id;var a=this._getMarkupContent();if(!is_scalar(a)){DOM.setContent(this.menu,a);}else DOM.setContent(this.menu,HTML(a));this.container.appendChild(this.menu);};dropmenu.prototype._positionMenu=function(){if(this.alignment||this.direction||(!this.alignment&&!this.direction&&!this.registered_menu_id)){if(this.menu.parentNode!=this.container)this.container.appendChild(this.menu);var a=Vector2.getElementPosition(this.displayTarget,'document'),b=Vector2.getElementPosition(this.container,'document'),c=a.x-b.x,d=a.y-b.y+this.displayTarget.offsetHeight;if(this.alignment==dropmenu.ALIGN_RIGHT||this.direction==dropmenu.DIRECTION_UP){CSS.show(this.menu);this.menu.style.left='-9999px';this.menu.style.top='-9999px';if(this.alignment==dropmenu.ALIGN_RIGHT){var e=this.menu.offsetWidth;c=c+this.displayTarget.offsetWidth-e;}if(this.direction==dropmenu.DIRECTION_UP){var f=this.menu.offsetHeight;d=d-this.displayTarget.offsetHeight-f+1;}CSS.hide(this.menu);}this.menu.style.left=c+'px';this.menu.style.top=d+'px';}};dropmenu.prototype._onclick=function(event){this._hide();return false;};dropmenu.prototype._show=function(){if(!this.menu)this._buildMenu();this._positionMenu();CSS.show(this.menu);var a=this._documentHideHandler.bind(this);this.click_event=Event.listen(document.body,'click',a);onbeforeunloadRegister(a);this.isShown=true;for(var b=0;b<this.show_hooks.length;b++)this.show_hooks[b]();};dropmenu.prototype._documentHideHandler=function(a){if(!this.canHide){this.canHide=true;}else this._hide();};dropmenu.prototype._hide=function(){if(this.menu)CSS.hide(this.menu);if(this.click_event)this.click_event.remove();this.click_event=null;this.isShown=false;for(var a=0;a<this.hide_hooks.length;a++)this.hide_hooks[a]();if(!this.registered_menu_id)this.destroy();};dropmenu.prototype._build_menu_shim=function(){this.shim=null;if(ua.ie()<7){this.shim=document.createElement('iframe');CSS.setClass(shim,'iframe_shim');this.container.appendChild(this.shim);}};dropmenu.getExistingInstance=function(a){return dropmenu.INSTANCES[a];};
__d("isEmail",[],function(a,b,c,d,e,f){function g(h){return (/^([\w!.%+\-])+@([\w\-])+(?:\.[\w\-]+)+$/).test(h);}e.exports=g;});
__d("legacy:string-misc",["htmlHyperlink","isEmail"],function(a,b,c,d){a.html_hyperlink=b('htmlHyperlink');a.is_email=b('isEmail');},3);
var EditAppsController={BOOKMARKS_VIEW:'bookmarks',currentView:'',sortableGroup:null,ownedApps:null,init:function(a,b){this.profileID=a;this.ownedApps=b;EditAppSettings.setupHandlers({profile:this.changeProfileCallback,extended:this.setExtendedPermissionCallback});},setView:function(a){this.currentView=a;},switchView:function(a){goURI(new URI('/editapps.php').addQueryData({v:a}).toString());},changeProfileCallback:function(a){if(ge('editapps_tab_'+a)){toggleDisplayNone('editapps_tab_'+a);toggleDisplayNone('editapps_tab_'+a+'_undo');}},removeAppSuccessDialog:function(a,b,c){var d="Sovellus poistettu",e=tx._("Olet poistanut sovelluksen {application-name}.",{'application-name':b});new Dialog().setTitle(d).setBody(e).setButtons([Dialog.OK]).setHandler(a.bind(this,c)).show();},removeApplication:function(a,b,c){var d=htmlize(b),e=tx._("Poistetaanko {application-name}?",{'application-name':d}),f='<a href="/?sk=apps">'+"Sovellussivu"+'</a>',g='<p>'+tx._("If you remove {application-name}, it will be taken off your timeline, bookmarks and from the list of apps you use in your settings. You can also block apps to prevent them from accessing the non-public information you share with others who use them.",{'application-name':d,'applications-link':f})+'</p>';g+='<input type="hidden" name="remove_appId" value="'+a+'" />';var h={name:'remove',label:"Poista"},i=[h,Dialog.CANCEL];g='<div class="remove_application_dialog">'+g+'</div>';new Dialog().setTitle(e).setBody(g).setButtons(i).setModal(true).setHandler(function(){EditAppSettings.setup(a,this.profileID).removeApplication(c);}).show();return false;},removeExtendedPermission:function(a,b){this.setExtendedPermission(a,b,false);},undoRemoveExtendedPermission:function(a,b){this.setExtendedPermission(a,b,true);},setExtendedPermission:function(a,b,c){EditAppSettings.setup(a,this.profileID).setExtendedPermission(b,c);return true;},setExtendedPermissionCallback:function(a,b){toggleDisplayNone('editapps_extperm_'+b+'_'+a);toggleDisplayNone('editapps_extperm_'+b+'_'+a+'_undo');},addSortable:function(a){var b=$('editapps_bookmarked_wrapper_'+a);this.sortableGroup.addSortable(a,b);}};
__d("Collection",[],function(a,b,c,d,e,f){function g(h,i){if(!h.__collection__){var j=new Function();for(var k in h.prototype)j.prototype[k]=g._call.bind(null,k);h.__collection__=j;}var l=new h.__collection__();l._elements=i;return l;}g._call=function(h){var i=Array.prototype.slice.call(arguments,1);this._elements.forEach(function(j){j[h].apply(j,i);});return this;};e.exports=g;});
__d("Drag",["Arbiter","DOM","Style","Vector"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('Style'),j=b('Vector'),k={};k.currentDraggable=null;k.grab=function(l){if(k.currentDraggable)k._onmouseup();l.lastDragOver=null;k.attachDragEvents();k.currentDraggable=l;};k.attachDragEvents=function(){document.onselectstart=function(){document.onselectstart=null;return false;};if(k.dragEventsAttached)return;k.dragEventsAttached=true;g.subscribe('scroller/scroll',k._onmousemove);Event.listen(document,{mousemove:k._onmousemove,mouseup:k._onmouseup});};k.droppables={};k.addDroppable=function(l,m){(k.droppables[l]=k.droppables[l]||[]).push(m);};k.removeDroppable=function(l,m){k.droppables[l]=k.droppables[l].filter(function(n){return n!=m;});};k.getOffsetParent=function(l){if(h.isNodeOfType(l,['body','html']))return document.body;while((l=l.parentNode)&&l!==document.body)if(i.get(l,'position')!=='static')return l;return document.body;};k._onmousemove=function(event,l){if(!k.currentDraggable)return;var m=l||j.getEventPosition(event),n=k.currentDraggable,o=k.droppables[n.namespace];if(n.namespace&&n.active&&o){var p={};o.forEach(function(v){p[v.zIndex]=v.zIndex;});var q=[];for(var r in p)q.push(p[r]);q.sort();var s=n.lastDragOver,t=null;for(var u=q.length-1;u>=0;u--)if(s&&s.dom!=null&&s.zIndex==q[u]&&s.pointInside(m)){t=s;break;}else for(r=0;r<o.length;r++){if(q[u]!=o[r].zIndex)continue;if(s!=o[r]&&n.dom!=o[r].dom&&o[r].pointInside(m)){t=o[r];u=-1;break;}}if(t&&t!=s){t.ondragover(n);k.currentDraggable.adjustCursorPosition();}if(t)t.ondragmove(n,m.sub(j.getElementPosition(t.dom)));n.lastDragOver=t;}k.currentDraggable._onmousemove(m);};k._onmouseup=function(l){document.onselectstart=null;if(k.currentDraggable){k.currentDraggable._ondrop();k.currentDraggable=null;}};e.exports=k;});
__d("Draggable",["Arbiter","Collection","DOM","Drag","Rect","Style","Vector","event-extensions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Collection'),i=b('DOM'),j=b('Drag'),k=b('Rect'),l=b('Style'),m=b('Vector'),n=b('event-extensions').$E;function o(q){this.canvas=q;this.scrollZone=50;this.velocity=100;this.coefficient=1;}o.findScrollParent=function(q){var r;q=q.parentNode;while(q){if(q.scrollHeight!=q.offsetTop){r=l.get(q,'overflowY');if(r=='scroll'||r=='auto')return q;}q=q.parentNode;}return document.body;};o.prototype.activate=function(){this.activate=bagofholding;this.event=Event.listen(document,'mousemove',this._onmousemove.bind(this));this.interval=setInterval(this._intervalHandler.bind(this),50);this.cursor=null;};o.prototype.deactivate=function(){delete this.activate;this.event&&this.event.remove();this.event=null;clearInterval(this.interval);};o.prototype._onmousemove=function(event){this.cursor=new m.getEventPosition(event);};o.prototype._intervalHandler=function(){if(!this.cursor)return;var q=this.canvas==document.body?k.getViewportBounds():new k(this.canvas),r=new k(this.cursor.y-q.t,q.r-this.cursor.x,q.b-this.cursor.y,this.cursor.x-q.l),s=new m(0,0);if(r.t<r.b&&r.t<this.scrollZone){s.y=-this.scrollZone+r.t;}else if(r.b<this.scrollZone)s.y=this.scrollZone-r.b;s.y=this._doMath(s.y);if(r.l<r.r&&r.l<this.scrollZone){s.x=-this.scrollZone+r.l;}else if(r.r<this.scrollZone)s.x=this.scrollZone-r.r;s.x=this._doMath(s.x);if(s.x||s.y){s.scrollElementBy(this.canvas);if(document.body==this.canvas)this.cursor=this.cursor.add(s);g.inform('scroller/scroll',this.cursor);}};o.prototype._doMath=function(q){q=(q>=0?Math.min(q,this.scrollZone):Math.max(q,-this.scrollZone));return Math.floor(Math.pow(q/this.scrollZone*this.velocity,this.coefficient));};function p(q){if(!q)throw new Error('Element should be a DOM node');if(!(this instanceof p)){if(q instanceof Array){var r=[];q.forEach(function(s){r.push(new p(s));});return new h(p,r);}else return new p(q);}else{this.data={};this.handles=[];this.dom=q;this.boundingBox=null;this.useScroller=true;this.grabPctX=this.grabPctY=0;this.addHandle(this.dom);}}p.prototype.destroy=function(){this.handles.forEach(function(q){this.removeHandle(q.obj);}.bind(this));this.data=this.dom=null;};p.prototype.adjustCursorPosition=function(){var q=m.getElementDimensions(this.dom);this.cursorPositionVector=new m(parseInt(this.grabPctX*q.x,10),parseInt(this.grabPctY*q.y,10));};p.prototype._onclick=function(event){if(this.active)return Event.kill(event);};p.prototype._ongrab=function(q){this.ongrab();if(this.useScroller){if(!this.scroller)this.scroller=new o(o.findScrollParent(this.dom));this.scroller.activate();}if(this.active){if(!this.oldPosition)this.oldPosition=this.dom.style.position;this.dom.style.position=this.absolute?'absolute':'relative';q.sub(this.cursorPositionVector).setElementPosition(this.dom);}};p.prototype._onmousedown=function(event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;var q=n(event).getTarget();if(i.isNodeOfType(q,['input','select','textarea','object','embed']))return true;var r=m.getEventPosition(event),s=m.getElementDimensions(this.dom);this.draggableInitialVector=m.getElementPosition(this.dom);this.cursorPositionVector=r.sub(this.draggableInitialVector);this.grabPctX=s.x===0?0:this.cursorPositionVector.x/s.x;this.grabPctY=s.y===0?0:this.cursorPositionVector.y/s.y;j.grab(this,event);if(this.gutter){this.cursorInitialVector=r;}else{this._setActive(true);this._ongrab(r);}return Event.kill(event);};p.prototype._onmousemove=function(q){if(!this.active)if(q.distanceTo(this.cursorInitialVector)>=this.gutter){this._setActive(true);this._ongrab(q);}if(this.active){var r=q.sub(this.cursorPositionVector),s;if(this.boundingBox){var t=k.newFromVectors(r,m.getElementDimensions(this.dom));t=t.boundWithin(this.boundingBox);r=t.getPositionVector();if(this.boundingBox.w()===0){s=new m(this.draggableInitialVector.x,r.y,'document');}else if(this.boundingBox.h()===0){s=new m(r.x,this.draggableInitialVector.y,'document');}else s=r;}else s=r;var u=j.getOffsetParent(this.dom);if(u!==document.body)s=s.sub(m.getElementPosition(u));s.setElementPosition(this.dom);this.ondrag(q);}};p.prototype._ondrop=function(){this.scroller&&this.scroller.deactivate();if(this.active){(function(){this._setActive(false);}).bind(this).defer();this.ondrop();if(this.lastDragOver)this.lastDragOver.ondrop(this);}};p.prototype.killDrag=function(){this._setActive(false);j._onmouseup();};p.prototype.setBoundingBox=function(q){this.boundingBox=q;return this;};p.prototype.resetPosition=function(){this.dom.style.position=this.oldPosition;this.oldPosition=null;this.dom.style.left='';this.dom.style.top='';return this;};p.prototype.setUseAbsolute=function(q){this.absolute=q;return this;};p.prototype.ondrag=bagofholding;p.prototype.setDragHandler=function(q){this.ondrag=q;return this;};p.prototype.ongrab=bagofholding;p.prototype.setGrabHandler=function(q){this.ongrab=q;return this;};p.prototype.ondrop=bagofholding;p.prototype.setDropHandler=function(q){this.ondrop=q;return this;};p.prototype.gutter=0;p.prototype.setGutter=function(q){this.gutter=q;return this;};p.prototype.setNamespace=function(q){this.namespace=q;return this;};p.prototype.setUseScroller=function(q){this.useScroller=q;return this;};p.prototype.handles=null;p.prototype.addHandle=function(q){if(this.handles.length==1&&this.handles[0].obj==this.dom)this.removeHandle(this.dom);this.handles.push({obj:q,evt:[Event.listen(q,'mousedown',this._onmousedown.bind(this)),Event.listen(q,'click',this._onclick.bind(this)),Event.listen(q,'drag',Event.kill),Event.listen(q,'selectstart',Event.kill)]});return this;};p.prototype.removeHandle=function(q){this.handles=this.handles.filter(function(r){if(r.obj!=q){return true;}else{r.evt.forEach(function(s){s.remove();});return false;}});};p.prototype.getDOM=function(){return this.dom;};p.prototype.setKey=function(q,r){this.data[q]=r;return this;};p.prototype.getKey=function(q){return this.data[q];};p.prototype._setActive=function(q){this.dom.activeDrag=this.active=q;for(var r=0;r<this.handles.length;r++)this.handles[r].obj.activeDrag=q;};e.exports=p;});
__d("Droppable",["Collection","Drag","Draggable","Vector"],function(a,b,c,d,e,f){var g=b('Collection'),h=b('Drag'),i=b('Draggable'),j=b('Vector');function k(l){if(!l)throw new Error('Element should be a DOM node');if(!(this instanceof k)){if(l instanceof Array){var m=[];l.forEach(function(n){m.push(new k(n));});return new g(k,m);}else return new k(l);}else{this.data={};this.dom=l;this.namespace=null;}}k.prototype.destroy=function(){if(this.namespace)h.removeDroppable(this.namespace,this);this.data=this.dom=null;};k.prototype.setNamespace=function(l){if(this.namespace)h.removeDroppable(this.namespace,this);this.namespace=l;h.addDroppable(l,this);return this;};k.prototype.zIndex=0;k.prototype.setZIndex=function(l){this.zIndex=l;return this;};k.prototype.pointInside=function(l){var m=j.getElementPosition(this.dom);return m.x<=l.x&&this.dom.offsetWidth+m.x>l.x&&m.y<=l.y&&this.dom.offsetHeight+m.y>l.y;};k.prototype.ondragover=bagofholding;k.prototype.setDragOverHandler=function(l){this.ondragover=l;return this;};k.prototype.ondragmove=bagofholding;k.prototype.setDragMoveHandler=function(l){this.ondragmove=l;return this;};k.prototype.ondrop=bagofholding;k.prototype.setDropHandler=function(l){this.ondrop=l;return this;};k.prototype.getDOM=i.prototype.getDOM;k.prototype.setKey=i.prototype.setKey;k.prototype.getKey=i.prototype.getKey;e.exports=k;});
__d("SortableGroup",["CSS","DOM","Draggable","Droppable","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Draggable'),j=b('Droppable'),k=b('Vector'),l=b('copyProperties');function m(){this.namespace='sortable'+(++m.instanceCount);this.draggables={};this.droppables={};this.sortables={};this.linkedGroups=[];this.linkedGroups.onbeforelinkjump=bagofholding;this.linkedGroups.onlinkjump=bagofholding;this.rootNode=null;this.boundingBox=null;this.neverEmpty=false;this.hasEmptyMessage=false;this.isDroppable=true;this.isDraggable=true;this.requireSameParent=true;this.anchor=null;this.disabled=false;}m.instanceCount=0;l(m.prototype,{gutter:15,onbeforegrabcallback:bagofholding,onbeforedragover:bagofholding,ondragover:bagofholding,ondropcallback:bagofholding,ongrabcallback:bagofholding,onorderchange:bagofholding,addEmptyMessage:function(n,o){var p='placeholder';if(n.parentNode!=o)h.appendContent(o,n);this.emptyMessage=n;this._initializeAdded(p,n);this.hasEmptyMessage=true;this.sortables[p]=n;this.droppables[p]=(new j(n)).setNamespace(this.namespace).setDragOverHandler(this._dragOverHandlerShim.bind(this,p));return this;},removeEmptyMessage:function(){if(this.emptyMessage)h.remove(this.emptyMessage);this.hasEmptyMessage=false;this.removeSortable('placeholder');return this;},addSortable:function(n,o,p){this._initializeAdded(n,o);this.sortables[n]=o;this.draggables[n]=(new i(o)).setNamespace(this.namespace).setGutter(this.gutter).setUseAbsolute(true).setGrabHandler(this.grabHandler.bind(this,n)).setDropHandler(this.dropHandler.bind(this,n)).setKey('key',n).setBoundingBox(this.boundingBox);if(p)this.draggables[n].addHandle(p);this.droppables[n]=(new j(o)).setNamespace(this.namespace).setDragOverHandler(this._dragOverHandlerShim.bind(this,n));return this;},destroy:function(){for(var n in this.droppables)this.droppables[n].destroy();for(var o in this.draggables)this.draggables[o].destroy();this.droppables=this.draggables=this.rootNode=null;this.linkedGroups.remove(this);for(var p=0;p<this.linkedGroups.length;p++)this.linkedGroups[p].linkedGroups=this.linkedGroups;},dragOverHandler:function(n,o){if(!this.isDroppable&&!this.anchor)return;var p=false;if(!(o in this.draggables)){this.linkedGroups.onbeforelinkjump.call(this,o);if(!this.migrateLinkedSortable(o))throw new Error('Draggable dropped onto a foreign droppable!');p=true;}var q=true,r=this.getSortables(),s=this.sortables[o],t=this.sortables[n];if(!this.anchor){var u=r.length;for(var v=0;v<u;v++)if(r[v]==t){break;}else if(r[v]==s){q=false;break;}}else t=this.anchor;this.onbeforedragover(s,t);var w=this.linkedGroups.placeholder;this.insertPlaceholder(w,t,q||this.anchor);w.parentNode.insertBefore(s,w);this.ondragover(s,t);if(p)this.linkedGroups.onlinkjump.call(this,o);},dropHandler:function(n){if(this._checkLastRemaining()){this.draggables[n].resetPosition();return;}var o=this.linkedGroups.placeholder;g.removeClass(this.sortables[n],'drag');this.draggables[n].resetPosition();o.parentNode.insertBefore(this.sortables[n],o);o.parentNode.removeChild(o);for(var p=0;p<this.linkedGroups.length;p++)if(this.linkedGroups[p].anchor)delete this.linkedGroups[p].anchor;this.ondropcallback(n,this.sortables[n]);this.onorderchange();},getOrder:function(){var n=[],o=this.getSortables();for(var p=0;p<o.length;p++)for(var q in this.sortables)if(this.sortables[q]==o[p]){n.push(q);break;}return n;},getSortables:function(){return this.rootNode?this.rootNode.childNodes:[];},grabHandler:function(n){if(this.disabled||this._checkLastRemaining()||!this.isDraggable){this.draggables[n].killDrag();return;}this.onbeforegrabcallback(this.sortables[n],n);var o=this.linkedGroups.placeholder,p=this.sortables[n];g.setClass(o,p.className);g.addClass(o,'droppable_placeholder');g.addClass(p,'drag');k.getElementDimensions(p).setElementDimensions(o);p.parentNode.insertBefore(o,p);this.ongrabcallback(this.sortables[n],n);if(!this.isDroppable){this.anchor=p.nextSibling;if(!this.anchor){this.anchor=h.create('div');p.parentNode.appendChild(this.anchor);}}},insertPlaceholder:function(n,o,p){if(p){h.insertBefore(o,n);}else h.insertAfter(o,n);},keyExists:function(n){return this.sortables[n];},link:function(n){n.linkedGroups=this.linkedGroups;if(!this.linkedGroups.length)this.linkedGroups.push(this);this.linkedGroups.push(n);for(var o=0;o<this.linkedGroups.length;o++)if(this.linkedGroups[o].namespace!=this.namespace){this.linkedGroups[o].namespace=this.namespace;for(var p in this.linkedGroups[o].droppables){this.linkedGroups[o].droppables[p].setNamespace(this.namespace);var q=this.linkedGroups[o].draggables[p];q&&q.setNamespace(this.namespace);}}return this;},migrateLinkedSortable:function(n){for(var o=0;o<this.linkedGroups.length;o++)if(n in this.linkedGroups[o].draggables){this.sortables[n]=this.linkedGroups[o].sortables[n];this.draggables[n]=this.linkedGroups[o].draggables[n];this.draggables[n].setGrabHandler(this.grabHandler.bind(this,n)).setDropHandler(this.dropHandler.bind(this,n));this.droppables[n]=this.linkedGroups[o].droppables[n];this.droppables[n].setDragOverHandler(this._dragOverHandlerShim.bind(this,n));delete this.linkedGroups[o].sortables[n];delete this.linkedGroups[o].draggables[n];delete this.linkedGroups[o].droppables[n];return true;}return false;},removeSortable:function(n){if(n in this.sortables){if(n in this.draggables)this.draggables[n].destroy();if(n in this.droppables)this.droppables[n].destroy();delete this.draggables[n];delete this.droppables[n];delete this.sortables[n];}},setDisabled:function(n){this.disabled=n;return this;},forceDrop:function(n){if(n in this.sortables)this.draggables[n].killDrag();},setBeforeGrabCallback:function(n){this.onbeforegrabcallback=n;return this;},setBoundingBox:function(n){this.boundingBox=n;for(var o in this.draggables)this.draggables[o].setBoundingBox(this.boundingBox);return this;},setBeforeDragOverCallback:function(n){this.onbeforedragover=n;return this;},setDragOverCallback:function(n){this.ondragover=n;return this;},setDropCallback:function(n){this.ondropcallback=n;return this;},setDroppable:function(n){this.isDroppable=n;return this;},setDraggable:function(n){this.isDraggable=n;return this;},setGrabCallback:function(n){this.ongrabcallback=n;return this;},setBeforeLinkJumpHandler:function(n){this.linkedGroups.onbeforelinkjump=n;return this;},setInsertPlaceholderHandler:function(n){this.insertPlaceholder=n;},setLinkJumpHandler:function(n){this.linkedGroups.onlinkjump=n;return this;},setNeverEmpty:function(n){this.neverEmpty=n;},setOrderChangeHandler:function(n){this.onorderchange=n;return this;},setRequireSameParent:function(n,o){this.requireSameParent=o;},setSortablesGetter:function(n){this.getSortables=n;},_checkLastRemaining:function(n){var o=this.hasEmptyMessage?2:1;return this.neverEmpty&&this.getSortables().length==o;},_dragOverHandlerShim:function(n,o){this.dragOverHandler(n,o.getKey('key'));},_initializeAdded:function(n,o){if(this.rootNode===null){this.rootNode=o.parentNode;if(!this.linkedGroups.placeholder)this.linkedGroups.placeholder=h.create(o.tagName,{className:'dragPlaceholder',style:{padding:'0'}});}else if(this.requireSameParent&&this.rootNode!=o.parentNode)throw new Error('All sortables of a collection must share the same parentNode');if(n in this.draggables)throw new Error('All sortables must have a unique key');}});e.exports=a.SortableGroup||m;});
__d("legacy:sort",["SortableGroup"],function(a,b,c,d){a.SortableGroup=b('SortableGroup');},3);
function PhotoInlineOrganizer(a,b){this.root=$(a);this.url=b;this.IDLE='idle';this.PENDING='pending';this.SAVING='saving';this.UP='up';this.DOWN='down';this.state=this.IDLE;this.sortable=new SortableGroup();this.sortable.setRequireSameParent(false);this.sortable.setSortablesGetter(function(){return DOM.scry(this.root,'div.dragWrapper');}.bind(this));this.sortable.setInsertPlaceholderHandler(this.insertPlaceholder.bind(this));this.sortable.setOrderChangeHandler(this.onSave.bind(this));PhotoInlineOrganizer.cache[a]=this;PhotoInlineOrganizer.refresh(a);this.order=this.sortable.getOrder();Event.listen(this.root,'click',this.moveListener.bind(this));}PhotoInlineOrganizer.cache={};PhotoInlineOrganizer.refresh=function(a){var b=PhotoInlineOrganizer.cache[a];DOM.scry(b.root,'td').forEach(function(c){if(c.getAttribute('data-id')){var d=DOM.find(c,'div.dragWrapper'),e=DOM.find(d,'a.uiMediaThumb');b.sortable.addSortable(c.getAttribute('data-id'),d,e);c.removeAttribute('data-id');}});};PhotoInlineOrganizer.appendToExisting=function(a,b){var c=$(a),d=DOM.scry(c,'table')[0],e=PhotoInlineOrganizer.cache[d.id],f=DOM.find(e.root,'tbody'),g=$(b),h=DOM.find(g,'table');DOM.scry(h,'tr').forEach(function(j){f.appendChild(j);});var i=DOM.scry(c,'.uiMorePager');if(i.length>0)c.appendChild(i[0].parentNode);PhotoInlineOrganizer.refresh(d.id);};copy_properties(PhotoInlineOrganizer.prototype,{getItems:function(){return DOM.scry(this.root,'div.dragWrapper').filter(function(a){return !CSS.hasClass(a,'drag');});},moveListener:function(event){var a=event.getTarget();if(CSS.hasClass(a,'arrow')){this.movePhoto(Parent.byClass(a,'dragWrapper'),CSS.hasClass(a,this.DOWN)?this.DOWN:this.UP);a.focus();return false;}},movePhoto:function(a,b){var c=DOM.scry(this.root,'td'),d=this.getItems(),e=d.indexOf(a),f=0;if(b==this.UP&&e>0){f=-1;}else if(b==this.DOWN&&e<d.length-1)f=1;if(f!==0){DOM.appendContent(c[e],d[e+f]);DOM.appendContent(c[e+f],d[e]);}this.onSave();},save:function(){if(this.state!=this.IDLE){this.state=this.PENDING;}else{this.state=this.SAVING;new AsyncRequest().setURI(this.url).setMethod('POST').setData({order:this.order}).setHandler(this.saveResponse.bind(this)).setErrorHandler(this.saveResponse.bind(this)).send();}},saveResponse:function(a){var b=this.state;this.state=this.IDLE;if(b==this.PENDING)this.save();if(a.getError())AsyncResponse.verboseErrorHandler(a);},onSave:function(){var a=this.sortable.getOrder();if(a.join('|')!=this.order.join('|')){this.order=a;this.save();}},insertPlaceholder:function(a,b,c){var d=DOM.scry(this.root,'td'),e=this.getItems(),f=e.indexOf(b),g=e.indexOf(a),h;if(f>g){for(h=g;h<f;h++)DOM.appendContent(d[h],e[h+1]);}else for(h=g-1;h>=f;h--)DOM.appendContent(d[h+1],e[h]);DOM.appendContent(d[f],a);}});