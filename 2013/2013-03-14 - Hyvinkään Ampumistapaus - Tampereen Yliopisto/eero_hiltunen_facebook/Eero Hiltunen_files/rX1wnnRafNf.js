/*1337983774,176832696*/

if (window.CavalryLogger) { CavalryLogger.start_js(["uYsuU"]); }

function EmuController(a,b){this.impression=b;this.containerId=a;DataStore.set($(a),'emuController',this);return this;}copy_properties(EmuController,{fromContainer:function(a){var b=ge(a);if(!b)return null;return DataStore.get(b,'emuController');},getEventClass:function(a){return "emuEvent"+String(a).trim();}});copy_properties(EmuController.prototype,{EVENT_HANDLER_PATH:'/ajax/emu/end.php',CLICK:1,FAN:"fad_fan",event:function(a,b,c,d){var e={eid:this.impression,f:0,ui:this.containerId,en:a,a:1};if(b)e.ed=JSON.stringify(b);if(!d)var d=bagofholding;var f=new AsyncRequest().setURI(this.EVENT_HANDLER_PATH).setData(e).setErrorHandler(d);if(c)f.setHandler(c);f.send();},redirect:function(){var a={eid:this.impression,f:0,ui:this.containerId,en:this.CLICK,a:0,sig:Math.floor(Math.random()*65535)+65536},b=new URI(this.EVENT_HANDLER_PATH);b.setQueryData(a);goURI(b);}});
var ShortClickHandlers={EVENT_NAME_CAME_BACK:'cameback',onclicked:function(a){if(this.onsite)return;if(a.button!==0||a.getModifiers().any)return;this.click_ts=(+new Date());if(this.listeners!==undefined)for(var b in this.listeners)this.listeners[b].remove();this.listeners={focus:Event.listen(window,'focus',ShortClickHandlers.oncameback.bind(this))};},oncameback:function(a){var b=(+new Date())-this.click_ts;this.listeners[a.type].remove();var c={click_ts:this.click_ts,length:b,trigger:a.type};this.sendData(ShortClickHandlers.EVENT_NAME_CAME_BACK,c);}};
function EmuTracker(a,b){this.base=EmuController.fromContainer(a);!this.base;this.onsite=b;var c=DOM.scry($(a),"a."+EmuController.getEventClass(EmuTracker.EVENT_CLICK));c.forEach(function(d){Event.listen(d,'click',ShortClickHandlers.onclicked.bind(this));}.bind(this));return this;}copy_properties(EmuTracker,{EVENT_CLICK:1});copy_properties(EmuTracker.prototype,{sendData:function(a,b){this.base.event(a,b);}});
function BassWhitespaceListener(a,b){this.link=b;Event.listen(a,'click',this.onclicked.bind(this));}copy_properties(BassWhitespaceListener.prototype,{onclicked:function(a){if(Parent.byTag(a.getTarget(),'A'))return;switch(this.link.getAttribute('rel')){case 'async':Bootloader.loadComponents('async',function(){AsyncRequest.bootstrap(this.link.getAttribute('ajaxify'),this.link);}.bind(this));break;case 'theater':var b=Parent.byClass(a.getTarget(),'fbPhotoSnowlift');Bootloader.loadComponents('PhotoViewer',function(){PhotoViewer.bootstrap(this.link.getAttribute('ajaxify'),this.link);}.bind(this));if(b)return false;break;default:goURI(this.link.getAttribute('href'));}}});
__d("VideoCallRecordMessageDialog",["Dialog","URI"],function(a,b,c,d,e,f){var g=b('Dialog'),h=b('URI'),i={get:function(j,k){return new g().setTitle(tx._("{firstname} ei ole paikalla",{firstname:k})).setBody("Haluatko j\u00e4tt\u00e4\u00e4 videoviestin?").setButtons([{name:'record-message',label:"Tallenna viesti"},g.CANCEL]).setHandler(function(){var l=h('/ajax/messaging/composer.php').setQueryData({ids:[j],autoloadvideo:true}).toString();g.bootstrap(l);});}};e.exports=i;});
__d("VideoCallCore",["Arbiter","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","ChannelConstants","Cookie","Dialog","UserAgent","ge","ShortProfiles","VideoCallRecordMessageDialog"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AvailableList'),j=b('AvailableListConstants'),k=b('Bootloader'),l=b('ChannelConstants'),m=b('Cookie'),n=b('Dialog'),o=b('UserAgent'),p=b('ge'),q=[],r={isSupported:function(){if(o.windows()){return (o.ie()>=7&&!o.ie64())||o.firefox()>=3.6||o.chrome()>=5;}else if(o.osx()>10.4)return (o.firefox()>=3.6||o.chrome()>=5||o.safari()>=500);return false;},isInstalled:function(){var v=false;if(this.isSupported())if(s()){var w=null;try{w=new ActiveXObject('SkypeLimited.SkypeWebPlugin');v=!!w;}catch(x){}w=null;}else v=t();return v;},mightReloadPostInstall:function(){return o.windows();},onVideoMessage:function(v){q.push(v);k.loadModules(['VideoCallController'],bagofholding);},setMessageHandler:function(v){this.onVideoMessage=v;if(v)while(q.length)v(q.shift());},availableForCall:function(v){var w=i.get(v);return w==j.ACTIVE||w==j.IDLE;},onProfileButtonClick:function(v){r.startCallOrLeaveMessage(v,'profile_button_click');},attachListenerToProfileButton:function(v){var w=p('videoCallProfileButton');if(w)Event.listen(w,'click',function(event){r.startCallOrLeaveMessage(v,'profile_button_click_timeline');});},startCallOrLeaveMessage:function(v,w){if(this.availableForCall(v)){r.showOutgoingCallDialog(v,w);}else b('ShortProfiles').get(v,function(x){b('VideoCallRecordMessageDialog').get(v,x.firstName).show();});},showOutgoingCallDialog:function(v,w){var x=w||'unknown';r.logClick(v,x);var y=r.isInstalled()?'outgoing_dialog.php':'intro.php',z='/ajax/chat/video/'+y+'?idTarget='+v;new n().setAllowCrossPageTransition(true).setAsync(new h(z)).show();},logClick:function(v,w){new h().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:v,clickSource:w}).setAllowCrossPageTransition(true).setErrorHandler(bagofholding).send();}};function s(){return o.ie()&&o.windows()&&!o.opera();}function t(){if(!navigator)return null;navigator.plugins.refresh(false);var v=navigator.mimeTypes['application/skypesdk-plugin'];return v&&v.enabledPlugin;}function u(){if(!r.mightReloadPostInstall())return;var v=m.get('vcpwn');if(v){m.clear('vcpwn');var w=m.get('vctid');if(w){m.clear('vctid');if(m.get('vctid'))return;if(w&&r.isInstalled()){var x='/ajax/chat/video/outgoing_dialog.php?idTarget='+w;new n().setAllowCrossPageTransition(true).setAsync(new h(x)).show();}}}}g.subscribe(l.getArbiterType('video'),function(v,w){r.onVideoMessage(w.obj);});g.subscribe(l.getArbiterType('chat_event'),function(v,w){if(w.obj.event_name=="missed-call")k.loadModules(['VideoCallController'],function(x){x.onMissedCallEvent(w.obj);});});u();e.exports=r;});
__d("Poller",["AsyncRequest","Cookie","copyProperties","Env"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Cookie'),i=b('copyProperties'),j=b('Env');function k(l,m,n){this._clearOnQuicklingEvent=!n;this._requestCallback=m;this.setTimePeriod(l);}k.MIN_TIME_PERIOD=2000;i(k.prototype,{stop:function(){clearTimeout(this._token);this._token=null;this._cancelRequest();},scheduleRequest:function(){this.stop();if(this._timePeriod)this._token=this._makeRequest.bind(this).defer(this._timePeriod,this._clearOnQuicklingEvent);},requestNow:function(){this.stop();this._makeRequest();},_timePeriod:null,setTimePeriod:function(l){l=l||null;if(l&&(isNaN(l)||l<k.MIN_TIME_PERIOD))return;if(l&&this._timePeriod==null)this._token=this._makeRequest.bind(this).defer(l,this._clearOnQuicklingEvents);this._timePeriod=l;},_makeRequest:function(){this._cancelRequest();if(!this._isLoadUser())return;var l=new g(),m=true;l.setInitialHandler(function(){return m;});this._cancelRequest=function(){m=false;};l.setFinallyHandler(this.scheduleRequest.bind(this));l.setInitialHandler=bagofholding;l.setFinallyHandler=bagofholding;this._requestCallback(l);if(m)l.send();},_isLoadUser:function(){return j.user==getCookie('c_user');},_cancelRequest:bagofholding,getTimePeriod:function(){return this._timePeriod;}});a.Poller=e.exports=k;},3);
__d("CallbackManagerController",["ErrorUtils","copyProperties"],function(a,b,c,d,e,f){var g=b('ErrorUtils'),h=b('copyProperties'),i=function(j){this._pendingIDs=[];this._allRequests=[undefined];this._callbackArgHandler=j;};h(i.prototype,{executeOrEnqueue:function(j,k,l){l=l||{};var m=this._attemptCallback(k,j,l);if(m)return [];this._allRequests.push({fn:k,request:j,options:l});var n=this._allRequests.length-1;this._pendingIDs.push(n);return n;},unsubscribe:function(j){delete this._allRequests[j];},getRequest:function(j){return this._allRequests[j];},runPossibleCallbacks:function(){var j=this._pendingIDs;this._pendingIDs=[];var k=[];j.forEach(function(l){var m=this._allRequests[l];if(!m)return;if(this._callbackArgHandler(m.request,m.options)){k.push(l);}else this._pendingIDs.push(l);}.bind(this));k.forEach(function(l){var m=this._allRequests[l];delete this._allRequests[l];this._attemptCallback(m.fn,m.request,m.options);}.bind(this));},_attemptCallback:function(j,k,l){var m=this._callbackArgHandler(k,l);if(m){var n={ids:k};g.applyWithGuard(j,n,[m]);}return !!m;}});e.exports=i;});
__d("KeyedCallbackManager",["CallbackManagerController","copyProperties"],function(a,b,c,d,e,f){var g=b('CallbackManagerController'),h=b('copyProperties'),i=function(){this._resources={};this._controller=new g(this._constructCallbackArg.bind(this));};h(i.prototype,{executeOrEnqueue:function(j,k){if(!(j instanceof Array)){var l=j,m=k;j=[j];k=function(n){m(n[l]);};}return this._controller.executeOrEnqueue(j,k);},unsubscribe:function(j){this._controller.unsubscribe(j);},getUnavailableResources:function(j){var k=this._controller.getRequest(j),l=[];if(k)l=k.request.filter(function(m){return !this._resources[m];}.bind(this));return l;},addResourcesAndExecute:function(j){h(this._resources,j);this._controller.runPossibleCallbacks();},setResource:function(j,k){this._resources[j]=k;this._controller.runPossibleCallbacks();},getResource:function(j){return this._resources[j];},getAllResources:function(){return this._resources;},dumpResources:function(){var j={};for(var k in this._resources){var l=this._resources[k];if(typeof l==='object')l=h({},l);j[k]=l;}return j;},_constructCallbackArg:function(j){var k={};for(var l=0;l<j.length;l++){var m=j[l],n=this._resources[m];if(typeof n=='undefined')return false;k[m]=n;}return k;}});e.exports=i;});
__d("MercuryServerDispatcher",["areObjectsEqual","copyProperties","AsyncRequest","debounceAcrossTransitions","JSLogger","URI","Dialog"],function(a,b,c,d,e,f){var g=b('areObjectsEqual'),h=b('copyProperties'),i=b('AsyncRequest'),j=b('debounceAcrossTransitions'),k=b('JSLogger'),l=b('URI'),m={},n=k.create('mercury_dispatcher'),o=false,p={IMMEDIATE:'immediate',IDEMPOTENT:'idempotent',BATCH_SUCCESSIVE:'batch-successive',BATCH_SUCCESSIVE_UNIQUE:'batch-successive-unique',BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR:'batch-successive-piggyback-retry',BATCH_DEFERRED_MULTI:'batch-deferred-multi',BATCH_CONDITIONAL:'batch-conditional',registerEndpoints:function(r){for(var s in r){var t=r[s];m[s]=new q(s,t);}},trySend:function(r,s){m[r].trySend(s);}};function q(r,s){var t=s.mode||p.IMMEDIATE;switch(t){case p.IMMEDIATE:case p.IDEMPOTENT:case p.BATCH_SUCCESSIVE:case p.BATCH_SUCCESSIVE_UNIQUE:case p.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR:case p.BATCH_DEFERRED_MULTI:case p.BATCH_CONDITIONAL:break;default:throw new Error('Invalid MercuryServerDispatcher mode '+t);}this._endpoint=r;this._mode=t;this._combineData=s.batch_function;this._combineDataIf=s.batch_if;this._handler=s.handler;this._errorHandler=s.error_handler;this._transportErrorHandler=s.transport_error_handler||s.error_handler;this._deferredSend=j(this._batchSend,0,this);}h(q.prototype,{_inFlight:0,_handler:null,_errorHandler:null,_transportErrorHandler:null,_combineData:null,_pendingRequestData:null,trySend:function(r){if(o)return;if(typeof r=='undefined')r=null;var s=this._mode;if(s==p.IMMEDIATE){this._send(r);}else if(s==p.IDEMPOTENT){if(!this._inFlight)this._send(r);}else if(s==p.BATCH_SUCCESSIVE||s==p.BATCH_SUCCESSIVE_UNIQUE){if(!this._inFlight){this._send(r);}else this._batchData(r);}else if(s==p.BATCH_CONDITIONAL){if(this._inFlight&&(this._combineDataIf(this._pendingRequestData,r)||this._combineDataIf(this._batchedData,r))){this._batchData(r);}else this._send(r);}else if(s==p.BATCH_DEFERRED_MULTI){this._batchData(r);this._deferredSend();}else if(s==p.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR){this._batchData(r);if(!this._inFlight)this._batchSend();}},_send:function(r){this._inFlight++;this._pendingRequestData=h({},r);n.log('send',{endpoint:this._endpoint,data:r,inflight_count:this._inFlight});new i(this._endpoint).setData(r).setHandler(this._handleResponse.bind(this)).setErrorHandler(this._handleError.bind(this)).setTransportErrorHandler(this._handleTransportError.bind(this)).setAllowCrossPageTransition(true).send();},_batchData:function(r){if(this._mode==p.BATCH_SUCCESSIVE_UNIQUE&&this._pendingRequestData&&g(r,this._pendingRequestData)){return;}else if(typeof this._batchedData=='undefined'){this._batchedData=r;}else this._batchedData=this._combineData(this._batchedData,r);},_batchSend:function(){if(typeof this._batchedData!='undefined'){this._send(this._batchedData);delete this._batchedData;}},_handleResponse:function(r){this._inFlight--;n.log('response',{endpoint:this._endpoint,inflight_count:this._inFlight});var s=r.getPayload();o=s&&s.kill_chat;if(o)n.log('killswitch_enabled',{endpoint:this._endpoint,inflight_count:this._inFlight});if(s&&s.error_payload){if(this._errorHandler)this._errorHandler(r);}else this._handler&&this._handler(s);if(this._mode==p.BATCH_SUCCESSIVE||this._mode==p.BATCH_SUCCESSIVE_UNIQUE||this._mode==p.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR||this._mode==p.BATCH_CONDITIONAL)this._batchSend();this._pendingRequestData=null;},_handleErrorCommon:function(r,s){n.error('error',{endpoint:this._endpoint,inflight_count:this._inFlight-1});s&&s(r);this._inFlight--;var t=this._mode;if(t==p.BATCH_SUCCESSIVE||t==p.BATCH_SUCCESSIVE_UNIQUE||t==p.BATCH_CONDITIONAL){this._batchSend();}else if(t==p.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR)if(typeof this._batchedData=='undefined'){this._batchedData=this._pendingRequestData;}else{this._batchedData=this._combineData(this._pendingRequestData,this._batchedData);this._batchSend();}this._pendingRequestData=null;},_handleError:function(r){this._handleErrorCommon(r,this._errorHandler);},_handleTransportError:function(r){this._handleErrorCommon(r,this._transportErrorHandler);}});e.exports=p;});
__d("MessagingReliabilityLogger",["function-extensions","AsyncRequest","copyProperties","isEmpty","PresenceUtil","Run","MercuryServerDispatcher","MessagingReliabilityLoggerInitialData"],function(a,b,c,d,e,f){b('function-extensions');var g=b('AsyncRequest'),h=b('copyProperties'),i=b('isEmpty'),j=b('PresenceUtil'),k=b('Run'),l=b('MercuryServerDispatcher'),m=c('MessagingReliabilityLoggerInitialData'),n='/ajax/mercury/client_reliability.php',o=2000;function p(v,w){var x={app:m.app,categories:JSON.stringify(v)};if(!i(w))x.extra=JSON.stringify(w);return x;}function q(v,w,x,y){if(v[w]===undefined)v[w]={};if(v[w][x]===undefined)v[w][x]=0;v[w][x]+=y;}function r(v,w,x,y){if(v[w]===undefined)v[w]={};if(v[w][x]===undefined)v[w][x]=[];for(var z=0;z<y.length;++z)v[w][x].push(y[z]);}function s(v,w){if(!v.categories||!w.categories)return;var x=JSON.parse(v.categories),y=v.extra?JSON.parse(v.extra):{},z=JSON.parse(w.categories),aa=w.extra?JSON.parse(w.extra):{};for(var ba in z){var ca=z[ba],da=aa[ba];for(var ea in ca){q(x,ba,ea,ca[ea]);if(da!==undefined){var fa=da[ea];if(fa!==undefined)r(y,ba,ea,fa);}}}return p(x,y);}var t={};t[n]={mode:l.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR,batch_function:s};l.registerEndpoints(t);var u={addEntry:function(v,w,x){if(!m.enabled)return;var y={};q(y,v,w,1);var z={};if(x!==undefined)r(z,v,w,[x]);l.trySend(n,p(y,z));}};u.addEntry('page_event','load',j.getSessionID());k.onBeforeUnload(function(){var v={page_event:{unload:1}},w={page_event:{unload:[j.getSessionID()]}};new g(n).setData(p(v,w)).setOption('asynchronous',false).setTimeoutHandler(bagofholding).resetTimeout(o).send();},false);e.exports=u;});
__d("MercuryIDs",[],function(a,b,c,d,e,f){function g(h){return typeof h==='string'&&h.indexOf(':')!==-1;}e.exports={isValid:function(h){if(!h)return false;return g(h);},tokenize:function(h){if(!this.isValid(h))throw 'bad_id_format';var i=h.indexOf(':');return {type:h.substr(0,i),value:h.substr(i+1)};}};});
__d("MercuryAssert",["MercuryIDs"],function(a,b,c,d,e,f){var g=b('MercuryIDs');e.exports={isParticipantID:function(h){if(!g.isValid(h))throw 'bad_participant_id';},allParticipantIDs:function(h){h.forEach(this.isParticipantID);},isUserParticipantID:function(h){var i=g.tokenize(h);if(i.type!='fbid')throw 'bad_user_id';},isEmailParticipantID:function(h){var i=g.tokenize(h);if(i.type!='email')throw 'bad_email_id';},allThreadID:function(h){h.forEach(this.isThreadID);},isThreadID:function(h){if(!g.isValid(h))throw 'bad_thread_id';}};});
__d("TimestampConverter",["JSLogger"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=g.create('timestamp_converter');function i(k){return (typeof(k)=='string')&&k.length>6;}var j={convertActionIDToTimestamp:function(k){if(i(k)){var l=k.slice(0,-6);return parseInt(l,10);}},maxValidActionID:function(k,l){if(!i(k))return l;if(!i(l))return k;return this.isGreaterThan(k,l)?k:l;},isGreaterThan:function(k,l){if(!i(k)||!i(l))return false;return this.convertActionIDToTimestamp(k)>this.convertActionIDToTimestamp(l);}};e.exports=j;});
__d("MercuryThreadInformer",["Arbiter","copyProperties","MercuryAssert"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('MercuryAssert'),j={},k={},l={},m=false,n=false,o=false,p={},q={},r={},s=0;function t(){if(!s){var v=j,w=k,x=l,y=m,z=n,aa=o,ba=p,ca=q,da=r;j={};k={};l={};m=false;n=false;o=false;p={};q={};r={};var ea=Object.keys(w);if(ea.length||y)u.inform('threadlist-updated',ea);if(ea.length)u.inform('threads-updated',w);for(var fa in x){u.inform('thread-read-changed',x);break;}for(var fa in v){u.inform('threads-deleted',v);break;}if(z)u.inform('unseen-updated',null);if(aa)u.inform('unread-updated',null);for(fa in ba){u.inform('messages-received',ba);break;}for(fa in ca){u.inform('messages-reordered',ca);break;}for(fa in da){u.inform('messages-updated',da);break;}}}var u=h(new g(),{updatedThread:function(v){k[v]=true;t();},deletedThread:function(v){j[v]=true;t();},updatedThreadlist:function(){m=true;t();},updatedUnseenState:function(){n=true;t();},updatedUnreadState:function(){o=true;t();},changedThreadReadState:function(v,w,x){if(!l[v]||l[v].timestamp<x)l[v]={mark_as_read:w,timestamp:x};t();},receivedMessage:function(v){i.isThreadID(v.thread_id);var w=v.thread_id;if(!p[w])p[w]=[];p[w].push(v);this.updatedThread(w);},reorderedMessages:function(v,w){q[v]={source:w};t();},updatedMessage:function(v,w,x){if(!r[v])r[v]={};r[v][w]={source:x};t();},synchronizeInforms:function(v){s++;try{v();}catch(w){throw w;}finally{s--;t();}},listen:function(v,w){return this.subscribe('threads-updated',function(x,y){if(y[v])w(v);});}});e.exports=u;});
__d("MercuryServerRequests",["Arbiter","KeyedCallbackManager","TimestampConverter","copyProperties","Env","JSLogger","MercuryAssert","MercuryServerDispatcher","MercuryThreadInformer","MercuryIDs","MessagingReliabilityLogger","createObjectFrom","hasArrayNature","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('KeyedCallbackManager'),i=b('TimestampConverter'),j=b('copyProperties'),k=b('Env'),l=b('JSLogger'),m=b('MercuryAssert'),n=b('MercuryServerDispatcher'),o=b('MercuryThreadInformer'),p=b('MercuryIDs'),q=b('MessagingReliabilityLogger'),r=b('createObjectFrom'),s=b('hasArrayNature'),t=c('MercuryConstants'),u=0,v=l.create('mercury_server'),w=new h(),x=new h(),y=[],z={},aa={};function ba(va){if(va){v.log('action_id_update',{old_action_id:u,new_action_id:va});u=i.maxValidActionID(u,va);}}function ca(va){var wa=va.thread_id,xa=w.getResource(wa);if(!xa){if(va.is_canonical_user){var ya=va.participants;if(ya.length==1){xa='user:'+k.user;}else ya.forEach(function(za){var ab=p.tokenize(za);if(ab.type=='fbid'&&ab.value!=k.user)xa='user:'+ab.value;});}else if(va.is_canonical_group){xa='group:'+va.group_id;}else if(va.is_canonical_live_listen){xa='live_listen:'+va.live_listen_id;}else if(va.root_message_threading_id)xa='root:'+va.root_message_threading_id;xa=xa||'thread:'+wa;da(wa,xa);}va.thread_id=xa;}function da(va,wa){w.setResource(va,wa);x.setResource(wa,va);aa[va]=wa;}function ea(va,wa){var xa=x.executeOrEnqueue(va,wa),ya=x.getUnavailableResources(xa),za=sa.tokenizeThreadID(va);if(ya.length&&za.type!='root')sa.fetchThreadData(ya);}function fa(va){return x.getResource(va);}function ga(va){return !!w.getResource(va);}function ha(va){var wa=w.getResource(va);if(typeof wa=='undefined')v.warn('no_client_thread_id',{server_id:va});return wa;}function ia(va){if(va.action_type!=t.MercuryActionType.SEND_MESSAGE)return;var wa=va.client_thread_id;if(!wa)wa=ha(va.thread_id);var xa=null;if(wa)xa=p.tokenize(wa).type;var ya=null;switch(va.status){case t.MercuryActionStatus.SUCCESS:ya='success';break;case t.MercuryActionStatus.REQUEST_ERROR:ya='request_error';break;case t.MercuryActionStatus.TRANSPORT_ERROR:ya='transport_error';break;case t.MercuryActionStatus.FAILED_UNKNOWN_REASON:ya='confirmed_error';break;case t.MercuryActionStatus.UNABLE_TO_CONFIRM:ya='confirm_error';break;default:return;}q.addEntry('send_'+xa,ya,va.thread_id+','+va.message_id);}function ja(va){if(va.message_counts&&!(va.message_counts instanceof Array)){va.message_counts=[va.message_counts];va.message_counts[0].folder=t.MessagingTag.INBOX;}(va.message_counts||[]).forEach(function(eb){ba(eb.last_action_id);});(va.threads||[]).forEach(function(eb){ca(eb);delete z[eb.thread_id];delete z[fa(eb.thread_id)];ba(eb.last_action_id);});(va.ordered_threadlists||[]).forEach(function(eb){eb.thread_ids=eb.thread_ids.map(ha);});va.actions=va.actions||[];va.actions.forEach(function(eb){ia(eb);if(eb.status&&eb.status!=t.MercuryActionStatus.SUCCESS&&!eb.thread_id){eb.thread_id=eb.client_thread_id;return;}if(eb.action_type==t.MercuryActionType.SEND_MESSAGE&&eb.client_thread_id)da(eb.thread_id,eb.client_thread_id);eb.server_thread_id=eb.thread_id;eb.thread_id=ga(eb.thread_id)?ha(eb.thread_id):null;ba(eb.action_id);});if(va.end_of_history){var wa=[];for(var xa=0;xa<va.end_of_history.length;xa++){var ya=va.end_of_history[xa];if(ya.type=='user'){wa.push('user:'+ya.id);}else if(ya.type=='thread'&&ga(ya.id))wa.push(ha(ya.id));}va.end_of_history=wa;}if(va.roger){var za={};for(var ab in va.roger){var bb=w.getResource(ab);if(bb){var cb=va.roger[ab];za[bb]={};for(var db in cb)za[bb]['fbid:'+db]=cb[db];}}va.roger=za;}}function ka(){if(y&&y.length){var va=y[0];y=y.slice(1);sa.handleUpdate(va);}}function la(va,wa){var xa=j({},va),ya;if(wa.threads){if(!xa.threads)xa.threads={};for(ya in wa.threads)xa.threads[ya]=Object.keys(r((xa.threads[ya]||[]).concat(wa.threads[ya])));}if(wa.messages){if(!xa.messages)xa.messages={};for(ya in wa.messages){if(!xa.messages[ya])xa.messages[ya]={};for(var za in wa.messages[ya])if(xa.messages[ya][za]){xa.messages[ya][za]=oa(xa.messages[ya][za],wa.messages[ya][za]);}else xa.messages[ya][za]=wa.messages[ya][za];}}return xa;}function ma(va,wa){var xa=j(r(va.folders,true),r(wa.folders,true));return {folders:Object.keys(xa)};}function na(va,wa){for(var xa in wa)if(va[xa]){va[xa]=oa(va[xa],wa[xa]);}else{var ya={};j(ya,wa[xa]);va[xa]=ya;}return va;}function oa(va,wa){var xa=va.offset<wa.offset?va.offset:wa.offset,ya=va.offset+va.limit,za=wa.offset+wa.limit,ab=(ya>za)?ya:za,bb=ab-xa;return {offset:xa,limit:bb};}function pa(va,wa){var xa={ids:{}};j(xa.ids,va.ids);j(xa.ids,wa.ids);return xa;}function qa(va,wa){var xa={},ya;for(ya in va)j(xa,r(va[ya],ya));for(ya in wa)j(xa,r(wa[ya],ya));var za={};for(var ab in xa){ya=xa[ab];if(!za[ya])za[ya]=[];za[ya].push(ab);}return za;}function ra(va,wa){var xa=r(va.ids,true),ya=r(wa.ids,true),za=j(xa,ya);return {ids:Object.keys(za)};}var sa=j(new g(),{tokenizeThreadID:function(va){m.isThreadID(va);return p.tokenize(va);},getServerThreadID:function(va,wa){m.isThreadID(va);ea(va,wa);},getClientThreadIDNow:function(va){return ha(va);},getServerThreadIDNow:function(va){return fa(va);},convertThreadIDIfAvailable:function(va){var wa=w.getResource(va);if(wa===undefined){return va;}else return wa;},canLinkExternally:function(va){m.isThreadID(va);var wa=sa.tokenizeThreadID(va);return (wa.type=='user')||!!fa(va);},fetchThreadlistInfo:function(va,wa,xa){xa=xa||t.MessagingTag.INBOX;var ya={};ya[xa]={offset:va,limit:wa};n.trySend('/ajax/mercury/threadlist_info.php',ya);},fetchUnseenThreadIDs:function(va){this.fetchThreadlistInfo(t.MercuryThreadlistConstants.RECENT_THREAD_OFFSET,t.MercuryThreadlistConstants.JEWEL_THREAD_COUNT,va);},fetchUnreadThreadIDs:function(va){n.trySend('/ajax/mercury/unread_threads.php',{folders:[va]});},fetchMissedMessages:function(va){n.trySend('/ajax/mercury/thread_sync.php',{last_action_id:u,folder:va[0],folders:va});},fetchFullMissedMessages:function(){n.trySend('/ajax/mercury/thread_full_sync.php',{last_action_id:u,folders:[t.MessagingTag.INBOX]});},fetchThreadData:function(va){m.allThreadID(va);var wa={threads:{}},xa=[],ya=[],za=[],ab=[];va.forEach(function(cb){if(z[cb])return;z[cb]=true;var db=sa.tokenizeThreadID(cb);if(db.type=='user'){xa.push(db.value);wa.threads.user_ids=xa;}else if(db.type=='group'){za.push(db.value);wa.threads.group_ids=za;}else if(db.type=='live_listen'){ab.push(db.value);wa.threads.live_listen_ids=ab;}else if(db.type=='thread'){ya.push(db.value);wa.threads.thread_ids=ya;}else if(db.type!='root')throw new Error('Unknown thread type',db);});this.inform("fetch-thread-data",wa);for(var bb in wa.threads){n.trySend('/ajax/mercury/thread_info.php',wa);break;}},ensureThreadIsFetched:function(va){if(!w.getResource(va)&&!z[va]){z[va]=true;n.trySend('/ajax/mercury/thread_info.php',{threads:{thread_ids:[va]}});}},fetchThreadMessages:function(va,wa,xa){m.isThreadID(va);var ya=sa.tokenizeThreadID(va),za;switch(ya.type){case 'user':za='user_ids';break;case 'group':za='group_ids';break;case 'live_listen':za='live_listen_ids';break;case 'thread':za='thread_ids';break;}var ab={messages:{}};if(za){ab.messages[za]={};ab.messages[za][ya.value]={offset:wa,limit:xa};n.trySend('/ajax/mercury/thread_info.php',ab);}else ea(va,function(bb){ab.messages.thread_ids={};ab.messages.thread_ids[bb]={offset:wa,limit:xa};n.trySend('/ajax/mercury/thread_info.php',ab);});},handleThreadInfoError:function(va){var wa=va.getRequest().getData(),xa=[];if(wa.messages){for(var ya in wa.messages.thread_ids)xa.push(ta(ha(ya)));for(var za in wa.messages.user_ids)xa.push(ta('user:'+za));for(var ab in wa.messages.group_ids)xa.push(ta('group:'+ab));}if(xa.length)sa.handleUpdate({actions:xa,from_client:true,payload_source:t.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});if(wa.threads&&(wa.threads.user_ids||wa.threads.group_ids||wa.threads.live_listen_ids||wa.threads.thread_ids)&&!wa.is_retry){if(wa.messages)delete wa.messages;v.log('retry_thread',wa);wa.is_retry=true;n.trySend('/ajax/mercury/thread_info.php',wa);}},changeThreadReadStatus:function(va,wa,xa){m.isThreadID(va);ea(va,function(za){var ab={ids:{}};ab.ids[za]=wa;n.trySend('/ajax/mercury/change_read_status.php',ab);});var ya=[{action_type:t.MercuryActionType.CHANGE_READ_STATUS,action_id:null,thread_id:va,mark_as_read:wa,folder:xa}];this.handleUpdate({actions:ya,from_client:true,payload_source:t.MercuryPayloadSource.CLIENT_CHANGE_READ_STATUS});},changeThreadArchivedStatus:function(va,wa){m.isThreadID(va);ea(va,function(za){var ab={ids:{}};ab.ids[za]=wa;n.trySend('/ajax/mercury/change_archived_status.php',ab);});var xa={action_type:t.MercuryActionType.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:va,archived:wa},ya={actions:[xa],from_client:true,payload_source:t.MercuryPayloadSource.CLIENT_CHANGE_ARCHIVED_STATUS};this.handleUpdate(ya);},changeThreadFolder:function(va,wa){m.isThreadID(va);ea(va,function(za){var ab={};ab[wa]=[za];n.trySend('/ajax/mercury/move_thread.php',ab);});var xa={action_type:t.MercuryActionType.CHANGE_FOLDER,action_id:null,thread_id:va,new_folder:wa},ya={actions:[xa],from_client:true,payload_source:t.MercuryPayloadSource.CLIENT_CHANGE_FOLDER};this.handleUpdate(ya);},deleteThread:function(va){m.isThreadID(va);ea(va,function(ya){var za={ids:[ya]};n.trySend('/ajax/mercury/delete_thread.php',za);});var wa={action_type:t.MercuryActionType.DELETE_THREAD,action_id:null,thread_id:va},xa={actions:[wa],from_client:true,payload_source:t.MercuryPayloadSource.CLIENT_DELETE_THREAD};this.handleUpdate(xa);},clearChat:function(va,wa,xa){m.isThreadID(va);n.trySend('/ajax/chat/settings.php',{clear_history_id:wa});var ya=[{action_type:t.MercuryActionType.CLEAR_CHAT,action_id:null,thread_id:va,clear_time:xa}];this.handleUpdate({actions:ya,from_client:true,payload_source:t.MercuryPayloadSource.CLIENT_CLEAR_CHAT});},_batchThreadRead:function(va,wa){var xa={};j(xa,va.ids);j(xa,wa.ids);return {ids:xa};},sendNewMessage:function(va){var wa=sa.tokenizeThreadID(va.thread_id),xa=j({},va);if((wa.type=='root'&&wa.value==xa.message_id)||(wa.type=='user'&&!fa(va.thread_id))){xa.client_thread_id=xa.thread_id;xa.thread_id=null;this._sendNewMessageToServer(xa);}else ea(xa.thread_id,function(za){xa.thread_id=za;sa._sendNewMessageToServer(xa);});var ya={actions:[j({},va)],from_client:true,payload_source:t.MercuryPayloadSource.CLIENT_SEND_MESSAGE};sa.handleUpdate(ya);},_sendNewMessageToServer:function(va){n.trySend('/ajax/mercury/send_messages.php',{message_batch:[va]});},_batchMessageSend:function(va,wa){return {message_batch:va.message_batch.concat(wa.message_batch)};},requestMessageConfirmation:function(va){var wa={},xa={};for(var ya in va){var za=fa(ya);if(za){wa[za]=va[ya];}else{var ab=va[ya];for(var bb=0;bb<ab.length;bb++)xa[ab[bb]]=ya;}}var cb=Object.keys(wa),db=Object.keys(xa);if(cb.length||db.length)n.trySend('/ajax/mercury/confirm_messages.php',{thread_message_map:wa,local_messages:xa});},handleMessageConfirmError:function(va){var wa=va.getRequest().getData().thread_message_map,xa=va.getRequest().getData().local_messages;if(!wa&&!xa)return;var ya=[];for(var za in wa){var ab=wa[za];ab.forEach(function(db){ya.push({action_type:t.MercuryActionType.SEND_MESSAGE,client_message_id:db,message_id:db,client_thread_id:null,thread_id:za,status:t.MercuryActionStatus.UNABLE_TO_CONFIRM});});}for(var bb in xa){var cb=xa[bb];ya.push({action_type:t.MercuryActionType.SEND_MESSAGE,client_message_id:bb,message_id:bb,client_thread_id:cb,thread_id:null,status:t.MercuryActionStatus.UNABLE_TO_CONFIRM});}if(ya.length)this.handleUpdate({actions:ya,payload_source:t.MercuryPayloadSource.CLIENT_HANDLE_ERROR});},markSeen:function(){var va=i.convertActionIDToTimestamp(u);n.trySend('/ajax/mercury/mark_seen.php',{seen_timestamp:va});},_batchMarkSeen:function(va,wa){return wa;},handleRoger:function(va){var wa=va.tid?w.getResource(va.tid):('user:'+va.reader);if(wa){var xa={};xa[wa]={};xa[wa]['fbid:'+va.reader]=va.time;this.inform('update-roger',xa);}},handleUpdateWaitForThread:function(va,wa){var xa;if(va.payload_source==t.MercuryPayloadSource.CLIENT_LIVE_LISTEN){va.from_client=true;xa=x.getResource(wa);if(xa){sa.handleUpdate(va);return;}x.executeOrEnqueue(wa,function(){y.push(va);});this.fetchThreadData([wa]);}else{xa=w.getResource(wa);if(xa){sa.handleUpdate(va);return;}w.executeOrEnqueue(wa,function(){y.push(va);});if(!z[wa]){z[wa]=true;n.trySend('/ajax/mercury/thread_info.php',{threads:{thread_ids:[wa]}});}}},handleUpdate:function(va){v.debug('handle_update',{payload:va,from_client:va.from_client});for(var wa in va){o.synchronizeInforms(function(){if(!va.from_client)ja(va);this.inform('update-thread-ids',aa);aa={};this.inform('update-participants',va);this.inform('update-threads',va);this.inform('update-unread',va);this.inform('update-threadlist',va);this.inform('update-messages',va);this.inform('update-unseen',va);this.inform('update-typing-state',va);this.inform('update-roger',va.roger);this.inform('model-update-completed',null);ka();}.bind(this));break;}},_handleSendMessageErrorCommon:function(va,wa){var xa=va.getPayload(),ya=va.getRequest().getData(),za=ya.message_batch;if(!za){ia({action_type:t.MercuryActionType.SEND_MESSAGE,status:t.MercuryActionStatus.REQUEST_EMPTY_MESSAGE_LIST});return;}var ab;if(xa&&xa.error_payload){ab=t.MercuryActionStatus.UNCONFIRMED;}else ab=wa;var bb=za.map(function(db){return {action_type:t.MercuryActionType.SEND_MESSAGE,client_message_id:db.message_id,message_id:db.message_id,client_thread_id:db.client_thread_id,thread_id:db.thread_id,status:ab};}),cb={actions:bb,payload_source:t.MercuryPayloadSource.CLIENT_HANDLE_ERROR};this.handleUpdate(cb);},handleSendMessageError:function(va){this._handleSendMessageErrorCommon(va,t.MercuryActionStatus.REQUEST_ERROR);},handleSendMessageTransportError:function(va){this._handleSendMessageErrorCommon(va,t.MercuryActionStatus.TRANSPORT_ERROR);},getLastActionID:function(){return u;}});function ta(va){return {action_type:t.MercuryActionType.LOG_MESSAGE,thread_id:va,message_id:va,timestamp:(new Date()).getTime(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:t.MercurySourceType.UNKNOWN,log_message_type:t.MercuryLogMessageType.SERVER_ERROR,log_message_data:{}};}var ua=sa.handleUpdate.bind(sa);n.registerEndpoints({'/ajax/mercury/thread_sync.php':{mode:n.IDEMPOTENT,handler:ua},'/ajax/mercury/thread_full_sync.php':{mode:n.IDEMPOTENT,handler:ua},'/ajax/mercury/thread_info.php':{mode:n.BATCH_DEFERRED_MULTI,batch_function:la,handler:ua,error_handler:sa.handleThreadInfoError.bind(sa)},'/ajax/mercury/change_read_status.php':{mode:n.BATCH_SUCCESSIVE,batch_function:sa._batchThreadRead,handler:ua},'/ajax/mercury/send_messages.php':{mode:n.BATCH_SUCCESSIVE,batch_function:sa._batchMessageSend,handler:ua,error_handler:sa.handleSendMessageError.bind(sa),transport_error_handler:sa.handleSendMessageTransportError.bind(sa)},'/ajax/mercury/mark_seen.php':{mode:n.BATCH_SUCCESSIVE,batch_function:sa._batchMarkSeen,handler:ua},'/ajax/mercury/confirm_messages.php':{mode:n.IMMEDIATE,handler:ua,error_handler:sa.handleMessageConfirmError.bind(sa)},'/ajax/mercury/threadlist_info.php':{mode:n.BATCH_SUCCESSIVE_UNIQUE,batch_function:na,handler:ua},'/ajax/mercury/unread_threads.php':{mode:n.BATCH_SUCCESSIVE_UNIQUE,batch_function:ma,handler:ua},'/ajax/chat/settings.php':{mode:n.IMMEDIATE},'/ajax/mercury/change_archived_status.php':{mode:n.BATCH_SUCCESSIVE,batch_function:pa,handler:ua},'/ajax/mercury/delete_thread.php':{mode:n.BATCH_SUCCESSIVE,batch_function:ra,handler:ua},'/ajax/mercury/move_thread.php':{mode:n.BATCH_SUCCESSIVE,batch_function:qa,handler:ua}});e.exports=sa;});
__d("MercuryParticipants",["Env","JSLogger","MercuryAssert","ShortProfiles","MercuryServerRequests","MercuryIDs","copyProperties","getObjectValues","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Env'),h=b('JSLogger'),i=b('MercuryAssert'),j=b('ShortProfiles'),k=b('MercuryServerRequests'),l=b('MercuryIDs'),m=b('copyProperties'),n=b('getObjectValues'),o=c('MercuryConstants'),p='fbid:'+g.user,q={},r=h.create('mercury_participants'),s=function(v){if(!q[v.id])q[v.id]=m({},v);};function t(v){i.isEmailParticipantID(v);var w=l.tokenize(v),x=w.value;return {gender:o.MercuryParticipantsConstants.UNKNOWN_GENDER,href:null,id:v,image_src:o.MercuryParticipantsConstants.EMAIL_IMAGE,name:x,short_name:x,employee:false,call_promo:false};}var u={user:p,get:function(v,w){i.isParticipantID(v);this.getMulti([v],function(x){w(x[v]);});},getMulti:function(v,w){i.allParticipantIDs(v);var x={},y={};v.forEach(function(aa){if(q[aa]){x[aa]=m({},q[aa]);}else{var ba=l.tokenize(aa);if(ba.type=='fbid'){var ca=ba.value;y[aa]=ca;}else if(ba.type=='email')x[aa]=t(aa);}});var z=n(y);if(z.length){j.getMulti(z,function(aa){for(var ba in y){var ca=y[ba],da=aa[ca];x[ba]={gender:da.gender,href:da.uri,id:ba,image_src:da.thumbSrc,name:da.name,short_name:da.firstName,employee:da.employee,call_promo:da.showVideoPromo};}w(x);});}else w(x);},getUserID:function(v){if(!l.isValid(v))return null;var w=l.tokenize(v);if(w.type!='fbid')return null;return w.value;},addParticipants:function(v){v.forEach(s);}};k.subscribe('update-participants',function(v,w){u.addParticipants(w.participants||[]);});e.exports=u;});
__d("MercuryFolders",["array-extensions","MercuryConstants"],function(a,b,c,d,e,f){b('array-extensions');var g=c('MercuryConstants'),h=[g.MessagingTag.INBOX,g.MessagingTag.OTHER,g.MessagingTag.ACTION_ARCHIVED],i={getSupportedFolders:function(){return h.concat();},isSupportedFolder:function(j){return h.contains(j);},getFromMeta:function(j){var k=j.folder;if(j.is_archived)k=g.MessagingTag.ACTION_ARCHIVED;return k;}};e.exports=i;});
__d("MercuryAttachment",["startsWith","MercuryConstants"],function(a,b,c,d,e,f){var g=b('startsWith'),h=c('MercuryConstants'),i={getAttachIconClass:function(j){switch(j){case h.MercuryAttachmentContentType.PHOTO:return 'MercuryPhotoIcon';case h.MercuryAttachmentContentType.VIDEO:return 'MercuryVideoIcon';case h.MercuryAttachmentContentType.MUSIC:return 'MercuryMusicIcon';case h.MercuryAttachmentContentType.TEXT:return 'MercuryTextIcon';}return 'MercuryDefaultIcon';},getAttachIconClassByMime:function(j){if(g(j,'image')){return 'MercuryPhotoIcon';}else if(g(j,'video')){return 'MercuryVideoIcon';}else if(g(j,'audio')){return 'MercuryMusicIcon';}else if(g(j,'text/plain')){return 'MercuryTextIcon';}else return 'MercuryDefaultIcon';},getAttachTypeByMime:function(j){if(g(j,'image')){return h.MercuryAttachmentContentType.PHOTO;}else if(g(j,'video')){return h.MercuryAttachmentContentType.VIDEO;}else if(g(j,'audio')){return h.MercuryAttachmentContentType.MUSIC;}else if(g(j,'text/plain')){return h.MercuryAttachmentContentType.TEXT;}else return h.MercuryAttachmentContentType.UNKNOWN;}};e.exports=i;});
__d("MercuryAttachmentRenderer",["CSS","DOM","MercuryAttachment","MercuryAttachmentTemplates","MercuryConstants"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('MercuryAttachment'),j=c('MercuryAttachmentTemplates'),k=c('MercuryConstants'),l={renderError:function(m){var n=j[':fb:mercury:attachment:error'].build();h.appendContent(n.getRoot(),m.error_msg);return n.getRoot();},renderExternalLink:function(m){var n=j[':fb:mercury:attachment:external-link'].build().setNodeContent('name',m.name).setNodeContent('shortLink',m.base_url),o=n.getNode('preview-link');o.setAttribute('href',m.url);m.rel&&o.setAttribute('rel',m.rel);n.getNode('preview-image').setAttribute('src',m.preview_url);n.getNode('name').setAttribute('href',m.url);g.addClass(n.getNode('preview'),m.preview_class);return n.getRoot();},renderFileLink:function(m){var n=j[':fb:mercury:attachment:file-link'].build().setNodeContent('filename',m.name),o=n.getNode('link');o.setAttribute('href',m.url);m.rel&&o.setAttribute('rel',m.rel);g.addClass(n.getRoot(),i.getAttachIconClass(m.icon_type));return n.getRoot();},renderMusic:function(m){var n=j[':fb:mercury:attachment:music'].build().setNodeContent('filename',m.name),o=n.getNode('link');o.setAttribute('href',m.url);o.setAttribute('target','_blank');m.rel&&o.setAttribute('rel',m.rel);var p=n.getNode('preview-link');p.setAttribute('href',m.url);m.rel&&p.setAttribute('rel',m.rel);n.getNode('preview-image').setAttribute('src',m.preview_url);g.addClass(n.getNode('icon_link'),'MercuryMusicIcon');return n.getRoot();},renderPreview:function(m){var n=j[':fb:mercury:attachment:preview'].build(),o=n.getNode('preview-link');o.setAttribute('href',m.url);m.rel&&o.setAttribute('rel',m.rel);n.getNode('preview-image').setAttribute('src',m.preview_url);g.addClass(n.getRoot(),m.preview_class);return n.getRoot();},renderShareLink:function(m){var n=j[':fb:mercury:attachment:share-link'].build().setNodeContent('name',m.name),o=n.getNode('link');o.setAttribute('href',m.url);m.rel&&o.setAttribute('rel',m.rel);return n.getRoot();},renderVideoThumb:function(m){var n=j[':fb:mercury:attachment:video-thumb'].build(),o=n.getNode('thumb');o.setAttribute('href',m.url);o.setAttribute('rel',m.rel);var p=h.find(n.getRoot(),'img');p.src=m.preview_url;return n.getRoot();},convertRaw:function(m){var n=[];for(var o=0;o<m.length;o++){var p=m[o];if(p.filename){var q={};q.attach_type=k.MercuryAttachmentType.FILE;q.name=p.filename;q.icon_type=i.getAttachTypeByMime(p.filetype);q.url='#';n.push(q);}}return n;}};e.exports=l;});
__d("MercuryTimestampTracker",["MercuryServerRequests","MercuryConstants"],function(a,b,c,d,e,f){var g=b('MercuryServerRequests'),h=c('MercuryConstants'),i=0;e.exports={getLastUserMessageTimestamp:function(){return i;}};g.subscribe('update-messages',function(j,k){if(!k.actions||!k.actions.length)return;var l=h.MercuryPayloadSource;if(k.payload_source==l.CLIENT_SEND_MESSAGE||k.payload_source==l.UNKNOWN)return;for(var m=0;m<k.actions.length;m++){var n=k.actions[m],o=n.action_type;if(o==h.MercuryActionType.USER_GENERATED_MESSAGE&&n.thread_id&&n.timestamp>i)i=n.timestamp;}});});
__d("MercuryThreads",["Arbiter","copyProperties","JSLogger","createObjectFrom","KeyedCallbackManager","TimestampConverter","MercuryFolders","MercuryAssert","MercuryAttachmentRenderer","MercuryServerRequests","MercuryThreadInformer","MercuryTimestampTracker","MercuryParticipants","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('JSLogger'),j=b('createObjectFrom'),k=b('KeyedCallbackManager'),l=b('TimestampConverter'),m=b('MercuryFolders'),n=b('MercuryAssert'),o=b('MercuryAttachmentRenderer'),p=b('MercuryServerRequests'),q=b('MercuryThreadInformer'),r=b('MercuryTimestampTracker'),s=b('MercuryParticipants'),t=c('MercuryConstants'),u=i.create('mercury_threads'),v=new k();function w(ga,ha){var ia=j(ga.participants,true),ja=s.user;ha.forEach(function(ka){if(ia[ka]!==true){ga.participants.push(ka);if(ka===ja)ga.is_subscribed=true;}});}function x(ga,ha){ga.participants.remove(ha);if(ha===s.user)ga.is_subscribed=false;}function y(ga,ha){if(ga.participants[0]!=ha){ga.participants.remove(ha);ga.participants.unshift(ha);}}function z(ga,ha){var ia=ha.body,ja=ha.subject,ka='';if(ja){ja=ja.toLowerCase();if(ia.slice(0,ja.length).toLowerCase()==ja){ka=ia;}else if(ia){ka=ja+' \u00B7 '+ia;}else ka=ja;}else ka=ia;ga.snippet=ka;ga.snippet_has_attachment=ha.has_attachment;if(ha.raw_attachments&&ha.raw_attachments.length>0){var la=o.convertRaw(ha.raw_attachments);ga.snippet_attachments=la;}else ga.snippet_attachments=ha.attachments;ga.is_forwarded_snippet=!!ha.forward_count;}function aa(ga,ha){if(!ga)return false;var ia=!ga.unread_count;if(ha==ia)return false;ga.unread_count=ha?0:1;v.setResource(ga.thread_id,ga);q.updatedThread(ga.thread_id);return true;}function ba(ga){var ha=v.getAllResources();for(var ia in ha){var ja=ha[ia];ja.unread_count=0;v.setResource(ia,ja);q.updatedThread(ia);}}function ca(ga,ha){if(!ga||ga.chat_clear_time===ha)return false;ga.chat_clear_time=ha;v.setResource(ga.thread_id,ga);q.reorderedMessages(ga.thread_id);return true;}function da(ga,ha){var ia=ha.action_type;if(ia==t.MercuryActionType.USER_GENERATED_MESSAGE||ia==t.MercuryActionType.LOG_MESSAGE){ha.is_unread&&ga.unread_count++;ga.is_archived=false;}switch(ia){case t.MercuryActionType.USER_GENERATED_MESSAGE:y(ga,ha.author);break;case t.MercuryActionType.LOG_MESSAGE:var ja=ha.log_message_type;if(ja==t.MercuryLogMessageType.SUBSCRIBE){w(ga,ha.log_message_data.added_participants);}else if(ja==t.MercuryLogMessageType.UNSUBSCRIBE){x(ga,ha.author);}else if(ja==t.MercuryLogMessageType.THREAD_IMAGE){ga.image_src=ha.log_message_data.image?ha.log_message_data.image.preview_url:null;}else if(ja==t.MercuryLogMessageType.THREAD_NAME)ga.name=ha.log_message_data.name;break;case t.MercuryActionType.CHANGE_READ_STATUS:if(ha.timestamp)q.changedThreadReadState(ga.thread_id,ha.mark_as_read,ha.timestamp);aa(ga,ha.mark_as_read);break;case t.MercuryActionType.CLEAR_CHAT:ca(ga,ha.clear_time);break;case t.MercuryActionType.CHANGE_ARCHIVED_STATUS:ga.is_archived=ha.archived;break;case t.MercuryActionType.CHANGE_FOLDER:ga.folder=ha.new_folder;break;}if(ha.action_id)ga.last_action_id=l.maxValidActionID(ha.action_id,ga.last_action_id);}function ea(ga){var ha=p.tokenizeThreadID(ga.thread_id);if(ha.type=='group'||ha.type=='live_listen'){u.error('invalid_new_thread_message',ga);return undefined;}var ia={thread_id:ga.thread_id,last_action_id:ga.action_id,participants:ga.specific_to_list,name:null,snippet:ga.body,snippet_has_attachment:false,snippet_attachments:[],unread_count:0,image_src:null,timestamp_absolute:ga.timestamp_absolute,timestamp_relative:ga.timestamp_relative,timestamp:ga.timestamp,is_canonical_user:ha.type=='user',is_subscribed:true,is_canonical_group:false,is_chatlogger_thread:false,group_id:null,is_canonical_live_listen:false,live_listen_id:null,root_message_threading_id:ga.message_id,folder:t.MessagingTag.INBOX,is_archived:false,mode:t.MercuryThreadMode.TITAN_ORIGINATED};v.setResource(ia.thread_id,ia);return ia;}g.subscribe(i.DUMP_EVENT,function(ga,ha){ha.messaging=ha.messaging||{};ha.messaging.threads=v.dumpResources();});var fa={getThreadMetaNow:function(ga){n.isThreadID(ga);return v.getResource(ga);},getThreadMeta:function(ga,ha){n.isThreadID(ga);var ia=v.executeOrEnqueue(ga,ha),ja=v.getUnavailableResources(ia);if(ja.length){var ka=p.tokenizeThreadID(ga);if(ka.type=='user'){this.getCanonicalThreadToUser(ka.value);}else p.fetchThreadData(ja);}return ia;},unsubscribe:function(ga){v.unsubscribe(ga);},changeThreadReadStatus:function(ga,ha){n.isThreadID(ga);var ia=v.getResource(ga);if(aa(ia,ha))p.changeThreadReadStatus(ga,ha,m.getFromMeta(ia));},changeThreadArchivedStatus:function(ga,ha){n.isThreadID(ga);var ia=v.getResource(ga);if(ia.is_archived!=ha){ia.is_archived=ha;q.updatedThread(ia.thread_id);p.changeThreadArchivedStatus(ga,ha);}},changeFolder:function(ga,ha){n.isThreadID(ga);var ia=v.getResource(ga);if(ia&&ia.folder!=ha){ia.folder=ha;q.updatedThread(ia.thread_id);p.changeThreadFolder(ga,ha);}},deleteThread:function(ga){n.isThreadID(ga);p.deleteThread(ga);},updateThreads:function(ga){if(!ga||!ga.length)return;var ha={};ga.forEach(function(ia){ha[ia.thread_id]=ia;});v.addResourcesAndExecute(ha);},updateMetadataByActions:function(ga){if(!ga||!ga.length)return;var ha={},ia={},ja={};for(var ka=0;ka<ga.length;ka++){var la=ga[ka];if(la.is_forward)continue;var ma=la.action_type,na=la.thread_id;n.isThreadID(na);var oa=this.getThreadMetaNow(na);if(ma==t.MercuryActionType.LOG_MESSAGE&&la.log_message_type==t.MercuryLogMessageType.SERVER_ERROR)continue;if(!oa&&!la.action_id&&ma==t.MercuryActionType.USER_GENERATED_MESSAGE)oa=ea(la);if(oa){if(la.timestamp<=oa.timestamp&&la.action_id)continue;if(ma==t.MercuryActionType.DELETE_THREAD){q.deletedThread(na);continue;}if(!ja[na])ja[na]=h({},oa);da(ja[na],la);if(ma==t.MercuryActionType.USER_GENERATED_MESSAGE)ha[na]=la;if(ma==t.MercuryActionType.USER_GENERATED_MESSAGE||ma==t.MercuryActionType.LOG_MESSAGE||ma==t.MercuryActionType.SEND_MESSAGE)if(la&&la.timestamp&&(!ia[na]||la.timestamp>ia[na].timestamp))ia[na]=la;}}for(var pa in ja){var qa=ja[pa],ra=ha[pa];if(ra)z(qa,ra);var sa=ia[pa];if(sa)qa=h(qa,{timestamp_absolute:sa.timestamp_absolute,timestamp_relative:sa.timestamp_relative,timestamp:sa.timestamp});v.setResource(pa,qa);}},getCanonicalThreadToGroup:function(ga,ha){var ia='group:'+ga;this.getThreadMeta(ia,ha);},getCanonicalThreadToLiveListen:function(ga,ha){var ia='live_listen:'+ga;this.getThreadMeta(ia,ha);},getCanonicalThreadToUser:function(ga,ha){var ia=this.getThreadIdForUser(ga),ja=v.getResource(ia);if(typeof ja=='undefined'){ja=fa.createNewLocalThread(ia,[s.user,'fbid:'+ga],ha);p.fetchThreadData([ia]);}return ja;},getThreadIdForUser:function(ga){return 'user:'+ga;},createNewLocalThread:function(ga,ha,ia){var ja=v.getResource(ga);if(!ja){var ka=p.tokenizeThreadID(ga);ja={thread_id:ga,last_action_id:null,participants:ha,name:null,snippet:'',snippet_has_attachment:false,unread_count:ia?ia:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,is_canonical_user:ka.type=='user',is_subscribed:true,is_canonical_group:ka.type=='group',group_id:(ka.type=='group'?ka.value:null),is_canonical_live_listen:ka.type=='live_listen',live_listen_id:(ka.type=='live_listen'?ka.value:null),root_message_threading_id:null,folder:t.MessagingTag.INBOX,is_archived:false,mode:t.MercuryThreadMode.TITAN_ORIGINATED};ja.is_chatlogger_thread=ja.is_canonical_group||ja.is_canonical_live_listen;v.setResource(ga,ja);}return ja;},addParticipantsToThreadLocally:function(ga,ha){var ia=v.getResource(ga);if(ia){w(ia,ha);q.updatedThread(ia.thread_id);}},getCanonicalUserInThread:function(ga){var ha=p.tokenizeThreadID(ga);return ha.type=='user'?ha.value:null;},getCanonicalGroupInThread:function(ga){var ha=p.tokenizeThreadID(ga);return ha.type=='group'?ha.value:null;},getCanonicalLiveListenInThread:function(ga){var ha=p.tokenizeThreadID(ga);return ha.type=='live_listen'?ha.value:null;},isEmptyLocalThread:function(ga){var ha=v.getResource(ga);if(!ha)return false;var ia=p.tokenizeThreadID(ga);return ia.type=='root'&&!ha.timestamp;},isMultichatThread:function(ga){var ha=p.tokenizeThreadID(ga).type;return ha!='user'&&ha!='group'&&ha!='live_listen';},isLiveListenThread:function(ga){return this.getCanonicalLiveListenInThread(ga)!==null;}};p.subscribe('update-threads',function(ga,ha){var ia=(ha.actions||[]).filter(function(ma){return ma.thread_id;});fa.updateThreads(ha.threads);fa.updateMetadataByActions(ia);(ha.threads||[]).forEach(function(ma){q.updatedThread(ma.thread_id);});var ja=ha.global_actions||[];for(var ka=0;ka<ja.length;ka++){var la=ja[ka];if(la.action_type==t.MercuryGlobalActionType.MARK_ALL_READ)ba(la.action_id);}});e.exports=fa;});
__d("TypeaheadShowLoadingIndicator",["CSS","copyProperties"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){this._subscription=this._typeahead.subscribe('loading',function(j,k){g.conditionClass(this._typeahead.getElement(),'typeaheadLoading',k.loading);g.conditionClass(this._typeahead.getView().getElement(),'typeaheadViewLoading',k.loading);}.bind(this));},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=i;});
__d("legacy:ShowLoadingIndicatorTypeaheadBehavior",["TypeaheadShowLoadingIndicator"],function(a,b,c,d){var e=b('TypeaheadShowLoadingIndicator');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.showLoadingIndicator=function(f){f.enableBehavior(e);};},3);
__d("TooltipLink",["Parent","Tooltip"],function(a,b,c,d,e,f){var g=b('Parent'),h=b('Tooltip'),i={setTooltipText:function(j,k){j=g.byTag(j,'a');j&&h.set(j,k);}};e.exports=i;});
__d("legacy:rect",["Rect"],function(a,b,c,d){a.Rect=b('Rect');},3);
__d("AjaxRequest",["ErrorUtils","Keys","URI","UserAgent","XHR","copyProperties"],function(a,b,c,d,e,f){var g=b('ErrorUtils'),h=b('Keys'),i=b('URI'),j=b('UserAgent'),k=b('XHR'),l=b('copyProperties');function m(p,q,r){this.xhr=k.create();if(!(q instanceof i))q=new i(q);if(r&&p=='GET'){q.setQueryData(r);}else this._params=r;this.method=p;this.uri=q;this.xhr.open(p,q);}m.corsEnabled=window.XMLHttpRequest&&('withCredentials' in new XMLHttpRequest());m.ERROR='ar:error';m.TIMEOUT='ar:timeout';m.PROXY_ERROR='ar:proxy error';m.TRANSPORT_ERROR='ar:transport error';m.SERVER_ERROR='ar:http error';m.PARSE_ERROR='ar:parse error';m._inflight=[];function n(){var p=m._inflight;m._inflight=[];p.forEach(function(q){q.abort();});}function o(p){p.onJSON=p.onError=p.onSuccess=null;clearTimeout(p._timer);if(p.xhr&&p.xhr.readyState<4){p.xhr.abort();p.xhr=null;}m._inflight=m._inflight.filter(function(q){return q&&q!=p&&q.xhr&&q.xhr.readyState<4;});}l(m.prototype,{timeout:60000,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(p){if(this[p])this[p](this);},_parseStatus:function(){var p;try{this.status=this.xhr.status;p=this.xhr.statusText;}catch(q){if(this.xhr.readyState>=4){this.errorType=m.TRANSPORT_ERROR;this.errorText=q.message;}return;}if(this.status===0&&!(/^(file|ftp)/.test(this.uri))){this.errorType=m.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=m.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=m.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=m.SERVER_ERROR;}else if(this.status>=500&&this.status<600){this.errorType=m.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=m.TRANSPORT_ERROR;}else{p='unrecognized status code: '+this.status;this.errorType=m.ERROR;}if(!this.errorText)this.errorText=p;},_parseResponse:function(){var p,q=this.xhr.readyState;try{p=this.xhr.responseText||'';}catch(r){if(q>=4){this.errorType=m.ERROR;this.errorText='responseText not available - '+r.message;}return;}while(this.xhr){var s=this._eol+1,t=p.indexOf('\n',s);if(t<0&&q==4)t=p.length;if(t<=this._eol)break;var u=p.substr(s,t-s).replace(/^\s*|\s*$/g,'');if(s===0&&this.prelude)if(this.prelude.test(u))u=u.replace(this.prelude,'');this._eol=t;if(u){try{this.json=JSON.parse(u);}catch(r){var v=(/(<body[\S\s]+?<\/body>)/i).test(p)&&RegExp.$1,w={message:r.message,'char':s,excerpt:((s===0&&v)||u).substr(512)};this.errorType=m.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(w);return;}g.applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var p=this.xhr&&this.xhr.readyState||0;if(this.status==null&&p>=2)this._parseStatus();if(this.status!=null&&p>=3&&!this.errorType)this._parseResponse();if(this.errorType||p==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');o(this);}},send:function(p){this.xhr.onreadystatechange=function(){g.applyWithGuard(this._onReadyState,this,arguments);}.bind(this);var q=this.timeout;if(q)this._timer=setTimeout((function(){this.errorType=m.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');o(this);}).bind(this),q,false);m._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(p?i.implodeQuery(p):'');},abort:function(){o(this);},toString:function(){var p='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)p+=' errorType='+this.errorType+' ('+this.errorText+')';return p+']';},toJSON:function(){var p={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};for(var q in p)if(p[q]==null)delete p[q];return p;}});if(window.addEventListener&&j.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===h.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',n);e.exports=m;});
__d("SystemEvents",["Arbiter","Env","ErrorUtils","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Env'),i=b('ErrorUtils'),j=b('UserAgent'),k=b('copyProperties'),l=new g(),m=[],n=1000;setInterval(function(){for(var w=0;w<m.length;w++)m[w]();},n,false);function o(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}var p=h.user,q=navigator.onLine;function r(){if(!q){q=true;l.inform(l.ONLINE,q);}}function s(){if(q){q=false;l.inform(l.ONLINE,q);}}if(j.ie()){if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=r;document.body.onoffline=s;});}else m.push(function(){(navigator.onLine?r:s)();});}else if(window.addEventListener)if(!j.chrome()){window.addEventListener('online',r,false);window.addEventListener('offline',s,false);}var t=p;m.push(function(){var w=o();if(t!=w){l.inform(l.USER,w);t=w;}});var u=Date.now();function v(){var w=Date.now(),x=w-u,y=x<0||x>10000;u=w;if(y)l.inform(l.TIME_TRAVEL,x);return y;}m.push(v);m.push(function(){if(window.onerror!=i.onerror)window.onerror=i.onerror;});a.SystemEvents=e.exports=k(l,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(w){return (w||o())==p;},isOnline:function(){return j.chrome()||q;},checkTimeTravel:v});},3);
__d("ChannelSubdomain",["Cookie","JSLogger"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('JSLogger'),i=h.create('channel'),j=7,k=null;function l(o){var p=null,q=m(),r;for(r=0;r<32&&(q&(1<<r));r++);o--;if(r<Math.min(32,j*o)){k=r;p=k%j;g.set('sub',q|(1<<k));}else{k=-1;p=null;i.error('subdomain_overflow',{slot:k,max:o});}return p;}function m(){var o=g.get('sub')||0;o=parseInt(o,10);return isNaN(o)?0:o;}function n(){if(k!==null&&k>=0){var o=m()&~(1<<k);if(o){g.set('sub',o);}else g.clear('sub');}}e.exports={allocate:l,clear:n};});
__d("DocRPC",[],function(a,b,c,d,e,f){var g={_apis:{},origin:location.origin||(location+'').replace(/([^:\/])\/.*/,'$1'),originFilter:/\.facebook\.com(:\d+)?$/,_init:function(){var h=function(event){event=event||window.event;var i=event.domain||event.origin;if(g.originFilter.test(i))g._dispatch(event.data);};if(window.postMessage)if(window.addEventListener){window.addEventListener('message',h,false);}else window.onmessage=h;this._init=function(){};},_dispatch:function(h){h=JSON.parse(h);var i=JSON.stringify(h.params);if(g._apis.hasOwnProperty(h.api)){var j=g._apis[h.api];if(j[h.method])j[h.method].apply(j,h.params);}},publish:function(h,i){g._init();g._apis[i]=h;},proxy:function(h,i,j,k){g._init();var l={_proxyId:Math.random().toString(36),_seq:0};function m(o){l[o]=function(){var p={api:i,method:o,params:Array.prototype.slice.call(arguments)},q=JSON.stringify(p.params);p=JSON.stringify(p);if(h.postMessage){h.postMessage(p,k);}else if(h.DocRPC)h.DocRPC._dispatch(p);};}for(var n=0;n<j.length;n++)m(j[n]);return l;}};e.exports=a.DocRPC=g;},3);
__d("ChannelTransport",["copyProperties","bind","AjaxRequest","URI","JSLogger","DocRPC","ChannelConstants"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('bind'),i=b('AjaxRequest'),j=b('URI'),k=b('JSLogger'),l=b('DocRPC'),m=b('ChannelConstants'),n=k.create('channel'),o=null,p=9000;function q(){return (1048576*Math.random()|0).toString(36);}function r(aa,ba){var ca=aa.subdomain;ca=ca===null?'':(ca+'-');var da=new j(ba).setDomain(ca+aa.host+'.facebook.com').setPort(aa.port).setSecure(j().isSecure());return da;}function s(event,aa){if(window!==window.parent&&/iframe/.test(window.location)){if(!o)o=l.proxy(window.parent,'outerTransport',['_addJsLoggerEntry'],top.DocRPC.origin);o._addJsLoggerEntry(event,aa);}else n.log(event,aa);}function t(aa){var ba={partition:aa.partition,cb:q()},ca=r(aa,'/p').setQueryData(ba);s('start_p',{uri:ca.toString()});var da=new i('GET',ca);if(i.corsEnabled)da.xhr.withCredentials=true;var ea=function(fa){s('finish_p',{xhr:fa.toJSON?fa.toJSON():fa});};da.timeout=aa.P_TIMEOUT||10000;da.onError=da.onSuccess=ea;da.send();}function u(aa,ba,ca){var da=new Image(),ea=0,fa=function(ia){da.abort();return ia?ba():ca();};da.onload=function(){s('ping_ok',{duration:Date.now()-ea});fa(true);};da.onerror=function(){t(aa);fa(false);};var ga=setTimeout(da.onerror,10000,false);da.abort=function(){if(ga){clearTimeout(ga);ga=null;}da.onload=da.onerror=null;};var ha={partition:aa.partition,cb:q()};ea=Date.now();da.src=r(aa,'/ping').setQueryData(ha);return da;}function v(aa,ba,ca,da){var ea=new Date(),fa=(ea-aa.userActive)/1000|0;if(fa<0)n.warn('idle_regression',{idleTime:fa,now:ea.getTime(),userActive:aa.userActive});var ga={channel:aa.user_channel,seq:aa.seq,partition:aa.partition,clientid:aa.sessionID,cb:q(),idle:fa};if(fa<60)ga.state='active';var ha=r(aa,'/pull').setQueryData(ga),ia=new i('GET',ha);if(i.corsEnabled)ia.xhr.withCredentials=true;ia.timeout=aa.PULL_TIMEOUT||60000;ia.onJSON=ba;ia.onSuccess=ca;ia.onError=function(){var ja=(this.status==12002&&this._time>=p)?ca:da;return ja&&ja.apply(this,arguments);};ia.send();return ia;}function w(aa){this.manager=aa;(this.init&&this.init());}function x(aa){w.apply(this,arguments);}g(x.prototype,{logName:'CORS',enterState:function(aa,ba){if(this._request){this._request.abort();this._request=null;}if(aa=='init')setTimeout(h(this.manager,'exitState',{status:m.OK,stateId:ba.stateId}),3000,false);if(!/pull|ping/.test(aa))return;var ca=this.manager;if(aa=='ping'){this._request=u(ba,h(ca,'exitState',{status:m.OK,stateId:ba.stateId}),h(ca,'exitState',{status:m.ERROR,stateId:ba.stateId}));}else if(aa=='pull')this._request=v(ba,h(ca,'_processTransportData',ba.stateId),h(ca,'exitState',{status:m.OK,stateId:ba.stateId}),h(ca,'exitState',{status:m.ERROR,stateId:ba.stateId}));}});function y(aa){n.log('iframe_init_constructor');w.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);l.publish(this,'outerTransport');}g(y.prototype,{logName:'iframe',_initIframe:function(aa){n.log('iframe_init_start');window.onchanneliframeready=function(){n.log('iframe_resources');return aa.resources;};window.onchanneliframeloaded=function(){n.log('iframe_loaded');};if(aa){this._iframeURI=r(aa,aa.path);if(aa.bustIframe){var ba={partition:aa.partition,cb:q()};this._iframeURI.setQueryData(ba);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);n.log('iframe_uri_set');}catch(ca){n.error('iframe_uri_set_error',ca);this.exitState({status:m.ERROR,stateId:aa.stateId},ca+'');}},_addJsLoggerEntry:function(event,aa){n.log(event,aa);},enterState:function(aa,ba){if(aa=='init'){this._initIframe(ba);}else if(/idle|ping|pull/.test(aa)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(aa!='idle')this.exitState({status:m.ERROR,stateId:ba.stateId},'iframe not yet loaded');}else if(aa=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(aa){if(this.manager.state=='init'&&aa.status==m.OK)this._iframeProxy=l.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function z(){this.init=this.init.bind(this);w.apply(this,arguments);}g(z.prototype,{logName:'iframe(inner)',init:function(){l.publish(this,'innerTransport');try{var ba=l.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);g(this,ba);this.exitState({status:m.OK,stateId:1e+06});}catch(aa){n.error('iframe_inner_init_error',aa);}},enterState:function(aa,ba){if(this._request){this._request.abort();this._request=null;}if(aa=='ping'){this._request=u(ba,h(this,'exitState',{status:m.OK,stateId:ba.stateId}),h(this,'exitState',{status:m.ERROR,stateId:ba.stateId}));}else if(aa=='pull')this._request=v(ba,h(this,'_processTransportData',ba.stateId),h(this,'exitState',{status:m.OK,stateId:ba.stateId}),h(this,'exitState',{status:m.ERROR,stateId:ba.stateId}));}});e.exports={getURI:r,Transport:w,CORSTransport:x,IframeTransport:y,IframeInnerTransport:z};});
__d("FBAjaxRequest",["$","Env","AjaxRequest"],function(a,b,c,d,e,f){var g=b('$'),h=b('Env'),i=b('AjaxRequest');function j(k,l,m){m=m||{};m.__a=1;m.__user=h.user;var n=new i(k,l,m),o=n._call;n._call=function(p){if(p=='onJSON'&&this.json){if(this.json.error){this.errorType=i.SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}o.apply(this,arguments);};return n;}e.exports=j;});
__d("MovingStat",[],function(a,b,c,d,e,f){function g(h){h=h||60000;var i={t:new Date(),count:0,v:0},j=i,k=0,l=0;function m(){var n=new Date()-h;while(j&&j.next&&j.t<n){k-=j.v;l-=j.count;j=j.next;}}this.add=function(n){k+=n;l++;var o=new Date();if(o-i.t<1000){i.v+=n;i.count++;}else{i.next={t:o,v:n,count:1};i=i.next;m();}};this.tally=function(n){n=n||1000;m();return {sum:k,count:l,timeAverage:k*n/h};};}e.exports=g;});
__d("Dcode",[],function(a,b,c,d,e,f){var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;});
__d("setIntervalAcrossTransitions",[],function(a,b,c,d,e,f){function g(h,i){return setInterval(h,i,false);}e.exports=g;});
__d("UserActivity",["event-extensions","Arbiter","throttleAcrossTransitions","ClickRefUtils","collectDataAttributes"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('throttleAcrossTransitions'),i=b('ClickRefUtils'),j=b('collectDataAttributes'),k=Date.now(),l=0,m=Math.floor(Math.random()*2147483647),n={DEFAULT_IDLE_MS:5000,EVENT_INTERVAL_MS:500,SESSIONIZATION_TIMEOUT:4*60*1000,subscribeOnce:function(p){var q=n.subscribe(function(){n.unsubscribe(q);p();});},subscribe:function(p){return g.subscribe('useractivity/activity',p);},unsubscribe:function(p){p.unsubscribe();},isActive:function(p){return (new Date()-k<(p||n.DEFAULT_IDLE_MS));},getTimeOnSite:function(){return l;},getInstanceID:function(){return m;}},o=h(function(event){var p=Date.now(),q=p-k;if(q<n.SESSIONIZATION_TIMEOUT)l+=q;k=p;g.inform('useractivity/activity',{event:event,idleness:q});},n.EVENT_INTERVAL_MS);Event.listen(document.documentElement,{mouseover:o,keydown:o,click:o});g.subscribe("UserAction/new",function(p,q){if(i.should_report(q.node,q.mode)){var r=j(q.node,['gt']),s={iref:i.get_intern_ref(q.node),gt_ref:r.ref,nav_section:r.nav_section,uact_tos:n.getTimeOnSite(),uact_id:n.getInstanceID(),buenopath:window._script_path};q.ua.add_data(s);}});e.exports=n;});
__d("ChannelManager",["function-extensions","AjaxRequest","Arbiter","AsyncRequest","ChannelConstants","ChannelSubdomain","ChannelTransport","Cookie","Env","FBAjaxRequest","JSLogger","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","Run","SystemEvents","URI","UserActivity","UserAgent","copyProperties","createArrayFrom","hasArrayNature","ChannelInitialData"],function(a,b,c,d,e,f){b('function-extensions');var g=b('AjaxRequest'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('ChannelConstants'),k=b('ChannelSubdomain'),l=b('ChannelTransport'),m=b('Cookie'),n=b('Env'),o=b('FBAjaxRequest'),p=b('JSLogger'),q=b('MovingStat'),r=b('PresenceCookieManager'),s=b('PresenceState'),t=b('PresenceUtil'),u=b('Run'),v=b('SystemEvents'),w=b('URI'),x=b('UserActivity'),y=b('UserAgent'),z=b('copyProperties'),aa=b('createArrayFrom'),ba=b('hasArrayNature'),ca=c('ChannelInitialData'),da,ea=p.create('channel'),fa={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'pull',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ga={userActive:Date.now(),sessionID:(Math.random()*2147483648|0).toString(16)},ha=1,ia={},ja=0;function ka(ra){return ra.toLowerCase().replace(/[^0-9a-z]+/g,'_');}function la(){return i.lastSuccessTime?Math.round((Date.now()-i.lastSuccessTime)/1000):-1;}function ma(){var ra={};if(da.getConfig('host'))ra[da.getConfig('user_channel')]=da.getConfig('seq',0);return ra;}function na(){var ra=Date.now(),sa=Date.now(),ta={total:0},ua='idle',va=false;v.subscribe([v.USER,v.ONLINE,v.TIME_TRAVEL],function(ya,za){pa(true);sa=null;da.lastPullTime=Date.now();var ab;switch(ya){case v.USER:ab=v.isPageOwner()?j.SYS_OWNER:j.SYS_NONOWNER;break;case v.ONLINE:ab=za?j.SYS_ONLINE:j.SYS_OFFLINE;break;case v.TIME_TRAVEL:ab=j.SYS_TIMETRAVEL;break;}da.exitState({status:ab,stateId:ha});});var wa=function(ya,za){var ab=Date.now(),bb;if(za){ra=ab;bb=za.nextState||za.state;}else bb=ua;v.checkTimeTravel();if(sa){var cb=Math.round((ab-sa)/1000);if(cb>0){ta[ua]=(ta[ua]||0)+cb;ta.total+=cb;}}ua=bb;sa=ab;if(!ya){ta.lastSuccessTime=la();ta.online=v.isOnline();ea.log('rollup',ta);}};h.subscribe(j.ON_ENTER_STATE,wa);setInterval(wa,60000,false);h.subscribe(p.DUMP_EVENT,function(ya,za){za.channelRollup=ta;});var xa=function(){if(da.isShutdown()||da.shouldIdle())return;v.checkTimeTravel();var ya=Date.now()-(da.lastPullTime||n.start),za=da.getConfig('CHANNEL_EXPIRY',180000);if(!va&&ya>za){var ab=la();ea.error('stall',{lastSuccessTime:ab,rollupState:ua});va=true;}var bb=Date.now()-ra;if(da.state=='pull'&&bb>90000){ra=null;ea.warn('jumpstart',{state:da.state,dormant:bb});da.enterState('init');}};setInterval(xa,10000,false);}function oa(){var ra=Date.now(),sa=1;function ta(){setTimeout(ta,sa*1000,false);var ya=da.state;if(ya=='idle'&&da.shouldIdle())return;ea.bump('conn_t',sa);if(ya=='pull')ea.bump('conn_t_pull',sa);}ta();var ua=[15,30,60,120,240],va=false,wa=false;function xa(ya){setTimeout(function(){ea.rate('pullenter_'+ya,va);ea.rate('pullexit_'+ya,wa);},ya*1000,false);}while(ua.length)xa(ua.shift());h.subscribe(j.ON_ENTER_STATE,function(ya,za){if(za.state=='pull')va=true;ra=Date.now();});h.subscribe(j.ON_EXIT_STATE,function(ya,za){if(za.state!='pull'||!ra)return;var ab='other';if(za.status==j.OK){wa=true;ab='ok';}else if(za.xhr&&za.xhr.errorType){ab=/ar:(\w+)/.test(za.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(za.status))return;var bb=(Date.now()-ra)/1000;if(bb<0){return;}else if(bb>3600)bb=3600;ea.bump('conn_num');ea.bump('conn_exit',bb);ea.bump('conn_num_'+ab);ea.bump('conn_exit_'+ab,bb);});}function pa(ra){if(ra){ja=0;ia={};}else ja++;}function qa(){var ra=[],sa=new w('/probe').setDomain(ga.host+'.facebook.com').setPort(ga.port).setSecure(w().isSecure()),ta=new g('GET',sa);ta.onJSON=function(ua,va){ra.push(Date.now());if(ra.length>=2){ea.log('probe_ok',{time:ra[1]-ra[0]});ta.abort();}};ta.onSuccess=function(ua){if(ra.length!=2)ea.error('probe_error',{error:'beats.length = '+ra.length});};ta.onError=function(ua){ea.error('probe_error',ua);};ea.log('probe_request');ta.send();}da={state:'idle',nextState:null,lastPullTime:Date.now(),init:function(ra){this.init=function(){};if(typeof(x)!='undefined'){x.subscribe(function(){ga.userActive=Date.now();}.bind(this));}else ea.error('user_activity_undefined');r.register('ch',ma);var sa=this.getConfig('max_conn',2);ga.subdomain=k.allocate(sa);if(typeof window.onpageshow!='undefined'){Event.listen(window,'pagehide',k.clear);}else u.onUnload(k.clear);this._transportRate=new q(30000);var ta=(g.corsEnabled&&!ga.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new l[ta](this);if(ra)this.enterState.apply(this,arguments);h.subscribe(p.DUMP_EVENT,function(event,ua){ua.transportRate=this._transportRate.tally();ua.transportType=ta;ua.transportVersion=2;}.bind(this));na();oa();if(da.getConfig('streamProbe')&&da.getConfig('host')&&g.corsEnabled)qa();},configure:function(){var ra=aa(arguments);ea.log('configure',ra);ra.forEach(z.bind(null,ga));h.inform(j.ON_CONFIG,this);},getConfig:function(ra,sa){return ra in ga?ga[ra]:sa;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(v.isPageOwner()&&v.isOnline());},_sendIframeError:function(ra){var sa=new i().setURI('/ajax/presence/reconnect.php').setData({reason:ra,fb_dtsg:n.fb_dtsg}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);sa.specifiesWriteRequiredParams()&&sa.send();},_getDelay:function(){var ra=da.getConfig('MIN_RETRY_INTERVAL',10000),sa=da.getConfig('MAX_RETRY_INTERVAL',60000),ta=Math.min(ra*Math.pow(2,Math.max(0,ja-1)),sa);return ta*(.75+Math.random()/2)|0;},enterState:function(){if(this._inEnterState)ea.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(ra){this._inEnterState=false;throw ra;}},_enterState:function(ra){var sa=0,ta=null,ua=aa(arguments);if(this.isShutdown())return;if(ra!='idle!'&&this.shouldIdle())return;ha++;ga.stateId=ha;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(ra)){var va=this._transportRate.tally().timeAverage,wa=da.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(va>=wa){if(!this._throttled){this._throttled=true;ea.warn('throttled');}ea.bump('throttle');sa=1000/wa;}}else if(!(/#$/.test(ra)))sa=this._getDelay();ra=ra.replace(/\W*$/,'');if(!fa[ra])throw new Error('invalid state:'+ra);var xa;if(sa<=0){xa={state:ra};this._transportRate.add(1);this.state=ra;var ya=this['_enter_'+this.state];if(ya){ua.shift();ya.apply(this,ua);}if(/init|idle|pull|ping/.test(this.state)){this.transport.enterState(this.state,ga);if(this.state=='ping')xa.url=l.getURI(ga).toString();}}else{this.state='idle';this.nextState=ra;xa={state:this.state,delay:sa,nextState:ra};ua[0]=ra+'#';this._deferredTransition=(function(){this._deferredTransition=null;this.enterState.apply(this,ua);}).bind(this).defer(sa,false);}ea.log('enter_'+this.state,xa);h.inform(j.ON_ENTER_STATE,xa);},exitState:function(ra,sa){var ta=ra.stateId,ua=ra.status;if(this.isShutdown()||ta<ha)return;var va=aa(arguments),wa=this.state;va[0]=ra.status;var xa={state:wa,status:ua};if(this.nextState)xa.nextState=this.nextState;if(sa&&sa.errorType){xa.xhr=sa.toJSON?sa.toJSON():sa;delete xa.xhr.json;}if(sa&&sa.json){if(sa.json.t)xa.t=sa.json.t;if(sa.json.reason)xa.reason=sa.json.reason;if(sa.json.seq)xa.seq=sa.json.seq;}ea.log('exit_'+wa,xa);h.inform(j.ON_EXIT_STATE,xa);var ya=this['_exit_'+wa];if(ya)ua=ya.apply(this,va)||ua;if(ua!=j.OK){pa();ia[wa]=(ia[wa]||0)+1;}var za=fa[this.nextState||wa][ua]||fa._all[ua],ab=za&&za.replace(/!*$/,'');if(!ab){ea.error('terminal_transition',xa);this._shutdownHint=j.HINT_INVALID_STATE;za='shutdown!';}this._lastState=wa;this._lastStatus=ua;this.enterState(za);},_processTransportData:function(ra,sa){var ta=sa.json,ua=ta.t;if('s' in ta){ta.seq=ta.s;delete ta.s;}var va=ga.seq;if('seq' in ta){ga.seq=ta.seq;s.doSync();}switch(ua){case 'continue':pa(true);this.exitState({status:j.OK,stateId:ra});break;case 'refresh':case 'refreshDelay':this.exitState({status:'refresh_'+(ta.reason||0),stateId:ra},sa);break;case 'fullReload':r.clear();ea.log('invalid_history');h.inform(j.ON_INVALID_HISTORY);this.exitState({status:j.ERROR_MISSING,stateId:ra},sa);break;case 'msg':var wa,xa,ya,za;pa(true);xa=ta.ms;ya=ga.seq-xa.length;for(wa=0;wa<xa.length;wa++,ya++)if(ya>=va){za=xa[wa];if(za.type){ea.debug(za.type);h.inform(j.getArbiterType(za.type),{obj:za});}}else ea.warn('seq_regression',{seq:ya,last_seq:va,messages:xa.length});break;default:ea.error('unknown_msg_type',{type:ua});break;}},_enter_init:function(){if(ia.init>=da.getConfig('MAX_INIT_FAILS',2))return this.exitState.bind(this,{status:j.ERROR_MAX,stateId:ha}).defer();this._initTimer=this.exitState.bind(this,{status:j.ERROR,stateId:ha},'timeout').defer(da.getConfig('IFRAME_LOAD_TIMEOUT',30000),false);},_enter_reconnect:function(ra){var sa=ha;if(!t.hasUserCookie()){ea.warn('no_user_cookie');(function(){da._shutdownHint=j.HINT_AUTH;da.exitState({status:j.ERROR_SHUTDOWN,stateId:sa});}).defer();return;}var ta={reason:ra,fb_dtsg:n.fb_dtsg};if(n.fb_isb)ta.fb_isb=n.fb_isb;var ua=new o('GET','/ajax/presence/reconnect.php',ta);ua.onSuccess=(function(){da.configure(ua.json);r.store();this.exitState({status:j.OK,stateId:sa});}).bind(this);ua.onError=(function(){var va=ua.json&&ua.json.error;if(ua.errorType==g.TRANSPORT_ERROR||ua.errorType==g.PROXY_ERROR)this._shutdownHint=j.HINT_CONN;if(va&&va==1356007){this._shutdownHint=j.HINT_MAINT;}else if(va==1357001||va==1357004||va==1348009){this._shutdownHint=j.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?j.ERROR_SHUTDOWN:j.ERROR,stateId:sa},ua);}).bind(this);ua.send();},_enter_shutdown:function(){h.inform(j.ON_SHUTDOWN,{reason:this._shutdownHint});},_exit_init:function(ra){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(ra==j.ERROR_MAX)this._sendIframeError(j.reason_IFrameLoadGiveUp);},_exit_pull:function(ra){if(ra==j.OK)this.lastPullTime=Date.now();},_exit_ping:function(ra){if(ra==j.OK){var sa=Date.now()-(this.lastPullTime||n.start);if(sa>this.getConfig('CHANNEL_EXPIRY',180000))return j.ERROR_STALE;}}};e.exports=da;if(ca.serverInitialized==null){da.configure(ca.channelConfig);if(/shutdown/.test(ca.state)){da._shutdownHint=j[ca.reason];}else ca.reconnectReason;da.init(ca.state,ca.reason);}});
__d("ChannelConnection",["Arbiter","copyProperties","ChatConfig","Run","SystemEvents","ChannelConstants","ChannelManager","JSLogger"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('ChatConfig'),j=b('Run'),k=b('SystemEvents'),l=b('ChannelConstants'),m=b('ChannelManager'),n=b('JSLogger'),o=n.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=h(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ba){v();q=w.defer(ba,false);o.log('mute_warning',{time:ba});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ba,ca){y();if(ba===l.ON_ENTER_STATE&&(ca.nextState||ca.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var da=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:da});}}else if(ba===l.ON_ENTER_STATE&&((ca.nextState||ca.state)==='ping'||(!ca.nextState&&ca.state==='idle'))){r=(function(){var ea=null;if(!(ca.state==='idle'&&!ca.nextState))ea=(ca.delay||0);o.log('reconnecting',{delay:ea});if(u.disconnected())o.log('reconnecting_ui',{delay:ea});s=u.RECONNECTING;(ca.state==='idle')&&t++;if(t>1){u.inform(u.RECONNECTING,ea);}else if(!ca.nextState&&ca.state==='idle')z(ba,ca);}).defer(500,false);}else if(ba===l.ON_SHUTDOWN){o.log('shutdown',{reason:ca.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,ca.reason);}}function aa(ba){if(m.state==='ping'||m.isShutdown())return;o.log('reconnect',{now:ba});u.inform(u.RECONNECTING,0);if(!!ba){if(p!==null){clearTimeout(p);p=null;}m.enterState('ping!');}else if(!p)p=setTimeout(function(){m.enterState('ping!');p=null;},i.get('channel_manual_reconnect_defer_msec'),false);}if(m.isShutdown()){z(l.ON_SHUTDOWN,m._shutdownHint);}else z(l.ON_ENTER_STATE,{state:m.state,nextState:m.nextState,delay:0});g.subscribe([l.ON_ENTER_STATE,l.ON_SHUTDOWN],z);k.subscribe(k.TIME_TRAVEL,function(){aa();x(i.get('mute_warning_time_msec'));});j.onBeforeUnload(y,false);h(u,{disconnected:function(){return s===u.SHUTDOWN||(s===u.RECONNECTING&&!q&&t>1);},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:aa,unmuteWarning:w});e.exports=u;});
__d("legacy:ChannelConnection",["ChannelConnection"],function(a,b,c,d){a.ChannelConnection=b('ChannelConnection');},3);
__d("deferUntil",[],function(a,b,c,d,e,f){function g(h,i,j,k,l){var m=i();if(m){h(m);return null;}var n=Date.now(),o=setInterval(function(){m=i();if(!m){if(!j||(j<new Date()-n))return;l&&l();}clearInterval(o);h(m);},20,k);return o;}e.exports=g;});
__d("legacy:function-utils",["debounce","throttle","deferUntil"],function(a,b,c,d){a.debounce=b('debounce');a.throttle=b('throttle');a.defer_until=b('deferUntil');},3);
__d("legacy:user-activity",["UserActivity"],function(a,b,c,d){a.UserActivity=a.UserActivity||b('UserActivity');},3);
__d("ChannelConstants",[],function(a,b,c,d,e,f){var g='channel/',h={ON_SHUTDOWN:g+'shutdown',ON_INVALID_HISTORY:g+'invalid_history',ON_CONFIG:g+'config',ON_ENTER_STATE:g+'enter_state',ON_EXIT_STATE:g+'exit_state',OK:'ok',ERROR:'error',ERROR_MAX:'error_max',ERROR_MISSING:'error_missing',ERROR_MSG_TYPE:'error_msg_type',ERROR_SHUTDOWN:'error_shutdown',ERROR_STALE:'error_stale',SYS_OWNER:'sys_owner',SYS_NONOWNER:'sys_nonowner',SYS_ONLINE:'sys_online',SYS_OFFLINE:'sys_offline',SYS_TIMETRAVEL:'sys_timetravel',HINT_AUTH:'shutdown auth',HINT_CONN:'shutdown conn',HINT_DISABLED:'shutdown disabled',HINT_INVALID_STATE:'shutdown invalid state',HINT_MAINT:'shutdown maint',HINT_UNSUPPORTED:'shutdown unsupported',reason_Unknown:0,reason_AsyncError:1,reason_TooLong:2,reason_Refresh:3,reason_RefreshDelay:4,reason_UIRestart:5,reason_NeedSeq:6,reason_PrevFailed:7,reason_IFrameLoadGiveUp:8,reason_IFrameLoadRetry:9,reason_IFrameLoadRetryWorked:10,reason_PageTransitionRetry:11,reason_IFrameLoadMaxSubdomain:12,reason_NoChannelInfo:13,reason_NoChannelHost:14,getArbiterType:function(i){return g+'message:'+i;}};e.exports=h;});
__d("legacy:ChannelConstants",["ChannelConstants"],function(a,b,c,d){a.ChannelConstants=b('ChannelConstants');},3);
__d("legacy:startsWith",["startsWith"],function(a,b,c,d){a.startsWith=b('startsWith');},3);
__d("NavigationMessage",[],function(a,b,c,d,e,f){var g={NAVIGATION_BEGIN:'NavigationMessage/navigationBegin',NAVIGATION_SELECT:'NavigationMessage/navigationSelect',NAVIGATION_FIRST_RESPONSE:'NavigationMessage/navigationFirstResponse',NAVIGATION_COMPLETED:'NavigationMessage/navigationCompleted',NAVIGATION_FAILED:'NavigationMessage/navigationFailed',NAVIGATION_COUNT_UPDATE:'NavigationMessage/navigationCount',NAVIGATION_FAVORITE_UPDATE:'NavigationMessage/navigationFavoriteUpdate',NAVIGATION_ITEM_REMOVED:'NavigationMessage/navigationItemRemoved',NAVIGATION_ITEM_HIDDEN:'NavigationMessage/navigationItemHidden',INTERNAL_LOADING_BEGIN:'NavigationMessage/internalLoadingBegin',INTERNAL_LOADING_COMPLETED:'NavigationMessage/internalLoadingCompleted'};e.exports=g;});
__d("legacy:ui-side-nav-message",["NavigationMessage"],function(a,b,c,d){a.NavigationMessage=b('NavigationMessage');},3);
__d("SimpleDrag",["event-extensions","ArbiterMixin","Class","UserAgent","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('UserAgent'),j=b('copyProperties');function k(l){Event.listen(l,'mousedown',this._start.bind(this));}j(k.prototype,g,{_start:function(event){var l=!!this.inform('start',event),m=i.ie()<9?document.documentElement:window,n=Event.listen(m,{selectstart:l?bagofholding:Event.prevent,mousemove:this.inform.bind(this,'update'),mouseup:function(event){for(var o in n)n[o].remove();this.inform('end',event);}.bind(this)});return l;}});e.exports=k;});
__d("ScrollAwareDOM",["CSS","DOM","DOMPosition","DOMQuery","HTML","Vector"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('DOMPosition'),j=b('DOMQuery'),k=b('HTML'),l=b('Vector');function m(q,r){return function(){p.monitor(arguments[q],r.curry.apply(r,arguments));};}function n(q){if(!(q instanceof Array))q=[q];for(var r=0;r<q.length;r++){var s=k.replaceJSONWrapper(q[r]);if(s instanceof k){return s.getRootNode();}else if(h.isNode(s))return s;}return null;}function o(q){return i.getElementPosition(q).y>=0;}var p={monitor:function(q,r){var s=n(q);if(s){var t=!!s.offsetParent;if(t&&o(s))return r();var u=l.getDocumentDimensions(),v=r();if(t||(s.offsetParent&&!o(s))){var w=l.getDocumentDimensions().sub(u);w.scrollElementBy(j.getDocumentScrollElement());}return v;}else return r();},replace:function(q,r){var s=n(r);if(!s||g.hasClass(s,'hidden_elem'))s=q;return p.monitor(s,function(){h.replace(q,r);});},prependContent:m(1,h.prependContent),insertAfter:m(1,h.insertAfter),insertBefore:m(1,h.insertBefore),setContent:m(0,h.setContent),appendContent:m(1,h.appendContent),remove:m(0,h.remove),empty:m(0,h.empty)};e.exports=p;});
__d("legacy:ScrollAwareDOM",["ScrollAwareDOM"],function(a,b,c,d){a.ScrollAwareDOM=b('ScrollAwareDOM');},3);
__d("legacy:dom-collect",["collectDataAttributes"],function(a,b,c,d){a.collect_data_attribs=b('collectDataAttributes');},3);
__d("legacy:dom-form",["Form"],function(a,b,c,d){a.Form=b('Form');},3);
__d("legacy:dom-html",["HTML"],function(a,b,c,d){a.HTML=b('HTML');},3);
__d("legacy:link-controller",["LinkController"],function(a,b,c,d){a.LinkController=b('LinkController');},3);
__d("UserNoOp",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=function(){},i=function(){return this;};g(h.prototype,{add_event:i,add_data:i,set_ua_id:i,set_namespace:i});e.exports=h;});
__d("legacy:UserAction",["UserNoOp","userAction"],function(a,b,c,d){a.UserNoOp=b('UserNoOp');a.user_action=b('userAction');a.report_data=function(e,f){user_action(e,null,null,'FORCE',f);};},3);
__d("math-extensions",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=e.exports={rand32:function(){return Math.floor(Math.random()*4294967295);},verifyNumber:function(i){if(typeof i=='undefined'||isNaN(i)||i==Number.POSITIVE_INFINITY||i==Number.NEGATIVE_INFINITY)i=0;return i;},mod:function(i,j){var k=i%j;if(k*j<0)k+=j;return k;},clip:function(i,j,k){return Math.max(j,Math.min(i,k));}};g(a,h);},3);
__d("coalesce",[],function(a,b,c,d,e,f){function g(){for(var h=0;h<arguments.length;++h)if(arguments[h]!=null)return arguments[h];return null;}e.exports=g;});
__d("mergeObjects",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(){var i={};for(var j=0;j<arguments.length;j++)g(i,arguments[j]);return i;}e.exports=h;});
__d("legacy:object-extensions",["areObjectsEqual","coalesce","isScalar","mergeObjects","getObjectValues","createObjectFrom"],function(a,b,c,d){a.are_equal=b('areObjectsEqual');a.coalesce=b('coalesce');a.count=function(e){return Object.keys(e).length;};a.is_scalar=b('isScalar');a.keys=Object.keys;a.merge=b('mergeObjects');a.values=b('getObjectValues');Object.from=b('createObjectFrom');},3);
__d("AccessibleLayer",["copyProperties","DOM","Input","tx"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('DOM'),i=b('Input'),j=b('tx');function k(l){this._layer=l;}g(k.prototype,{enable:function(){var l=this._layer.getRoot();if(l.tabIndex==-1)l.tabIndex=0;var m=h.create('a',{className:'accessible_elem',href:'#'},["Sulje ponnahdusikkuna ja palaa"]);h.appendContent(l,m);this._listener=Event.listen(m,'click',this._closeListener.bind(this));this._afterShowSubscription=this._layer.subscribe('aftershow',this._onAfterShow.bind(this));},disable:function(){this._listener.remove();this._afterShowSubscription.unsubscribe();this._listener=this._afterShowSubscription=null;},_closeListener:function(event){var l=this._layer.getCausalElement();if(l){if(l.tabIndex==-1)l.tabIndex=0;i.focus(l);}this._layer.hide();},_onAfterShow:function(){var l=this._layer.getRoot();if(!h.contains(l,document.activeElement))i.focus(l);}});e.exports=k;});
__d("ARIA",["DOM","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ge'),i,j,k=function(){i=h('ariaAssertiveAlert');if(!i){i=g.create('div',{id:'ariaAssertiveAlert',className:'accessible_elem',role:'alert','aria-live':'assertive'});g.appendContent(document.body,i);}j=h('ariaPoliteAlert');if(!j){j=i.cloneNode(false);j.setAttribute('id','ariaPoliteAlert');j.setAttribute('aria-live','polite');g.appendContent(document.body,j);}k=bagofholding;};function l(n,o){k();var p=o?i:j;g.setContent(p,n);}var m={owns:function(n,o){n.setAttribute('aria-owns',g.getID(o));},setPopup:function(n,o){var p=g.getID(o);n.setAttribute('aria-owns',p);n.setAttribute('aria-controls',p);n.setAttribute('aria-haspopup','true');if(n.tabIndex==-1)n.tabIndex=0;},announce:function(n){l(n,true);},notify:function(n){l(n);}};e.exports=m;});
__d("ContextualDialogFooterLink",["event-extensions","copyProperties","CSS","DOM"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('CSS'),i=b('DOM');function j(k){this._layer=k;}g(j.prototype,{_subscriptions:null,enable:function(){var k=this._layer.getRoot(),l=i.scry(k,'.uiContextualDialogFooterLink')[0],m='uiContextualDialogHoverFooterArrow';this._subscriptions=[Event.listen(l,'mouseenter',h.addClass.curry(k,m)),Event.listen(l,'mouseleave',h.removeClass.curry(k,m))];},disable:function(){this._subscriptions.forEach(function(k){k.remove();});this._subscriptions=null;}});e.exports=j;});
__d("ContextualThing",["DOM","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ge');function i(k){var l;while(k){if(k.getAttribute&&(l=k.getAttribute('data-ownerid')))return h(l);k=k.parentNode;}return null;}var j={register:function(k,l){k.setAttribute('data-ownerid',g.getID(l));},remove:function(k){k.removeAttribute('data-ownerid');},containsIncludingLayers:function(k,l){while(l){if(g.contains(k,l))return true;l=i(l);}return false;}};e.exports=j;});
__d("KeyEventController",["event-extensions","DOM","Run","copyProperties","isEmpty"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOM'),h=b('Run'),i=b('event-extensions').$E,j=b('copyProperties'),k=b('isEmpty');function l(){this.handlers={};document.onkeyup=this.onkeyevent.bind(this,'onkeyup');document.onkeydown=this.onkeyevent.bind(this,'onkeydown');document.onkeypress=this.onkeyevent.bind(this,'onkeypress');}j(l,{instance:null,getInstance:function(){return l.instance||(l.instance=new l());},defaultFilter:function(event,m){event=i(event);return l.filterEventTypes(event,m)&&l.filterEventTargets(event,m)&&l.filterEventModifiers(event,m);},filterEventTypes:function(event,m){if(m==='onkeydown')return true;return false;},filterEventTargets:function(event,m){var n=event.getTarget();return !g.isNodeOfType(n,l._interactiveElements)||(n.type in l._uninterestingTypes)||(g.isNodeOfType(n,['input','textarea'])&&n.value.length===0&&event.keyCode in l._controlKeys);},filterEventModifiers:function(event,m){if(event.ctrlKey||event.altKey||event.metaKey||event.repeat)return false;return true;},registerKey:function(m,n,o,p){if(o===undefined)o=l.defaultFilter;var q=l.getInstance(),r=q.mapKey(m);if(k(q.handlers))h.onLeave(q.resetHandlers.bind(q));for(var s=0;s<r.length;s++){m=r[s];if(!q.handlers[m]||p)q.handlers[m]=[];q.handlers[m].push({callback:n,filter:o});}},keyCodeMap:{BACKSPACE:[8],TAB:[9],RETURN:[13],ESCAPE:[27],LEFT:[37,63234],UP:[38,63232],RIGHT:[39,63235],DOWN:[40,63233],DELETE:[46],COMMA:[188],PERIOD:[190],'`':[192],'[':[219],']':[221]},_interactiveElements:['input','select','textarea','object','embed'],_uninterestingTypes:{checkbox:1,radio:1,submit:1},_controlKeys:{8:1,9:1,13:1,27:1,37:1,63234:1,38:1,63232:1,39:1,63235:1,40:1,63233:1,46:1}});j(l.prototype,{mapKey:function(m){if(m>=0&&m<=9){if(typeof(m)!='number')m=m.charCodeAt(0)-48;return [48+m,96+m];}var n=l.keyCodeMap[m.toUpperCase()];if(n)return n;return [m.toUpperCase().charCodeAt(0)];},onkeyevent:function(m,n){n=i(n);var o=this.handlers[n.keyCode],p,q,r;if(o)for(var s=0;s<o.length;s++){p=o[s].callback;q=o[s].filter;try{if(!q||q(n,m)){r=p(n,m);if(r===false)return Event.kill(n);}}catch(t){}}return true;},resetHandlers:function(){this.handlers={};}});e.exports=l;});
__d("Layer",["event-extensions","ArbiterMixin","BehaviorsMixin","Class","CSS","DataStore","DOM","HTML","KeyEventController","Style","$","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('BehaviorsMixin'),i=b('Class'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('HTML'),n=b('KeyEventController'),o=b('Style'),p=b('$'),q=b('copyProperties'),r=[];function s(t,u){this._config=t||{};if(u){this._configure(this._config,u);var v=this._config.addedBehaviors||[];this.enableBehaviors(this._getDefaultBehaviors().concat(v));}}q(s,g);q(s,{init:function(t,u){t.init(u);},initAndShow:function(t,u){t.init(u).show();},show:function(t){t.show();}});q(s.prototype,g,h,{_initialized:false,_root:null,_shown:false,_hiding:false,_causalElement:null,init:function(t){this._configure(this._config,t);var u=this._config.addedBehaviors||[];this.enableBehaviors(this._getDefaultBehaviors().concat(u));this._initialized=true;return this;},_configure:function(t,u){if(u){var v=l.isNode(u),w=typeof u==='string'||m.isHTML(u);if(w)u=m(u).getRootNode();}this._root=this._buildWrapper(t,u);j.addClass(this._root,'uiLayer');if(t.causalElement)this._causalElement=p(t.causalElement);k.set(this._root,'layer',this);},_getDefaultBehaviors:function(){return [];},getCausalElement:function(){return this._causalElement;},getInsertParent:function(){return this._insertParent||l.getDocumentBodyElement();},getRoot:function(){return this._root;},_buildWrapper:function(t,u){return u;},setInsertParent:function(t){if(t){if(this._shown&&t!==this.getInsertParent()){l.appendContent(t,this.getRoot());this.updatePosition();}this._insertParent=t;}return this;},show:function(){if(this._shown)return this;var t=this.getRoot();this.inform('beforeshow');o.set(t,'visibility','hidden');o.set(t,'overflow','hidden');j.show(t);l.appendContent(this.getInsertParent(),t);if(this.updatePosition()!==false){r.push(this);this._shown=true;this.inform('show');s.inform('show',this);}else l.remove(t);o.set(t,'visibility','');o.set(t,'overflow','');this.inform('aftershow');return this;},hide:function(){if(this._hiding||!this._shown||this.inform('beforehide')===false)return this;this._hiding=true;if(this.inform('starthide')!==false)this.finishHide();return this;},finishHide:function(){r.remove(this);this._hiding=false;this._shown=false;l.remove(this.getRoot());this.inform('hide');s.inform('hide',this);},isShown:function(){return this._shown;},updatePosition:function(){return true;},destroy:function(){this.hide();this.destroyBehaviors();this.inform('destroy');s.inform('destroy',this);k.remove(this._root,'layer');this._root=this._causalElement=null;}});Event.listen(document.documentElement,'keydown',function(event){if(n.filterEventTargets(event,'keydown'))for(var t=r.length-1;t>=0;t--)if(r[t].inform('key',event)===false)return false;},Event.Priority.URGENT);e.exports=s;});
__d("LayerButtons",["event-extensions","Parent","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Parent'),h=b('copyProperties');function i(j){this._layer=j;}h(i.prototype,{_listener:null,enable:function(){this._listener=Event.listen(this._layer.getRoot(),'click',this._handle.bind(this));},disable:function(){this._listener.remove();this._listener=null;},_handle:function(j){var k=j.getTarget(),l=g.byClass(k,'layerConfirm');if(l){if(this._layer.inform('confirm',l)===false)j.prevent();return;}var m=g.byClass(k,'layerCancel');if(m){if(this._layer.inform('cancel',m)===false)j.prevent();return;}var n=g.byClass(k,'layerButton');if(n)if(this._layer.inform('button',n)===false)j.prevent();}});e.exports=i;});
__d("LayerDestroyOnHide",["function-extensions","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('copyProperties');function h(i){this._layer=i;}g(h.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('hide',Function.prototype.defer.shield(this._layer.destroy.bind(this._layer)));},disable:function(){if(this._subscription){this._layer.unsubscribe(this._subscription);this._subscription=null;}}});e.exports=h;});
__d("LayerFadeOnHide",["Animation","Style","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Style'),i=b('UserAgent'),j=b('copyProperties');function k(l){this._layer=l;}j(k.prototype,{_subscription:null,enable:function(){if(i.ie()<9)return;this._subscription=this._layer.subscribe('starthide',this._animate.bind(this));},disable:function(){if(this._subscription){this._layer.unsubscribe(this._subscription);this._subscription=null;}},_animate:function(){new g(this._layer.getRoot()).from('opacity',1).to('opacity',0).duration(150).ondone(this._finish.bind(this)).go();return false;},_finish:function(){this._layer.finishHide();h.set(this._layer.getRoot(),'opacity','');}});e.exports=k;});
__d("LayerFadeOnShow",["Animation","Style","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Style'),i=b('UserAgent'),j=b('copyProperties');function k(l){this._layer=l;}j(k.prototype,{_subscriptions:null,enable:function(){if(i.ie()<9)return;this._subscriptions=[this._layer.subscribe('beforeshow',function(){h.set(this._layer.getRoot(),'opacity',0);}.bind(this)),this._layer.subscribe('show',this._animate.bind(this))];},disable:function(){if(this._subscriptions){while(this._subscriptions.length)this._layer.unsubscribe(this._subscriptions.pop());this._subscriptions=null;}},_animate:function(){var l=this._layer.getRoot();new g(l).from('opacity',0).to('opacity',1).duration(100).ondone(h.set.curry(l,'opacity','')).go();}});e.exports=k;});
__d("LayerFormHooks",["event-extensions","Form","copyProperties"],function(a,b,c,d,f,g){b('event-extensions');var h=b('Form'),i=b('copyProperties');function j(e){this._layer=e;}i(j.prototype,{_subscriptions:null,enable:function(){var e=this._layer.getRoot();this._subscriptions=[Event.listen(e,'submit',this._onSubmit.bind(this)),Event.listen(e,'success',this._onSuccess.bind(this)),Event.listen(e,'error',this._onError.bind(this))];},disable:function(){this._subscriptions.forEach(function(e){e.remove();});this._subscriptions=null;},_onSubmit:function(event){var k=event.getTarget();if(this._layer.inform('submit',event)===false){event.kill();return;}var l=(h.getAttribute(k,'rel')==='async');if(!l)return this._onSuccess(e);},_onSuccess:function(event){this._layer.inform('success',event);},_onError:function(event){var e=event.getData();if(this._layer.inform('error',{response:e.response})===false)event.kill();}});f.exports=j;});
__d("LayerHideOnBlur",["event-extensions","Class","ContextualThing","copyProperties","LayerFadeOnHide"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('ContextualThing'),i=b('copyProperties'),j=b('LayerFadeOnHide');function k(l){this._layer=l;}i(k.prototype,{_listener:null,_layerSubscriptions:null,enable:function(){if(!this._layerSubscriptions){this._layerSubscriptions=[this._layer.subscribe('show',this._attachListener.bind(this)),this._layer.subscribe('hide',this._removeListener.bind(this))];if(this._layer.isShown())this._attachListener();}},disable:function(){this._removeListener();if(this._layerSubscriptions){while(this._layerSubscriptions.length)this._layer.unsubscribe(this._layerSubscriptions.pop());this._layerSubscriptions=null;}},_attachListener:function(){(function(){this._listener=Event.listen(document.documentElement,'click',function(l){if(!h.containsIncludingLayers(this._getNodeToCheck(),l.getTarget()))this._layer.disableBehavior(j).hide();}.bind(this));}).bind(this).defer();},_getNodeToCheck:function(){return this._layer.getRoot();},_removeListener:function(){if(this._listener){this._listener.remove();this._listener=null;}}});e.exports=k;});
__d("LayerHideOnCancel",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._layer=i;}g(h.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('cancel',function(){this._layer.hide();return false;}.bind(this));},disable:function(){this._subscription.unsubscribe();this._subscription=null;}});e.exports=h;});
__d("LayerHideOnEscape",["event-extensions","copyProperties","Input","Keys"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('Input'),i=b('Keys');function j(k){this._layer=k;}g(j.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('key',this._handle.bind(this));},disable:function(){this._layer.unsubscribe(this._subscription);this._subscription=null;},_handle:function(k,event){if(Event.getKeyCode(event)===i.ESC){var l=this._layer.getCausalElement();if(l)if(l.tabIndex!=-1)h.focus(l);this._layer.hide();return false;}}});e.exports=j;});
__d("LayerHideOnSuccess",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._layer=i;}g(h.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('success',this._layer.hide.bind(this._layer));},disable:function(){if(this._subscription){this._layer.unsubscribe(this._subscription);this._subscription=null;}}});e.exports=h;});
__d("LayerHideOnTransition",["Arbiter","Class","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('copyProperties');function j(k){this._layer=k;}i(j.prototype,{_subscription:null,enable:function(){this._subscription=g.subscribe('page_transition',this._layer.hide.shield(this._layer),g.SUBSCRIBE_NEW);},disable:function(){if(this._subscription){this._subscription.unsubscribe();this._subscription=null;}}});e.exports=j;});
__d("TabbableElements",["Style","createArrayFrom"],function(a,b,c,d,e,f){var g=b('Style'),h=b('createArrayFrom'),i={find:function(j){function k(n){if(n.tabIndex>0)return true;switch(n.tagName){case "A":return n.href&&n.rel!="ignore";case "INPUT":return n.type!="hidden"&&n.type!="file"&&!n.disabled;case "SELECT":return !n.disabled;case "TEXTAREA":return !n.disabled;default:return false;}}function l(n){if(n.offsetHeight===0&&n.offsetWidth===0)return true;var o=n;while(o&&o!=j&&g.get(o,'visibility')!=='hidden')o=o.parentNode;return o!==j;}var m=h(j.getElementsByTagName("*"));return m.filter(function(n){return k(n)&&!l(n);});}};e.exports=i;});
__d("LayerTabIsolation",["event-extensions","copyProperties","TabbableElements","Keys","Input"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('TabbableElements'),i=b('Keys'),j=b('Input');function k(l){this._layer=l;}g(k.prototype,{_tabHandler:null,_subscriptions:[],enable:function(){this._subscriptions=[this._layer.subscribe('show',this._attachHandler.bind(this)),this._layer.subscribe('hide',this._detachHandler.bind(this))];},disable:function(){while(this._subscriptions.length)this._layer.unsubscribe(this._subscriptions.pop());this._detachHandler();},_attachHandler:function(){var l=this._layer.getRoot();this._tabHandler=Event.listen(l,'keydown',function(m){if(Event.getKeyCode(m)==i.TAB){var n=m.getTarget();if(n){var o=h.find(l),p=o[0],q=o[o.length-1],r=m.getModifiers().shift;if(r&&n==p){m.preventDefault();j.focus(q);}else if(!r&&n==q){m.preventDefault();j.focus(p);}}}});},_detachHandler:function(){if(this._tabHandler){this._tabHandler.remove();this._tabHandler=null;}}});e.exports=k;});
__d("LayerMouseHooks",["event-extensions","function-extensions","ContextualThing","DOM","Layer","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ContextualThing'),h=b('DOM'),i=b('Layer'),j=b('copyProperties');function k(l){this._layer=l;}j(k.prototype,{_mouseSubscriptions:[],_layerSubscriptions:[],enable:function(){var l=this._layer.getRoot();this._mouseSubscriptions=[Event.listen(l,'mouseenter',this._onMouseEnter.bind(this)),Event.listen(l,'mouseleave',this._onMouseLeave.bind(this))];this._layerSubscriptions=[i.subscribe('show',this._onLayerShow.bind(this)),i.subscribe('hide',this._onLayerHide.bind(this))];},disable:function(){this._mouseSubscriptions.forEach(function(l){l.remove();});this._mouseSubscriptions=[];this._layerSubscriptions.forEach(function(l){i.unsubscribe(l);});this._layerSubscriptions=[];},_onMouseEnter:function(l){this._fireMouseLeaveOnLayerHide=false;if(!this._spawnedLayer)this._layer.inform('mouseenter');},_onMouseLeave:function(l){if(!this._spawnedLayer)this._layer.inform('mouseleave');this._fireMouseLeaveOnLayerHide=!!this._spawnedLayer;},_onLayerShow:function(l,m){var n=m.getContext&&m.getContext();if(n)if(h.contains(this._layer.getRoot(),n))this._spawnedLayer=m;},_onLayerHide:function(l,m){if(m===this._spawnedLayer){this._spawnedLayer=null;if(this._fireMouseLeaveOnLayerHide)this._onMouseLeave.bind(this).defer();}}});e.exports=k;});
__d("Overlay",["Arbiter","Class","CSS","DataStore","DOM","Layer","LayerButtons","LayerDestroyOnHide","LayerFadeOnHide","LayerFadeOnShow","LayerFormHooks","LayerHideOnBlur","LayerHideOnCancel","LayerHideOnEscape","LayerHideOnSuccess","LayerHideOnTransition","LayerTabIsolation","LayerMouseHooks","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('Layer'),m=b('LayerButtons'),n=b('LayerDestroyOnHide'),o=b('LayerFadeOnHide'),p=b('LayerFadeOnShow'),q=b('LayerFormHooks'),r=b('LayerHideOnBlur'),s=b('LayerHideOnCancel'),t=b('LayerHideOnEscape'),u=b('LayerHideOnSuccess'),v=b('LayerHideOnTransition'),w=b('LayerTabIsolation'),x=b('LayerMouseHooks'),y=b('$'),z=k.$N,aa=b('copyProperties');function ba(ca,da){ca=aa({buildWrapper:true},ca||{});this._shouldBuildWrapper=ca.buildWrapper;this.parent.construct(this,ca,da);}h.extend(ba,l);aa(ba.prototype,{_configure:function(ca,da){this.parent._configure(ca,da);var ea=this.getRoot();this._overlay=k.scry(ea,'div.uiOverlay')[0]||ea;i.hide(ea);k.appendContent(this.getInsertParent(),ea);j.set(this._overlay,'overlay',this);var fa=j.get(this._overlay,'width');fa&&this.setWidth(fa);if(this.setFixed)this.setFixed(j.get(this._overlay,'fixed')=='true');if(j.get(this._overlay,'fadeonshow')!='false')this.enableBehavior(p);if(j.get(this._overlay,'fadeonhide')!='false')this.enableBehavior(o);if(j.get(this._overlay,'hideonsuccess')!='false')this.enableBehavior(u);if(j.get(this._overlay,'hideonblur')=='true')this.enableBehavior(r);if(j.get(this._overlay,'destroyonhide')!='false')this.enableBehavior(n);return this;},_getDefaultBehaviors:function(){return this.parent._getDefaultBehaviors().concat([m,q,x,s,t,v,w]);},initWithoutBuildingWrapper:function(){this._shouldBuildWrapper=false;return this.init.apply(this,arguments);},_buildWrapper:function(ca,da){da=this.parent._buildWrapper(ca,da);if(!this._shouldBuildWrapper)return da;var ea=z('div',{className:'uiOverlayContent'},da);return z('div',{className:'uiOverlay'},ea);},destroy:function(){j.remove(this.getRoot(),'overlay');this.parent.destroy();}});e.exports=ba;});
__d("ContextualDialogX",["event-extensions","AccessibleLayer","ARIA","Arbiter","Bootloader","Class","ContextualDialogFooterLink","ContextualThing","CSS","DataStore","DOM","Locale","Overlay","Parent","Style","Vector","$","copyProperties","getOverlayZIndex"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AccessibleLayer'),h=b('ARIA'),i=b('Arbiter'),j=b('Bootloader'),k=b('Class'),l=b('ContextualDialogFooterLink'),m=b('ContextualThing'),n=b('CSS'),o=b('DataStore'),p=b('DOM'),q=b('Locale'),r=b('Overlay'),s=b('Parent'),t=b('Style'),u=b('Vector'),v=b('$'),w=b('copyProperties'),x=b('getOverlayZIndex');function y(z,aa){this.parent.construct(this,z,aa);}k.extend(y,r);w(y,{ARROW_OFFSET:15,ARROW_LENGTH:16,ARROW_INSET:22,TOP_MARGIN:8,BOTTOM_MARGIN:30,LEFT_MARGIN:15,RIGHT_MARGIN:30,POSITION_TO_CLASS:{above:'uiContextualDialogAbove',below:'uiContextualDialogBelow',left:'uiContextualDialogLeft',right:'uiContextualDialogRight'},RIGHT_ALIGNED_CLASS:'uiContextualDialogRightAligned',ARROW_CLASS:{bottom:'uiContextualDialogArrowBottom',top:'uiContextualDialogArrowTop',right:'uiContextualDialogArrowRight',left:'uiContextualDialogArrowLeft'},POSITION_TO_ARROW:{above:'bottom',below:'top',left:'right',right:'left'},getInstance:function(z){var aa=o.get(z,'ContextualDialogX');if(!aa){var ba=s.byClass(z,'uiOverlay');if(ba)aa=o.get(ba,'overlay');}return aa;}});w(y.prototype,{_scrollListener:null,_scrollParent:null,_width:null,_fixed:false,_hasFooter:false,_showSubscription:null,_hideSubscription:null,_hovercardSubscription:null,_setContextSubscription:null,_configure:function(z,aa){this.parent._configure(z,aa);var ba=this.getRoot(),ca=o.get.curry(ba);this.setAlignH(ca('alignh','left'));this.setOffsetX(ca('offsetx',0));this.setOffsetY(ca('offsety',0));this.setPosition(ca('position','above'));this._hasFooter=ca('hasfooter',false);if(this._hasFooter){var da=p.scry(ba,'.uiContextualDialogFooterLink')[0];da&&this.enableBehavior(l);}this._setContextSubscription=this.subscribe('beforeshow',function(){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;var ga=ca('context');if(ga){this.setContext(v(ga));}else{ga=ca('contextselector');if(ga)this.setContext(p.find(document,ga));}}.bind(this));this._content=p.scry(ba,'.uiContextualDialogContent')[0];var ea=null,fa=null;this._showSubscription=this.subscribe('show',function(){var ga=this.updatePosition.shield(this);ea=Event.listen(window,'resize',ga);fa=i.subscribe('reflow',ga);this._setupScrollListener(this._scrollParent);m.register(ba,this.context);i.inform('layer_shown',{type:'ContextualDialog'});}.bind(this));this._hideSubscription=this.subscribe('hide',function(){ea.remove();fa.unsubscribe();this._teardownScrollListener();m.remove(ba);i.inform('layer_hidden',{type:'ContextualDialog'});}.bind(this));this._hovercardSubscription=i.subscribe('Hovercard/hide',function(ga,ha){if(a.Hovercard.contains(this.getContext()))this.hide();}.bind(this));return this;},_getDefaultBehaviors:function(){return this.parent._getDefaultBehaviors().concat([g]);},_buildWrapper:function(z,aa){var ba=this.parent._buildWrapper(z,aa);if(!this._shouldBuildWrapper)return ba;n.addClass(ba,'uiContextualDialog');return p.create('div',{className:'uiContextualDialogPositioner'},ba);},setWidth:function(z){this._width=Math.floor(z);return this;},setFixed:function(z){z=!!z;n.conditionClass(this.getRoot(),'uiContextualDialogFixed',z);this._fixed=z;return this;},setAlignH:function(z){this.alignH=z;this._updateAlignmentClass();this._shown&&this.updatePosition();this.position&&this._updateArrow();return this;},getContent:function(){return this._content;},getContext:function(){return this.context;},setContext:function(z){if(this._setContextSubscription){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;}z=v(z);if(this.context&&this.context!=z)o.remove(this.context,'ContextualDialogX');this.context=z;h.setPopup(this.getCausalElement(),this.getRoot());var aa=s.byClass(z,'fbPhotoSnowlift');this.setInsertParent(aa||p.getDocumentBodyElement());if(this._scrollListener&&this._scrollParent!==aa){this._teardownScrollListener();this._setupScrollListener(aa);}this._scrollParent=aa;var ba=x(z,this._insertParent);t.set(this.getRoot(),'z-index',ba>200?ba:'');o.set(this.context,'ContextualDialogX',this);return this;},getCausalElement:function(){return this.parent.getCausalElement()||this.context;},listen:function(z,aa){return Event.listen(this.getRoot(),z,aa);},setOffsetX:function(z){this.offsetX=parseInt(z,10)||0;this._shown&&this.updatePosition();return this;},setOffsetY:function(z){this.offsetY=parseInt(z,10)||0;this._shown&&this.updatePosition();return this;},setPosition:function(z){this.position=z;for(var aa in y.POSITION_TO_CLASS)n.conditionClass(this.getRoot(),y.POSITION_TO_CLASS[aa],z==aa);this._updateAlignmentClass();this._shown&&this.updatePosition();this._updateArrow();return this;},updatePosition:function(){if(!this.context)return false;if(this._width)t.set(this._overlay,'width',this._width+'px');var z=this._fixed?'viewport':'document',aa=u.getElementPosition(this.context,z),ba=this._scrollParent;if(ba)aa=aa.sub(u.getElementPosition(ba,'document')).add(ba.scrollLeft,ba.scrollTop);var ca=u.getElementDimensions(this.context),da=this.position=='above'||this.position=='below',ea=q.isRTL();if((this.position=='right'||(da&&this.alignH=='right'))!=ea)aa=aa.add(ca.x,0);if(this.position=='below')aa=aa.add(0,ca.y);var fa=new u(0,0);if(da&&this.alignH=='center'){fa=fa.add((ca.x-this._width)/2,0);}else{var ga=da?ca.x:ca.y,ha=2*y.ARROW_INSET;if(ga<ha){var ia=ga/2-y.ARROW_INSET;fa=fa.add(da?ia:0,da?0:ia);}}fa=fa.add(this.offsetX,this.offsetY);if(ea)fa=fa.mul(-1,1);aa=aa.add(fa);if(this._fixed)aa=new u(aa.x,aa.y,'document');aa.setElementPosition(this.getRoot());this._adjustVerticalPosition();this._adjustHorizontalPosition();return true;},scrollTo:function(){if(this.context)j.loadModules(['DOMScroll'],function(z){z.scrollTo(this.context,true,true);}.bind(this));},destroy:function(){this.unsubscribe(this._showSubscription);this.unsubscribe(this._hideSubscription);this._hovercardSubscription.unsubscribe();if(this._setContextSubscription){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;}this.context&&o.remove(this.context,'ContextualDialogX');this.parent.destroy();},_adjustVerticalPosition:function(){if(this.position!='left'&&this.position!='right'){t.set(this._overlay,'top','');return;}var z=this.getRoot(),aa=u.getElementPosition(z,'viewport').y,ba=u.getElementDimensions(this._overlay).y,ca=u.getViewportDimensions().y,da=y.TOP_MARGIN,ea=Math.min(Math.max(0,aa+ba+y.BOTTOM_MARGIN-ca),Math.max(-da,aa-da),ba-2*y.ARROW_INSET);t.set(this._overlay,'top',(-1*ea)+'px');t.set(this._arrow,'top',y.ARROW_OFFSET+'px');t.set(this._arrow,'marginTop',ea+'px');},_adjustHorizontalPosition:function(){if((this.position!='above'&&this.position!='below')||this.alignH!='left'){t.set(this._overlay,'left','');t.set(this._overlay,'right','');return;}var z=this.getRoot(),aa=u.getElementPosition(z,'viewport').x,ba=u.getElementDimensions(this._overlay).x,ca=u.getViewportDimensions().x,da=q.isRTL(),ea;if(!da){ea=aa+ba+y.RIGHT_MARGIN-ca;}else ea=y.LEFT_MARGIN+ba-aa;ea=Math.min(Math.max(0,ea),ba-2*y.ARROW_INSET);t.set(this._overlay,da?'right':'left',-1*ea+'px');t.set(this._arrow,da?'right':'left',y.ARROW_OFFSET+'px');t.set(this._arrow,da?'marginRight':'marginLeft',ea+'px');},_updateArrow:function(){var z=0;if(this.position=='above'||this.position=='below')switch(this.alignH){case 'center':z=50;break;case 'right':z=100;break;}this._renderArrow(y.POSITION_TO_ARROW[this.position],z);},_renderArrow:function(z,aa){for(var ba in y.ARROW_CLASS)n.conditionClass(this._overlay,y.ARROW_CLASS[ba],z==ba);n.conditionClass(this._overlay,'uiContextualDialogWithFooterArrowBottom',z=='bottom'&&this._hasFooter);if(z=='none')return;if(!this._arrow){this._arrow=p.create('i',{className:'uiContextualDialogArrow'});p.appendContent(this._overlay,this._arrow);}t.set(this._arrow,'top','');t.set(this._arrow,'left','');t.set(this._arrow,'right','');t.set(this._arrow,'margin','');var ca=z=='top'||z=='bottom',da=ca?(q.isRTL()?'right':'left'):'top';aa=aa||0;t.set(this._arrow,da,aa+'%');var ea=y.ARROW_LENGTH+y.ARROW_OFFSET*2;t.set(this._arrow,'margin-'+da,-(ea*aa/100-y.ARROW_OFFSET)+'px');},_updateAlignmentClass:function(){n.conditionClass(this.getRoot(),y.RIGHT_ALIGNED_CLASS,(this.position=='above'||this.position=='below')&&this.alignH=='right');},_setupScrollListener:function(z){this._scrollListener=Event.listen(z||window,'scroll',this._adjustVerticalPosition.shield(this));},_teardownScrollListener:function(){this._scrollListener.remove();this._scrollListener=null;}});e.exports=y;});
__d("Rect",["Vector","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Vector'),h=b('$'),i=b('copyProperties');function j(k,l,m,n,o){if(arguments.length===1){if(k instanceof j)return k;if(k instanceof g)return new j(k.y,k.x,k.y,k.x,k.domain);return j.getElementBounds(h(k));}i(this,{t:k,r:l,b:m,l:n,domain:o||'pure'});}i(j.prototype,{w:function(){return this.r-this.l;},h:function(){return this.b-this.t;},toString:function(){return '(('+this.l+', '+this.t+'), ('+this.r+', '+this.b+'))';},contains:function(k){k=new j(k).convertTo(this.domain);var l=this;return (l.l<=k.l&&l.r>=k.r&&l.t<=k.t&&l.b>=k.b);},add:function(k,l){if(arguments.length==1){if(k.domain!='pure')k=k.convertTo(this.domain);return this.add(k.x,k.y);}var m=parseFloat(k),n=parseFloat(l);return new j(this.t+n,this.r+m,this.b+n,this.l+m,this.domain);},sub:function(k,l){if(arguments.length==1){return this.add(k.mul(-1));}else return this.add(-k,-l);},boundWithin:function(k){var l=0,m=0;if(this.l<k.l){l=k.l-this.l;}else if(this.r>k.r)l=k.r-this.r;if(this.t<k.t){m=k.t-this.t;}else if(this.b>k.b)m=k.b-this.b;return this.add(l,m);},getCenter:function(){return new g(this.l+this.w()/2,this.t+this.h()/2,this.domain);},getPositionVector:function(){return new g(this.l,this.t,this.domain);},getDimensionVector:function(){return new g(this.w(),this.h(),'pure');},convertTo:function(k){if(this.domain==k)return this;if(k=='pure')return new j(this.t,this.r,this.b,this.l,'pure');if(this.domain=='pure')return new j(0,0,0,0);var l=new g(this.l,this.t,this.domain).convertTo(k);return new j(l.y,l.x+this.w(),l.y+this.h(),l.x,k);}});i(j,{deserialize:function(k){var l=k.split(':');return new j(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]),parseFloat(l[0]));},newFromVectors:function(k,l){return new j(k.y,k.x+l.x,k.y+l.y,k.x,k.domain);},getElementBounds:function(k){return j.newFromVectors(g.getElementPosition(k),g.getElementDimensions(k));},getViewportBounds:function(){return j.newFromVectors(g.getScrollPosition(),g.getViewportDimensions());},minimumBoundingBox:function(k){var l=new j(Math.min(),Math.max(),Math.max(),Math.min()),m;for(var n=0;n<k.length;n++){m=k[n];l.t=Math.min(l.t,m.t);l.r=Math.max(l.r,m.r);l.b=Math.max(l.b,m.b);l.l=Math.min(l.l,m.l);}return l;}});e.exports=j;});
__d("Hovercard",["ClickRef","event-extensions","function-extensions","Arbiter","AsyncRequest","AsyncSignal","ContextualDialogX","DOM","LayerDestroyOnHide","LayerFadeOnHide","LayerFadeOnShow","Parent","Rect","UserAgent","URI","Vector","tx","userAction"],function(a,b,c,d,e,f){b('ClickRef');b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AsyncSignal'),j=b('ContextualDialogX'),k=b('DOM'),l=b('LayerDestroyOnHide'),m=b('LayerFadeOnHide'),n=b('LayerFadeOnShow'),o=b('Parent'),p=b('Rect'),q=b('UserAgent'),r=b('URI'),s=b('Vector'),t=b('tx'),u=b('userAction'),v=450,w=385,x={},y={},z=null,aa=null,ba=null,ca=150,da=700,ea=1000,fa=250,ga=null,ha=null,ia=null,ja=null;function ka(){if(q.ie()<7)return;Event.listen(document.documentElement,'mouseover',la);Event.listen(window,'scroll',function(){bb.hide(true);});g.subscribe('page_transition',function(){ra();bb.dirtyAll();},g.SUBSCRIBE_NEW);g.subscribe('layer_shown',function(cb,db){if(db.type!='Hovercard'&&db.type!='ContextualDialog')ra();},g.SUBSCRIBE_NEW);}function la(event){var cb=o.byTag(event.getTarget(),'a');if(cb&&ma(cb)){pa(cb);event.stop();}}function ma(cb){aa=cb;if(!na(cb)){var db;if(!cb||!(db=oa(cb))){y.moveToken&&y.moveToken.remove();y={};return false;}if(y.node!=cb){y.moveToken&&y.moveToken.remove();y={node:cb,endpoint:db,pos:null};}}return true;}function na(cb){return cb&&z&&y.node==cb;}function oa(cb){return cb.getAttribute('data-hovercard');}function pa(cb){var db=Event.listen(cb,'mouseout',function(){clearTimeout(ga);clearTimeout(ha);db.remove();aa=null;bb.hide();});if(!y.moveToken)y.moveToken=Event.listen(cb,'mousemove',function(event){y.pos=s.getEventPosition(event);});clearTimeout(ga);clearTimeout(ha);clearTimeout(ja);var eb=ca,fb=z?fa:da;if(cb.getAttribute('data-hovercard-instant'))eb=fb=50;ga=setTimeout(xa.curry(cb),eb);ha=setTimeout(qa.curry(cb),fb);}function qa(cb,db){if(y.node!=cb)return;var eb=x[oa(cb)];if(eb){sa(eb);}else if(db){sa(za());}else{var fb=z?fa:da;ia=setTimeout(qa.curry(cb,true),ea-fb);}}function ra(){bb.hide(true);clearTimeout(ha);}function sa(cb){var db=y.node,eb=z,fb=eb!=db;if(z){var gb=j.getInstance(z);gb&&gb.hide();}if(!k.contains(document.body,db)){bb.hide(true);return;}z=db;ba=cb;ta();cb.setContext(db).show();if(fb){(function(){new i('/ajax/hovercard/shown.php').send();u('himp',z,null,'FORCE',{ft:{evt:39}});}).defer();if(eb){g.inform('Hovercard/hide',{node:eb});}else g.inform('layer_shown',{type:'Hovercard'});g.inform('Hovercard/show',{node:db});}}function ta(){var cb=s.getViewportDimensions(),db=s.getElementPosition(z,'viewport'),eb=db.convertTo('document'),fb=wa(z),gb='above',hb='left',ib=va(eb,fb,'above');if(db.y+ib<=w){var jb=va(eb,fb,'below');if(db.y+jb+z.offsetHeight+w<cb.y){gb='below';ib=jb;}}var kb=cb.x;if(a.ChatSidebar)kb-=a.ChatSidebar.getVisibleWidth();var lb=ua(eb,fb,'left');if(db.x+lb+v>=kb){var mb=ua(eb,fb,'right');if(db.x+mb+z.offsetWidth>v){hb='right';lb=mb;}}ba.setPosition(gb).setAlignH(hb).setOffsetX(lb).setOffsetY(ib);}function ua(cb,db,eb){if(eb=='left')return db.l-cb.x;return db.r-(cb.x+z.offsetWidth);}function va(cb,db,eb){if(eb=='above')return db.t-cb.y;return db.b-(cb.y+z.offsetHeight);}function wa(cb){var db=y.pos,eb=cb.getClientRects();if(!db||eb.length===0)return p.getElementBounds(cb);var fb,gb=false;for(var hb=0;hb<eb.length;hb++){var ib=new p(Math.round(eb[hb].top),Math.round(eb[hb].right),Math.round(eb[hb].bottom),Math.round(eb[hb].left),'viewport').convertTo('document'),jb=ib.getPositionVector(),kb=jb.add(ib.getDimensionVector());if(!fb||(jb.x<=fb.l&&jb.y>fb.t)){if(gb)break;fb=new p(jb.y,kb.x,kb.y,jb.x,'document');}else{fb.t=Math.min(fb.t,jb.y);fb.b=Math.max(fb.b,kb.y);fb.r=kb.x;}if(ib.contains(db))gb=true;}return fb;}function xa(cb){if(cb.id&&x[cb.id]!=null)return;var db=oa(cb);if(x[db]!=null)return;ya(db);var eb=function(){bb.dirty(db);ra();};new h(db).setData({endpoint:db}).setMethod('GET').setReadOnly(true).setErrorHandler(eb).setTransportErrorHandler(eb).send();}function ya(cb){x[cb]=false;}var za=function(){var cb=new j({},k.create('div',{className:'HovercardLoading'},"Ladataan..."));cb.disableBehavior(l).disableBehavior(n).disableBehavior(m);ab(cb);za=bagof(cb);return cb;};function ab(cb){cb.subscribe('mouseenter',function(){clearTimeout(ja);aa=y.node;});cb.subscribe('mouseleave',function(){bb.hide(false);aa=null;});}var bb={hide:function(cb){if(!z)return;if(cb){if(ba){g.inform('layer_hidden',{type:'Hovercard'});g.inform('Hovercard/hide',{node:z});ba.hide();}aa=null;z=null;ba=null;}else ja=setTimeout(bb.hide.curry(true),fa);},setDialog:function(cb,db){x[cb]=db;ab(db);if(y.endpoint==cb&&aa==y.node)sa(db);},getDialog:function(cb){return x[cb];},contains:function(cb){if(ba)return k.contains(ba.getRoot(),cb);return false;},dirty:function(cb){var db=x[cb];if(db){db.destroy();delete x[cb];}},dirtyAll:function(){for(var cb in x){var db=x[cb];db&&bb.dirty(cb);}},getBaseURI:function(){return r('/ajax/hovercard/hovercard.php').setSubdomain('www');}};if(!a.Hovercard){ka();}else bb=a.Hovercard;e.exports=bb;a.Hovercard=e.exports;});
__d("DocumentTitle",["Arbiter"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=document.title,i=null,j=1500,k=[],l=0,m=null,n=false;function o(){if(k.length>0){if(!n){p(k[l].title);l=++l%k.length;}else q();}else{clearInterval(m);m=null;q();}}function p(s){document.title=s;n=true;}function q(){r.set(i||h,true);n=false;}var r={get:function(){return h;},set:function(s,t){document.title=s;if(!t){h=s;i=null;g.inform('update_title',s);}else i=s;},blink:function(s){var t={title:s};k.push(t);if(m===null)m=setInterval(o,j);return {stop:function(){var u=k.indexOf(t);if(u>=0){k.splice(u,1);if(l>u){l--;}else if(l==u&&l==k.length)l=0;}}};}};a.DocumentTitle=e.exports=r;},3);
__d("computeRelativeURI",["URI","isEmpty"],function(a,b,c,d,e,f){var g=b('URI'),h=b('isEmpty');function i(k,l){if(!l)return k;if(l.charAt(0)=='/')return l;var m=k.split('/').slice(0,-1);m[0]!=='';l.split('/').forEach(function(n){if(!(n=='.'))if(n=='..'){if(m.length>1)m=m.slice(0,-1);}else m.push(n);});return m.join('/');}function j(k,l){var m=new g(),n=l;k=new g(k);l=new g(l);if(l.getDomain()&&!l.isFacebookURI())return n;var o=k,p=['Protocol','Domain','Port','Path','QueryData','Fragment'];p.forEach(function(q){var r=q=='Path'&&o===k;if(r)m.setPath(i(k.getPath(),l.getPath()));if(!h(l['get'+q]()))o=l;if(!r)m['set'+q](o['get'+q]());});return m;}e.exports=j;});
__d("HistoryManager",["event-extensions","function-extensions","Cookie","Env","URI","UserAgent","copyProperties","goOrReplace"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Cookie'),h=b('Env'),i=b('URI'),j=b('UserAgent'),k=b('copyProperties'),l=b('goOrReplace'),m={_IFRAME_BASE_URI:'http://static.ak.facebook.com/common/history_manager.php',history:null,current:0,fragment:null,_setIframeSrcFragment:function(n){n=n.toString();var o=m.history.length-1;m.iframe.src=m._IFRAME_BASE_URI+'?|index='+o+'#'+encodeURIComponent(n);return m;},getIframeSrcFragment:function(){return decodeURIComponent(i(m.iframe.contentWindow.document.location.href).getFragment());},nextframe:function(n,o){if(o){m._setIframeSrcFragment(n);return;}if(n!==undefined){m.iframeQueue.push(n);}else{m.iframeQueue.splice(0,1);m.iframeTimeout=null;m.checkURI();}if(m.iframeQueue.length&&!m.iframeTimeout){var p=m.iframeQueue[0];m.iframeTimeout=setTimeout(function(){m._setIframeSrcFragment(p);},100,false);}},isInitialized:function(){return !!m._initialized;},init:function(){if(!h.ALLOW_TRANSITION_IN_IFRAME&&window!=window.top)return;if(m._initialized)return m;var n=i(),o=n.getFragment()||'';if(o.charAt(0)==='!'){o=o.substr(1);n.setFragment(o);}if(i.getRequestURI(false).getProtocol().toLowerCase()=='https')m._IFRAME_BASE_URI='https://s-static.ak.facebook.com/common/history_manager.php';k(m,{_initialized:true,fragment:o,orig_fragment:o,history:[n],callbacks:[],lastChanged:Date.now(),canonical:i('#'),fragmentTimeout:null,user:0,iframeTimeout:null,iframeQueue:[],enabled:true,debug:bagofholding});if(window.history&&history.pushState){this.lastURI=document.URL;window.history.replaceState(this.lastURI,null);Event.listen(window,'popstate',function(p){if(p&&p.state&&m.lastURI!=p.state){m.lastURI=p.state;m.lastChanged=Date.now();m.notify(i(p.state).getUnqualifiedURI().toString());}}.bind(m));if(j.safari()<534||j.chrome()<=13){setInterval(m.checkURI,42,false);m._updateRefererURI(this.lastURI);}return m;}m._updateRefererURI(i.getRequestURI(false));if(j.safari()<500||j.firefox()<2){m.enabled=false;return m;}if(j.ie()<8){m.iframe=document.createElement('iframe');k(m.iframe.style,{width:'0',height:'0',frameborder:'0',left:'0',top:'0',position:'absolute'});m._setIframeSrcFragment(o);document.body.insertBefore(m.iframe,document.body.firstChild);}else if('onhashchange' in window){Event.listen(window,'hashchange',function(){m.checkURI.bind(m).defer();});}else setInterval(m.checkURI,42,false);return m;},registerURIHandler:function(n){m.callbacks.push(n);return m;},setCanonicalLocation:function(n){m.canonical=i(n);return m;},notify:function(n){if(n==m.orig_fragment)n=m.canonical.getFragment();for(var o=0;o<m.callbacks.length;o++)try{if(m.callbacks[o](n))return true;}catch(p){}return false;},checkURI:function(){if(Date.now()-m.lastChanged<400)return;if(window.history&&history.pushState){var n=i(document.URL).removeQueryData('ref').toString(),o=i(m.lastURI).removeQueryData('ref').toString();if(n!=o){m.lastChanged=Date.now();m.lastURI=n;if(j.safari()<534)m._updateRefererURI(n);m.notify(i(n).getUnqualifiedURI().toString());}return;}if(j.ie()<8&&m.iframeQueue.length)return;if(j.safari()&&window.history.length==200){if(!m.warned)m.warned=true;return;}var p=i().getFragment();if(p.charAt(0)=='!')p=p.substr(1);if(j.ie()<8)p=m.getIframeSrcFragment();p=p.replace(/%23/g,'#');if(p!=m.fragment.replace(/%23/g,'#')){m.debug([p,' vs ',m.fragment,'whl: ',window.history.length,'QHL: ',m.history.length].join(' '));for(var q=m.history.length-1;q>=0;--q)if(m.history[q].getFragment().replace(/%23/g,'#')==p)break;++m.user;if(q>=0){m.go(q-m.current);}else m.go('#'+p);--m.user;}},_updateRefererURI:function(n){n=n.toString();if(n.charAt(0)!='/'&&n.indexOf('//')==-1)return;var o=new i(window.location);if(o.isFacebookURI()){var p=o.getPath()+window.location.search;}else var p='';var q=i(n).getQualifiedURI().setFragment(p).toString(),r=2048;if(q.length>r)q=q.substring(0,r)+'...';g.set('x-referer',q);},go:function(n,o,p){if(window.history&&history.pushState){o||typeof(n)=='number';var q=i(n).removeQueryData('ref').toString();m.lastChanged=Date.now();this.lastURI=q;if(p){window.history.replaceState(n,null,q);}else window.history.pushState(n,null,q);if(j.safari()<534)m._updateRefererURI(n);return false;}m.debug('go: '+n);if(o===undefined)o=true;if(!m.enabled)if(!o)return false;if(typeof(n)=='number'){if(!n)return false;var r=n+m.current,s=Math.max(0,Math.min(m.history.length-1,r));m.current=s;r=m.history[s].getFragment()||m.orig_fragment;r=i(r).removeQueryData('ref').getUnqualifiedURI().toString();m.fragment=r;m.lastChanged=Date.now();if(j.ie()<8){if(m.fragmentTimeout)clearTimeout(m.fragmentTimeout);m._temporary_fragment=r;m.fragmentTimeout=setTimeout(function(){window.location.hash='#!'+r;delete m._temporary_fragment;},750,false);if(!m.user)m.nextframe(r,p);}else if(!m.user)l(window.location,window.location.href.split('#')[0]+'#!'+r,p);if(o)m.notify(r);m._updateRefererURI(r);return false;}n=i(n);if(n.getDomain()==i().getDomain())n=i('#'+n.getUnqualifiedURI());var t=m.history[m.current].getFragment(),u=n.getFragment();if(u==t||(t==m.orig_fragment&&u==m.canonical.getFragment())){if(o)m.notify(u);m._updateRefererURI(u);return false;}if(p)m.current--;var v=(m.history.length-m.current)-1;m.history.splice(m.current+1,v);m.history.push(i(n));return m.go(1,o,p);},getCurrentFragment:function(){var n=m._temporary_fragment!==undefined?m._temporary_fragment:i.getRequestURI(false).getFragment();return n==m.orig_fragment?m.canonical.getFragment():n;}};e.exports=m;});
__d("DOMScroll",["Animation","DOM","DOMQuery","Style","Vector","ge"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('DOM'),i=b('DOMQuery'),j=b('Style'),k=b('Vector'),l=h.$N,m=b('ge'),n={getScrollState:function(){var o=k.getViewportDimensions(),p=k.getDocumentDimensions(),q=(p.x>o.x),r=(p.y>o.y);q+=0;r+=0;return new k(q,r);},_scrollbarSize:null,_initScrollbarSize:function(){var o=l('p');o.style.width='100%';o.style.height='200px';var p=l('div');p.style.position='absolute';p.style.top='0px';p.style.left='0px';p.style.visibility='hidden';p.style.width='200px';p.style.height='150px';p.style.overflow='hidden';p.appendChild(o);document.body.appendChild(p);var q=o.offsetWidth;p.style.overflow='scroll';var r=o.offsetWidth;if(q==r)r=p.clientWidth;document.body.removeChild(p);n._scrollbarSize=q-r;},getScrollbarSize:function(){if(n._scrollbarSize===null)n._initScrollbarSize();return n._scrollbarSize;},scrollTo:function(o,p,q,r,s){if(typeof p=='undefined'||p===true)p=750;if(!(o instanceof k)){var t=k.getScrollPosition().x,u=k.getElementPosition(m(o)).y;o=new k(t,u,'document');if(!r){var v=m('blueBar'),w=m('blueBarHolder');if(v&&j.isFixed(v))o.y-=k.getElementDimensions(w).y/(q?2:1);}}if(q){o.y-=k.getViewportDimensions().y/2;}else if(r){o.y-=k.getViewportDimensions().y;o.y+=r;}o=o.convertTo('document');if(p){var x=h.getDocumentBodyElement();return new g(x).to('scrollTop',o.y).to('scrollLeft',o.x).ease(g.ease.end).duration(p).ondone(s).go();}else if(window.scrollTo){window.scrollTo(o.x,o.y);s&&s();}},ensureVisible:function(o,p,q,r,s){if(q===undefined)q=10;o=m(o);if(p)o=i.find(o,p);var t=k.getScrollPosition().x,u=k.getScrollPosition().y,v=u+k.getViewportDimensions().y,w=k.getElementPosition(o).y,x=w+k.getElementDimensions(o).y,y=m('blueBar'),z=m('blueBarHolder');if(y&&j.isFixed(y))w-=k.getElementDimensions(z).y;w-=q;x+=q;if(w<u){n.scrollTo(new k(t,w,'document'),r,false,false,s);}else if(x>v)if(w-(x-v)<u){n.scrollTo(new k(t,w,'document'),r,false,false,s);}else n.scrollTo(new k(t,x,'document'),r,false,true,s);},scrollToTop:function(o){var p=k.getScrollPosition();n.scrollTo(new k(p.x,0,'document'),o!==false);}};e.exports=n;});
__d("JSLogger",[],function(a,b,c,d,e,f){var g={MAX_HISTORY:500,counts:{},categories:{},seq:0,pageId:(Math.random()*2147483648|0).toString(36)};function h(l){if(l instanceof Error&&a.ErrorUtils)l=a.ErrorUtils.normalizeError(l);try{return JSON.stringify(l);}catch(m){return '{}';}}function i(l,event,m){if(!g.counts[l])g.counts[l]={};if(!g.counts[l][event])g.counts[l][event]=0;m=m==null?1:Number(m);g.counts[l][event]+=isFinite(m)?m:0;}g.logAction=function(event,l,m){if(this.type=='bump'){i(this.cat,event,l);}else if(this.type=='rate'){(l&&i(this.cat,event+'_n',m));i(this.cat,event+'_d',m);}else{var n={cat:this.cat,type:this.type,event:event,data:l!=null?h(l):null,date:Date.now(),seq:g.seq++};g.head=g.head?(g.head.next=n):(g.tail=n);while(g.head.seq-g.tail.seq>g.MAX_HISTORY)g.tail=g.tail.next;return n;}};function j(l){if(!g.categories[l]){g.categories[l]={};var m=function(n){var o={cat:l,type:n};g.categories[l][n]=function(){var p;try{p=a.top.require&&a.top.require('JSLogger')._.logAction;}catch(q){}(p&&p.apply(o,arguments));};};m('debug');m('log');m('warn');m('error');m('bump');m('rate');}return g.categories[l];}function k(l,m){var n=[];for(var o=m||g.tail;o;o=o.next)if(!l||l(o)){var p={type:o.type,cat:o.cat,date:o.date,event:o.event,seq:o.seq};if(o.data)p.data=JSON.parse(o.data);n.push(p);}return n;}e.exports={_:g,DUMP_EVENT:'jslogger/dump',create:j,getEntries:k};});
__d("PageTransitions",["event-extensions","Arbiter","Dialog","DOM","DOMScroll","Env","Form","HistoryManager","JSLogger","LinkController","OnloadHooks","StringEscape","URI","UserAgent","Vector","areObjectsEqual","computeRelativeURI","copyProperties","ge","goOrReplace","startsWith","tx","userAction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('Dialog'),i=b('DOM'),j=b('DOMScroll'),k=b('Env'),l=b('Form'),m=b('HistoryManager'),n=b('JSLogger'),o=b('LinkController'),p=b('OnloadHooks'),q=b('StringEscape'),r=b('URI'),s=b('UserAgent'),t=b('Vector'),u=b('areObjectsEqual'),v=b('computeRelativeURI'),w=b('copyProperties'),x=b('ge'),y=b('goOrReplace'),z=b('startsWith'),aa=b('tx'),ba=b('userAction'),ca={_transition_handlers:[],_scroll_positions:{},_scroll_locked:false,isInitialized:function(){return !!ca._initialized;},_init:function(){if(!k.ALLOW_TRANSITION_IN_IFRAME&&window!=window.top)return;if(ca._initialized)return ca;ca._initialized=true;var ea=r.getRequestURI(false),fa=ea.getUnqualifiedURI(),ga=r(fa).setFragment(null),ha=fa.getFragment();if(ha.charAt(0)==='!'&&ga.toString()===ha.substr(1))fa=ga;w(ca,{_current_uri:fa,_most_recent_uri:fa,_next_uri:fa});var ia;if(z(ea.getFragment(),'/')){ia=ea.getFragment();}else ia=fa;m.init().setCanonicalLocation('#'+ia).registerURIHandler(ca._historyManagerHandler);o.registerFallbackHandler(ca._rewriteHref);o.registerFallbackHandler(ca._onlinkclick);Event.listen(document.documentElement,'submit',ca._onformsubmit);Event.listen(window,'scroll',function(){if(!ca._scroll_locked)ca._scroll_positions[ca._current_uri]=t.getScrollPosition();});return ca;},registerHandler:function(ea,fa){ca._init();fa=fa||5;if(!ca._transition_handlers[fa])ca._transition_handlers[fa]=[];ca._transition_handlers[fa].push(ea);},getCurrentURI:function(ea){if(!ca._current_uri&&!ea)return new r(ca._most_recent_uri);return new r(ca._current_uri);},getMostRecentURI:function(){return new r(ca._most_recent_uri);},getNextURI:function(){return new r(ca._next_uri);},_rewriteHref:function(ea){var fa=ea.getAttribute('href'),ga=v(ca._most_recent_uri.getQualifiedURI(),fa).toString();if(fa!=ga)ea.setAttribute('href',ga);},_onlinkclick:function(ea){da.lookBusy(ea);ca.go(ea.getAttribute('href'));return false;},_onformsubmit:function(event){var ea=event.getTarget();if(l.getAttribute(ea,'rel')||l.getAttribute(ea,'target'))return;var fa=ba('form',ea,event).set_namespace('page_transition'),ga=a.ArbiterMonitor;if(ga)ga.initUA(fa,[ea]);var ha=new r(l.getAttribute(ea,'action')||''),ia=v(ca._most_recent_uri,ha);ea.setAttribute('action',ia.toString());if((l.getAttribute(ea,'method')||'GET').toUpperCase()==='GET'){ca.go(ia.addQueryData(l.serialize(ea)));event.kill();}},go:function(ea,fa){var ga=new r(ea).removeQueryData('quickling').getQualifiedURI(),ha=ga.getUnqualifiedURI();delete ca._scroll_positions[ha];!fa&&ba('uri',{href:ga.toString()},null,'INDIRECT');da.lookBusy();ca._loadPage(ga,function(ia){if(ia){m.go(ga.toString(),false,fa);}else y(window.location,ga,fa);});},_historyManagerHandler:function(ea){if(ea.charAt(0)!='/')return false;ba('h',{href:ea},null);ca._loadPage(new r(ea),function(fa){if(!fa)y(window.location,ea,true);});return true;},_loadPage:function(ea,fa){if(r(ea).getFragment()&&u(r(ea).setFragment(null).getQualifiedURI(),r(ca._current_uri).setFragment(null).getQualifiedURI())){ca._current_uri=ca._most_recent_uri=ea;ca.restoreScrollPosition();da.stopLookingBusy();return;}var ga=ca._scroll_positions[ca._current_uri];ca._current_uri=null;ca._next_uri=ea;if(ga)j.scrollTo(ga,false);var ha=function(){ca._scroll_locked=true;var ja=ca._handleTransition(ea);fa&&fa(ja);},ia=p.runHooks('onbeforeleavehooks');if(ia){da.stopLookingBusy();ca._warnBeforeLeaving(ia,ha);}else ha();},_handleTransition:function(ea){window.onbeforeleavehooks=undefined;da.lookBusy();if(!ea.isSameOrigin())return false;var fa=window.AsyncRequest&&window.AsyncRequest.getLastID();g.inform("pre_page_transition",{from:ca.getMostRecentURI(),to:ea});for(var ga=ca._transition_handlers.length-1;ga>=0;--ga){var ha=ca._transition_handlers[ga];if(!ha)continue;for(var ia=ha.length-1;ia>=0;--ia)if(ha[ia](ea)===true){var ja={sender:this,uri:ea,id:fa};try{g.inform("page_transition",ja);}catch(ka){}return true;}else ha.splice(ia,1);}return false;},unifyURI:function(){ca._current_uri=ca._most_recent_uri=ca._next_uri;},transitionComplete:function(ea){ca._executeCompletionCallback();da.stopLookingBusy();ca.unifyURI();if(!ea)ca.restoreScrollPosition();try{if(document.activeElement&&document.activeElement.nodeName==='A')document.activeElement.blur();}catch(fa){}},_executeCompletionCallback:function(){if(ca._completionCallback)ca._completionCallback();ca._completionCallback=null;},setCompletionCallback:function(ea){ca._completionCallback=ea;},rewriteCurrentURI:function(ea,fa){ca.registerHandler(function(){if(ea==ca.getMostRecentURI().getUnqualifiedURI().toString()){ca.transitionComplete();return true;}});ca.go(fa,true);},_warnBeforeLeaving:function(ea,fa){new h().setTitle("Haluatko varmasti poistua t\u00e4lt\u00e4 sivulta?").setBody(q.htmlize(ea)).setButtons([{name:'leave_page',label:"Poistu t\u00e4lt\u00e4 sivulta",handler:fa},{name:'continue_editing',label:"Pysy t\u00e4ll\u00e4 sivulla",className:'inputaux'}]).setModal(true).show();},restoreScrollPosition:function(){ca._scroll_locked=false;var ea=ca._current_uri,fa=ca._scroll_positions[ea];if(fa){j.scrollTo(fa,false);return;}function ga(ja){if(!ja)return null;var ka="a[name='"+q.escapeJSQuotes(ja)+"']";return i.scry(document.body,ka)[0]||x(ja);}var ha=ga(r(ea).getFragment());if(ha){var ia=t.getElementPosition(ha);ia.x=0;j.scrollTo(ia);}}},da=window._BusyUIManager||{_looking_busy:false,_original_cursors:[],lookBusy:function(ea){if(ea)da._giveProgressCursor(ea);if(da._looking_busy)return;da._looking_busy=true;da._giveProgressCursor(document.documentElement);},stopLookingBusy:function(){if(!da._looking_busy)return;da._looking_busy=false;while(da._original_cursors.length){var ea=da._original_cursors.pop(),fa=ea[0],ga=ea[1];if(fa.style)fa.style.cursor=ga||'';}},_giveProgressCursor:function(ea){if(!s.safari()){da._original_cursors.push([ea,ea.style.cursor]);ea.style.cursor='progress';}}};e.exports=ca;});
__d("legacy:page-transitions",["goOrReplace","computeRelativeURI","HistoryManager","PageTransitions"],function(a,b,c,d){a.go_or_replace=b('goOrReplace');a.computeRelativeURI=b('computeRelativeURI');a.HistoryManager=a.HistoryManager||b('HistoryManager');a.PageTransitions=a.PageTransitions||b('PageTransitions');},3);
__d("legacy:JSLogger",["JSLogger"],function(a,b,c,d){a.JSLogger=b('JSLogger');},3);
__d("AsyncLayout",["AjaxPipeRequest","Arbiter","AsyncResponse","AsyncRequest","CSS","DOM","HTML","NavigationMessage","PageTransitions","URI","$","copyProperties","ge","goURI"],function(a,b,c,d,e,f){var g=b('AjaxPipeRequest'),h=b('Arbiter'),i=b('AsyncResponse'),j=b('AsyncRequest'),k=b('CSS'),l=b('DOM'),m=b('HTML'),n=b('NavigationMessage'),o=b('PageTransitions'),p=b('URI'),q=b('$'),r=b('copyProperties'),s=b('ge'),t=b('goURI');function u(v){this.canvasID=v;if(s('rightCol'))this.auxiliaryID='rightCol';if(s('headerArea'))this.headerID='headerArea';if(s('toolbarContainer'))this.toolbarID='toolbarContainer';this.waitingForAux=false;o.registerHandler(this.catchPageTransition.bind(this));this.subscription=h.subscribe(n.NAVIGATION_BEGIN,this.onNavigate.bind(this));}r(u.prototype,{catchPageTransition:function(v){this.subscription.unsubscribe();return false;},getCanvasID:function(v){return v.sidecol?'contentCol':'contentArea';},onNavigate:function(v,w){var x=w.useAjaxPipe;w=w.params;if(w.endpoint){if(this.request){this.request.setFinallyHandler(bagofholding);this.request.abort();}if(this.sideRequest)this.sideRequest.abort();if(x){this.request=new g().setURI(w.endpoint).setData(w).setCanvasId(this.getCanvasID(w)).setFinallyHandler(this.finallyHandler.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFirstResponseCallback(this.firstResponseCallback.bind(this)).send();}else{w.handled=true;this.waitingForAux=w.sidecol;var y=!!w.iframe,z=new j().setOption('useIframeTransport',y).setURI(new p(w.endpoint)).setReadOnly(true).setMethod('GET').setData(w).setHandler(this.onResponse.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFinallyHandler(this.finallyHandler.bind(this));this.request=z;z.send();}}},onSideResponse:function(v){var w=v.getPayload();if(w&&this.auxiliaryID)this.receivedAux(w);},receivedAux:function(v){!this.waitingForAux;this.waitingForAux=false;l.setContent(q(this.auxiliaryID),m(v));},onResponse:function(v){var w=v.getPayload();if(w.redirect){t(w.redirect);}else{var x=w.html||w;l.setContent(q(this.canvasID),m(x));if(w.side_html&&this.auxiliaryID)this.receivedAux(w.side_html);if(this.headerID&&!w.keep_header){var y=q(this.headerID);l.setContent(y,m(w.header_html||''));k.conditionShow(y,w.header_html);}if(w.toolbar_html&&this.toolbarID)l.setContent(q(this.toolbarID),m(w.toolbar_html));if(w.js)(new Function(w.js))();k.conditionClass('contentCol','hasRightCol',this.auxiliaryID&&!w.noRightSide);var z=s('rightCol');if(z&&w.noRightSide)l.empty(z);}var aa=v.getRequest().getData();h.inform(n.NAVIGATION_COMPLETED,aa.key);},errorHandler:function(v){i.verboseErrorHandler(v);h.inform(n.NAVIGATION_FAILED);this.request=null;},firstResponseCallback:function(v){window.scrollTo(0,0);h.inform(n.NAVIGATION_FIRST_RESPONSE);},finallyHandler:function(v){this.request=null;o.transitionComplete(true);h.inform(n.NAVIGATION_COMPLETED);}});e.exports=u;});
__d("ContextualLayer",["array-extensions","event-extensions","Arbiter","ARIA","Class","ContextualThing","CSS","DataStore","DOM","Layer","LayerHideOnTransition","Locale","Parent","Style","Vector","copyProperties","getOverlayZIndex"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Arbiter'),h=b('ARIA'),i=b('Class'),j=b('ContextualThing'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('Layer'),o=b('LayerHideOnTransition'),p=b('Locale'),q=b('Parent'),r=b('Style'),s=b('Vector'),t=m.$N,u=b('copyProperties'),v=b('getOverlayZIndex');function w(aa){return aa.getPosition()==='left'||(aa.isVertical()&&aa.getAlignment()==='right');}function x(aa,ba){this.parent.construct(this,aa,ba);}var y=[];g.subscribe('reflow',function(){y.forEach(function(aa){if(aa.updatePosition()===false)aa.hide();});});i.extend(x,n);u(x.prototype,{_contentWrapper:null,_content:null,_context:null,_parentLayer:null,_parentSubscription:null,_orientation:null,_orientationClass:null,_configure:function(aa,ba){this.parent._configure(aa,ba);aa.context&&this.setContext(aa.context);aa.position&&this.setPosition(aa.position);aa.alignment&&this.setAlignment(aa.alignment);aa.offsetX&&this.setOffsetX(aa.offsetX);aa.offsetY&&this.setOffsetY(aa.offsetY);this._content=ba;},_getDefaultBehaviors:function(){return this.parent._getDefaultBehaviors().concat([o]);},_buildWrapper:function(aa,ba){this._contentWrapper=t('div',{className:'uiContextualLayer'},ba);return t('div',{className:'uiContextualLayerPositioner'},this._contentWrapper);},getInsertParent:function(){var aa=this._insertParent;if(!aa&&this._context)aa=q.byClass(this._context,'uiContextualLayerParent');return aa||this.parent.getInsertParent();},setContent:function(aa){this._content=aa;m.setContent(this._contentWrapper,this._content);this._shown&&this.updatePosition();return this;},setContext:function(aa){this._context=aa;this._contextScrollParent=null;if(this._shown){j.register(this.getRoot(),this._context);this.updatePosition();}this._setParentSubscription();h.setPopup(this.getCausalElement(),this.getRoot());return this;},getCausalElement:function(){return this.parent.getCausalElement()||this._context;},_setParentSubscription:function(){var aa=this._context,ba=null;while(aa!==null){ba=l.get(aa,'layer');if(ba)break;aa=aa.parentNode;}if(ba===this._parentLayer)return;if(this._parentLayer&&this._parentSubscription){this._parentLayer.unsubscribe(this._parentSubscription);this._parentSubscription=null;}if(ba)this._parentSubscription=ba.subscribe('hide',this.hide.bind(this));this._parentLayer=ba;},setPosition:function(aa){this._getOrientation().setDefaultPosition(aa);this._shown&&this.updatePosition();return this;},setAlignment:function(aa){this._getOrientation().setDefaultAlignment(aa);this._shown&&this.updatePosition();return this;},setOffsetX:function(aa){this._getOrientation().setDefaultOffsetX(aa);this._shown&&this.updatePosition();return this;},setOffsetY:function(aa){this._getOrientation().setDefaultOffsetY(aa);this._shown&&this.updatePosition();return this;},_getOrientation:function(){if(!this._orientation)this._orientation=new z();return this._orientation;},getContent:function(){return this._content;},getContext:function(){return this._context;},getContextScrollParent:function(){if(!this._contextScrollParent)this._contextScrollParent=r.getScrollParent(this._context);return this._contextScrollParent;},setInsertParent:function(aa){this._insertScrollParent=null;return this.parent.setInsertParent(aa);},getInsertScrollParent:function(){if(!this._insertScrollParent)this._insertScrollParent=r.getScrollParent(this.getInsertParent());return this._insertScrollParent;},show:function(){this.parent.show();if(this._shown){j.register(this.getRoot(),this._context);y.push(this);this._resizeListener=this._resizeListener||Event.listen(window,'resize',this.updatePosition.bind(this));}return this;},hide:function(){j.remove(this.getRoot());y.remove(this);this._resizeListener&&this._resizeListener.remove();this._resizeListener=null;return this.parent.hide();},updatePosition:function(){if(!this._context||!this._context.offsetParent)return false;var aa=this._getOrientation();this.inform('adjust',aa.reset());if(!aa.isValid())return false;this._updateWrapperPosition(aa);this._updateWrapperClass(aa);var ba=r.isFixed(this._context)&&!r.isFixed(this.getInsertParent()),ca=this.getRoot();k.conditionClass(ca,'uiContextualLayerPositionerFixed',ba);var da,ea,fa;if(ba){da='viewport';ea=new s(0,0);fa=document.body.offsetWidth;}else{da='document';var ga=ca.offsetParent;if(!ga)return false;ea=s.getElementPosition(ga,da);fa=ga.offsetWidth;if(ga!==m.getDocumentBodyElement())ea=ea.sub(new s(ga.scrollLeft,ga.scrollTop));}var ha=s.getElementPosition(this._context,da),ia=ha.x-ea.x,ja=ha.y-ea.y,ka=p.isRTL();if(aa.getPosition()==='below')ja+=this._context.offsetHeight;if((aa.getPosition()==='right'||(aa.isVertical()&&aa.getAlignment()==='right'))!=ka)ia+=this._context.offsetWidth;var la=aa.getOffsetX();if(aa.isVertical()&&aa.getAlignment()==='center')la+=(this._context.offsetWidth-this._content.offsetWidth)/2;if(ka)la*=-1;var ma='left',na=ia+la;if(w(aa)!==ka){ma='right';na=fa-na;}r.set(ca,ma,na+'px');r.set(ca,ma==='left'?'right':'left','');var oa=this.getInsertScrollParent(),pa;if(oa!==window){pa=oa.clientWidth;}else pa=document.documentElement.clientWidth;var qa=s.getElementPosition(ca).x;if(ma==='left'){r.set(ca,'width',(pa-qa)+'px');}else r.set(ca,'width',qa+ca.offsetWidth+'px');r.set(ca,'top',(ja+aa.getOffsetY())+'px');var ra=v(this._context,this.getInsertParent());r.set(ca,'z-index',ra>200?ra:'');return true;},_updateWrapperPosition:function(aa){var ba=aa.getPosition()==='above';r.set(this._contentWrapper,'bottom',ba?'0':null);var ca=p.isRTL()?'left':'right',da=w(aa);r.set(this._contentWrapper,ca,da?'0':null);},_updateWrapperClass:function(aa){var ba=aa.getClassName();if(ba===this._orientationClass)return;if(this._orientationClass)k.removeClass(this._contentWrapper,this._orientationClass);this._orientationClass=ba;k.addClass(this._contentWrapper,ba);},destroy:function(){this.parent.destroy();this._contentWrapper=null;this._content=null;return this;}});function z(){this._default={_position:'above',_alignment:'left',_offsetX:0,_offsetY:0,_valid:true};this.reset();}z.OPPOSITE={above:'below',below:'above',left:'right',right:'left'};u(z.prototype,{setPosition:function(aa){this._position=aa;return this;},setAlignment:function(aa){this._alignment=aa;return this;},getOppositePosition:function(){return z.OPPOSITE[this.getPosition()];},invalidate:function(){this._valid=false;return this;},getPosition:function(){return this._position||'above';},getAlignment:function(){return this._alignment||'left';},getOffsetX:function(){var aa=this._offsetX||0;if(!this.isVertical()){if(this._default._position!==this._position)aa*=-1;}else if(this._default._alignment!==this._alignment)aa*=-1;return aa;},getOffsetY:function(){var aa=this._offsetY||0;if(this.isVertical()&&this._default._position!==this._position)aa*=-1;return aa;},getClassName:function(){if(this.isVertical())return this.getPosition()+this.getAlignment();return this.getPosition();},isValid:function(){return this._valid;},isVertical:function(){return this.getPosition()==='above'||this.getPosition()==='below';},reset:function(aa,ba){u(this,this._default);return this;},setDefaultPosition:function(aa){this._default._position=aa;return this;},setDefaultAlignment:function(aa){this._default._alignment=aa;return this;},setDefaultOffsetX:function(aa){this._default._offsetX=aa;return this;},setDefaultOffsetY:function(aa){this._default._offsetY=aa;return this;}});e.exports=x;});
__d("ContextualLayerAutoFlip",["array-extensions","event-extensions","DOM","Locale","Rect","Vector","copyProperties","ge","getOverlayZIndex"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('DOM'),h=b('Locale'),i=b('Rect'),j=b('Vector'),k=b('copyProperties'),l=b('ge'),m=b('getOverlayZIndex');function n(q){this._layer=q;}var o=function(){var q=l('blueBar'),r=q?q.offsetHeight:0;o=bagof(r);return r;};function p(){return (window.ChatSidebar&&window.ChatSidebar.getVisibleWidth())||0;}k(n.prototype,{enable:function(){this._subscription=this._layer.subscribe('adjust',this._adjustOrientation.bind(this));if(this._layer.isShown())this._layer.updatePosition();},disable:function(){this._layer.unsubscribe(this._subscription);this._subscription=null;if(this._layer.isShown())this._layer.updatePosition();},_adjustOrientation:function(q,r){var s=this._getValidPositions(r);if(!s.length){r.invalidate();return;}var t=this._getViewportRect(),u=j.getElementDimensions(this._layer.getContent()),v=this._getValidAlignments(r);for(var w=0;w<v.length;w++){r.setAlignment(v[w]);for(var x=0;x<s.length;x++){r.setPosition(s[x]);var y=this._getLayerRect(r,u);if(t.contains(y))return;}}r.setPosition(s[0]).setAlignment(v[0]);},_getViewportRect:function(){var q=l('globalContainer'),r=this._layer.getContext(),s=(q&&g.contains(q,r))||m(r)<300,t=i.getViewportBounds();if(s){t.t+=o();if(h.isRTL()){t.l+=p();}else t.r-=p();}return t;},_getLayerRect:function(q,r){var s=this._layer.getContext(),t=j.getElementPosition(s,'viewport'),u=t.y+q.getOffsetY();if(q.getPosition()==='above'){u-=r.y;}else if(q.getPosition()==='below')u+=s.offsetHeight;var v=t.x+q.getOffsetX();if(q.isVertical()){var w=q.getAlignment();if(w==='center'){v+=(s.offsetWidth-r.x)/2;}else if((w==='right')!==h.isRTL())v+=s.offsetWidth-r.x;}else if((q.getPosition()==='right')!==h.isRTL()){v+=s.offsetWidth;}else v-=r.x;return new i(u,v+r.x,u+r.y,v,'viewport');},_getValidPositions:function(q){var r=[q.getPosition(),q.getOppositePosition()],s=this._layer.getContextScrollParent();if(s===window||s===g.getDocumentScrollElement())return r;var t=this._layer.getContext(),u=j.getElementPosition(s,'viewport').y,v=j.getElementPosition(t,'viewport').y;if(q.isVertical()){return r.filter(function(x){if(x==='above'){return v>=u;}else{var y=u+s.offsetHeight,z=v+t.offsetHeight;return z<=y;}});}else{var w=u+s.offsetHeight;if(v>=u&&v+t.offsetHeight<=w){return r;}else return [];}},_getValidAlignments:function(q){var r=['left','center','right'],s=q.getAlignment(),t=r.indexOf(s);if(t>0){r.splice(t,1);r.unshift(s);}return r;}});e.exports=n;});
__d("ContextualLayerHideOnScroll",["event-extensions","Class","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('copyProperties');function i(j){this._layer=j;}h(i.prototype,{_subscriptions:[],enable:function(){this._subscriptions=[this._layer.subscribe('contextchange',this._handleContextChange.bind(this)),this._layer.subscribe('show',this.attach.bind(this)),this._layer.subscribe('hide',this.detach.bind(this))];},disable:function(){while(this._subscriptions.length)this._layer.unsubscribe(this._subscriptions.pop());this.detach();},attach:function(){if(this._listener)return;var j=this._layer.getContextScrollParent();if(j===window)return;this._listener=Event.listen(j,'scroll',this._layer.hide.bind(this._layer));},detach:function(){this._listener&&this._listener.remove();this._listener=null;},_handleContextChange:function(){this.detach();if(this._layer.isShown())this.attach();}});e.exports=i;});
__d("BasicTypeaheadRenderer",["DOM"],function(a,b,c,d,e,f){var g=b('DOM');function h(i,j){var k=[];if(i.icon)k.push(g.create('img',{alt:'',src:i.icon}));if(i.text)k.push(g.create('span',{className:'text'},[i.text]));if(i.subtext)k.push(g.create('span',{className:'subtext'},[i.subtext]));var l=g.create('li',{className:i.type||''},k);l.setAttribute('role','option');if(i.text)l.setAttribute('aria-label',i.text);return l;}h.className='basic';e.exports=h;});
__d("TypeaheadView",["event-extensions","ArbiterMixin","ARIA","BasicTypeaheadRenderer","Class","CSS","DOM","Parent","$","copyProperties","ge","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('ARIA'),i=b('BasicTypeaheadRenderer'),j=b('Class'),k=b('CSS'),l=b('DOM'),m=b('Parent'),n=b('$'),o=b('copyProperties'),p=b('ge'),q=b('tx');function r(s,t){this.element=this.content=n(s);o(this,t);}o(r.prototype,g,{events:['highlight','render','reset','select'],renderer:i,autoSelect:false,accessibleResultsText:"Automaattinen t\u00e4ydennys tulokset ovat saatavilla. K\u00e4yt\u00e4 yl\u00f6s ja alas nuolin\u00e4pp\u00e4imi\u00e4 navigoidaksesi tuloksiin.",accessibleEmptyText:"Automaattisia tuloksia ei saatavilla",init:function(){this.init=bagofholding;this.initializeEvents();this.reset();},initializeEvents:function(){Event.listen(this.element,{mouseup:this.mouseup.bind(this),mouseover:this.mouseover.bind(this)});},setTypeahead:function(s){this.typeahead=s;},getElement:function(){return this.element;},mouseup:function(event){if(event.button!=2){this.select(true);event.kill();}},mouseover:function(event){if(this.visible)this.highlight(this.getIndex(event));},reset:function(s){if(!s)this.disableAutoSelect=false;this.justRendered=false;this.justShown=false;this.index=-1;this.items=[];this.results=[];this.value='';this.content.innerHTML='';this.inform('reset');return this;},getIndex:function(event){return this.items.indexOf(m.byTag(event.getTarget(),'li'));},getSelection:function(){var s=this.results[this.index]||null;return this.visible?s:null;},isEmpty:function(){return !this.results.length;},isVisible:function(){return this.visible;},show:function(){k.show(this.element);if(this.results&&this.results.length)if(this.autoSelect){h.notify(q._("{name} on automaattisesti valittu. K\u00e4yt\u00e4 yl\u00f6s ja alas nuolin\u00e4pp\u00e4imi\u00e4 navigoidaksesi lis\u00e4\u00e4 tuloksia.",{name:this.getItemText(this.selected)}));}else h.notify(this.accessibleResultsText);this.typeahead&&this.element.setAttribute('aria-expanded','true');this.visible=true;return this;},hide:function(){k.hide(this.element);h.notify('');this.typeahead&&this.typeahead.setAttribute('aria-expanded','false');this.visible=false;return this;},render:function(s,t,u){this.value=s;if(!t.length){if(this.results.length&&s)h.notify(this.accessibleEmptyText);this.reset(true);return;}this.justRendered=true;if(!this.results.length){this.justShown=true;if(!this.autoSelect&&this.isVisible()&&t.length)h.notify(this.accessibleResultsText);}var v={results:t,value:s};this.inform('beforeRender',v);t=v.results;var w=this.getDefaultIndex(t);if(this.index>0&&this.index!==this.getDefaultIndex(this.results)){var x=this.results[this.index];for(var y=0,z=t.length;y<z;++y)if(x.uid==t[y].uid){w=y;break;}}this.results=t;l.setContent(this.content,this.buildResults(t));this.items=this.getItems();this.highlight(w,false);this.inform('render',t);},getItems:function(){return l.scry(this.content,'li');},buildResults:function(s){var t,u=null;if(typeof this.renderer=='function'){t=this.renderer;u=this.renderer.className||'';}else{t=a.TypeaheadRenderers[this.renderer];u=this.renderer;}t=t.bind(this);var v=s.map(function(x,y){return x.node||t(x,y);}),w=l.create('ul',{className:u,id:'typeahead_list_'+(this.typeahead?l.getID(this.typeahead):l.getID(this.element))},v);w.setAttribute('role','listbox');return w;},getDefaultIndex:function(s){var t=(this.autoSelect&&!this.disableAutoSelect);return this.index<0&&!t?-1:0;},next:function(){this.highlight(this.index+1);},prev:function(){this.highlight(this.index-1);},getItemText:function(s){var t='';if(s){t=s.getAttribute('aria-label');if(!t){t=l.getText(s);s.setAttribute('aria-label',t);}}return t;},setIsViewingSelectedItems:function(s){this.viewingSelected=s;return this;},getIsViewingSelectedItems:function(){return this.viewingSelected;},highlight:function(s,t){var u=true;this.selected&&k.removeClass(this.selected,'selected');if(s>this.items.length-1){s=-1;}else if(s<-1)s=this.items.length-1;if(s>=0&&s<this.items.length){if(this.selected&&this.getItemText(this.items[s])===this.getItemText(this.selected))u=false;this.selected=this.items[s];k.addClass(this.selected,'selected');}this.index=s;this.disableAutoSelect=(s==-1);var v=(s!==-1),w=this.getItemText(this.selected);if(s!==-1&&this.isVisible()&&w&&this.autoSelect)if(this.justShown){h.notify(q._("{name} on automaattisesti valittu. K\u00e4yt\u00e4 yl\u00f6s ja alas nuolin\u00e4pp\u00e4imi\u00e4 navigoidaksesi lis\u00e4\u00e4 tuloksia.",{name:w}));this.justRendered=false;this.justShown=false;v=false;}else if(u&&this.justRendered){h.notify(q._("{name} on automaattisesti valittu.",{name:w}));this.justRendered=false;v=false;}if(u&&v)h.announce(w);if(t!==false)this.inform('highlight',{index:s,selected:this.results[s],element:this.selected});},select:function(s){var t=this.index,u=this.results[t];if(u){this.inform('select',{index:t,clicked:!!s,selected:u});this.inform('afterSelect');}}});e.exports=r;});
__d("BucketedTypeaheadView",["Class","DOM","TypeaheadView","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('DOM'),i=b('TypeaheadView'),j=b('copyProperties');function k(l,m){this.parent.construct(this,l,m);}g.extend(k,i);j(k.prototype,{render:function(l,m,n){m=this.buildBuckets(l,m);return this.parent.render(l,m,n);},highlight:function(l,m){if(l==-1&&this.index!==0)l=this.index;if(l>=0&&l<this.items.length&&this.results[l].type=='header')l=l+1;this.parent.highlight(l,m);},buildBuckets:function(l,m){if(!this.typeObjects)return m;var n=[],o={};for(var p=0;p<m.length;++p){var q=m[p],r=q.render_type||q.type;if(!o.hasOwnProperty(r)){o[r]=n.length;n.push([this.buildBucketHeader(r)]);}q.classNames=r;q.groupIndex=o[r];q.indexInGroup=n[q.groupIndex].length-1;n[q.groupIndex].push(q);}var s=[];for(var t=0;t<n.length;++t)s=s.concat(n[t]);return s;},buildBucketHeader:function(l){var m=this.typeObjects[l];if(m.markup){m.text=m.markup;delete m.markup;}return this.typeObjects[l];},buildResults:function(l){var m=this.parent.buildResults(l);if(this.typeObjects){return h.$N('div',{className:'bucketed'},[m]);}else return m;},select:function(l){var m=this.results[this.index];if(m&&m.type!='header')this.parent.select(l);},getDefaultIndex:function(l){var m=(this.autoSelect&&!this.disableAutoSelect),n=l.length===0?-1:(l[0].type=='header'?1:0);return this.index<0&&!m?-1:n;},prev:function(){var l=this.results[this.index-1];if(l&&l.type=='header')this.index--;return this.parent.prev();},next:function(){var l=this.results[this.index+1];if(l&&l.type=='header')this.index++;return this.parent.next();}});e.exports=k;});
__d("ContextualTypeaheadView",["event-extensions","Class","ContextualLayer","ContextualLayerAutoFlip","ContextualLayerHideOnScroll","DOM","Style","BucketedTypeaheadView","Vector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('ContextualLayer'),i=b('ContextualLayerAutoFlip'),j=b('ContextualLayerHideOnScroll'),k=b('DOM'),l=b('Style'),m=b('BucketedTypeaheadView'),n=b('Vector'),o=b('copyProperties');function p(q,r){this.parent.construct(this,q,r);}g.extend(p,m);o(p.prototype,{init:function(){this.initializeLayer();this.parent.init();},initializeLayer:function(){this.context=this.getContext();this.wrapper=k.$N('div');k.appendContent(this.wrapper,this.element);this.layer=new h({context:this.context,position:'below',causalElement:this.causalElement},this.wrapper);this.layer.enableBehavior(j);if(l.isFixed(this.context))this.layer.enableBehavior(i);this.subscribe('render',this.renderLayer.bind(this));},show:function(){this.layer.show();n.getElementDimensions(this.context).setElementWidth(this.wrapper);return this.parent.show();},hide:function(){this.layer.hide();return this.parent.hide();},renderLayer:function(){if(!this.isVisible())return;if(this.layer.isShown()){this.layer.updatePosition();}else this.layer.show();},getContext:function(){return this.element.parentNode;}});e.exports=p;});
__d("TypeaheadUtil",["function-extensions"],function(a,b,c,d,e,f){b('function-extensions');var g=/[ ]+/g,h=/[^ ]+/g,i=/[.,+*?$|#{}()\^\-\[\]\\\/!@%'"~=<>_:;\u2010\u2011\u2012\u2013\u2014\u2015\u30fb\uff1a]/g,j={},k={a:"\u0430 \u00e0 \u00e1 \u00e2 \u00e3 \u00e4 \u00e5",b:"\u0431",c:"\u0446 \u00e7 \u010d",d:"\u0434 \u00f0 \u010f \u0111",e:"\u044d \u0435 \u00e8 \u00e9 \u00ea \u00eb \u011b",f:"\u0444",g:"\u0433 \u011f",h:"\u0445 \u0127",i:"\u0438 \u00ec \u00ed \u00ee \u00ef \u0131",j:"\u0439",k:"\u043a \u0138",l:"\u043b \u013e \u013a \u0140 \u0142",m:"\u043c",n:"\u043d \u00f1 \u0148 \u0149 \u014b",o:"\u043e \u00f8 \u00f6 \u00f5 \u00f4 \u00f3 \u00f2",p:"\u043f",r:"\u0440 \u0159 \u0155",s:"\u0441 \u015f \u0161 \u017f",t:"\u0442 \u0165 \u0167 \u00fe",u:"\u0443 \u044e \u00fc \u00fb \u00fa \u00f9 \u016f",v:"\u0432",y:"\u044b \u00ff \u00fd",z:"\u0437 \u017e",ae:"\u00e6",oe:"\u0153",ts:"\u0446",ch:"\u0447",ij:"\u0133",sh:"\u0448",ss:"\u00df",ya:"\u044f"};for(var l in k){var m=k[l].split(' ');for(var n=0;n<m.length;n++)j[m[n]]=l;}var o={};function p(v){return v?v.replace(i,' '):'';}function q(v){v=(''+v).toLowerCase();var w='',x='';for(var y=v.length;y--;){x=v.charAt(y);w=(j[x]||x)+w;}return w.replace(g,' ');}function r(v){var w=[],x=h.exec(v);while(x){x=x[0];w.push(x);x=h.exec(v);}return w;}function s(v,w){v=''+v;if(!o.hasOwnProperty(v)){var x=q(v),y=p(x);o[v]={value:v,flatValue:x,tokens:r(y),isPrefixQuery:y&&y[y.length-1]!=' '};}if(w&&typeof o[v].sortedTokens=='undefined'){o[v].sortedTokens=o[v].tokens.slice();o[v].sortedTokens.sort(function(z,aa){return aa.length-z.length;});}return o[v];}function t(v,w,x){var y=s(w,v=='prefix'),z=v=='prefix'?y.sortedTokens:y.tokens,aa=s(x).tokens,ba={},ca=y.isPrefixQuery&&v=='query'?z.length-1:null,da=function(ea,fa){for(var ga=0;ga<aa.length;++ga){var ha=aa[ga];if(!ba[ga]&&(ha==ea||((v=='query'&&fa===ca||v=='prefix')&&ha.indexOf(ea)===0)))return (ba[ga]=true);}return false;};return z.length&&z.every(da);}var u={parse:s,isExactMatch:t.curry('exact'),isQueryMatch:t.curry('query'),isPrefixMatch:t.curry('prefix')};e.exports=u;});
__d("DataSource",["array-extensions","ArbiterMixin","AsyncRequest","Class","TypeaheadUtil","copyProperties","createArrayFrom","createObjectFrom"],function(a,b,c,d,e,f){b('array-extensions');var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('Class'),j=b('TypeaheadUtil'),k=b('copyProperties'),l=b('createArrayFrom'),m=b('createObjectFrom');function n(o){this._maxResults=o.maxResults||10;this.token=o.token;this.queryData=o.queryData||{};this.queryEndpoint=o.queryEndpoint||'';this.bootstrapData=o.bootstrapData||{};this.bootstrapEndpoint=o.bootstrapEndpoint||'';this._exclusions=o.exclusions||[];this._indexedFields=o.indexedFields||['text','tokens'];this._alwaysPrefixMatch=o.alwaysPrefixMatch||false;this._deduplicationKey=o.deduplicationKey||null;this._minExactMatchLength=4;}k(n.prototype,g,{events:['bootstrap','query','respond'],init:function(){this.init=bagofholding;this._fields=m(this._indexedFields);this._activeQueries=0;this.dirty();},dirty:function(){this.value='';this._bootstrapped=false;this._bootstrapping=false;this._data={};this.localCache={};this.queryCache={};this.inform('dirty',{});return this;},bootstrap:function(){if(this._bootstrapped)return;this.bootstrapWithoutToken();this._bootstrapped=true;this._bootstrapping=true;this.inform('bootstrap',{bootstrapping:true});},bootstrapWithoutToken:function(){this.fetch(this.bootstrapEndpoint,this.bootstrapData,{bootstrap:true,token:this.token});},bootstrapWithToken:function(){var o=k({},this.bootstrapData);o.token=this.token;this.fetch(this.bootstrapEndpoint,o,{bootstrap:true,replaceCache:true});},query:function(o,p,q){this.inform('beforeQuery',{value:o});var r=this.buildUids(o,[],q),s=this.respond(o,r);this.value=o;this.inform('query',{value:o,results:s});var t=j.parse(o).flatValue;if(p||!t||!this.queryEndpoint||this.getQueryCache().hasOwnProperty(t)||!this.shouldFetchMoreResults(s))return false;this.inform('queryEndpoint',{value:o});this.fetch(this.queryEndpoint,this.getQueryData(o,r),{value:o,exclusions:q});return true;},shouldFetchMoreResults:function(o){return o.length<this._maxResults;},getQueryData:function(o,p){var q=k({value:o},this.queryData||{});p=p||[];if(p.length)q.existing_ids=p.join(',');if(this._bootstrapping)q.bsp=true;return q;},setQueryData:function(o,p){if(p)this.queryData={};k(this.queryData,o);return this;},setBootstrapData:function(o,p){if(p)this.bootstrapData={};k(this.bootstrapData,o);return this;},getExclusions:function(){return l(this._exclusions);},setExclusions:function(o){this._exclusions=o||[];},setFilter:function(o){this.filter=o;},respond:function(o,p,q){var r=this.buildData(p);this.inform('respond',{value:o,results:r,isAsync:!!q});return r;},asyncErrorHandler:bagofholding,fetch:function(o,p,q){if(!o)return;var r=new h().setURI(o).setData(p).setMethod('GET').setReadOnly(true).setHandler(function(s){this.fetchHandler(s,q||{});}.bind(this));if(o===this.queryEndpoint)r.setFinallyHandler(function(){this._activeQueries--;if(!this._activeQueries)this.inform('activity',{activity:false});}.bind(this));r.setErrorHandler(this.asyncErrorHandler);this.inform('beforeFetch',{request:r,fetch_context:q});r.send();if(o===this.queryEndpoint){if(!this._activeQueries)this.inform('activity',{activity:true});this._activeQueries++;}},fetchHandler:function(o,p){var q=p.value,r=p.exclusions;if(!q&&p.replaceCache)this.localCache={};this.addEntries(o.getPayload().entries,q);this.inform('fetchComplete',{response:o,value:q,fetch_context:p});var s=(!q&&this.value)?this.value:q;this.respond(s,this.buildUids(s,[],r),true);if(!q){if(this._bootstrapping){this._bootstrapping=false;this.inform('bootstrap',{bootstrapping:false});}if(p.token&&o.getPayload().token!==p.token)this.bootstrapWithToken();}},addEntries:function(o,p){var q=this.processEntries(l(o||[]),p),r=this.buildUids(p,q);if(p){var s=this.getQueryCache();s[j.parse(p).flatValue]=r;}else this.fillCache(r);},processEntries:function(o,p){return o.map(function(q,r){var s=(q.uid=q.uid+''),t=this.getEntry(s);if(!t){t=q;t.query=p;this.setEntry(s,t);}else k(t,q);t.index===undefined&&(t.index=r);return s;},this);},getAllEntries:function(){return this._data||{};},getEntry:function(o){return this._data[o]||null;},setEntry:function(o,p){this._data[o]=p;},fillCache:function(o){var p=this.localCache;o.forEach(function(q){var r=this.getEntry(q);if(!r)return;r.bootstrapped=true;var s=j.parse(this.getTextToIndex(r)).tokens;for(var t=0,u=s.length;t<u;++t){var v=s[t];if(!p.hasOwnProperty(v))p[v]={};p[v][q]=true;}},this);},getTextToIndex:function(o){if(o.textToIndex)return o.textToIndex;var p=[];for(var q in this._fields){var r=o[q];if(r)p.push(r.join?r.join(' '):r);}return (o.textToIndex=p.join(' '));},mergeUids:function(o,p,q,r){var s=function(t,u){var v=this.getEntry(t),w=this.getEntry(u);if(v.extended_match!==w.extended_match)return v.extended_match?1:-1;if(v.index!==w.index)return v.index-w.index;if(v.text.length!==w.text.length)return v.text.length-w.text.length;return v.uid<w.uid;}.bind(this);this._checkExtendedMatch(r,o);return this.deduplicateByKey(o.sort(s).concat(p,q));},_checkExtendedMatch:function(o,p){var q=this._alwaysPrefixMatch?j.isPrefixMatch:j.isQueryMatch;for(var r=0;r<p.length;++r){var s=this.getEntry(p[r]);s.extended_match=s.tokens?!q(o,s.text):false;}},buildUids:function(o,p,q){if(!p)p=[];if(!o)return p;if(!q)q=[];var r=this.buildCacheResults(o,this.localCache),s=this.buildQueryResults(o),t=this.mergeUids(r,s,p,o),u=m(q.concat(this._exclusions)),v=t.filter(function(w){if(u.hasOwnProperty(w)||!this.getEntry(w))return false;if(this.filter&&!this.filter(this.getEntry(w)))return false;return (u[w]=true);},this);return this.uidsIncludingExact(o,v,u);},uidsIncludingExact:function(o,p,q){var r=p.length;if(o.length<this._minExactMatchLength||r<=this._maxResults)return p;for(var s=0;s<r;++s){var t=this.getEntry(p[s]);t.text_lower||(t.text_lower=t.text.toLowerCase());if(t.text_lower===j.parse(o).flatValue){if(s>=this._maxResults){var u=p.splice(s,1);p.splice(this._maxResults-1,0,u);}break;}}return p;},buildData:function(o){var p=[],q=Math.min(o.length,this._maxResults);for(var r=0;r<q;++r)p.push(this.getEntry(o[r]));return p;},findQueryCache:function(o){var p=0,q=null,r=this.getQueryCache();for(var s in r)if(o.indexOf(s)===0&&s.length>p){p=s.length;q=s;}return r[q]||[];},buildQueryResults:function(o){var p=j.parse(o).flatValue,q=this.findQueryCache(p);if(this.getQueryCache().hasOwnProperty(p))return q;return this.filterQueryResults(o,q);},filterQueryResults:function(o,p){var q=this._alwaysPrefixMatch?j.isPrefixMatch:j.isQueryMatch;return p.filter(function(r){return q(o,this.getTextToIndex(this.getEntry(r)));},this);},buildCacheResults:function(o,p){var q=j.parse(o,this._alwaysPrefixMatch),r=this._alwaysPrefixMatch?q.sortedTokens:q.tokens,s=r.length,t=q.isPrefixQuery?s-1:null,u={},v={},w={},x=[],y=false,z={},aa=0;for(var ba=0;ba<s;++ba){var ca=r[ba];if(!z.hasOwnProperty(ca)){aa++;z[ca]=true;}else continue;for(var da in p)if((!u.hasOwnProperty(da)&&da===ca)||((this._alwaysPrefixMatch||t===ba)&&da.indexOf(ca)===0)){if(da===ca){if(v.hasOwnProperty(da))y=true;u[da]=true;}else{if(u.hasOwnProperty(da)||v.hasOwnProperty(da))y=true;v[da]=true;}for(var ea in p[da])if(ba===0||(w.hasOwnProperty(ea)&&w[ea]==aa-1))w[ea]=aa;}}for(var fa in w)if(w[fa]==aa)x.push(fa);if(y||aa<s)x=this.filterQueryResults(o,x);return x;},deduplicateByKey:function(o){if(!this._deduplicationKey)return o;var p=m(o.map(this._getDeduplicationKey.bind(this)),o);return o.filter(function(q){return p[this._getDeduplicationKey(q)]==q;}.bind(this));},_getDeduplicationKey:function(o){var p=this.getEntry(o);return p[this._deduplicationKey]||'__'+o+'__';},getQueryCache:function(){return this.queryCache;},setMaxResults:function(o){this._maxResults=o;this.value&&this.respond(this.value,this.buildUids(this.value));},updateToken:function(o){this.token=o;this.dirty();return this;}});e.exports=n;});
__d("ImageUtils",["UserAgent"],function(a,b,c,d,e,f){var g=b('UserAgent'),h={hasLoaded:function(i){if(i.naturalWidth!==undefined){return i.complete&&i.width!==0;}else if(i.height==20&&i.width==20&&i.complete){return false;}else if(i.complete===undefined&&g.safari()<500){var j=new Image();j.src=i.src;return j.complete;}return i.complete;}};e.exports=h;});
__d("Menu",["event-extensions","Arbiter","CSS","DataStore","DOM","HTML","Keys","Parent","Run","Style","UserAgent","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('CSS'),i=b('DataStore'),j=b('DOM'),k=b('HTML'),l=b('Keys'),m=b('Parent'),n=b('Run'),o=b('Style'),p=b('UserAgent'),q=b('copyProperties'),r=null,s='menu:mouseover',t=null;function u(ca){if(h.hasClass(ca,'uiMenuContainer'))return ca;return m.byClass(ca,'uiMenu');}function v(ca){return m.byClass(ca,'uiMenuItem');}function w(ca){if(document.activeElement){var da=v(document.activeElement);return ca.indexOf(da);}return -1;}function x(ca){return j.find(ca,'a.itemAnchor');}function y(ca){return h.hasClass(ca,'checked');}function z(ca){return !h.hasClass(ca,'disabled')&&o.get(ca,'display')!=='none';}function aa(event){var ca=document.activeElement;if(!ca||!m.byClass(ca,'uiMenu')||!j.isNodeOfType(ca,['input','textarea'])){var da=v(event.getTarget());da&&r.focusItem(da);}}function ba(ca){p.firefox()&&x(ca).blur();r.inform('select',{menu:u(ca),item:ca});}n.onLoad(function(){var ca={};ca.click=function(event){var da=v(event.getTarget());if(da&&z(da)){ba(da);var ea=x(da),fa=ea.href,ga=ea.getAttribute('rel');return (ga&&ga!=='ignore')||(fa&&fa.charAt(fa.length-1)!=='#');}};ca.keydown=function(event){var da=event.getTarget();if(event.getModifiers().any)return;if(!t||j.isNodeOfType(da,['input','textarea']))return;var ea=Event.getKeyCode(event),fa;switch(ea){case l.UP:case l.DOWN:var ga=r.getEnabledItems(t);fa=w(ga);r.focusItem(ga[fa+(ea===l.UP?-1:1)]);return false;case l.SPACE:var ha=v(da);if(ha){ba(ha);event.prevent();}break;default:var ia=String.fromCharCode(ea).toLowerCase(),ja=r.getEnabledItems(t);fa=w(ja);var ka=fa,la=ja.length;while((~fa&&(ka=++ka%la)!==fa)||(!~fa&&++ka<la)){var ma=r.getItemLabel(ja[ka]);if(ma&&ma.charAt(0).toLowerCase()===ia){r.focusItem(ja[ka]);return false;}}}};Event.listen(document.documentElement,ca);});r=e.exports=q(new g(),{focusItem:function(ca){if(ca&&z(ca)){this._removeSelected(u(ca));h.addClass(ca,'selected');x(ca).focus();}},getEnabledItems:function(ca){return r.getItems(ca).filter(z);},getCheckedItems:function(ca){return r.getItems(ca).filter(y);},getItems:function(ca){return j.scry(ca,'li.uiMenuItem');},getItemLabel:function(ca){return ca.getAttribute('data-label',2)||'';},isItemChecked:function(ca){return h.hasClass(ca,'checked');},register:function(ca,da){ca=u(ca);if(!i.get(ca,s))i.set(ca,s,Event.listen(ca,'mouseover',aa));if(da!==false)t=ca;},setItemEnabled:function(ca,da){if(!da&&!j.scry(ca,'span.disabledAnchor')[0])j.appendContent(ca,j.$N('span',{className:j.find(ca,'a').className+' disabledAnchor'},k(x(ca).innerHTML)));h.conditionClass(ca,'disabled',!da);},toggleItem:function(ca){var da=!r.isItemChecked(ca);r.setItemChecked(ca,da);},setItemChecked:function(ca,da){h.conditionClass(ca,'checked',da);x(ca).setAttribute('aria-checked',da);},unregister:function(ca){ca=u(ca);var da=i.remove(ca,s);da&&da.remove();t=null;this._removeSelected(ca);},_removeSelected:function(ca){r.getItems(ca).filter(function(da){return h.hasClass(da,'selected');}).forEach(function(da){h.removeClass(da,'selected');});}});});
__d("MultiBootstrapDataSource",["Class","DataSource"],function(a,b,c,d,e,f){var g=b('Class'),h=b('DataSource');function i(j){this._bootstrapEndpoints=j.bootstrapEndpoints;this.parent.construct(this,j);}g.extend(i,h);i.prototype.bootstrapWithoutToken=function(){for(var j=0;j<this._bootstrapEndpoints.length;j++)this.fetch(this._bootstrapEndpoints[j].endpoint,this._bootstrapEndpoints[j].data||{},{bootstrap:true});};e.exports=i;});
__d("OnVisible",["event-extensions","DOM","Run","Vector","copyProperties","throttle"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOM'),h=b('Run'),i=b('Vector'),j=b('copyProperties'),k=b('throttle');function l(m,n,o,p,q){this.element=m;this.handler=n;this.strict=o;this.buffer=p||300;this.options=q||{};this.lastY=null;this.lastTime=Date.now();this.scrollHandler=null;this.reset();h.onLeave(this.remove.bind(this));}j(l.prototype,{reset:function(){if(this.scrollListener)return;this.removed=false;this.scrollHandler=k(function(m){var n=i.getElementPosition(this.element);if(!n||this.removed){this.remove();return;}this.targetY=n.y;var o=i.getScrollPosition().y;if(this.lastY===null)this.lastY=o;var p=i.getViewportDimensions().y,q=o+p+this.buffer;if(q>this.targetY){var r=!this.strict||(o-this.buffer<(this.targetY+i.getElementDimensions(this.element).y));if(r){this.remove();if(this.options.detect_speed){var s=(o-this.lastY),t=s/(Date.now()-this.lastTime+1);if((t>p/100)||(q>=i.getDocumentDimensions().y&&s>1000))return true;}this.handler(!m);}}if(this.options.detect_speed){this.lastY=o;this.lastTime=Date.now();}return true;},100,this);(function(){this.scrollListener=Event.listen(window,'scroll',this.scrollHandler);this.resizeListener=Event.listen(window,'resize',this.scrollHandler);this.scrollHandler.defer();}).bind(this).defer();},remove:function(){this.removed=true;if(this.scrollListener){this.scrollListener.remove();this.resizeListener.remove();this.scrollListener=this.resizeListener=null;}},setBuffer:function(m){this.buffer=m;this.scrollHandler&&this.scrollHandler.defer();}});e.exports=l;});
__d("PrivacyConst",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h={FRIENDS_MINUS_ACQUAINTANCES:127,FACEBOOK_EMPLOYEES:112,CUSTOM:111,EVERYONE:80,NETWORKS_FRIENDS_OF_FRIENDS:60,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SELF:10,NOBODY:0},i={EVERYONE:80,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SOME_FRIENDS:30,SELF:10,NO_FRIENDS:0},j={ONLY_CORP_NETWORK:200,COLLEGE_NETWORK_FRIENDS_OF_FRIENDS:201,COLLEGE_NETWORK_FRIENDS:202},k={TYPE_COLLEGE:1,TYPE_HS:2,TYPE_CORP:3,TYPE_GEO:4,TYPE_MANAGED:14,TYPE_TEST:50},l=1;g(h,j);var m={BaseValue:h,FriendsValue:i,NetworksAll:l,NetworkTypes:k,SpecialPreset:j};e.exports=m;});
__d("Toggler",["array-extensions","event-extensions","Arbiter","ArbiterMixin","Class","ContextualDialogX","ContextualThing","CSS","DataStore","Dialog","DOM","copyProperties","createArrayFrom","ge","getObjectValues"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('ContextualDialogX'),k=b('ContextualThing'),l=b('CSS'),m=b('DataStore'),n=b('Dialog'),o=b('DOM'),p=b('copyProperties'),q=b('createArrayFrom'),r=b('ge'),s=b('getObjectValues'),t=[],u;function v(){v=bagofholding;Event.listen(document.documentElement,'click',function(event){var z=event.getTarget();t.forEach(function(aa){aa.active&&!aa.sticky&&!k.containsIncludingLayers(aa.getActive(),z)&&!aa.inTargetFlyout(z)&&aa.inActiveDialog()&&aa.hide();});},Event.Priority.URGENT);}var w=function(){this.active=null;this.togglers={};this.setSticky(false);t.push(this);this.subscribe(['show','hide'],w.inform.bind(w));return v();};p(w.prototype,h,{show:function(z){var aa=x(this,z),ba=aa.active;if(z!==ba){ba&&aa.hide();aa.active=z;l.addClass(z,'openToggler');var ca=o.scry(z,'a[rel="toggle"]');if(ca.length>0&&ca[0].getAttribute('data-target'))l.removeClass(r(ca[0].getAttribute('data-target')),'toggleTargetClosed');o.appendContent(z,aa.getToggler('next'));o.prependContent(z,aa.getToggler('prev'));aa.inform('show',aa);}},hide:function(z){var aa=x(this,z),ba=aa.active;if(ba&&(!z||z===ba)){l.removeClass(ba,'openToggler');var ca=o.scry(ba,'a[rel="toggle"]');if(ca.length>0&&ca[0].getAttribute('data-target'))l.addClass(r(ca[0].getAttribute('data-target')),'toggleTargetClosed');s(aa.togglers).forEach(o.remove);aa.inform('hide',aa);aa.active=null;}},toggle:function(z){var aa=x(this,z);if(aa.active===z){aa.hide();}else aa.show(z);},getActive:function(){return x(this).active;},isShown:function(){return x(this).active&&l.hasClass(x(this).active,'openToggler');},inTargetFlyout:function(z){var aa=y(this.getActive());return aa&&k.containsIncludingLayers(aa,z);},inActiveDialog:function(){var z=n.getCurrent();return !z||o.contains(z.getRoot(),this.getActive());},getToggler:function(z){var aa=x(this);if(!aa.togglers[z])aa.togglers[z]=o.create('button',{className:'hideToggler',onfocus:function(){var ba=o.scry(aa.active,'a[rel="toggle"]')[0];ba&&ba.focus();aa.hide();}});return this.togglers[z];},setSticky:function(z){var aa=x(this);z=z!==false;if(z!==aa.sticky){aa.sticky=z;if(z){aa._pt&&aa._pt.unsubscribe();}else aa._pt=g.subscribe('page_transition',aa.hide.bind(aa,null));}return aa;}});p(w,w.prototype);p(w,{bootstrap:function(z){var aa=z.parentNode;w.getInstance(aa).toggle(aa);},createInstance:function(z){var aa=new w().setSticky(true);m.set(z,'toggler',aa);return aa;},getInstance:function(z){while(z){var aa=m.get(z,'toggler');if(aa)return aa;if(l.hasClass(z,'uiToggleContext'))return w.createInstance(z);z=z.parentNode;}return (u=u||new w());},listen:function(z,aa,ba){return w.subscribe(q(z),function(ca,da){if(da.getActive()===aa)return ba(ca,da);});},subscribe:(function(z){return function(aa,ba){aa=q(aa);if(aa.contains('show'))t.forEach(function(ca){if(ca.getActive())ba.curry('show',ca).defer();});return z(aa,ba);};})(w.subscribe.bind(w))});function x(z,aa){if(z instanceof w)return z;return w.getInstance(aa);}function y(z){var aa=o.scry(z,'a[rel="toggle"]');if(aa.length>0&&aa[0].getAttribute('data-target'))return r(aa[0].getAttribute('data-target'));}e.exports=w;});
__d("Tooltip",["event-extensions","ARIA","AsyncRequest","copyProperties","ContextualLayer","ContextualLayerAutoFlip","CSS","DataStore","DOM","HTML","StringEscape","Style","URI","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ARIA'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('ContextualLayer'),k=b('ContextualLayerAutoFlip'),l=b('CSS'),m=b('DataStore'),n=b('DOM'),o=b('HTML'),p=b('StringEscape'),q=b('Style'),r=b('URI'),s=b('tx'),t=null,u=null,v=null,w=[];function x(){if(!u){v=n.create('div',{className:'tooltipContent'});var ca=n.create('i',{className:'arrow'}),da=n.create('div',{className:'uiTooltipX'},[v,ca]);u=new j({},da);u.enableBehavior(k);}}function y(ca){return i({position:ca.getAttribute('tooltip-position')||'above',alignH:ca.getAttribute('tooltip-alignh')||'left'},m.get(ca,'tooltip'));}function z(ca,da){var ea=y(ca);m.set(ca,'tooltip',{content:da.content||ea.content,position:da.position||ea.position,alignH:da.alignH||ea.alignH});ca.setAttribute('data-hover','tooltip');}function aa(ca,da){ba.set(ca,"Ladataan...");new h(da).setHandler(function(ea){ba.set(ca,ea.getPayload());}).setErrorHandler(bagofholding).send();}var ba={process:function(ca,da){if(!n.contains(ca,da))return;if(ca!==t){var ea=ca.getAttribute('tooltip-uri');if(ea){ca.removeAttribute('tooltip-uri');aa(ca,ea);}var fa=ca.getAttribute('title');if(fa){ca.setAttribute('title','');var ga=y(ca);!ga.content&&ba.set(ca,fa);}ba.show(ca);}},remove:function(ca){m.remove(ca,'tooltip');ca.removeAttribute('data-hover');ca.removeAttribute('tooltip-position');ca.removeAttribute('tooltip-alignh');ca===t&&ba.hide();},hide:function(){if(t){u.hide();t=null;while(w.length)w.pop().remove();}},set:function(ca,da,ea,fa){if(ea||fa)z(ca,{position:ea,alignH:fa});if(da instanceof r){if(ca===t){aa(ca,da);}else ca.setAttribute('tooltip-uri',da);}else{z(ca,{content:da});ca===t&&ba.show(ca);}},show:function(ca){x();ba.hide();var da=y(ca);if(!da.content)return;var ea=0,fa=0;if(da.position==='left'||da.position==='right'){fa=(ca.offsetHeight-20)/2;}else if(da.alignH!=='center'){var ga=ca.offsetWidth;if(ga<18)ea=(ga-18)/2*(da.alignH==='right'?-1:1);}u.setContext(ca).setOffsetX(ea).setOffsetY(fa).setPosition(da.position).setAlignment(da.alignH);if(typeof da.content==='string'){l.addClass(u,'invisible_elem');var ha=n.create('span',{},o(p.htmlize(da.content))),ia=n.create('div',{className:'tooltipText'},ha);n.setContent(v,ia);u.show();g.notify(da.content);if(ia.offsetWidth<ha.offsetWidth){l.addClass(ia,'tooltipWrap');u.updatePosition();}l.removeClass(u,'invisible_elem');}else{n.setContent(v,da.content);u.show();g.notify(n.getText(v));}var ja=function(la){if(!n.contains(t,la.getTarget()))ba.hide();};w.push(Event.listen(document.documentElement,'mouseover',ja));w.push(Event.listen(document.documentElement,'focusin',ja));var ka=q.getScrollParent(ca);if(ka!==window)w.push(Event.listen(ka,'scroll',ba.hide));w.push(Event.listen(ca,'click',ba.hide));t=ca;}};Event.listen(window,'scroll',ba.hide);e.exports=ba;});
__d("Selector",["event-extensions","Arbiter","Button","ContextualLayer","copyProperties","CSS","DataStore","DOM","HTML","Input","Keys","KeyStatus","Menu","Parent","Style","Toggler","Tooltip","Vector"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('Button'),i=b('ContextualLayer'),j=b('copyProperties'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('HTML'),o=b('Input'),p=b('Keys'),q=b('KeyStatus'),r=b('Menu'),s=b('Parent'),t=b('Style'),u=b('Toggler'),v=b('Tooltip'),w=b('Vector'),x,y,z=[],aa;function ba(ma){return s.byClass(ma,'uiSelector');}function ca(ma){return s.byClass(ma,'uiSelectorButton');}function da(){if(!y)y=new i({position:'below'},m.create('div'));return y;}function ea(ma){return m.scry(ma,'select')[0];}function fa(ma){return m.find(ma,'div.uiSelectorMenuWrapper');}function ga(){ga=bagofholding;r.subscribe('select',function(ma,na){if(!x||!na||na.menu!==la.getSelectorMenu(x))return;var oa=ha(x),pa=ia(na.item);if(pa){var qa=x,ra=la.isOptionSelected(na.item),sa=la.inform('select',{selector:qa,option:na.item,clone:aa});if(sa===false)return;if(oa||!ra){la.setSelected(qa,la.getOptionValue(na.item),!ra);la.inform('toggle',{selector:qa,option:na.item});la.inform('change',{selector:qa});g.inform('Form/change',{node:qa});if(ja(qa))l.set(qa,'dirty',true);}}if(!oa||!pa)x&&la.toggle(x);});}function ha(ma){return !!ma.getAttribute('data-multiple');}function ia(ma){return k.hasClass(ma,'uiSelectorOption');}function ja(ma){return !!ma.getAttribute('data-autosubmit');}var ka={keydown:function(event){var ma=event.getTarget();if(m.isNodeOfType(ma,['input','textarea']))return;switch(Event.getKeyCode(event)){case p.DOWN:case p.SPACE:case p.UP:if(ca(ma)){var na=ba(ma);la.toggle(na);return false;}break;case p.ESC:if(x){la.toggle(x);return false;}break;}},mouseover:function(event){var ma=s.byAttribute(event.getTarget(),'ajaxify');if(ma&&k.hasClass(ma,'uiSelectorButton'))la.loadMenu(ba(ma));}};Event.listen(document.documentElement,ka);u.subscribe(['show','hide'],function(ma,na){var oa=ba(na.getActive());if(oa){ga();var pa=la.getSelectorButton(oa),qa=la.getSelectorMenu(oa),ra=ma==='show';pa.setAttribute('aria-expanded',ra?'true':'false');if(ra){x=oa;if(k.hasClass(pa,'uiButtonDisabled')){la.setEnabled(oa,false);return false;}qa=qa||la.loadMenu(oa);var sa=t.getScrollParent(oa),ta=sa!==window&&sa!==m.getDocumentScrollElement();if(ta||k.hasClass(oa,'uiSelectorUseLayer')){if(ta)z.push(Event.listen(sa,'scroll',function(){na.hide();}));aa=m.create('div',{className:oa.className});k.addClass(aa,'invisible_elem');w.getElementDimensions(oa).setElementDimensions(aa);m.replace(oa,aa);var ua=k.hasClass(oa,'uiSelectorRight'),va=k.hasClass(oa,'uiSelectorBottomUp');da().setContext(aa).setContent(oa).setPosition(va?'above':'below').setAlignment(ua?'right':'left').show();}r.register(qa);if(q.isKeyDown()){var wa=r.getCheckedItems(qa);if(!wa.length)wa=r.getEnabledItems(qa);r.focusItem(wa[0]);}}else{x=null;if(aa){while(z.length)z.pop().remove();m.replace(aa,oa);da().hide();aa=null;}qa&&r.unregister(qa);if(ja(oa)&&l.get(oa,'dirty')){var xa=m.scry(oa,'input.submitButton')[0];xa&&xa.click();l.remove(oa,'dirty');}}k.conditionClass(la.getSelectorButton(oa),'selected',ra);la.inform(ra?'open':'close',{selector:oa,clone:aa});}});var la=j(new g(),{attachMenu:function(ma,na,oa){ma=ba(ma);if(ma){x&&r.unregister(la.getSelectorMenu(x));m.setContent(fa(ma),na);x&&r.register(la.getSelectorMenu(ma));aa&&da().updatePosition();if(oa){var pa=ma.getAttribute('data-name');pa&&oa.setAttribute('name',pa);if(!ha(ma))oa.setAttribute('multiple',false);var qa=ea(ma);if(qa){m.replace(qa,oa);}else m.insertAfter(ma.firstChild,oa);}return true;}},getOption:function(ma,na){var oa=la.getOptions(ma),pa=oa.length;while(pa--)if(na===la.getOptionValue(oa[pa]))return oa[pa];return null;},getOptions:function(ma){var na=r.getItems(la.getSelectorMenu(ma));return na.filter(ia);},getEnabledOptions:function(ma){var na=r.getEnabledItems(la.getSelectorMenu(ma));return na.filter(ia);},getSelectedOptions:function(ma){return r.getCheckedItems(la.getSelectorMenu(ma));},getOptionText:function(ma){return r.getItemLabel(ma);},getOptionValue:function(ma){var na=ba(ma),oa=ea(na),pa=la.getOptions(na).indexOf(ma);return pa>=0?oa.options[pa+1].value:'';},getSelectorButton:function(ma){return m.find(ma,'a.uiSelectorButton');},getSelectorMenu:function(ma){return m.scry(ma,'div.uiSelectorMenu')[0];},getValue:function(ma){var na=ea(ma);if(!na)return null;if(!ha(ma))return na.value;var oa=[],pa=na.options;for(var qa=1,ra=pa.length;qa<ra;qa++)if(pa[qa].selected)oa.push(pa[qa].value);return oa;},isOptionSelected:function(ma){return r.isItemChecked(ma);},listen:function(ma,na,oa){return this.subscribe(na,function(pa,qa){if(qa.selector===ma)return oa(qa,pa);});},loadMenu:function(ma){var na=la.getSelectorMenu(ma);if(!na){var oa=la.getSelectorButton(ma),pa=oa.getAttribute('ajaxify');if(pa){d(['AsyncRequest'],function(ra){ra.bootstrap(pa,oa);});var qa=n('<div class="uiSelectorMenuWrapper uiToggleFlyout">'+'<div class="uiMenu uiSelectorMenu loading">'+'<ul class="uiMenuInner">'+'<li><span></span></li>'+'</ul>'+'</div>'+'</div>');m.appendContent(oa.parentNode,qa);na=la.getSelectorMenu(ma);oa.removeAttribute('onmouseover');}}return na;},setButtonLabel:function(ma,na){var oa=la.getSelectorButton(ma),pa=parseInt(oa.getAttribute('data-length'),10);na=na||oa.getAttribute('data-label')||'';h.setLabel(oa,na);if(typeof na==='string'){k.conditionClass(oa,'uiSelectorBigButtonLabel',na.length>pa);if(pa&&na.length>pa){oa.setAttribute('title',na);}else oa.removeAttribute('title');}},setButtonTooltip:function(ma,na){var oa=la.getSelectorButton(ma),pa=s.byTag(oa,'a');pa&&v.set(s.byTag(oa,'a'),na||oa.getAttribute('data-tooltip')||'');},setEnabled:function(ma,na){if(!na&&x&&ba(ma)===x)la.toggle(ma);h.setEnabled(la.getSelectorButton(ma),na);},setOptionEnabled:function(ma,na){r.setItemEnabled(ma,na);},setSelected:function(ma,na,oa){oa=oa!==false;var pa=la.getOption(ma,na);if(!pa)return;var qa=la.isOptionSelected(pa);if(oa!==qa){if(!ha(ma)&&!qa){var ra=la.getSelectedOptions(ma)[0];ra&&r.toggleItem(ra);}r.toggleItem(pa);}la.updateSelector(ma);},toggle:function(ma){u.toggle(m.scry(ba(ma),'div.wrap')[0]);},updateSelector:function(ma){var na=la.getOptions(ma),oa=la.getSelectedOptions(ma),pa=ea(ma).options,qa=[],ra=[];for(var sa=0,ta=na.length;sa<ta;sa++){var ua=oa.contains(na[sa]);pa[sa+1].selected=ua;if(ua){var va=la.getOptionText(na[sa]);qa.push(va);ra.push(na[sa].getAttribute('data-tooltip')||va);}}pa[0].selected=!oa.length;var wa=k.hasClass(ma,'uiSelectorDynamicLabel'),xa=k.hasClass(ma,'uiSelectorDynamicTooltip');if(wa||xa){var ya='';if(ha(ma)){var za=la.getSelectorButton(ma);ya=za.getAttribute('data-delimiter')||', ';}qa=qa.join(ya);ra=ra.join(ya);wa&&la.setButtonLabel(ma,qa);xa&&la.setButtonTooltip(ma,ra);}}});e.exports=la;});
__d("Typeahead",["array-extensions","event-extensions","ArbiterMixin","BehaviorsMixin","Class","DataStore","DOM","Parent","Run","copyProperties","ge"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('ArbiterMixin'),h=b('BehaviorsMixin'),i=b('Class'),j=b('DataStore'),k=b('DOM'),l=b('Parent'),m=b('Run'),n=b('copyProperties'),o=b('ge');function p(q,r,s,t){this.args={data:q,view:r,core:s};j.set(t,'Typeahead',this);this.element=t;}p.getInstance=function(q){var r=l.byClass(q,'uiTypeahead');return r?j.get(r,'Typeahead'):null;};n(p.prototype,g,h,{init:function(q){this.init=bagofholding;this.getCore();this.proxyEvents();this.initBehaviors(q||[]);this.inform('init',this);this.data.bootstrap();this.core.focus();},getData:function(){if(!this.data){var q=this.args.data;this.data=q;this.data.init();}return this.data;},getView:function(){if(!this.view){var q=this.args.view,r=o(q.node_id);if(!r){r=k.$N('div',{className:'uiTypeaheadView'});k.appendContent(this.element,r);}if(typeof q.ctor==='string'){this.view=new window[q.ctor](r,q.options||{});}else this.view=new q.ctor(r,q.options||{});this.view.init();this.view.setTypeahead(this.element);}return this.view;},getCore:function(){if(!this.core){var q=this.args.core;if(typeof q.ctor==='string'){this.core=new window[q.ctor](q.options||{});}else this.core=new q.ctor(q.options||{});this.core.init(this.getData(),this.getView(),this.getElement());}return this.core;},getElement:function(){return this.element;},swapData:function(q){var r=this.core;this.data=this.args.data=q;q.init();if(r){r.data=q;r.initData();r.reset();}q.bootstrap();return q;},proxyEvents:function(){[this.data,this.view,this.core].forEach(function(q){q.subscribe(q.events,this.inform.bind(this));},this);},initBehaviors:function(q){q.forEach(function(r){if(typeof r==='string'){if(a.TypeaheadBehaviors&&a.TypeaheadBehaviors[r]){a.TypeaheadBehaviors[r](this);}else m.onLoad(function(){if(a.TypeaheadBehaviors)(a.TypeaheadBehaviors[r]||bagofholding)(this);}.bind(this));}else this.enableBehavior(r);},this);}});p.initNow=function(q,r,s){if(s)s.init(q);q.init(r);};p.init=function(q,r,s,t){if(!k.isNodeOfType(q,['input','textarea']))q=k.scry(q,'input')[0]||k.scry(q,'textarea')[0];var u=false;try{u=document.activeElement===q;}catch(v){}if(u){p.initNow(r,s,t);}else var w=Event.listen(q,'focus',function(){p.initNow(r,s,t);w.remove();});};e.exports=p;});
__d("TypeaheadCore",["event-extensions","Arbiter","ArbiterMixin","Class","CSS","DOM","Input","InputSelection","Keys","UserAgent","bind","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DOM'),l=b('Input'),m=b('InputSelection'),n=b('Keys'),o=b('UserAgent'),p=b('bind'),q=b('copyProperties');function r(s){q(this,s);}q(r.prototype,h,{events:['blur','focus','unselect','loading'],keepFocused:true,resetOnSelect:false,resetOnKeyup:true,setValueOnSelect:false,queryTimeout:250,preventFocusChangeOnTab:false,init:function(s,t,u){this.init=bagofholding;this.data=s;this.view=t;this.root=u;this.initInput();this.inputWrap=k.find(u,'div.wrap');this.hiddenInput=k.find(u,'input.hiddenInput');this.value='';this.nextQuery=null;this.selectedText=null;if(this.setValueOnSelect&&j.hasClass(this.inputWrap,'selected'))this.selectedText=this.getValue();this.initView();this.initData();this.initEvents();this.initToggle();this._exclusions=[];},initInput:function(){this.element=k.find(this.root,'.textInput');var s=k.scry(this.element,'input')[0];if(s)this.element=s;},initView:function(){this.view.subscribe('highlight',function(s,t){this.element.focus();this.element.setAttribute('aria-activedescendant',(t.index!==-1)?k.getID(t.element):'');}.bind(this));this.view.subscribe('select',function(s,t){this.select(t.selected);}.bind(this));this.view.subscribe('afterSelect',function(){this.afterSelect();}.bind(this));},initData:function(){this.data.subscribe('respond',function(s,t){if(t.forceDisplay||t.value==this.getValue()&&!this.element.disabled)this.view.render(t.value,t.results,t.isAsync);}.bind(this));this.data.subscribe('activity',function(s,t){this.fetching=t.activity;if(!this.fetching)this.nextQuery&&this.performQuery();if(this.loading!=this.fetching){this.loading=this.fetching;this.inform('loading',{loading:this.loading});}}.bind(this));},initEvents:function(){Event.listen(this.view.getElement(),{mouseup:this.viewMouseup.bind(this),mousedown:this.viewMousedown.bind(this)});var s={blur:p(this,'blur'),focus:p(this,'focus'),click:p(this,'click'),keyup:p(this,'keyup'),keydown:p(this,'keydown')};if(o.firefox())s.text=s.keyup;if(o.firefox()<4){s.keypress=s.keydown;delete s.keydown;}Event.listen(this.element,s);Event.listen(this.element,'keypress',p(this,'keypress'));},initToggle:function(){this.subscribe('blur',this.view.hide.bind(this.view));this.subscribe('focus',this.view.show.bind(this.view));},viewMousedown:function(){this.selecting=true;},viewMouseup:function(){this.selecting=false;},blur:function(){if(this.selecting){this.selecting=false;return;}this.inform('blur');},click:function(){var s=m.get(this.element);if(s.start==s.end)this.element.select();},focus:function(){this.checkValue();this.inform('focus');},keyup:function(){if(this.resetOnKeyup&&!this.getValue())this.view.reset();this.checkValue();},keydown:function(event){if(!this.view.isVisible()||this.view.isEmpty()){this.checkValue.bind(this).defer();return;}switch(Event.getKeyCode(event)){case n.TAB:this.handleTab(event);return;case n.UP:this.view.prev();break;case n.DOWN:this.view.next();break;case n.ESC:this.view.reset();break;default:this.checkValue.bind(this).defer();return;}event.kill();},keypress:function(event){if(this.view.getSelection()&&Event.getKeyCode(event)==n.RETURN){this.view.select();event.kill();}},handleTab:function(event){this.view.select();this.preventFocusChangeOnTab&&event.kill();},select:function(s){if(s&&this.setValueOnSelect){this.setValue(s.text);this.setHiddenValue(s.uid);this.selectedText=s.text;j.addClass(this.inputWrap,'selected');}},afterSelect:function(){this.keepFocused?this.element.focus():this.element.blur();this.resetOnSelect?this.reset():this.view.reset();},unselect:function(){if(this.setValueOnSelect){this.selectedText=null;j.removeClass(this.inputWrap,'selected');}this.setHiddenValue();this.inform('unselect',this);},setEnabled:function(s){var t=s===false;this.element.disabled=t;j.conditionClass(this.root,'uiTypeaheadDisabled',t);},reset:function(){this.unselect();this.setValue();!this.keepFocused&&l.reset(this.element);this.view.reset();this.inform('reset');},getElement:function(){return this.element;},setExclusions:function(s){this._exclusions=s;},getExclusions:function(){return this._exclusions;},setValue:function(s){this.value=this.nextQuery=s||'';l.setValue(this.element,this.value);},setHiddenValue:function(s){this.hiddenInput.value=(s||s===0)?s:'';g.inform('Form/change',{node:this.hiddenInput});},getValue:function(){return l.getValue(this.element);},getHiddenValue:function(){return this.hiddenInput.value||'';},checkValue:function(){var s=this.getValue();if(s==this.value)return;if(this.selectedText&&this.selectedText!=s)this.unselect();var t=Date.now(),u=t-this.time;this.time=t;this.value=this.nextQuery=s;this.performQuery(u);},performQuery:function(s){if(this.selectedText)return;s=s||0;if(this.fetching&&s<this.queryTimeout){this.data.query(this.nextQuery,true,this._exclusions);}else{this.data.query(this.nextQuery,false,this._exclusions);this.nextQuery=null;}}});e.exports=r;});
__d("XHPTemplate",["event-extensions","DataStore","DOM","HTML","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DataStore'),h=b('DOM'),i=b('HTML'),j=b('copyProperties');function k(m){this._model=m;}j(k.prototype,{render:function(){if(i.isHTML(this._model))this._model=h.setContent(document.createDocumentFragment(),this._model)[0];return this._model.cloneNode(true);},build:function(){return new l(this.render());}});j(k,{getNode:function(m,n){return k.getNodes(m)[n];},getNodes:function(m){var n=g.get(m,'XHPTemplate:nodes');if(!n){n={};var o=h.scry(m,'[data-jsid]');o.push(m);var p=o.length;while(p--){var q=o[p];n[q.getAttribute('data-jsid')]=q;q.removeAttribute('data-jsid');}g.set(m,'XHPTemplate:nodes',n);}return n;}});function l(m){this._root=m;this._populateNodes();}j(l.prototype,{_populateNodes:function(){this._nodes={};this._leaves={};var m=this._root.getElementsByTagName('*');for(var n=0,o=m.length;n<o;n++){var p=m[n],q=p.getAttribute('data-jsid');if(q){p.removeAttribute('data-jsid');this._nodes[q]=p;this._leaves[q]=!p.childNodes.length;}}},getRoot:function(){return this._root;},getNode:function(m){return this._nodes[m];},setNodeProperty:function(m,n,o){this.getNode(m)[n]=o;return this;},setNodeContent:function(m,n){if(!this._leaves[m])throw new Error("Can't setContent on non-leaf node: "+m);h.setContent(this.getNode(m),n);return this;}});e.exports=k;});
__d("legacy:onvisible",["OnVisible"],function(a,b,c,d){a.OnVisible=b('OnVisible');},3);
__d("TypeaheadBestName",["TypeaheadUtil","copyProperties"],function(a,b,c,d,e,f){var g=b('TypeaheadUtil'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){var j=this._typeahead.getView();this._subscription=j.subscribe('beforeRender',function(k,l){var m=l.value;for(var n=0;n<l.results.length;++n){var o=l.results[n];if(o.alternate_names==null)continue;if(g.isQueryMatch(m,o.default_name)){o.text=o.default_name;return;}for(var p=0;p<o.alternate_names.length;p++)if(g.isQueryMatch(m,o.alternate_names[p])){o.text=o.alternate_names[p];return;}o.text=o.default_name;}});},disable:function(){this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;}});e.exports=i;});
__d("legacy:BestNameTypeaheadBehavior",["TypeaheadBestName"],function(a,b,c,d){var e=b('TypeaheadBestName');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.buildBestAvailableNames=function(f){f.enableBehavior(e);};},3);
__d("MentionsInputMatchers",[],function(a,b,c,d,e,f){var g=['@','\\uff20','+','\\uff0b'].join(''),h='.,*?$|#{}()\\^\\-\\[\\]\\\\\/!%&\'"~=<>_:;',i='\\b[A-Z][^ A-Z'+h+']',j='([^'+g+h+']|['+h+'][^ '+h+'])',k='(?:^|\\s)(?:['+g+']('+j+'{0,20}))',l='(?:(?:'+i+'+)|'+k+')',m='(?:'+i+'{4,})',n={trigger:new RegExp('['+g+']$'),mainMatcher:new RegExp(k+'$'),autoMatcher:new RegExp(l+'$'),userMatcher:new RegExp(m+'$')};e.exports=n;});
__d("MentionsInput",["event-extensions","function-extensions","Arbiter","ArbiterMixin","Class","CSS","DataStore","DOM","HTML","Input","InputSelection","Parent","StringEscape","Style","Typeahead","TypeaheadUtil","UserAgent","copyProperties","MentionsInputMatchers"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('HTML'),n=b('Input'),o=b('InputSelection'),p=b('Parent'),q=b('StringEscape'),r=b('Style'),s=b('Typeahead'),t=b('TypeaheadUtil'),u=b('UserAgent'),v=b('copyProperties'),w=q.htmlize,x=b('MentionsInputMatchers');function y(z,aa,ba,ca,da,ea){k.set(z,'MentionsInput',this);this._root=z;this._typeahead=aa;this._input=ba;var fa=false;try{fa=document.activeElement===this._input;}catch(ga){}if(fa){this.init.bind(this,ca,da,ea).defer();}else var ha=Event.listen(this._input,'focus',function(){this.init.bind(this,ca,da,ea).defer();ha.remove();}.bind(this));}y.getInstance=function(z){var aa=p.byClass(z,'uiMentionsInput');return aa?k.get(aa,'MentionsInput'):null;};v(y.prototype,h,{init:function(z,aa,ba){this.init=Function.prototype;this._initialized=true;this._highlighter=l.find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=l.find(this._root,'.highlighterContent');this._hiddenInput=l.find(this._root,'.mentionsHidden');this._placeholder=this._input.getAttribute('placeholder')||'';this._maxMentions=z.max||6;this._metrics=ba;if(u.firefox()<4){this._input.blur();setTimeout(function(){this._input.focus();}.bind(this));}if(!this._hiddenInput.name){var ca=this._input.name;this._input.name=ca+'_text';this._hiddenInput.name=ca;}this._initEvents();this._initTypeahead();this.reset(aa);this.inform('init',null,g.BEHAVIOR_STATE);},reset:function(z){if(!this._initialized)return;this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._hiddenInput&&(this._hiddenInput.value='');this._highlighterContent&&l.empty(this._highlighterContent);this._highlighterAuxContent&&l.remove(this._highlighterAuxContent);this._highlighterAuxContent=null;n.setPlaceholder(this._input,this._placeholder);r.set(this._typeahead.getElement(),'height','auto');if(z){n.setValue(this._input,z.flattened);for(var aa in z.mention_data)this._addToken({uid:aa,text:z.mention_data[aa],type:'unknown'});}this._updateTypeahead();this._updateWidth();this._update();},getRawValue:function(){return n.getValue(this._hiddenInput);},checkValue:function(){var z=this._typeahead.getCore().getValue();if(x.trigger.exec(z)||z==='')this.inform('sessionEnd',{});},getTypeahead:function(){return this._typeahead;},_initEvents:function(){var z=this._update.bind(this);Event.listen(this._input,{input:z,keyup:z,change:z,focus:this._updateWidth.bind(this)});if(this._metrics){this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);Event.listen(this._input,'keyup',function(event){this.checkValue.bind(this).defer();}.bind(this));}},_initTypeahead:function(){this._typeahead.subscribe('select',function(da,ea){var fa=ea.selected;this._addToken({uid:fa.uid,text:fa.text,type:fa.type});this.updateValue();}.bind(this));var z=this._input,aa=null,ba=function(){if(aa===null){aa=n.getSubmitOnEnter(z);n.setSubmitOnEnter(z,false);}},ca=function(){if(aa!==null){n.setSubmitOnEnter(z,aa);aa=null;}};this._typeahead.subscribe('render',ba);this._typeahead.subscribe('reset',ca);this._typeahead.subscribe('highlight',function(da,ea){ea.index>=0?ba():ca();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));this._typeahead.getCore().suffix='';this._typeahead.getData().setFilter(this._filterResults.bind(this));},_filterResults:function(z){if(this._filterData===null){var aa=o.get(this._input).start||0;for(var ba=0;ba<this._offsets.length;ba++){var ca=this._offsets[ba];if(aa>ca[0]&&aa<=ca[1]){this._filterData={caretIsInsideMention:true};return false;}}var da=this._typeahead.getCore();this._filterData={value:da.getValue(),rawValue:da.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(x.mainMatcher.test(this._filterData.rawValue))return true;if(z.type!='user')return false;if(x.userMatcher.test(this._filterData.value))return true;return t.isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(z));},_addToken:function(z){var aa=z.uid;if(!this._mentioned.hasOwnProperty(aa)){this._mentioned[aa]=z;this._orderedUIDs.push(aa);this._numMentioned++;this._updateTypeahead();}},_removeToken:function(z){if(this._mentioned.hasOwnProperty(z)){delete this._mentioned[z];this._orderedUIDs.remove(z);this._numMentioned--;this._updateTypeahead();}},_reduceToken:function(z,aa){var ba=aa.split(' '),ca=[];for(var da=0;da<ba.length;da++)if(z.indexOf(ba[da])!=-1)ca.push(ba[da]);ba=ca;for(da=1;da<ba.length;da++)for(var ea=1;ea<ba[da-1].length+1;ea++)if(z.indexOf(ba[da-1].substr(0,ea)+ba[da])!=-1)ba.splice(da-1,1);while(z.indexOf(ba.join(' '))==-1)ba.splice(0,1);return ba.join(' ');},_update:function(){var z=n.getValue(this._input);if(z==this._value)return;this._updateTokens();this.updateValue();this._updateDirection();},_updateTokens:function(){var z=n.getValue(this._input),aa=false;for(var ba=0;ba<this._orderedUIDs.length;++ba){var ca=this._orderedUIDs[ba],da=this._mentioned[ca],ea=da.text,fa;if(da.type=='user'&&(fa=this._reduceToken(z,ea))!==''){if(fa==ea.substring(0,ea.lastIndexOf(' '))&&z==this._value.substring(0,this._value.length-1)){z=z.substring(0,z.lastIndexOf(' '));aa=true;}da.text=fa;}else if(!ea||z.indexOf(ea)==-1||typeof ea!=='string')this._removeToken(ca);}this._value=z;if(aa)n.setValue(this._input,z);},updateValue:function(){var z=n.getValue(this._input),aa=this._orderedUIDs,ba=[],ca,da,ea,fa;for(fa=0;fa<aa.length;++fa){da=this._mentioned[aa[fa]].text;z=z.replace(da,function(ga,ha){ba.push([ha,ha+da.length]);return da;});}for(fa=0;fa<aa.length;++fa){ea=aa[fa];da=this._mentioned[ea].text;z=z.replace(da,'@['+ea+':]');}ca=w(z);for(fa=0;fa<aa.length;++fa){ea=aa[fa];da=this._mentioned[ea].text;ca=ca.replace('@['+ea+':]','<b>'+w(da)+'</b>');da=da.replace(/[\\\]:]/g,function(ga){return '\\'+ga;});z=z.replace('@['+ea+':]','@['+ea+':'+da+']');}if(u.ie()){ca=ca.replace(/ {2}/g,'&nbsp;<wbr />&nbsp;<wbr />');ca=ca.replace(/ (?=[^\/]|\/[^>])/g,'&nbsp;<wbr />');}this._offsets=ba;this._hiddenInput.value=z;l.setContent(this._highlighterContent,m(ca));this._updateHighlighter();this._updateHeight();},_updateDirection:function(){var z=r.get(this._input,'direction');if(z==this._dir)return;this._dir=z;r.set(this._highlighter,'direction',z);if(z=='rtl'){r.set(this._highlighter,'text-align','right');}else r.set(this._highlighter,'text-align','left');},_updateWidth:function(){var z=r.getFloat.curry(this._input),aa=this._input.offsetWidth-z('paddingLeft')-z('paddingRight')-z('borderLeftWidth')-z('borderRightWidth');if(u.firefox())aa-=2;if(u.ie()<=7){aa-=r.getFloat(this._highlighterInner,'paddingLeft');this._highlighter.style.zoom=1;}this._highlighterInner.style.width=Math.max(aa,0)+'px';},_updateHeight:function(){if(this._highlighterAuxContent){var z=this._highlighter.offsetHeight,aa=this._typeahead.getElement();if(z>aa.offsetHeight){r.set(aa,'height',z+'px');g.inform('reflow');}}},_updateTypeahead:function(){var z=this._typeahead.getCore(),aa=null;if(!this._maxMentions||this._numMentioned<this._maxMentions)aa=x.autoMatcher;z.matcher=aa;z.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});},_updateHighlighter:function(){if(this._highlighterContent)j.conditionShow(this._highlighterContent,this._numMentioned>0||this.hasAuxContent());},setAuxContent:function(z){if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=l.create('span',{className:'highlighterAuxContent'});l.insertAfter(this._highlighterContent,this._highlighterAuxContent);}l.setContent(this._highlighterAuxContent,z);if(z){n.setPlaceholder(this._input,'');}else n.setPlaceholder(this._input,this._placeholder);this._updateHighlighter();this._updateHeight();}},hasAuxContent:function(){var z=this.getAuxContentRoot();return z&&z.innerHTML.length>0;},getAuxContentRoot:function(){return this._highlighterAuxContent;},addMention:function(z){var aa=n.getValue(this._input);n.setValue(this._input,aa+" "+z.text);this._addToken(z);this._update();},getMentions:function(){return this._mentioned;}});e.exports=y;});
__d("OptimisticUFI",["event-extensions","Arbiter","AsyncRequest","AsyncResponse","CommentPrelude","CSS","DOM","Form","HTML","Input","math-extensions","MentionsInput","Parent","StringEscape","XHPTemplate"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AsyncResponse'),j=b('CommentPrelude'),k=b('CSS'),l=b('DOM'),m=b('Form'),n=b('HTML'),o=b('Input'),p=b('math-extensions'),q=b('MentionsInput'),r=b('Parent'),s=b('StringEscape'),t=b('XHPTemplate'),u={COMMENT_SEND_EVENT:'ufi/comment',_commentSeqNo:0,init:function(v){this._commentTemplate=v;if(!this._loaded){Event.listen(document.documentElement,'click',this._clickHandler.bind(this),Event.Priority.URGENT);this._loaded=true;}},_clickHandler:function(event){var v=event.getTarget(),w=v.name=='comment'&&v.parentNode&&r.byClass(v,'optimistic_submit');if(!w)return true;var x=v.form,y=l.scry(x,'textarea')[0];if(o.isEmpty(y))return true;j.uncollapse(x);var z,aa,ba=l.scry(v,'^.commentList li.uiUfiAddComment')[0];if(ba){aa=l.find(ba.previousSibling,'div.commentContent span[data-jsid="text"]');}else{z=this._commentTemplate.render();aa=t.getNode(z,'text');}l.setContent(aa,n(s.htmlize(y.value.trim())));var ca=l.scry(x,'ul.commentList')[0];if(!ca)return true;var da;if(ba){da=ba.previousSibling;k.show(da);k.hide(ba);var ea=l.scry(x,'li.uiUfiAddComment');for(var fa=0;fa<ea.length;fa++)k.show(ea[fa]);}else{k.show(ca.parentNode);ca.appendChild(z);da=ca.lastChild;}var ga=p.rand32();da.id='optimistic_comment_'+ga+'_'+this._commentSeqNo++;var ha=m.serialize(x);ha.comment_replace=da.id;ha.comment=1;function ia(){new h(m.getAttribute(x,'action')).setData(ha).setRelativeTo(x).setErrorHandler(function(ka){k.addClass(da,'uiUfiCommentFailed');i.defaultErrorHandler(ka);}).setServerDialogCancelHandler(function(){l.remove(da);}).send();}if(!ba)Event.listen(t.getNode(z,'retry_link'),'click',ia);ia();y.value=y.style.height='';y.focus();var ja=q.getInstance(y);ja&&ja.reset();if(ba){l.remove(ba);}else g.inform(u.COMMENT_SEND_EVENT,{form:x});return false;}};e.exports=u;});
__d("ScrollableArea",["array-extensions","event-extensions","Animation","CSS","DataStore","DOM","Parent","Run","SimpleDrag","Style","UserAgent","Vector","copyProperties"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Animation'),h=b('CSS'),i=b('DataStore'),j=b('DOM'),k=b('Parent'),l=b('Run'),m=b('SimpleDrag'),n=b('Style'),o=b('UserAgent'),p=b('Vector'),q=b('copyProperties');function r(s,t){if(!s)return;t=t||{};this._elem=s;this._wrap=j.find(s,'div.uiScrollableAreaWrap');this._body=j.find(this._wrap,'div.uiScrollableAreaBody');this._track=j.find(s,'div.uiScrollableAreaTrack');this._gripper=j.find(this._track,'div.uiScrollableAreaGripper');this._options=t;this.adjustGripper.bind(this).defer();this._listeners=[Event.listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(t.fade!==false)this._listeners.push(Event.listen(s,'mouseenter',this.showScrollbar.shield(this)),Event.listen(s,'mousemove',this._handleMousemove.bind(this)),Event.listen(s,'mouseout',this.hideScrollbar.shield(this)));if(o.safari()||o.chrome())this._listeners.push(Event.listen(s,'mousedown',function(){var u=Event.listen(window,'mouseup',function(){if(s.scrollLeft)s.scrollLeft=0;u.remove();});}));this.initDrag();i.set(this._elem,'ScrollableArea',this);if(!t.persistent)l.onLeave(this.destroy.bind(this));}q(r,{fromNative:function(s,t){if(!h.hasClass(s,'uiScrollableArea')||!h.hasClass(s,'native'))return;t=t||{};h.removeClass(s,'native');var u=j.create('div',{className:'uiScrollableAreaTrack'},j.create('div',{className:'uiScrollableAreaGripper'}));if(t.fade!==false){h.addClass(s,'fade');h.addClass(u,'invisible_elem');}else h.addClass(s,'nofade');j.appendContent(s,u);var v=new r(s,t);v.resize();return v;},getInstance:function(s){var t=k.byClass(s,'uiScrollableArea');return t?i.get(t,'ScrollableArea'):null;},poke:function(s){var t=r.getInstance(s);t&&t.poke();}});q(r.prototype,{initDrag:function(){var s=new m(this._gripper);s.subscribe('start',function(t,event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;var u=p.getEventPosition(event).y,v=this._gripper.offsetTop,w=s.subscribe('update',function(y,event){var z=p.getEventPosition(event).y-u,aa=this._elem.clientHeight,ba=this._body.offsetHeight,ca=this._track.offsetHeight,da=aa/ba*ca,ea=ba-this._wrap.offsetHeight,fa=v+z,ga=ca-da;fa=Math.max(Math.min(fa,ga),0);var ha=fa/ga*ea;this._wrap.scrollTop=ha;}.bind(this)),x=s.subscribe('end',function(){s.unsubscribe(w);s.unsubscribe(x);});}.bind(this));},adjustGripper:function(){var s=this._elem.clientHeight,t=this._body.offsetHeight,u=this._track.offsetHeight,v=s/t*u;if(v<u){n.set(this._gripper,'height',v+'px');var w=this._wrap.scrollTop/t*u;n.set(this._gripper,'top',w+'px');h.show(this._gripper);}else h.hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function(){h.conditionClass(this._elem,'contentBefore',this._wrap.scrollTop>0);h.conditionClass(this._elem,'contentAfter',!this.isScrolledToBottom());},destroy:function(){this._listeners.forEach(function(s){s.remove();});this._listeners.length=0;},_handleMousemove:function(event){var s=p.getElementPosition(this._track).x,t=p.getElementDimensions(this._track).x;if(Math.abs(s+t/2-p.getEventPosition(event).x)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();},hideScrollbar:function(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=(new g(this._track)).from('opacity',1).to('opacity',0).duration(250).ondone(h.addClass.curry(this._track,'invisible_elem')).go();}.bind(this).defer(750);return this;},resize:function(){var s=p.getElementDimensions(this._elem).x;if(!this._options.fade)s-=10;n.set(this._body,'width',s+'px');return this;},showScrollbar:function(s){this.adjustGripper();if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}n.set(this._track,'opacity',1);h.removeClass(this._track,'invisible_elem');if(s!==false)this.hideScrollbar();return this;},isScrolledToBottom:function(){return this._wrap.scrollTop>=this._wrap.scrollHeight-this._wrap.clientHeight;},scrollToBottom:function(s){this.setScrollTop(this._wrap.scrollHeight,s);},scrollToTop:function(s){this.setScrollTop(0,s);},scrollIntoView:function(s){var t=this._wrap.scrollTop,u=t+this._wrap.clientHeight,v=s.offsetTop,w=v+s.offsetHeight;if(v<t){this._wrap.scrollTop=v;}else if(w>u)this._wrap.scrollTop=t+(w-u);},poke:function(){var s=this._wrap.scrollTop;this._wrap.scrollTop+=1;this._wrap.scrollTop-=1;this._wrap.scrollTop=s;return this.showScrollbar(false);},getScrollTop:function(){return this._wrap.scrollTop;},getScrollHeight:function(){return this._wrap.scrollHeight;},setScrollTop:function(s,t){if(t!==false){(new g(this._wrap)).to('scrollTop',s).ease(g.ease.end).go();}else this._wrap.scrollTop=s;}});e.exports=r;});
__d("UFIUpdate",["CommentPrelude","DOM","HTML","MentionsInput","ScrollableArea","ScrollAwareDOM"],function(a,b,c,d,e,f){var g=b('CommentPrelude'),h=b('DOM'),i=b('HTML'),j=b('MentionsInput'),k=b('ScrollableArea'),l=b('ScrollAwareDOM'),m={expandFeedback:function(n,o,p){h.scry(n,o).forEach(function(q){g.expand(q,p);});},uncollapseFeedback:function(n,o){g.uncollapse(h.find(n,o));},multiContentReplaceGlobal:function(n,o){this.multiContentReplace(document.documentElement,n,o);},multiContentReplace:function(n,o,p){p=p instanceof i?p.getRootNode():p;h.scry(n,o).forEach(function(q){l.replace(q,p.cloneNode(true));});},refocusCommentBox:function(n,o){var p=h.find(n,'textarea');p.value=p.style.height="";if(o){p.blur();p.focus.defer();}else document.documentElement.onfocusin({target:p});},resetMentionsInput:function(n){var o=j.getInstance(h.find(n,'div.uiMentionsInput'));o&&o.reset();},insertAtBottom:function(n,o,p,q){var r=h.scry(n,'.comment_'+p).length;if(o)r+=h.scry(n,'#'+o).length;if(!r){var s=h.find(n,'.commentList'),t=k.getInstance(s),u=t&&t.isScrolledToBottom();l.appendContent(s,q);u&&t.scrollToBottom(false);}},updateUnsubscribeLink:function(n,o){var p=h.scry(n,'.unsub_link')[0];if(p){h.replace(p,o);}else h.insertAfter(h.find(n,'.comment_link')," \xB7 "+o);}};e.exports=m;});
function ufi_add_ft_hidden_node(a){if(a.link_data)return;var b=collect_data_attribs(a,['ft']).ft;if(count(b)){var c=$N('input',{type:'hidden',name:'link_data',value:JSON.stringify(b)});a.appendChild(c);}}function ufi_add_all_link_data(){Bootloader.loadComponents('dom-collect',function(){DOM.scry(document.body,'form.commentable_item').forEach(ufi_add_ft_hidden_node);});}function question_add_all_link_data(){Bootloader.loadComponents('dom-collect',function(){DOM.scry(document.body,'form.fbEigenpollForm').forEach(ufi_add_ft_hidden_node);DOM.scry(document.body,'form.fbQuestionPollForm').forEach(ufi_add_ft_hidden_node);});}
__d("UIPagelet",["DOM","AjaxPipeRequest","AsyncRequest","copyProperties","HTML"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('AjaxPipeRequest'),i=b('AsyncRequest'),j=b('copyProperties'),k=b('HTML');function l(m,n,o,p){this._id=m||null;this._element=ge(m||g.$N('div'));this._src=n||null;this._context_data=o||{};this._data=p||{};this._handler=bagofholding;this._request=null;this._use_ajaxpipe=false;this._is_bundle=true;this._allow_cross_page_transition=false;this._append=false;return this;}l.loadFromEndpoint=function(m,n,o,p){p=p||{};var q='/ajax/pagelet/generic.php/';if(p.intern)q='/intern'+q;var r=(q+m).replace(/\/+/g,'/');if(p.subdomain)r=URI(r).setSubdomain(p.subdomain);var s=new l(n,r,o).setUseAjaxPipe(p.usePipe).setBundleOption(m.substring(0,8)!='/intern/'&&p.bundle!==false).setAppend(p.append).setJSNonBlock(p.jsNonblock).setDisplayCallback(p.displayCallback).setConstHeight(p.constHeight).setAllowCrossPageTransition(p.crossPage);p.handler&&s.setHandler(p.handler);s.go();return s;};j(l.prototype,{getElement:function(m){m=m||false;if(m)this._element=ge(this._id);return this._element;},setHandler:function(m){this._handler=m;return this;},go:function(m,n){if(arguments.length>=2||typeof m=='string'){this._src=m;this._data=n||{};}else if(arguments.length==1)this._data=m;this.refresh();return this;},setAllowCrossPageTransition:function(m){this._allow_cross_page_transition=m;return this;},setBundleOption:function(m){this._is_bundle=m;return this;},refresh:function(m){var n=function(q){this._request=null;if(m&&this._id)this._element=ge(this._id);var r=k(q.getPayload());if(this._append){g.appendContent(this._element,r);}else g.setContent(this._element,r);this._handler();}.bind(this);if(this._use_ajaxpipe){this._request=new h();this._request.setCanvasId(this._id).setAppend(this._append).setConstHeight(this._constHeight).setJSNonBlock(this._jsNonblock).setDisplayCallback(this._displayCallback);}else{var o=this._displayCallback;this._request=new i().setMethod('GET').setReadOnly(true).setOption('bundle',this._is_bundle).setHandler(function(q){if(o){o(n.curry(q));}else n(q);});}var p={};j(p,this._context_data);j(p,this._data);this._request.setURI(this._src).setAllowCrossPageTransition(this._allow_cross_page_transition).setData({data:JSON.stringify(p)}).send();return this;},cancel:function(){if(this._request)this._request.abort();},setUseAjaxPipe:function(m){this._use_ajaxpipe=!!m;return this;},setAppend:function(m){this._append=!!m;return this;},setJSNonBlock:function(m){this._jsNonblock=!!m;return this;},setDisplayCallback:function(m){this._displayCallback=m;return this;},setConstHeight:function(m){this._constHeight=!!m;return this;}});a.UIPagelet=e.exports=l;},3);
__d("Scrollable",["event-extensions","Parent","UserAgent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Parent'),h=b('UserAgent'),i=function(event){var k=g.byClass(event.getTarget(),'scrollable');if(!k)return;if((typeof event.axis!=='undefined'&&event.axis===event.HORIZONTAL_AXIS)||(event.wheelDeltaX&&!event.wheelDeltaY)){event.prevent();return;}var l=event.wheelDelta?event.wheelDelta:-event.detail,m=k.scrollHeight,n=k.clientHeight;if(m>n){var o=k.scrollTop;if((l>0&&o===0)||(l<0&&o>=m-n)){event.prevent();}else if(h.ie()<9)if(k.currentStyle){var p=k.currentStyle.fontSize;if(p.indexOf('px')<0){var q=document.createElement('div');q.style.fontSize=p;q.style.height='1em';p=q.style.pixelHeight;}else p=parseInt(p,10);k.scrollTop=o-Math.round(l/120*p);event.prevent();}}},j=document.documentElement;if(h.firefox()){j.addEventListener('DOMMouseScroll',i,false);}else Event.listen(j,'mousewheel',i);});
__d("legacy:Toggler",["Toggler"],function(a,b,c,d){a.Toggler=b('Toggler');},3);
__d("legacy:MentionsInput",["MentionsInput"],function(a,b,c,d){a.MentionsInput=b('MentionsInput');},3);
__d("legacy:Selector",["Selector"],function(a,b,c,d){a.Selector=b('Selector');},3);
__d("legacy:ScrollableArea",["ScrollableArea"],function(a,b,c,d){a.ScrollableArea=b('ScrollableArea');},3);
__d("legacy:ContextualDialogX",["ContextualDialogX"],function(a,b,c,d){a.ContextualDialogX=b('ContextualDialogX');},3);
__d("legacy:Tooltip",["Tooltip"],function(a,b,c,d){a.Tooltip=b('Tooltip');},3);
__d("TypeaheadAreaCore",["Class","InputSelection","TypeaheadCore","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('InputSelection'),i=b('TypeaheadCore'),j=b('copyProperties');function k(l){this.parent.construct(this,l);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}g.extend(k,i);j(k.prototype,{prefix:'',suffix:', ',matcher:"\\b[^,]*",click:bagofholding,select:function(l){this.parent.select(l);var m=this.element.value,n=this.prefix+l.text+this.suffix;this.expandBounds(m,n);var o=m.substring(0,this.start),p=m.substring(this.end);this.element.value=o+n+p;h.set(this.element,o.length+n.length);},expandBounds:function(l,m){l=l.toLowerCase().trim();m=m.toLowerCase();var n,o,p,q,r=/\s/;o=l.substring(this.start,this.end);p=m.indexOf(o);n=this.start;while(n>=0&&p>=0){q=l.charAt(n-1);if(!q||r.test(q))this.start=n;o=q+o;p=m.indexOf(o);n--;}o=l.substring(this.start,this.end);p=m.indexOf(o);n=this.end;while(n<=l.length&&p>=0){q=l.charAt(n);if(!q||r.test(q))this.end=n;o=o+q;p=m.indexOf(o);n++;}},getRawValue:function(){var l=h.get(this.element).start||0;return this.parent.getValue().substring(0,l);},getValue:function(){var l=this.matcher&&this.matcher.exec(this.getRawValue());if(!l)return '';var m=l[0],n=l.index+m.length;m=m.replace(/^\s/,'');var o=m.length;m=m.replace(/\s$/,'');var p=o-m.length;this.start=n-o;this.end=n+p;return l[1]||l[0];}});e.exports=k;});
__d("TypeaheadMetrics",["event-extensions","AsyncRequest","copyProperties","Typeahead"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('copyProperties'),i=b('Typeahead');function j(k){this.extraData={};h(this,k);}h(j.prototype,{endPoint:'/ajax/typeahead/record_basic_metrics.php',init:function(k){this.init=bagofholding;this.core=k.getCore();this.view=k.getView();this.data=k.getData();this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();},_reset:function(){this.stats={};this.avgStats={};this.sessionActive=false;this.sid=Math.floor(Date.now()*Math.random());this.data.setQueryData({sid:this.sid});},recordSelect:function(k){var l=k.selected;if(l.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',l.uid);this.recordStat('selected_type',l.type);this.recordStat('selected_position',k.index);this.recordStat('selected_with_mouse',k.clicked?1:0);this._sessionEnd();},bindSessionStart:function(k,event,l){if(l)for(var m=0;m<this._sessionStartEvents.length;++m){var n=this._sessionStartEvents[m];n.obj.unsubscribe(n.token);}this._sessionStartEvents.push({obj:k,token:k.subscribe(event,function(o,p){this._sessionStart();}.bind(this))});},bindSessionEnd:function(k,event,l){if(l)for(var m=0;m<this._sessionEndEvents.length;++m){var n=this._sessionEndEvents[m];n.obj.unsubscribe(n.token);}this._sessionEndEvents.push({obj:k,token:k.subscribe(event,function(o,p){this._sessionEnd();}.bind(this))});},initEvents:function(){this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(k,l){this.recordSelect(l);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(k,l){this.results=l;}.bind(this));this.data.subscribe('beforeQuery',function(k,l){if(!l.value)return;this.query=l.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('beforeFetch',function(k,l){if(l.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else l.fetch_context.queryBegin=Date.now();}.bind(this));this.data.subscribe('fetchComplete',function(k,l){if(l.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);var m={};l.response.payload.entries.forEach(function(n){if(!m[n.type]){m[n.type]=1;}else m[n.type]++;});this.recordStat('bootstrap_response_types',m);this.bootstrapped=true;}else this.recordAvgStat('avg_query_latency',Date.now()-l.fetch_context.queryBegin);}.bind(this));this.data.subscribe('dirty',function(k,l){this.bootstrapped=false;});},_sessionStart:function(){if(this.sessionActive)return;this.sessionActive=true;},_sessionEnd:function(){if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();},recordStat:function(k,l){this.stats[k]=l;},recordCountStat:function(k){var l=this.stats[k];this.stats[k]=l?l+1:1;},recordAvgStat:function(k,l){if(this.avgStats[k]){this.avgStats[k][0]+=l;++this.avgStats[k][1];}else this.avgStats[k]=[l,1];},submit:function(){if(Object.keys(this.stats).length){h(this.stats,this.extraData);if(this.results){var k=(this.results).map(function(n,o){return n.uid;});this.recordStat('candidate_results',JSON.stringify(k));}if(this.query)this.recordStat('query',this.query);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var l in this.avgStats){var m=this.avgStats[l];this.stats[l]=m[0]/m[1];}new g().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).send();this._reset();}}});j.register=function(k,l,m){if(document.activeElement===k){l.init(m);}else var n=Event.listen(k,'focus',function(){l.init(m);n.remove();});};e.exports=j;});
__d("TypeaheadHoistFriends",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._typeahead=i;}g(h.prototype,{_subscription:null,enable:function(){var i=this._typeahead.getView();this._subscription=i.subscribe('beforeRender',function(j,k){var l=[],m=[];for(var n=0;n<k.results.length;++n){var o=k.results[n];if(o.type=='user'&&o.bootstrapped){m.push(o);}else l.push(o);}k.results=m.concat(l);});},disable:function(){this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;}});e.exports=h;});
__d("legacy:HoistFriendsTypeaheadBehavior",["TypeaheadHoistFriends"],function(a,b,c,d){var e=b('TypeaheadHoistFriends');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.hoistFriends=function(f){f.enableBehavior(e);};},3);
__d("CompactTypeaheadRenderer",["DOM"],function(a,b,c,d,e,f){var g=b('DOM');function h(i,j){var k=[],l=i.photo;if(l){if(l instanceof Array){var m=[g.create('span',{className:'splitpic leftpic'},[g.create('img',{alt:'',src:l[0]})]),g.create('span',{className:'splitpic'+(l[2]?' toppic':'')},[g.create('img',{alt:'',src:l[1]})])];if(l[2])m.push(g.create('span',{className:'splitpic bottompic'},[g.create('img',{alt:'',src:l[2]})]));l=g.create('span',{className:'splitpics clearfix'},m);}else l=g.create('img',{alt:'',src:l});k.push(l);}if(i.text)k.push(g.create('span',{className:'text'},[i.text]));var n=i.subtext,o=i.category;if(n||o){var p=[];n&&p.push(n);n&&o&&p.push(" \u00b7 ");o&&p.push(o);k.push(g.create('span',{className:'subtext'},p));}var q=g.create('li',{className:i.type||''},k);q.setAttribute('role','option');if(i.text)q.setAttribute('aria-label',i.text);return q;}h.className='compact';e.exports=h;});
__d("FileForm",["event-extensions","ArbiterMixin","AsyncRequest","AsyncResponse","DataStore","Env","Form","JSONPTransport","URI","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('AsyncResponse'),j=b('DataStore'),k=b('Env'),l=b('Form'),m=b('JSONPTransport'),n=b('URI'),o=b('copyProperties');function p(q){this._form=q;this._form.enctype=this._form.encoding='multipart/form-data';this._listener=Event.listen(this._form,'submit',this.submit.bind(this));j.set(this._form,'FileForm',this);}p.getInstance=function(q){return j.get(q,'FileForm');};o(p.prototype,g,{setAllowCrossDomain:function(q){this._allowCrossDomain=q;return this;},submit:function(event){this.inform('submit');l.setDisabled.curry(this._form,true).defer();var q='FormData' in window;if(q)if(!n(this._form.action).isSameOrigin()&&!this._allowCrossDomain)q=false;return q?this._sendViaXHR(event):this._sendViaFrame(event);},_sendViaFrame:function(event){var q=new h();q.setStatusElement(this._form);q.addStatusIndicator();q.setOption('useIframeTransport',true);var r=q.handleResponse.bind(q),s=new m('iframe',this._form.action,r),t=s.createTransportFrame(),u=s.getRequestURI().addQueryData({__iframe:true,__user:k.user});this._form.setAttribute('action',u.toString());this._form.setAttribute('target',t.name);q.setURI(u);q.setHandler(this.success.bind(this));q.setErrorHandler(this.failure.bind(this));q.setInitialHandler(l.setDisabled.curry(this._form,false));q.setFinallyHandler(l.setDisabled.curry(this._form,false));},_sendViaXHR:function(event){new h(this._form.action).setMethod(this._form.method).setRawData(new FormData(this._form)).setStatusElement(this._form).setHandler(this.success.bind(this)).setErrorHandler(this.failure.bind(this)).setUploadProgressHandler(this.progress.bind(this)).setInitialHandler(l.setDisabled.curry(this._form,false)).setFinallyHandler(l.setDisabled.curry(this._form,false)).send();return false;},success:function(q){if(this.inform('success',q)!==false)Event.fire(this._form,'success',{response:q});},failure:function(q){if(this.inform('failure',q)!==false)if(Event.fire(this._form,'error',{response:q})!==false)i.defaultErrorHandler(q);},progress:function(event){this.inform('progress',event);},destroy:function(){this._listener.remove();this._listener=null;this._form.enctype=this._form.encoding=null;j.remove(this._form,'FileForm');}});e.exports=p;});
__d("URLScraper",["event-extensions","ArbiterMixin","Class","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('copyProperties');function j(ea){this.input=ea;this.enable();}i(j.prototype,g,{reset:function(){this.lastMatch=null;},enable:function(){if(this.events)return;var ea=function(fa){setTimeout(this.check.bind(this,fa),30);};this.events=Event.listen(this.input,{paste:ea.bind(this,false),keydown:ea.bind(this,true)});},disable:function(){if(!this.events)return;for(var event in this.events)this.events[event].remove();this.events=null;},check:function(ea){var fa=this.input.value;if(ea&&j.trigger(fa))return;var ga=j.match(fa);if(ga&&ga!=this.lastMatch){this.lastMatch=ga;this.inform('match',{url:ga});}}});var k='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',l='\u2000-\u206F\u00ab\u00bb',m='(?:[1-9]?[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])',n='(?:(?:ht|f)tps?)://',o='(?:(?:'+m+'[.]){3}'+m+')',p='(?:\\b)www\\d{0,3}[.]',q='[^\\s'+k+l+']',r='(?:(?:[.:\\-_%@]|'+q+')*'+q+')',s='(?:[.][a-z]{2,4})',t='(?::\\d+){0,1}',u='(?=[\/?#])',v='(?:'+'(?:'+n+r+t+')|'+'(?:'+o+t+')|'+'(?:'+p+r+s+t+')|'+'(?:'+r+s+t+u+')'+')',w='[\/#?]',x='\\([^\\s()<>]+\\)',y='[^\\s()<>]+',z='[^\\s'+k+l+']',aa='(?:'+'(?:'+w+')'+'(?:'+'(?:'+x+'|'+y+')*'+'(?:'+x+'|'+z+')'+')*'+')*',ba=new RegExp('('+'(?:'+v+')'+'(?:'+aa+')'+')','im'),ca=new RegExp('('+'(?:'+n+r+t+')|'+'(?:'+p+r+s+t+')'+')'),da=/[\s'";]/;j.match=function(ea){var fa=(ba.exec(ea)||[])[1]||null;if(fa&&fa.indexOf('@')!=-1){return (ca.exec(fa))?fa:null;}else return fa;};j.trigger=function(ea){return !da.test(ea.charAt(ea.length-1));};e.exports=j;});
__d("Composer",["function-extensions","Arbiter","ArbiterMixin","Button","Class","CSS","DOM","FileForm","HTML","Input","PageTransitions","Parent","Run","ServerJS","URI","URLScraper","$","copyProperties","ge","tx","event-extensions"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Button'),j=b('Class'),k=b('CSS'),l=b('DOM'),m=b('FileForm'),n=b('HTML'),o=b('Input'),p=b('PageTransitions'),q=b('Parent'),r=b('Run'),s=b('ServerJS'),t=b('URI'),u=b('URLScraper'),v=b('$'),w=b('copyProperties'),x=b('ge'),y=b('tx'),z=b('event-extensions').$E,aa=1,ba=4,ca={},da=function(){var ha=l.scry(this.root,'span.linkAttachment')[0];if(!ha&&this.isMetaComposer)ha=l.scry(this.root,'span.attachmentAcceptsLink')[0];if(!ha)return;var ia=q.byTag(ha,'form');this.scraper=new u(this.input);this.scraper.subscribe('match',function(ja,ka){if(this.isMetaComposer){var la=this.form.xhpc_targetid,ma=new t('/ajax/metacomposer/attachment/link/scraper.php');ma.addQueryData({scrape_url:encodeURIComponent(ka.url),targetid:la.value});ia.action=ma.toString();}else{k.show(ha);ia.action='/ajax/composer/attachment/link/scraper.php?scrape_url='+encodeURIComponent(ka.url);}ia.xhpc.value=ha.id;ia.xhpc.disabled=false;ia.xhpc.click();}.bind(this));this.isMetaComposer&&this.scraper.check();},ea=function(ha){if(this.inform('submit')===false){ha.kill();return false;}if(this.submitHandler)return (new Function(this.submitHandler)).apply(this.form);};function fa(ha,ia,ja,ka){ca[ha.id]=this;this.root=ha;this.resetCfg=ia;this.dataSource=ka;this.lazyEndpoint=this.resetCfg&&this.resetCfg.lazyEndpoint;this.focus=l.find(ha,'div.focus_target');this.form=l.find(ha,'form.attachmentForm');this.content=l.find(ha,'div.attachmentContent');this.isMetaComposer=ja;if(this.isMetaComposer){this.messageBox=l.find(ha,'div.uiMetaComposerMessageBox');this.metaArea=l.find(ha,'div.attachmentMetaArea');this.bottomArea=l.find(ha,'div.attachmentBottomArea');this.barArea=l.find(ha,'div.attachmentBarArea');this.blurb=l.find(ha,'div.uiMetaComposerMessageBox div.textBlurb');this.input=l.find(ha,'div.uiMetaComposerMessageBox textarea.input');this.button=l.find(ha,'div.uiMetaComposerMessageBox label.submitBtn');this.privacy=l.find(ha,'div.uiMetaComposerMessageBox li.privacyWidget');}else{this.blurb=l.find(ha,'div.uiComposerMessageBox div.textBlurb');this.input=l.find(ha,'div.uiComposerMessageBox textarea.input');this.button=l.find(ha,'div.uiComposerMessageBox label.submitBtn');this.privacy=l.find(ha,'div.uiComposerMessageBox li.privacyWidget');}Event.listen(this.form,'submit',ea.bind(this));if(this.isMetaComposer){Event.listen(this.input,'focus',this.onFocus.bind(this));if(q.byClass(this.input,'child_was_focused'))this.onFocus.bind(this).defer();}g.inform('xhpc/construct/'+ha.id,this,g.BEHAVIOR_STATE);}w(fa.prototype,h,{init:function(ha){this.mentionsInput=ha;if(this.mentionsInput)this.mentionsInput.subscribe('init',function(){var ia=this.mentionsInput.getTypeahead().getView();ia.subscribe(['reset','render'],function(ja){k.conditionClass(this.root,'uiComposerMention',(ja=='render'));}.bind(this));}.bind(this));da.call(this);this.inform('init',null,g.BEHAVIOR_PERSISTENT);r.onBeforeUnload(this._handleUnsavedChanges.bind(this));},setBlurb:function(ha){l.setContent(this.blurb,ha);},setEnabled:function(ha){i.setEnabled(this.button,ha);},setLoading:function(ha){k.conditionClass(this.root,'async_saving',!!ha);},setContentVisible:function(ha){k.conditionClass(this.root,'uiComposerHideContent',!ha);},setMessageBoxVisible:function(ha){k.conditionClass(this.root,'uiComposerHideMessageBox',!ha);},setInputVisible:function(ha){k.conditionClass(this.root,'uiComposerHideInput',!ha);},setTopicTaggerVisible:function(ha){k.conditionClass(this.root,'uiTagComposerHidden',!ha);},mutate:function(ha){var ia=x(ha.xhpc);if(ia){var ja=l.scry(this.root,'.uiComposerAttachmentSelected')[0];if(ha.confirmAugmentation&&ja!==ia)return;ja&&k.removeClass(ja,'uiComposerAttachmentSelected');k.addClass(ia,'uiComposerAttachmentSelected');if(!ha.disableCache)Event.listen(ia,'click',function(la){z(la).stop();ha.disableCache=true;this.mutate(ha);}.bind(this));}if(!ha.keepContentAreas){this.setContentVisible(false);l.empty(this.content);if(this.isMetaComposer){this.mentionsInput&&this.mentionsInput.setAuxContent(null);l.empty(this.metaArea);l.empty(this.bottomArea);l.empty(this.barArea);}}if(ha.content){l.setContent(this.content,n(ha.content));this.setContentVisible(true);}if(this.isMetaComposer){ha.metaContent&&l.setContent(this.metaArea,n(ha.metaContent));ha.bottomContent&&l.setContent(this.bottomArea,n(ha.bottomContent));ha.barContent&&l.setContent(this.barArea,n(ha.barContent));}this.setMessageBoxVisible(!ha.messageBoxHidden);k.conditionClass(this.root,'uiComposerWhiteMessageBox',!ha.messageBoxHidden&&!ha.inputHidden&&!ha.content);this.setInputVisible(!ha.inputHidden);k.conditionShow(this.privacy,!ha.privacyWidgetHidden);if(!ha.keepContentAreas){o.setPlaceholder(this.input,ha.placeholder);i.setLabel(this.button,ha.buttonLabel);}this.setBlurb(n(ha.blurb));if(ha.autoscrape){this.scraper&&this.scraper.enable();}else this.scraper&&this.scraper.disable();this.setEnabled(!ha.disabled);this.setTopicTaggerVisible(!ha.hideTopicTagger);this.form.setAttribute('action',ha.endpoint);if(ha.formType==aa){this.form.setAttribute('rel','async');}else this.form.removeAttribute('rel');this.form.removeAttribute('target');if(ha.formType==ba){if(!this._fileForm){this._fileForm=new m(this.form);this._fileForm.subscribe('failure',this.setLoading.bind(this,false));}}else if(this._fileForm){this._fileForm.destroy();this._fileForm=null;}this.submitHandler=ha.submitHandler;this.lazyEndpoint=ha.lazyEndpoint;k.addClass(this.root,'uiComposerInteracted');k.addClass(this.root,'uiComposerOpen');if(ha.messageBoxFocused){var ka=document.activeElement;if(ka===document.body||q.byClass(ka,'attachmentLink'))this.focusInput.bind(this).defer();}g.inform('composer/mutate',this);},subscribeToMutate:function(ha){return g.subscribe('composer/mutate',function(ia,ja){if(ja===this)ha();}.bind(this));},unsubscribeFromMutate:function(ha){ha.unsubscribe();},reset:function(ha){if(!ha){o.reset(this.input);this.mentionsInput&&this.mentionsInput.reset();this.scraper&&this.scraper.reset();}if(this.isMetaComposer){l.empty(this.metaArea);l.empty(this.bottomArea);l.empty(this.barArea);}if(this.resetCfg){this.mutate(this.resetCfg);}else{var ia=l.scry(this.root,'.uiComposerAttachmentSelected')[0];if(ia)k.removeClass(ia,'uiComposerAttachmentSelected');}k.removeClass(this.root,'uiComposerInteracted');k.setClass(this.focus,'focus_target');this.setLoading(false);g.inform('composer/reset');},onFocus:function(){if(this.lazyEndpoint){var ha=l.find(this.root,'form.attachmentSelectForm'),ia=new t(this.lazyEndpoint);ia.addQueryData({isAugmentation:true});ha.action=ia.toString();var ja=l.scry(this.root,'.uiComposerAttachmentSelected')[0];ha.xhpc.value=ja&&ja.id;ha.xhpc.click();k.removeClass.curry(this.root,'async_saving').defer();}this.inform('focus');},focusInput:function(){o.focus(this.input);},getInput:function(){return this.input;},updateDataSourceToken:function(ha){if(this.dataSource)this.dataSource.updateToken(ha);},_handleUnsavedChanges:function(){var ha=p.getNextURI();if(ha.getQueryData().hasOwnProperty('theater'))return;if(this.input.offsetParent!==null&&!o.isEmpty(this.input)&&!(a.Dialog&&a.Dialog.getCurrent()))return "Julkaisusi ei ole viel\u00e4 valmis. Haluatko poistua julkaisematta?";}});var ga;w(fa,{setNodeToConfigure:function(ha){ga=ha;},configure:function(ha,ia,ja){var ka=q.byClass(ga,'uiComposer').id,la=g.subscribe('xhpc/construct/'+ka,function(ma,na){(function(){la.unsubscribe();}).defer();na.mutate(ha);na.subscribe('init',function(){new s().handle(ia);new Function(ja)();if(ha.attachmentJS)new Function(ha.attachmentJS).call(na);});});},publish:function(ha,ia){ia=ia||{};ia.composer=fa.getInstance(ha);ia.composer.reset(false);if(ia.streamNode){ia.streamStory=ia.streamNode;}else if(ia.streamMarkup)ia.streamStory=n(ia.streamMarkup).getRootNode();g.inform('composer/publish',ia);},finish:function(ha){fa.getInstance(ha).setLoading(false);},getInstance:function(ha){var ia=q.byClass(v(ha),'uiComposer');return ia?ca[ia.id]:null;}});e.exports=fa;});
__d("legacy:Composer",["Composer"],function(a,b,c,d){a.Composer=b('Composer');},3);
function MetaComposerMessageBox(){}copy_properties(MetaComposerMessageBox.prototype,{init:function(a,b){this.inputContainer=DOM.scry(a,'div.inputContainer')[0];this.textInput=DOM.scry(a,'textarea.mentionsTextarea')[0];this.metaArea=DOM.scry(a,'div.attachmentMetaArea')[0];this.bottomArea=DOM.scry(a,'div.attachmentBottomArea')[0];this.barArea=DOM.scry(a,'div.attachmentBarArea')[0];Event.listen(this.inputContainer,'click',function(c){var d=c.getTarget();if(!DOM.contains(this.metaArea,d)&&d!==this.textInput)this.textInput.focus();}.bind(this));}});
__d("FullScreen",["event-extensions","Arbiter","CSS","UserAgent","copyProperties","throttle"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('CSS'),i=b('UserAgent'),j=b('copyProperties'),k=b('throttle'),l=j(new g(),{listenForEvent:function(m){var n=k(this.onChange,0,this);Event.listen(m,{webkitfullscreenchange:n,mozfullscreenchange:n,fullscreenchange:n});Event.listen(document,{webkitfullscreenchange:n,mozfullscreenchange:n,fullscreenchange:n});},enableFullScreen:function(m){this.listenForEvent(m);if(m.webkitRequestFullScreen){if(i.chrome()){m.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);}else m.webkitRequestFullScreen();}else if(m.mozRequestFullScreen){m.mozRequestFullScreen();}else if(m.requestFullScreen){m.requestFullScreen();}else return false;return true;},disableFullScreen:function(){if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.exitFullScreen){document.exitFullScreen();}else return false;return true;},isFullScreen:function(){return (document.webkitIsFullScreen||document.fullScreen||document.mozFullScreen);},toggleFullScreen:function(m){if(this.isFullScreen()){this.disableFullScreen();return false;}else return this.enableFullScreen(m);return false;},onChange:function(){var m=this.isFullScreen();h.conditionClass(document.body,'fullScreen',m);this.inform('changed');},isSupported:function(){return (document.webkitCancelFullScreen&&i.chrome())||document.mozCancelFullScreen||document.cancelFullScreen||document.exitFullScreen;}});e.exports=l;});
__d("PhotoSessionLog",["AsyncRequest","Run","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Run'),i=b('Vector'),j=b('copyProperties');function k(){}j(k,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWLIFT:6,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,buttonLikes:0,pagingAction:'',initLogging:function(l){this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=true;this.last=false;this.logIds=false;this.version=l;this.buttonLikes=0;this.pagingAction='';if(l===k.SNOWLIFT){var m=i.getViewportDimensions();this.width=m.x;this.height=m.y;}},setLogFbids:function(l){this.logIds=l;},setPhotoSet:function(l){this.set=l;},addButtonLike:function(){this.buttonLikes++;},setPagingAction:function(l){this.pagingAction=l;},addPhotoView:function(l,m,n){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(l)this.fbidList.push([l.fbid,l.owner,Date.now()]);if(m)this.hiResLoads++;if(n)this.fullScreenViews[l.fbid]=true;},logEnterFullScreen:function(l){this.fullScreenViews[l]=true;},addDetailData:function(l,m){if(!this.details[l])this.details[l]={t:m.num_tags,l:m.has_location,c:m.has_caption,cm:m.comment_count,lk:m.like_count,w:m.width,h:m.height,ad:'{}',p:this.pagingAction};},updateAdData:function(l,m){if(this.details[l])this.details[l].ad=JSON.stringify(m);},logPhotoViews:function(l){if((!this.views)||(this.version===k.SNOWLIFT&&l==k.LEAVE))return;if(l!=this.AGGREGATE)this.last=true;var m={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},first:this.first,last:this.last,close:l?l:this.UNKNOWN,button_likes:this.buttonLikes,version:this.version};if(this.version===k.SNOWLIFT){var n=i.getViewportDimensions();m.width=n.x||this.width;m.height=n.y||this.height;if(this.hiResLoads>0)m.hires_loads=this.hiResLoads;if(this.last){var o=Object.keys(this.fullScreenViews).length;if(o>0)m.fullscreen=o;}}new g().setURI('/ajax/photos/logging/session_logging.php').setAllowCrossPageTransition(true).setOption('asynchronous',(l!=k.UNLOAD)).setOption('suppressErrorHandlerWarning',true).setData(m).send();this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;this.fullScreenViews={};}}});h.onUnload(function(){k.logPhotoViews(k.UNLOAD);});h.onLeave(function(){k.logPhotoViews(k.LEAVE);});e.exports=k;});
__d("PhotosConst",[],function(a,b,c,d,e,f){var g={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,BULK_EDITOR:3,FLASH_UPLOADER:4,SIZE_NORMAL:'n'};e.exports=g;});
__d("PhotosUtils",["copyProperties","Rect","Vector"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('Rect'),i=b('Vector');function j(){}g(j,{getNearestBox:function(k,l){var m=Infinity,n=null;for(var o in k){var p=k[o];if(p.contains(l)){var q=l.distanceTo(p.getCenter());if(q<m){m=q;n=o;}}}return n;},absoluteToNormalizedPosition:function(k,l){var m=i.getElementPosition(k),n=i.getElementDimensions(k),o=l.sub(m).mul(100/n.x,100/n.y);o.domain='pure';return o;},normalizedToAbsolutePosition:function(k,l){var m=i.getElementPosition(k),n=i.getElementDimensions(k),o=l.mul(n.x/100,n.y/100).add(m);o.domain='document';return o;}});e.exports=j;});
__d("PhotoStreamCache",["array-extensions","HTML","PhotosConst","Rect","UIPagelet","URI","Vector","copyProperties","createArrayFrom"],function(a,b,c,d,e,f){b('array-extensions');var g=b('HTML'),h=b('PhotosConst'),i=b('Rect'),j=b('UIPagelet'),k=b('URI'),l=b('Vector'),m=b('copyProperties'),n=b('createArrayFrom');function o(){}m(o,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1});m(o.prototype,{init:function(p,q){this.version=p;this.pageletName=q;this.bufferSize=o.BUFFER_SIZE;this.fullBucketSize=o.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.leftLock=false;this.rightLock=false;this.reset();},reset:function(){this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;},destroy:function(){this.reset();this.isActive=false;},isLoaded:function(){return this.loaded;},canPage:function(){if(this.totalCount!==null)return this.totalCount>1;return this.getLength()>1;},errorInCurrent:function(){if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());},getLength:function(){return this.fbidList.length;},getPhotoSet:function(){return this.photoSetQuery.set;},getPhotoSetQuery:function(){return this.photoSetQuery;},getCurrentImageData:function(){return this.getImageData(this.getCursor());},getImageData:function(p){return this.getCacheContent(p,o.IMAGE_DATA);},getCurrentHtml:function(){return this.getCacheContent(this.getCursor(),o.HTML);},getCurrentExtraData:function(){return this.getCacheContent(this.getCursor(),o.EXTRA);},getCacheContent:function(p,q){if(!p||p===o.ERROR_ID)return null;return this.cache[q][p];},getCursorPos:function(){return this.position;},getCursor:function(){if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;},getCursorForURI:function(p){return this.permalinkMap[p];},calculatePositionForMovement:function(p){var q=this.position+p;if(this.allLoaded){var r=this.getLength();q=(r+q%r)%r;}return q;},isValidMovement:function(p){if(!this.isLoaded()||!this.canPage())return false;var q=this.calculatePositionForMovement(p);return this.getCursor()>0||(q>=0&&q<this.getLength());},moveCursor:function(p){if(!this.isValidMovement(p))return;this.position=this.calculatePositionForMovement(p);if(p!==0)this.loadMoreIfNeccessary(p>0);},checkErrorAt:function(p){if(!this.isLoaded())return false;if(p===o.ERROR_ID)return true;return false;},getRelativeMovement:function(p){for(var q=0;q<this.getLength();q++)if(this.fbidList[q]==p)return q-this.position;return null;},preloadImages:function(p){var q,r,s=this.getLength(),t=this.cache.image,u=o.BUFFER_SIZE;if(s>u*2){q=(this.position+s-u%s)%s;r=(this.position+u)%s;}else{q=0;r=s-1;}while(q!=r){var v=this.fbidList[q];if(t[v]&&t[v].url)if(p&&!t[v].resource){t[v].resource=new Image();t[v].resource.src=t[v].url;}else if(!p&&!t[v].small){t[v].small=new Image();t[v].small.src=t[v].smallurl||t[v].url;}q=(q+1)%s;}},loadMoreIfNeccessary:function(p){if(this.allLoaded||(p&&this.rightLock)||(!p&&this.leftLock))return;var q=p?1:-1,r=this.position+this.bufferSize*q;if(r<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(r>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}},getEndCursor:function(p){return p?this.fbidList[this.getLength()-1]:this.fbidList[0];},calculateRelativeIndex:function(p,q,r){if(!this.totalCount)return null;var s=this.fbidList.indexOf(q),t=this.fbidList.indexOf(r);if(s===-1||t===-1)return null;var u=t-s;return (p+u+this.totalCount)%this.totalCount;},fetch:function(p,q){var r=this.getEndCursor(q),s=m({cursor:r,version:this.version,end:this.getEndCursor(!q),fetchSize:q?p:-1*p},this.photoSetQuery);if(this.totalCount&&this.firstCursorIndex!==null){s.total=this.totalCount;s.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,r);}j.loadFromEndpoint(this.pageletName,null,s,{usePipe:true,jsNonblock:true,crossPage:true});},storeToCache:function(p){var q={};if(!this.isActive)return q;if('error' in p){this.processErrorResult(p.error);q.error=true;return q;}if('init' in p){this.processInitResult(p.init);q.init={logids:p.init.logids,fbid:p.init.fbid,loggedin:p.init.loggedin,fromad:p.init.fromad};}if('image' in p){this.processImageResult(p.image);q.image=true;}if('data' in p){this.processDataResult(p.data);q.data=true;}return q;},processInitResult:function(p){if(this.loaded)return;this.loaded=true;this.photoSetQuery=p.query;if(p.bufferSize)this.bufferSize=p.bufferSize;if(p.fullBucketSize)this.fullBucketSize=p.fullBucketSize;this.fbidList.push(p.fbid);this.firstCursor=p.fbid;if('initIndex' in p&&'totalCount' in p){this.firstCursorIndex=p.initIndex;this.totalCount=p.totalCount;}this.rightLock=true;if(this.version==h.VIEWER_PERMALINK)this.fetch(o.INIT_BUCKET_SIZE,true);},processImageResult:function(p){for(var q in p){this.cache.image[q]=p[q];if(p[q].dimensions)this.cache.image[q].dimensions=l.deserialize(p[q].dimensions);if(p[q].smalldims)this.cache.image[q].smalldims=l.deserialize(p[q].smalldims);this.permalinkMap[k(p[q].info.permalink).getUnqualifiedURI().toString()]=q;}},attachToFbidsList:function(p,q,r){if(this.allLoaded)return;if(q===-1){for(var s=p.length-1;s>=0;s--){this.fbidList.unshift(p[s]);this.position++;}this.leftLock=false;}else{for(var t=0;t<p.length;t++)this.fbidList.push(p[t]);this.rightLock=false;}if(r)this.setAllLoaded();},setAllLoaded:function(){this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);},processDataResult:function(p){for(var q in p){if(!this.cache.html[q])this.cache.html[q]={};for(var r in p[q].html){var s=p[q].html[r];if(typeof s==='string')s=g(s).getRootNode();this.cache.html[q][r]=n(s.childNodes);}if(!('extra' in p[q])){this.cache.extra[q]=null;continue;}this.cache.extra[q]={tagRects:{}};if(!Array.isArray(p[q].extra.tagRects))for(var t in p[q].extra.tagRects)if(p[q].extra.tagRects[t])this.cache.extra[q].tagRects[t]=i.deserialize(p[q].extra.tagRects[t]);}},processErrorResult:function(p){if(!this.isLoaded()){this.initError=true;return;}var q=p.side,r=[o.ERROR_ID];this.attachToFbidsList(r,q);},setTotalCount:function(p){this.totalCount=p;},setFirstCursorIndex:function(p){this.firstCursorIndex=p;}});e.exports=o;});
__d("PhotoSnowliftAds",["array-extensions","event-extensions","copyProperties","CSS","DataStore","DOM","PhotoSessionLog","UIPagelet","URI","Vector"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('copyProperties'),h=b('CSS'),i=b('DataStore'),j=b('DOM'),k=b('PhotoSessionLog'),l=b('UIPagelet'),m=b('URI'),n=b('Vector'),o=j.$N,p={DEFAULT_UNITS_REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,showSmallerAd:false,egoEnabled:false,refreshUnitsRate:null,adsStatus:'null',adsEvents:{},resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(q,r){if(r)this.adsStatus=q;var s=Date.now();this.adsEvents[q+'_'+s]=s;},init:function(q,r,s){this.reset();this.root=q;this.snowlift=r;this.showSmallerAd=s.showsmallerad;this.egoEnabled=s.ego_enabled;this.minAds=s.min_ads;this.addEvent('init',true);this.refreshUnitsRate=p.DEFAULT_UNITS_REFRESH_RATE;if(s.refresh_fast)this.refreshUnitsRate=s.refresh_rate;},reset:function(){this.lastLoadTime=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(q){this.availableDimensions=q;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(q,r){var s={};q.forEach(function(t){var u=t.root.firstChild.offsetHeight;t.units.forEach(function(w){if(!h.hasClass(w,'hidden')){var x=this.getHeight(w.firstChild,r);u-=x;}}.bind(this));var v={height:u,visible:false};t.units.forEach(function(w){var x=this.getIsAds(w),y=this.getHeight(w.firstChild,r),z=this.getUnitId(w);s[z]={height:y,visible:false,priority:0,is_ads:x,section_ref:v};}.bind(this));}.bind(this));return s;},calculateVisibleUnits:function(q,r,s){var t=0,u=this.getUnitPriority(r);u.forEach(function(v){if(r.hasOwnProperty(v)){var w=r[v],x=w.height;if(!w.section_ref.visible)x+=w.section_ref.height;w.height_below=s-x;w.visible=w.height_below>=0&&x>0;if(w.visible){w.section_ref.visible=true;s-=x;t++;}}}.bind(this));return r;},displayUnits:function(q,r){q.forEach(function(s){var t=false;s.units.forEach(function(u){var v=this.getUnitId(u),w=r[v],x=w.visible,y=w.height_below,z=w.is_ads;h.conditionClass(u,'hidden',!x);t=t||x;this.calcUnitStats(this.units[z][v],x,y);}.bind(this));h.conditionClass(s.root,'hidden',!t);}.bind(this));},getUnitPriority:function(q){var r=[],s=0,t=0;for(var u in q){var v=q[u];r.push(u);var w=this.minAds+s+t;if(v.is_ads){if(t<this.minAds)w=t;t++;}else s++;v.priority=w;}r=r.sort(function(x,y){var z=q[x],aa=q[y];return z.priority-aa.priority;}.bind(this));return r;},updateUnitsStatus:function(){var q=this.availableDimensions.x,r=this.availableDimensions.y,s=this.calculateUnitSizes(this.sections,q);s=this.calculateVisibleUnits(this.sections,s,r);this.displayUnits(this.sections,s);},calcUnitStats:function(q,r,s){var t=Date.now();if(q.visible)q.totalTime+=t-q.lastShowTime;if(q.trackingCode!==null&&q.totalTime>=this.UNITS_REGISTER_DELAY){var u=q.trackingCode;q.trackingCode=null;this.registerImpression(u,q.registerUrl);}q.visible=r;q.heightBelow=s;q.lastShowTime=t;},prepareResize:function(){var q=function(r){var s=o('div',{className:'inner'}),t=o('div',{className:'wrapper'},s);j.replace(r,t);j.setContent(s,r);return t;};this.sections=j.scry(this.root,'div.ego_section').map(function(r){return {root:q(r),units:j.scry(r,'div.ego_unit').map(q)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var q=this.nextRegisterTime();if(q!==Infinity)this.processResize.bind(this).defer(q,true);},setIsLogAdData:function(q){this.isLogAdData=q;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var q=this.snowlift.getImageId();if(this.isLogAdData&&q){var r=n.getElementDimensions(this.snowlift.getImage()),s=n.getElementDimensions(this.snowlift.getRHCHeader()),t=n.getElementDimensions(this.snowlift.getRHCBody()),u=n.getElementDimensions(this.snowlift.getRHCFooter()),v={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:r.x,image_y:r.y,header_x:s.x,header_y:s.y,body_x:t.x,body_y:t.y,footer_x:u.x,footer_y:u.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents};k.updateAdData(q,v);}},getAdsBelowSpace:function(){var q=[],r=this.units[1];for(var s in r)if(r.hasOwnProperty(s))q.push(r[s].heightBelow);return q;},getIsAds:function(q){var r=j.scry(q,'div.fbAdUnit');return r.length;},getUnitId:function(q){if(this.getIsAds(q)){return this.getAdId(q);}else return this.getEgoId(q);},getEgoId:function(q){var r=j.find(q,'div.fbEgoUnit'),s=r.getAttribute('data-ego'),t=JSON.parse(s).egoid;return t;},getAdId:function(q){var r=j.find(q,'div.fbAdUnit'),s=r.getAttribute('data-ad'),t=JSON.parse(s).adid;return t;},nextRegisterTime:function(){var q=Infinity,r=g(g({},this.units[0]),this.units[1]);for(var s in r)if(r.hasOwnProperty(s)){var t=r[s];if(t.trackingCode!==null&&t.visible)q=Math.min(q,this.UNITS_REGISTER_DELAY-t.totalTime);}return q;},getHeight:function(q,r){var s=i.get(q,'height');if(s&&s.x===r)return s.y;return this.cacheHeight(q,r);},cacheHeight:function(q,r){var s={x:r,y:q.offsetHeight};i.set(q,'height',s);return s.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);l.loadFromEndpoint('WebEgoPane',this.root.id,{pid:34,data:[this.loadQuery.set,true,this.egoEnabled]},{crossPage:true,bundle:false});},unitsLoaded:function(q,r){var s;if(r){s='/ai.php';this.addEvent('adsLoaded',true);}else{s='/ajax/ei.php';this.addEvent('egoLoaded',true);}var t={};for(var u in q)if(q.hasOwnProperty(u))t[u]={trackingCode:q[u],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:s};this.units[r]=t;if(r)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();h.removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var q=Date.now(),r=this.refreshUnitsRate;if(!this.isLoading&&q-this.lastLoadTime>r){h.addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(q,r){var s=o('iframe',{src:m(r).addQueryData({aed:q}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});s.setAttribute('aria-hidden','true');j.appendContent(this.root,s);},waitForImages:function(q){var r=j.scry(this.root,'img.img'),s=r.length,t=s;if(t===0)q();var u=function(){t--;if(t===0)q.defer();};for(var v=0;v<s;v++){var w=r[v];if(w.complete){u();}else Event.listen(w,{load:u,error:u,abort:u});}}};e.exports=p;});
__d("PhotoViewer",["Bootloader","copyProperties"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('copyProperties');function i(){this.image=null;this.root=null;this.stream=null;}h(i,{bootstrap:function(j,k){g.loadModules(['PhotoSnowlift'],function(l){l.bootstrap(j,k);});}});h(i.prototype,{getEventPrefix:bagof(null),getEventString:function(j){var k=this.getEventPrefix();if(k)return k+'.'+j;return null;},getImage:function(){return this.image;},getPosition:function(){return this.stream?this.stream.getCursor():null;},getRoot:function(){return this.root;},getSourceString:bagof(null),getVersionConst:bagof(null)});e.exports=i;});
__d("PhotoSnowlift",["array-extensions","event-extensions","function-extensions","Arbiter","AsyncRequest","Bootloader","Class","CSS","Dialog","DOM","DOMControl","DOMScroll","FullScreen","HTML","ImageUtils","KeyEventController","Keys","LinkController","Locale","OptimisticUFI","PageTransitions","Parent","PhotosConst","PhotoSessionLog","PhotoSnowliftAds","PhotoStreamCache","PhotosUtils","PhotoViewer","ScrollableArea","Style","Toggler","UIPagelet","URI","UserAgent","Vector","$","computeRelativeURI","copyProperties","createArrayFrom","ge","goURI","tx","userAction"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Bootloader'),j=b('Class'),k=b('CSS'),l=b('Dialog'),m=b('DOM'),n=b('DOMControl'),o=b('DOMScroll'),p=b('FullScreen'),q=b('HTML'),r=b('ImageUtils'),s=b('KeyEventController'),t=b('Keys'),u=b('LinkController'),v=b('Locale'),w=b('OptimisticUFI'),x=b('PageTransitions'),y=b('Parent'),z=b('PhotosConst'),aa=b('PhotoSessionLog'),ba=b('PhotoSnowliftAds'),ca=b('PhotoStreamCache'),da=b('PhotosUtils'),ea=b('PhotoViewer'),fa=b('ScrollableArea'),ga=b('Style'),ha=b('Toggler'),ia=b('UIPagelet'),ja=b('URI'),ka=b('UserAgent'),la=b('Vector'),ma=b('$'),na=b('computeRelativeURI'),oa=b('copyProperties'),pa=b('createArrayFrom'),qa=b('ge'),ra=b('goURI'),sa=b('tx'),ta=b('userAction'),ua=b('event-extensions').$E;function va(){this.parent.construct(this);}oa(va,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_HIRES_MAX:{x:2048,y:2048},STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:340,SIDEBAR_SIZE_MIN:285,STAGE_CHROME:{x:102,y:42},PIVOT_BAR_HEIGHT:110,VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,_instance:null,getInstance:function(){if(!va._instance)va._instance=new va();return va._instance;},addPhotoFbids:function(wa,xa,ya){va.getInstance().addPhotoFbids(wa,xa,ya);},attachSubscribeFlyout:function(wa){m.insertAfter(ma('fbPhotoSnowliftSubscribe'),wa);},attachTagger:function(wa){va.getInstance().attachTagger(wa);},preload:function(wa,xa){va.getInstance().preload(wa,xa);},bootstrap:function(wa,xa){if(xa.getAttribute('data-vaultbox')){i.loadModules(['VaultBox'],function(ya){ya.bootstrap(wa,xa);});return;}va.getInstance().bootstrap(wa,xa);},closeRefresh:function(){va.getInstance().closeRefresh();},deletePhoto:function(wa){va.getInstance().deletePhoto(wa);},getImage:function(){return va.getInstance().getImage();},getImageId:function(){return va.getInstance().getImageId();},getLoadQuery:function(){return va.getInstance().getLoadQuery();},getRHCBody:function(){return va.getInstance().getRHCBody();},getRHCFooter:function(){return va.getInstance().getRHCFooter();},getRHCHeader:function(){return va.getInstance().getRHCHeader();},getRoot:function(){return va.getInstance().getRoot();},saveTagsFromPayload:function(wa){va.getInstance().saveTagsFromPayload(wa);},saveTagsFromPayloadDelayed:function(wa){va.saveTagsFromPayload.curry(wa).defer(2000);},setErrorBoxContent:function(wa){va.getInstance().setErrorBoxContent(wa);},storeFromData:function(wa){va.getInstance().storeFromData(wa);},swapData:function(){va.getInstance().swapData();},touchMarkup:bagofholding,updateTotalCount:function(wa,xa,ya){va.getInstance().updateTotalCount(wa,xa,ya);}});j.extend(va,ea);oa(va.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,extraClass:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:va.STAGE_NORMAL_MAX,stagePagerPrev:null,ua:null,showHiRes:false,preload:function(wa,xa){i.loadModules(['fb-photos-snowlift-css','Live','PhotoTagApproval','PhotoTagger','PhotoTags','TagTokenizer','fb-photos-snowlift-fullscreen-css'],bagofholding);var ya=this.getImageSrc(ja(wa).getQueryData());if(ya)(new Image()).src=ya;},bootstrap:function(wa,xa){this.preload(wa,xa);ba.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.ua=ta('snowlift',xa,null).set_namespace('snowlift').set_ua_id('open');this.returningToStart=false;this.loading&&k.removeClass(this.loading,'loading');if(xa){k.addClass((this.loading=xa),'loading');this.getThumbAndSize(xa);}else this.loading=null;g.inform('PhotoSnowlift.GO',wa,g.BEHAVIOR_STATE);this.loadFrameIfUninitialized();},getEventPrefix:function(){return 'PhotoSnowlift';},getRoot:function(){return this.root;},getSourceString:function(){return 'snowlift';},getVersionConst:function(){return z.VIEWER_SNOWLIFT;},getImage:function(){return this.image;},getImageId:function(){return this.stream.getCursor();},getRHCHeader:function(){return this.rhcHeader;},getRHCBody:function(){return this.ufiForm;},getRHCFooter:function(){return this.rhcFooter;},getLoadQuery:function(){return this.loadQuery;},getOwnerId:function(){var wa=this.stream.getCurrentImageData();if(wa)return wa.info.owner;return null;},getThumbAndSize:function(wa){this.currentImageSize=null;this.thumbSrc=null;var xa=ja(wa.getAttribute('ajaxify')).getQueryData();if(!xa.size)return;var ya=la.deserialize(xa.size);if(!ya.x||!ya.y)return;this.currentImageSize=ya;if(!k.hasClass(wa,'uiMediaThumb')&&!k.hasClass(wa,'uiPhotoThumb')&&!k.hasClass(wa,'uiScaledThumb'))return;if(wa.getAttribute('data-cropped'))return;var za=m.scry(wa,'img')[0],ab=m.scry(wa,'i')[0],bb=y.byAttribute(wa,'data-size');this.shouldStretch=bb&&this.currentImageSize&&za&&bb.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=va.TIMELINE_STRETCH_WIDTH&&za.offsetWidth===va.TIMELINE_STRETCH_WIDTH;var cb;if(za){cb=za.src;}else if(ab){cb=k.getStyle(ab,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=cb;},loadFrameIfUninitialized:function(){if(this.root)return;new h('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();},init:function(wa,xa){this.showHiRes=xa.hires;this.fullscreen=xa.hires&&p.isSupported();this.stageMax=this.showHiRes?va.STAGE_HIRES_MAX:va.STAGE_NORMAL_MAX;this.stageChrome={x:va.STAGE_CHROME.x,y:va.STAGE_CHROME.y};if(xa.pivot_bar||xa.pivot_bar_dark)this.stageChrome.y+=va.PIVOT_BAR_HEIGHT;var ya=qa('fbPhotoSnowlift');if(!ya){ya=m.appendContent(m.getDocumentBodyElement(),wa)[0];this.initialLoad=false;}if(this.root==ya)return;this.initializeNodes(ya);ba.init(this.sideAdUnit,this,xa);if(!this.subscription){u.registerHandler(this.handleNavigateAway.bind(this));this.subscription=g.subscribe('PhotoSnowlift.GO',function(za,ab){this.openExplicitly=true;this.loading&&k.removeClass(this.loading,'loading');this.open(ab);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;x.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)p.subscribe('changed',this.onFullScreenChange.bind(this));},onFullScreenChange:function(){if(p.isFullScreen()){if(!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var wa=this.stream.getCurrentImageData();if(wa&&wa.url&&this.image.src!==wa.url&&this.shouldShowHiRes(wa))this.switchImage(wa.url);this.adjustForResize();}else this.uncollapseRHC();ha.hide();},initializeNodes:function(wa){this.root=wa;this.container=m.find(wa,'div.fbPhotoSnowliftContainer');this.popup=m.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=m.find(this.popup,'div.rhc');this.rhcHeader=m.find(this.rhc,'div.rhcHeader');this.rhcFooter=m.find(this.rhc,'div.rhcFooter');this.ufiForm=m.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=ma('fbPhotoSnowliftFeedbackInput');this.scroller=m.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=m.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=m.find(this.popup,'div.stageWrapper');this.errorBox=m.find(this.stageWrapper,'div.stageError');this.image=m.find(this.stageWrapper,'img.spotlight');this.stage=m.find(this.stageWrapper,'div.stage');this.videoStage=m.find(this.stageWrapper,'div.videoStage');this.prevPager=m.find(this.root,'a.snowliftPager.prev');this.nextPager=m.find(this.root,'a.snowliftPager.next');this.stageActions=m.find(wa,'div.stageActions');this.buttonActions=m.find(this.stageActions,'div.fbPhotosPhotoButtons');this.sideAdUnit=ma('fbPhotoSnowliftAdsSide');k.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);if(this.fullscreen)Event.listen(this.container,'click',(function(event){var xa=event.getTarget();if(y.byClass(xa,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(y.byClass(xa,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}).bind(this));},initializeScroller:function(){this.initializeScroller=bagofholding;this.scrollableArea=fa.fromNative(this.scroller,{fade:true,persistent:true});var wa=function(event){var xa=ua(event).getTarget();if(m.contains(this.ufiInputContainer,xa)){var ya=n.getInstance(xa);if(ya){this.scrollableArea.scrollToBottom();var za=ya.subscribe('resize',function(){var bb=this.scrollableArea.isScrolledToBottom();this.adjustScroller();bb&&this.scrollableArea.scrollToBottom();}.bind(this)),ab=Event.listen(xa,'blur',function(){ya.unsubscribe(za);ab.remove();});}}}.bind(this);g.subscribe(w.COMMENT_SEND_EVENT,function(xa,ya){if(this.ufiForm===ya.form){this.adjustScrollerIfNecessary();this.scrollableArea.scrollToBottom();}}.bind(this));Event.listen(this.rhc,'click',function(event){var xa=event.getTarget();if(y.byTag(xa,'a')||y.byTag(xa,'button')||m.isNodeOfType(xa,'input'))this.adjustScrollerIfNecessary();}.bind(this));g.subscribe('reflow',function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));if(this.ufiForm.attachEvent){this.ufiForm.attachEvent('onfocusin',wa);}else this.ufiForm.addEventListener('focus',wa,true);},openHandler:function(wa){if(this.isOpen||wa.getPath()!='/photo.php'||this.returningToStart||wa.getQueryData().closeTheater||wa.getQueryData().permPage||wa.getQueryData().makeprofile){this.openHandlerRegistered=false;return false;}this.open(wa);this._uriStack.push(ja(wa).getQualifiedURI().toString());x.transitionComplete();return true;},getImageSrc:function(wa){if(wa.smallsrc){if(!wa.size)return wa.smallsrc;var xa=la.deserialize(wa.size),ya=this.getStageSize(xa);if(ya.x<=va.STAGE_NORMAL_MAX.x&&ya.y<=va.STAGE_NORMAL_MAX.y)return wa.smallsrc;}return wa.src;},open:function(wa){var xa=ja(wa).getQueryData(),ya=this.getImageSrc(xa);if(ya){delete xa.src;delete xa.smallsrc;}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){xa.firstLoad=true;this.initialLoad=true;}this.loadQuery=xa;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.stream=new ca();this.stream.init(z.VIEWER_SNOWLIFT,'PhotoViewerPagelet');this.fetchInitialData();this.setLoadingState(va.STATE_HTML,true);this.rhcCollapsed=false;s.registerKey('ESCAPE',this.closeListener.bind(this));i.loadModules(['fb-photos-snowlift-css'],this._open.bind(this,wa,ya));},_open:function(wa,xa){this.createLoader(xa);k.show(this.root);if(!k.hasClass(document.documentElement,'wrapped'))(function(){var ab=la.getScrollPosition();k.addClass(document.documentElement,'theaterMode');var bb=o.getScrollbarSize();if(bb===0){this.extraClass='zeroScrollbar';}else if(bb===20){this.extraClass='scrollbar20';}else this.extraClass='defaultScrollbar';k.addClass(document.body,this.extraClass);o.scrollTo(ab,0);}).defer();this.ua&&this.ua.add_event('frame');g.inform('layer_shown',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.OPEN');this.stageHandlers=[Event.listen(window,'resize',this.adjustForResize.bind(this)),Event.listen(this.root,'click',this.closeListener.bind(this)),Event.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),Event.listen(this.stageWrapper,'mouseleave',this.hidePagers.bind(this)),Event.listen(this.stageWrapper,'mousemove',this.hilitePagerOnMouseMove.bind(this)),Event.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this))];var ya=qa('fbPhotoSnowliftFeedback');if(ya)this.stageHandlers.push(Event.listen(ya,'click',function(event){if(y.byClass(event.getTarget(),'like_link')){var ab=m.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(ab){k.toggleClass(ab,'viewerLikesThis');k.removeClass(ab,'viewerAlreadyLikedThis');}}var bb=y.byClass(event.getTarget(),'uiUfiCollapsedComment');if(bb)k.addClass(bb,'uiUfiCollapsedCommentToggle');}.bind(this)));var za=qa('fbPhotoSnowliftOnProfile');if(za)this.stageHandlers.push(Event.listen(za,'click',function(event){if(y.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=ja.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!xa)this.setLoadingState(va.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){x.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}aa.initLogging(aa.SNOWLIFT);if(ka.firefox()&&!k.hasClass(document.documentElement,'wrapped'))this.turnFlashAutoplayOff.defer();(function(){this.root.focus();}).bind(this).defer();},toggleFullScreen:function(){var wa=p.toggleFullScreen(document.documentElement);if(wa){var xa=this.stream.getCurrentImageData();if(xa&&xa.url&&this.image.src!==xa.url&&this.shouldShowHiRes(xa))(new Image()).src=xa.url;aa.logEnterFullScreen(this.stream.getCursor());}},getStream:function(){return this.stream;},fetchInitialData:function(){this.ua&&this.ua.add_event('init_data');ia.loadFromEndpoint('PhotoViewerInitPagelet',null,this.loadQuery,{usePipe:true,jsNonblock:true,crossPage:true});},turnFlashAutoplayOff:function(){m.scry(document,'div.swfObject').forEach(function(wa){var xa=wa.getAttribute('data-swfid');if(xa&&window[xa]){var ya=window[xa];ya.addParam('autostart','false');ya.addParam('autoplay','false');ya.addParam('play','false');ya.addVariable('video_autoplay','0');ya.addVariable('autoplay','0');ya.addVariable('play','0');var za=ja(ya.getAttribute('swf'));za.addQueryData({autoplay:'0'});za.setPath(za.getPath().replace('autoplay=1','autoplay=0'));ya.setAttribute('swf',za.toString());ya.write(wa);}});},toggleCollapse:function(){if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();},collapseRHC:function(){this.rhcCollapsed=true;k.addClass(this.root,'collapseRHC');this.adjustForResize();},uncollapseRHC:function(){this.rhcCollapsed=false;k.removeClass(this.root,'collapseRHC');this.adjustForResize();},closeHandler:function(){if(!this.isOpen)return;if(ja.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.close();this.returnToStartingURI(this.refreshOnClose);},returnToStartingURI:function(wa,xa){if(!wa)if(xa){this.squashNextTransition(ra.curry(xa));}else this.squashNextTransition();this.returningToStart=true;var ya=g.subscribe('page_transition',function(){this.returningToStart=false;ya.unsubscribe();}),za=wa||isNaN(ka.opera()),ab=this._uriStack.length;if(za&&ab<window.history.length){window.history.go(-ab);}else{var bb=this.startingURI,cb=new ja(bb).removeQueryData('closeTheater');if(bb.getQueryData().sk=='approve'&&bb.getPath()=='/profile.php'){cb.removeQueryData('highlight');cb.removeQueryData('notif_t');}ra(cb);}},squashNextTransition:function(wa){this.squashNext=true;x.registerHandler(function xa(){if(this.squashNext){this.squashNext=false;if(wa)wa.defer();x.transitionComplete();return true;}return false;}.bind(this));},handleNavigateAway:function(wa){var xa=na(x._most_recent_uri.getQualifiedURI(),wa.getAttribute('href'));if(this.isOpen&&(xa instanceof ja)&&xa.getUnqualifiedURI().toString()!=this.startingURI.toString()&&xa.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=aa.NAVIGATE;this.close();this.returnToStartingURI(false,xa);return false;}return true;},closeListener:function(event){if(this.isOpen&&!l.getCurrent()){if(Event.getKeyCode(event)==t.ESC){if(!k.hasClass(this.root,'taggingMode')&&!k.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.closingAction=aa.ESC;Event.kill(event);this.closeHandler();}return;}var wa=event.getTarget(),xa=y.byClass(wa,'closeTheater'),ya=xa||wa==this.root||wa==m.find(this.root,'div.fbPhotoSnowliftOuter')||wa==m.find(this.root,'div.fbPhotoSnowliftInner');if(ya){if(p.isFullScreen()){if(xa)p.toggleFullScreen();return;}if(xa){this.closingAction=aa.X;}else this.closingAction=aa.OUTSIDE;Event.kill(event);this.closeHandler();}}},close:function(){if(!this.isOpen)return;if(this.fullscreen)p.disableFullScreen();k.hide(this.root);this.openExplicitly=false;this.closeCleanup.bind(this).defer();},closeCleanup:function(){if(!k.hasClass(document.documentElement,'wrapped')){var wa=la.getScrollPosition();k.removeClass(document.documentElement,'theaterMode');k.removeClass(document.body,this.extraClass);o.scrollTo(wa,0);}k.removeClass(this.root,'dataLoaded');s.getInstance().resetHandlers();aa.logPhotoViews(this.closingAction);this.destroy();k.hide(this.errorBox);k.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;k.removeClass(this.stageWrapper,'showVideo');m.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();m.empty(this.sideAdUnit);this.stream.destroy();var xa=this.closingAction===aa.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){x.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}g.inform('layer_hidden',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.CLOSE',xa);this.root.setAttribute('aria-busy','true');this.isOpen=false;},createLoader:function(wa){if(this.currentImageSize===null){this.adjustStageSize(va.STAGE_MIN);}else{var xa=this.getStageSize(this.currentImageSize);xa=new la(Math.max(xa.x,va.STAGE_MIN.x),Math.max(xa.y,va.STAGE_MIN.y));var ya=this.getImageSizeInStage(this.currentImageSize,xa);if(this.thumbSrc===null){this.adjustStageSize(ya);}else this.useImage(m.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:ya.x+'px',height:ya.y+'px'}}),ya,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(wa)(function(){var za=new Image();za.onload=a.async_callback(function(){if(this.isOpen)if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(wa,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(va.STATE_IMAGE_DATA,false);}}.bind(this),'photo_theater');za.src=wa;}).bind(this).defer();k.hide(this.stageActions);this.setStagePagersState('disabled');},initDataFetched:function(wa){aa.setPhotoSet(this.stream.getPhotoSet());aa.setLogFbids(wa.logids);var xa=this.stream.getCurrentImageData();aa.addPhotoView(xa.info,this.shouldShowHiRes(xa),this.fullscreen&&p.isFullScreen());if(!this.pageHandlers){this.pageHandlers=[Event.listen(this.root,'click',this.pageListener.bind(this)),Event.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];s.registerKey('LEFT',this.pageListener.bind(this));s.registerKey('RIGHT',this.pageListener.bind(this));s.registerKey('L',this.likePhoto.bind(this),function(event,ya){event=ua(event);return (ya=='onkeyup'&&s.filterEventTargets(event,ya)&&s.filterEventModifiers(event,ya));});}k.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=wa.loggedin;this.disableAds=!this.isLoggedInViewer||wa.fromad;this.loadAds();},adjustScrollerIfNecessary:function(){clearTimeout(this.scrollerTimeout);this.scrollerTimeout=this.adjustScroller.bind(this).defer();},adjustScroller:function(){clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var wa=la.getElementDimensions(this.rhc),xa=wa.y;xa-=la.getElementDimensions(this.rhcHeader).y;xa-=la.getElementDimensions(this.ufiInputContainer).y;var ya=la.getElementDimensions(this.scrollerBody).y;if(ya>=xa){ga.set(this.scroller,'height',xa+'px');k.addClass(this.rhc,'pinnedUfi');xa=0;}else{ga.set(this.scroller,'height','auto');k.removeClass(this.rhc,'pinnedUfi');xa-=ya;}var za=la.getElementDimensions(this.ufiInputContainer).y;ga.set(this.ufiForm,'padding-bottom',za+'px');ba.resize(new la(wa.x,xa));this.scrollableArea.adjustGripper();},adjustForResize:function(){this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();},shouldShowHiRes:function(wa){if(!this.showHiRes||!wa||!wa.smallurl)return false;var xa=this.getStageSize(wa.dimensions),ya=this.getImageSizeInStage(wa.dimensions,xa);return (ya.x>va.STAGE_NORMAL_MAX.x||ya.y>va.STAGE_NORMAL_MAX.y);},getImageURL:function(wa){if(wa.video){return null;}else if(wa.smallurl&&!this.shouldShowHiRes(wa))return wa.smallurl;return wa.url;},getImageDimensions:function(wa){if(wa.smalldims&&(!this.shouldShowHiRes(wa)||this.image.src===wa.smallurl))return wa.smalldims;return wa.dimensions;},getStageSize:function(wa,xa){var ya=la.getViewportDimensions(),za=new la(wa.x,wa.y);if(xa)za=new la(Math.max(wa.x,xa.x),Math.max(wa.y,xa.y));var ab,bb;if(this.fullscreen&&p.isFullScreen()){return new la((this.rhcCollapsed?screen.width:screen.width-va.SIDEBAR_SIZE_MAX),screen.height-va.FULL_SCREEN_PADDING*2);}else{ab=Math.min(za.x,this.stageMax.x,(ya.x-va.SIDEBAR_SIZE_MAX-this.stageChrome.x));bb=Math.min(za.y,this.stageMax.y,ya.y-this.stageChrome.y);}if(ab===0&&bb===0)return new la(0,0);var cb=ab/bb,db=za.x/za.y;if(cb<db)return new la(ab,Math.ceil(ab/db));return new la(Math.ceil(bb*db),bb);},getImageSizeInStage:function(wa,xa){var ya=wa.x,za=wa.y;if(ya>=xa.x||za>=xa.y){var ab=xa.x/xa.y,bb=ya/za;if(ab<bb){ya=xa.x;za=Math.ceil(ya/bb);}else if(ab>bb){za=xa.y;ya=Math.ceil(za*bb);}else{ya=xa.x;za=xa.y;}}return new la(ya,za);},adjustStageSize:function(wa){var xa=this.currentImageSize;if(wa){xa=wa;}else{var ya=this.stream&&this.stream.getCurrentImageData();if(ya)xa=this.getImageDimensions(ya);}if(!xa)return;this.currentImageSize=xa;var za=0;if(this.shouldStretch&&!this.getVideoOnStage()&&xa.x>xa.y&&xa.x<=va.TIMELINE_STRETCH_WIDTH&&xa.x>=va.TIMELINE_STRETCH_MIN){xa.y=Math.round(xa.y*va.TIMELINE_STRETCH_WIDTH/xa.x);xa.x=va.TIMELINE_STRETCH_WIDTH;}else if(this.getVideoOnStage()){za=va.VIDEO_BOTTOM_BAR_SPACE*2;xa.y+=za;}var ab=this.getStageSize(xa,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new la(0,0);this.currentMinSize=new la(Math.max(ab.x,va.STAGE_MIN.x,this.currentMinSize.x),Math.max(ab.y,va.STAGE_MIN.y,this.currentMinSize.y));var bb=this.currentMinSize.x+va.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)bb=this.currentMinSize.x;this.popup.style.cssText='width:'+bb+'px;'+'height:'+this.currentMinSize.y+'px;';var cb=this.currentMinSize.y-za+'px';if(ka.firefox()||ka.ie()<8){var db=ga.get(this.stageWrapper,'font-size');if(ka.ie()&&db.indexOf('px')<0){var eb=m.create('div');eb.style.fontSize=db;eb.style.height='1em';db=eb.style.pixelHeight;}cb=((this.currentMinSize.y-za)/parseFloat(db))+'em';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+cb+';';if(ka.ie()<8){ga.set(this.root,'height',la.getViewportDimensions().y+'px');ga.set(this.container,'min-height',(this.currentMinSize.y+this.stageChrome.y)+'px');}var fb=this.getImageSizeInStage(xa,this.currentMinSize);this.image.style.cssText='width:'+fb.x+'px;'+'height:'+fb.y+'px;';this.adjustScrollerIfNecessary();},adjustForNewData:function(){if(!this.image)return;var wa=m.scry(this.stage,'div.tagsWrapper')[0],xa=la.getElementDimensions(this.image);if(wa){ga.set(wa,'width',xa.x+'px');ga.set(wa,'height',xa.y+'px');if(ka.ie()<=7){var ya=m.scry(this.root,'div.tagContainer')[0];if(ya)k.conditionClass(wa,'ie7VerticalFix',la.getElementDimensions(ya).y>xa.y);}}},setLoadingState:function(wa,xa){switch(wa){case va.STATE_IMAGE_PIXELS:k.conditionClass(this.root,'imagePixelsLoading',xa);break;case va.STATE_IMAGE_DATA:this.loadingStates[wa]=xa;k.conditionClass(this.root,'imageLoading',xa);break;case va.STATE_HTML:this.loadingStates[wa]=xa;k.conditionClass(this.root,'dataLoading',xa);this.rhc.setAttribute('aria-busy',xa?'true':'false');break;}},destroy:function(){this.stageHandlers.forEach(function(wa){wa.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(wa){wa.remove();});this.pageHandlers=null;}},checkState:function(wa){if(wa!=va.STATE_ERROR&&!this.loadingStates[wa])return;switch(wa){case va.STATE_IMAGE_DATA:var xa=this.stream.getCurrentImageData();if(xa){var ya=this.getImageURL(xa);if(ya){this.switchImage(ya,null,true);}else if(xa.video)this.switchVideo(xa.video,true);this.setLoadingState(wa,false);}break;case va.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(wa,false);}break;default:if(this.stream.errorInCurrent()){k.hide(this.image);k.show(this.errorBox);}break;}},buttonListener:function(event){var wa=event.getTarget(),xa=Date.now();if(y.byClass(wa,'fbPhotoTagApprovalBox'))return;if(xa-this.lastPage<350)return;if(y.byClass(wa,'fbPhotosPhotoLike')){this.likePhoto();}else if(y.byClass(wa,'tagApproveIgnore'))this.updateTagBox(event,wa);},likePhoto:function(){aa.addButtonLike();m.find(ma('fbPhotoSnowliftFeedback'),'button.like_link').click();},rotateListener:function(event){var wa=event.getTarget();if(y.byClass(wa,'rotateRight')){this.rotate('right');}else if(y.byClass(wa,'rotateLeft'))this.rotate('left');},updateTagBox:function(wa,xa){this.unhiliteAllTags();var ya=qa(wa);if(!ya)return;k.addClass(ya,'tagBox');k.addClass(ya,'tagBoxPendingResponse');k.removeClass(ya,'tagBoxPending');k.hide(m.find(ya,'span.tagForm'));if(xa){k.show(m.find(ya,'span.tagApproved'));}else k.show(m.find(ya,'span.tagIgnored'));},rotate:function(wa){var xa=this.stream.getCursor();if(this.getVideoOnStage()){var ya=(wa=='left')?270:90;i.loadModules(['VideoRotate'],function(ab){new ab(xa).motionRotate(ya);});return;}var za=oa({fbid:xa,cs_ver:z.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());za[wa]=1;this.setLoadingState(va.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);k.hide(this.image);new h('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(za).setErrorHandler(this.rotationError.bind(this,xa)).setFinallyHandler(this.rotationComplete.bind(this,xa)).setMethod('POST').setReadOnly(false).send();},rotationComplete:function(wa,xa){if(wa==this.stream.getCursor()){this.setLoadingState(va.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}},rotationError:function(wa,xa){if(wa==this.stream.getCursor()){this.setLoadingState(va.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));i.loadModules(['AsyncResponse'],function(ya){ya.defaultErrorHandler(xa);});}},saveTagsFromPayload:function(wa){this.storeFromData(wa);if('data' in wa&&this.stream.getCursor() in wa.data)this.swapData();},saveEdit:function(){if(!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;i.loadModules(['PhotoInlineEditor','Form'],function(wa,xa){var ya=wa.getInstance(this.getViewerConst());ya&&xa.bootstrap(ya.getForm().controller);}.bind(this));},mouseLeaveListener:function(event){this.unhiliteAllTags();this.reHilitePendingTag();},hilitePagerOnMouseMove:function(event){var wa=la.getEventPosition(event),xa=la.getElementPosition(this.stage);if(v.isRTL()){var ya=la.getElementDimensions(this.stage);this.stagePagerPrev=ya.x-(wa.x-xa.x)<va.GOPREV_AREA;}else this.stagePagerPrev=wa.x-xa.x<va.GOPREV_AREA;k.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);k.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var za,ab=event.getTarget();if(!y.byClass(ab,'snowliftOverlay')&&!y.byClass(ab,'bottomBarActions')&&!y.byClass(ab,'snowliftPager'))za=va.PAGER_FADE;this.showPagers(za);},showPagers:function(wa){clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof wa!=='undefined')this.fadePagerTimer=this.hidePagers.bind(this).defer(wa);},hidePagers:function(){if(this.actionMenuOn(true))return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');},actionMenuOn:function(wa){var xa=qa('fbPhotoSnowliftDropdownButton');if(xa&&y.byClass(xa,'openToggler'))return !wa||y.byClass(xa,'bottomBarActions');return false;},unhiliteAllTags:function(){m.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(wa){k.removeClass(wa,'hover');});this.hilitedTag=null;},switchHilitedTags:function(wa,xa){if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();var ya=qa(wa);if(ya){this.hilitedTag=wa;k.addClass(ya,'hover');if(k.hasClass(ya,'tagBoxPending')&&!k.hasClass(ya,'showPendingTagName')&&xa===true){m.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(za){k.removeClass(za,'showPendingTagName');});k.addClass(ya,'showPendingTagName');}}},reHilitePendingTag:function(){var wa=qa(this.hilitedTag);if(wa&&k.hasClass(wa,'showPendingTagName'))return;var xa=m.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(xa)this.switchHilitedTags(xa.id);},hiliteTagsOnMouseMove:function(event){if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var wa=event.getTarget();if(y.byClass(wa,'fbPhotoSnowliftTagApproval'))return;var xa=y.byClass(wa,'tagBoxPending'),ya=(this.hilitedTag&&k.hasClass(ma(this.hilitedTag),'tagBoxPending')),za=((!this.hilitedTag&&xa)||(!ya&&xa));if(za){this.switchHilitedTags(xa.id);return;}if(xa&&(xa.id==this.hilitedTag))return;var ab=250,bb=da.absoluteToNormalizedPosition(this.image,la.getEventPosition(event)),cb=da.getNearestBox(this.stream.getCurrentExtraData().tagRects,bb);if(!cb){if(!ya){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var db=null;if(ya){var eb={};eb[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];db=da.getNearestBox(eb,bb);}if(db!==null&&ya)return;if(this.hilitedTag!=cb)if(ya){this.switchTimer=this.switchHilitedTags.bind(this,cb).defer(ab);}else this.switchHilitedTags(cb);},getVideoOnStage:function(){var wa=this.stream&&this.stream.getCurrentImageData();return wa&&wa.video;},shouldPageOnAction:function(wa,xa){var ya=m.isNode(xa)&&(y.byClass(xa,'snowliftPager')||y.byClass(xa,'stagePagers')),za=m.isNode(xa)&&y.byClass(xa,'stage'),ab=((za&&k.hasClass(this.root,'taggingMode'))||y.byClass(xa,'tagBoxPending')||y.byClass(xa,'tagBoxPendingResponse')||y.byClass(xa,'fbPhotoTagApprovalBox'));if(ab)return false;return wa==t.LEFT||wa==t.RIGHT||ya||za;},pageListener:function(event){var wa=Event.getKeyCode(event),xa=event.getTarget();if(!this.shouldPageOnAction(wa,xa))return;var ya=0;if(wa==t.RIGHT){ya=1;aa.setPagingAction('key_right');}else if(wa==t.LEFT){ya=-1;aa.setPagingAction('key_left');}else if(y.byClass(xa,'next')){ya=1;aa.setPagingAction('click_next');}else if(y.byClass(xa,'prev')){ya=-1;aa.setPagingAction('click_prev');}else if(!this.stagePagerPrev){ya=1;aa.setPagingAction('click_stage');}else{ya=-1;aa.setPagingAction('click_stage_back');}if(k.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(ya);}else{this.page(ya);ta('a',xa,event);}},warnLeavePage:function(wa){new l().setTitle("Haluatko varmasti poistua t\u00e4lt\u00e4 sivulta?").setBody("Menet\u00e4t tallentamattomat muutoksesi, jos poistut sivulta.").setButtons([{name:'leave_page',label:"Poistu t\u00e4lt\u00e4 sivulta",handler:this.page.bind(this,wa)},{name:'continue_editing',label:"Pysy t\u00e4ll\u00e4 sivulla",className:'inputaux'}]).show();},page:function(wa,xa){if(!this.stream.isValidMovement(wa)){this.showPagers(va.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();var ya=this.getVideoOnStage();if(ya)this.switchVideo(ya,false);g.inform('PhotoSnowlift.PAGE');ha.hide();this.recacheData();this.stream.moveCursor(wa);k.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(va.STATE_HTML,true);k.show(this.errorBox);return;}var za=this.stream.getCurrentImageData();if(za){var ab=this.getImageURL(za);if(ab){this.switchImage(ab,null,true);}else if(za.video)this.switchVideo(za.video,true);if(!xa){this.replaceUrl=true;ra(za.info.permalink);}}else{this.setLoadingState(va.STATE_IMAGE_PIXELS,true);this.setLoadingState(va.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(va.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer;this.loadAds();},logImpressionDetailsForPhoto:function(){var wa=[].concat(m.scry(ma('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),m.scry(ma('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(wa.length===0)return;var xa={};for(var ya=0;ya<wa.length;ya++)xa[wa[ya].name]=wa[ya].value;if(this.getVideoOnStage()){xa.width=0;xa.height=0;}else{var za=this.getImageDimensions(this.stream.getCurrentImageData());xa.width=za.x;xa.height=za.y;}aa.addDetailData(this.stream.getCursor(),xa);ba.setIsLogAdData(true);},loadAds:function(){if(this.disableAds)return;ba.loadAdsFromUserActivity();},transitionHandler:function(wa){if(wa.getQueryData().closeTheater||wa.getQueryData().permPage||wa.getQueryData().makeprofile||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(wa.getQualifiedURI().toString());x.transitionComplete();return true;}var xa=this._uriStack.length;if(xa>=2&&this._uriStack[xa-2]==wa.getQualifiedURI().toString())this._uriStack.pop();var ya=this.stream.getCursorForURI(wa.getUnqualifiedURI().toString());if(ya){var za=this.stream.getRelativeMovement(ya);this.page(za,true);x.transitionComplete();return true;}if(this.isOpen){this.close();x.transitionComplete();return true;}this.transitionHandlerRegistered=false;return false;},recacheData:function(){if(!this.loadingStates.html){var wa=this.stream.getCurrentHtml();for(var xa in wa){wa[xa]=pa(ma(xa).childNodes);m.empty(ma(xa));}}},reloadIfTimeout:function(){if(!r.hasLoaded(this.image)){var wa=this.makeNewImage(this.image.src,true);Event.listen(wa,'load',this.useImage.bind(this,wa,null,true));}},useImage:function(wa,xa,ya){if(ya&&r.hasLoaded(this.image))return;m.replace(this.image,wa);this.image=wa;this.adjustStageSize(xa);},makeNewImage:function(wa,xa){if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!xa)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),va.LOADING_TIMEOUT);var ya=m.create('img',{className:'spotlight',alt:''});ya.setAttribute('aria-describedby','fbPhotosSnowliftCaption');ya.setAttribute('aria-busy','true');Event.listen(ya,'load',a.async_callback(function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);(function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this).defer();}.bind(this),'photo_theater'));ya.src=wa;return ya;},switchImage:function(wa,xa,ya){k.hide(this.image);k.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var za=this.stream&&this.stream.getCurrentImageData();if(za)aa.addPhotoView(za.info,this.shouldShowHiRes(za),this.fullscreen&&p.isFullScreen());this.useImage(this.makeNewImage(wa,false),xa,false);if(ya)this.stream.preloadImages(this.shouldShowHiRes(za));},switchVideo:function(wa,xa){var ya='swf_'+wa;if(xa){k.addClass(this.stageWrapper,'showVideo');var za=m.create('div',{className:'videoStageContainer'});m.appendContent(this.videoStage,za);za.id=wa;if(window[ya]&&!qa(ya))window[ya].write(wa);this.adjustStageSizeForVideo.bind(this,ya).defer();}else{window[ya]&&window[ya].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);m.empty(this.videoStage);k.removeClass(this.stageWrapper,'showVideo');}},checkVideoStatus:function(wa){if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var xa=this.getVideoOnStage();if(!xa){return;}else{var ya='swf_'+xa;if(wa!==ya)return;this.adjustStageSizeForVideo(wa);}},adjustStageSizeForVideo:function(wa){var xa=qa(wa);if(!xa){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,wa),200);}else this.adjustStageSize(new la(xa.width,xa.height));},setErrorBoxContent:function(wa){m.setContent(this.errorBox,wa);},swapData:function(){var wa,xa=this.stream.getCurrentHtml();if(xa){this.setLoadingState(va.STATE_HTML,false);for(var ya in xa){wa=qa(ya);wa&&m.setContent(wa,xa[ya]);}g.inform('PhotoSnowlift.DATA_CHANGE',this.stream.getCurrentImageData().info,g.BEHAVIOR_STATE);if(this.stream.getCurrentExtraData())g.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);}this.showPagers(va.PAGER_FADE);this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();},updateTotalCount:function(wa,xa,ya){var za=ma('fbPhotoSnowliftPositionAndCount'),ab=q(ya).getRootNode();m.replace(za,ab);za=ab;k.show(za);var bb=this.stream.getCurrentHtml();if(bb){var cb='fbPhotoSnowliftPositionAndCount';bb[cb]=pa(za.childNodes);this.stream.setTotalCount(wa);this.stream.setFirstCursorIndex(xa);}},addPhotoFbids:function(wa,xa,ya){var za=this.stream.getCursor()===null;this.stream.attachToFbidsList(wa,xa,ya);if(ya&&za)this.page(0,true);if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');},attachTagger:function(wa){m.appendContent(this.stageActions,wa);},storeFromData:function(wa){if(!this.isOpen)return;var xa=this.stream.storeToCache(wa);if('error' in xa){this.checkState(va.STATE_ERROR);return;}if('init' in xa){this.initDataFetched(xa.init);if(this.openExplicitly){this.replaceUrl=true;ra(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.ua&&this.ua.add_event('ufi');}if('image' in xa)this.checkState(va.STATE_IMAGE_DATA);if('data' in xa)this.checkState(va.STATE_HTML);},setStagePagersState:function(wa){switch(wa){case 'ready':k.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':k.addClass(this.root,'pagingActivated');return;case 'inactive':k.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':k.removeClass(this.root,'pagingReady');return;}},deletePhoto:function(wa){this.closeRefresh();},closeRefresh:function(){this.refreshOnClose=true;this.closeHandler();},onHiliteTag:function(wa,xa){if(xa.version!=z.VIEWER_SNOWLIFT)return;var ya=xa.tag;if(ya){this.switchHilitedTags(ya,true);}else this.unhiliteAllTags();},onUpdateTagBox:function(wa,xa){if(xa.version==z.VIEWER_SNOWLIFT)this.updateTagBox(xa.id,xa.approve);}});e.exports=va;});
__d("legacy:PhotoSnowlift",["PhotoSnowlift"],function(a,b,c,d){a.PhotoSnowlift=b('PhotoSnowlift');},3);
function FutureSideNav(){FutureSideNav.instance&&FutureSideNav.instance.uninstall();FutureSideNav.instance=this;}FutureSideNav.instance=null;FutureSideNav.getInstance=function(){return FutureSideNav.instance||new FutureSideNav();};copy_properties(FutureSideNav.prototype,{init:function(a,b,c){this.root=a;this.items={};this.sections={};this.editor=null;this.editing=false;this.selected=null;this.loading=null;this.keyParam='sk';this.defaultKey=b;this.uri=URI.getRequestURI();this.ajaxPipe=c;this.ajaxPipeEndpoints={};this.sidecol=true;this._installed=true;this._handlePageTransitions=true;PageTransitions.registerHandler(function(d){return this._handlePageTransitions&&this.handlePageTransition(d);}.bind(this));this._eventHandlers=[];this._arbiterSubscriptions=[Arbiter.subscribe(NavigationMessage.NAVIGATION_COMPLETED,this.navigationComplete.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FAILED,this.navigationFailed.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_COUNT_UPDATE,this.navigationCountUpdate.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_SELECT,this.navigationSelect.bind(this)),Arbiter.subscribe(ChannelConstants.getArbiterType('nav_update_counts'),this.navigationCountUpdateFromPresence.bind(this))];this._explicitHover=[];this._ensureHover('sideNavItem');this._eventHandlers.push(Event.listen(window,'resize',this._handleResize.bind(this)));this._checkNarrow();this._selectorSubscriptions=[];window.Selector&&this._selectorSubscriptions.push(Selector.subscribe(['open','close'],function(d,e){var f=Parent.byClass(e.selector,'sideNavItem');f&&CSS.conditionClass(f,'editMenuOpened',d==='open');}));onleaveRegister(this.uninstall.bind(this));},_handleResize:(function(){var a;return function(){a&&clearTimeout(a);a=this._checkNarrow.bind(this).defer(200);};})(),_checkNarrow:function(){CSS.conditionClass(this.root,'uiNarrowSideNav',Vector2.getElementPosition(this.root).x<20);},_ensureHover:function(a){if(ua.ie()<8)Bootloader.loadComponents('explicit-hover',function(){this._explicitHover.push(new ExplicitHover(this.root,a));}.bind(this));},uninstall:function(){if(this._installed){this._installed=false;this._handlePageTransitions=false;this._arbiterSubscriptions.forEach(Arbiter.unsubscribe);this._selectorSubscriptions.forEach(Selector.unsubscribe.bind(Selector));this._eventHandlers.forEach(function(a){a.remove();});this._explicitHover.forEach(function(a){a.uninstall();});}},initSection:function(a,b){this._initItems(b);this._initSection(a);},addItem:function(a,b){this._initItem(a,b);},_initItems:function(a){var b=function(c,d){var e=this._initItem(c,d);if(c.children)c.children.forEach(function(f){b(f,e);});}.bind(this);$A(a).forEach(function(c){b(c,null);});},_initItem:function(a,b){var c=this.items[a.id]=this._constructItem(a,b);if(c.equals(this.selected)||a.selected)this.setSelected(c);var d=c.getLinkNode();d&&this._eventHandlers.push(Event.listen(d,'click',function(event){return !this.editing;}.bind(this)));return c;},_initSection:function(a){var b=this.sections[a.id]=this._constructSection(a);this._eventHandlers.push(Event.listen(b.node,'click',this.handleSectionClick.bind(this,b)));DOM.scry(b.node,'div.bookmarksMenuButton').forEach(CSS.show);return b;},_constructItem:function(a,b){return new FutureSideNavItem(a,b);},_constructSection:function(a){return new FutureSideNavSection(a);},handleSectionClick:function(a,event){var b=this._getEventTarget(event,'a'),c=this._getItemForNode(b);if(!b){return;}else if(CSS.hasClass(b.parentNode,'uiMenuItem')){this._handleMenuClick(a,c,b.parentNode,event);}else this._handleLinkClick(a,b,event);},_getEventTarget:function(event,a){var b=event.getTarget();if(b.tagName!==a.toUpperCase()){return Parent.byTag(b,a);}else return b;},_handleMenuClick:function(a,b,c,event){if(CSS.hasClass(c,'rearrange'))this.beginEdit(a);},_handleLinkClick:function(a,b,event){if(CSS.hasClass(b,'navEditDone')){this.editing?this.endEdit():this.beginEdit(a);event.kill();}},getItem:function(a){if(this._isCurrentPath(a)){return this._getItemForKey(this._getKey(a.getQueryData())||this.defaultKey);}else return this._getItemForPath(a.getPath());},getNodeForKey:function(a){var b=this._getItemForKey(a);if(b)return b.node;},_isCurrentPath:function(a){return a.getDomain()===this.uri.getDomain()&&a.getPath()===this.uri.getPath();},_getKey:function(a){return a[this.keyParam];},_getItemForNode:function(a){a=Parent.byClass(a,'sideNavItem');return a&&this.items[a.id];},_getItemForKey:function(a){return this._findItem(function(b){return b.matchKey(a);});},_getItemForPath:function(a){return this._findItem(function(b){return b.matchPath(a);});},_findItem:function(a){for(var b in this.items)if(a(this.items[b]))return this.items[b];},removeItem:function(a){if(a&&this.items[a.id]){DOM.remove(a.node);delete this.items[a.id];}},removeItemByKey:function(a){this.removeItem(this._getItemForKey(a));},moveItem:function(a,b,c){var d=DOM.find(a.node,'ul.uiSideNav');(c?DOM.prependContent:DOM.appendContent)(d,b.node);},setLoading:function(a){this.loading&&this.loading.hideLoading();this.loading=a;this.loading&&this.loading.showLoading();},setSelected:function(a){this.setLoading(null);if(this.selected){this.selected.hideSelected();this.selected.getTop().hideChildren();}this.selected=a;if(this.selected){this.selected.showSelected();this.selected.getTop().showChildren();}},handlePageTransition:function(a){var b=this.getItem(a),c=b&&b.endpoint&&this._doPageTransition(b,a);return c;},_doPageTransition:function(a,b){this.setLoading(a);this._sendPageTransition(a.endpoint,copy_properties(this._getTransitionData(a,b),b.getQueryData()));return true;},_sendPageTransition:function(a,b){b.endpoint=a;Arbiter.inform(NavigationMessage.NAVIGATION_BEGIN,{useAjaxPipe:this._useAjaxPipe(a),params:b});},_getTransitionData:function(a,b){var c={};c.sidecol=this.sidecol;c.path=b.getPath();c[this.keyParam]=a.textKey;c.key=a.textKey;return c;},_useAjaxPipe:function(a){return this.ajaxPipe||this.ajaxPipeEndpoints[a];},navigationComplete:function(){this.loading&&this.setSelected(this.loading);},navigationFailed:function(){this.setLoading(null);},navigationSelect:function(a,b){var c=this._getItemForKey(this._getKey(b));if(b.asLoading){this.setLoading(c);}else this.setSelected(c);},navigationCountUpdate:function(a,b){var c=this._getItemForKey(b&&b.key);if(c)if(typeof b.count!=="undefined"){c.setCount(b.count,b.hide);}else if(typeof b.increment!=="undefined")c.incrementCount(b.increment,b.hide);},navigationCountUpdateFromPresence:function(a,b){b=b.obj;if(b)if(!b.class_name||b.class_name&&CSS.hasClass(this.root,b.class_name))if(b.items)for(var c=0;c<b.items.length;c++)this.navigationCountUpdate(a,b.items[c]);},beginEdit:function(a){if(!this.editing){this.editing=true;CSS.addClass(this.root,'editMode');this._updateTrackingData();Bootloader.loadComponents('sortable-side-nav-js',this._initEditor.bind(this,a));}},endEdit:function(){if(this.editing){CSS.removeClass(this.root,'editMode');this.editor.endEdit();this.editor=null;this.editing=false;this._updateTrackingData();}},_updateTrackingData:function(a){var b=this.root.getAttribute('data-gt')||"{}";try{b=JSON.parse(b);if(this.editing){b.editing=true;}else delete b.editing;this.root.setAttribute('data-gt',JSON.stringify(b));}catch(c){}},_initEditor:function(a){this.editor=a.getEditor();this.editor.beginEdit();}});function FutureSideNavSection(a){this.id=a.id;this.node=this.node||$(a.id);this.editEndpoint=a.editEndpoint;}copy_properties(FutureSideNavSection.prototype,{equals:function(a){return a&&a.id===this.id;},getEditor:function(){return new SortableSideNav(DOM.find(this.node,'ul.uiSideNav'),this.editEndpoint);}});function FutureSideNavItem(a,b){this.id=a.id;this.up=b;this.endpoint=a.endpoint;this.type=a.type;this.node=a.node||$(a.id);this.paths=a.path?$A(a.path):[];this.keys=a.key?$A(a.key):[];var c=this._findKeys(this.keys);this.numericKey=c.numeric||this.keys[0];this.textKey=c.text||this.keys[0];this._pathPattern=this._buildRegex(this.paths);this._keyPattern=this._buildRegex(this.keys);this.hideLoading();this.hideSelected();}copy_properties(FutureSideNavItem.prototype,{equals:function(a){return a&&a.id===this.id;},getLinkNode:function(){return (DOM.scry(this.node,'a.item')[0]||DOM.scry(this.node,'a.subitem')[0]);},matchPath:function(a){return this._matchInput(this._pathPattern,a);},matchKey:function(a){return this._matchInput(this._keyPattern,a);},_matchInput:function(a,b){var c=a&&a.exec(b);return c&&c.slice(1);},getTop:function(){return this.isTop()?this:this.up.getTop();},isTop:function(a){return !this.up;},setCount:function(a,b){return this._updateCount(a,true);},incrementCount:function(a,b){return this._updateCount(a,false);},_updateCount:function(a,b,c){var d=DOM.scry(this.node,'span.count')[0],e=d&&DOM.scry(d,'span.countValue')[0];if(e){var f=b?0:parseInt(DOM.getText(e),10),g=Math.max(0,f+a),h=this.isTop()?'hidden':'hiddenSubitem';DOM.setContent(e,g);c&&CSS.conditionClass(this.node,h,!g);CSS.conditionClass(d,'hidden_elem',!g);if(this.isTop()){var i=DOM.scry(this.node,'div.linkWrap')[0];if(i){CSS.conditionClass(i,'noCount',!g);CSS.conditionClass(i,'hasCount',g);}}}Arbiter.inform('NavigationMessage.COUNT_UPDATE_DONE');},showLoading:function(){CSS.addClass(this.node,'loading');},hideLoading:function(){CSS.removeClass(this.node,'loading');},showSelected:function(){CSS.addClass(this.node,'selectedItem');CSS.hasClass(this.node,'hider')&&CSS.addClass(this._getExpanderParent(),'expandedMode');},hideSelected:function(){CSS.removeClass(this.node,'selectedItem');},showChildren:function(){CSS.addClass(this.node,'open');},hideChildren:function(){CSS.removeClass(this.node,'open');},_getExpanderParent:function(){return Parent.byClass(this.node,'expandableSideNav');},_buildRegex:function(a){if(a.length){var b=a.map(function(c){if(typeof c==="string"){return c.replace(/([^a-z0-9_])/ig,'\\$1');}else if(c&&c.regex)return c.regex;});return new RegExp('^(?:'+b.join('|')+')$');}},_findKeys:function(a){var b=/^(app|group|fl)_/,c={};for(var d=0;d<a.length;d++){var e=b.test(a[d]);if(e&&!c.numeric){c.numeric=a[d];}else if(!e&&!c.text)c.text=a[d];if(c.numeric&&c.text)break;}return c;}});
__d("sprintf",[],function(a,b,c,d,e,f){function g(h,i){i=Array.prototype.slice.call(arguments,1);var j=0;return h.replace(/%s/g,function(k){return i[j++];});}e.exports=g;});
__d("Log",["sprintf"],function(a,b,c,d,e,f){var g=b('sprintf'),h={DEBUG:3,INFO:2,WARNING:1,ERROR:0};function i(k,l){var m=Array.prototype.slice.call(arguments,2),n=g.apply(null,m);if(j.level>=k&&window.console)console[l in console?l:'log'](n);}var j={level:-1,Level:h,debug:i.bind(null,h.DEBUG,'debug'),info:i.bind(null,h.INFO,'debug'),warn:i.bind(null,h.WARNING,'debug'),error:i.bind(null,h.ERROR,'debug')};e.exports=j;});
__d("resolveWindow",[],function(a,b,c,d,e,f){function g(h){var i=window,j=h.split('.');try{for(var l=0;l<j.length;l++){var m=j[l],n=/^frames\[['"]?([a-zA-Z0-9\-_]+)['"]?\]$/.exec(m);if(n){i=i.frames[n[1]];}else if(m==='opener'||m==='parent'||m==='top'){i=i[m];}else return null;}}catch(k){return null;}return i;}e.exports=g;});
__d("XD",["function-extensions","Arbiter","DOM","DOMDimensions","Log","URI","UserAgent","copyProperties","resolveWindow"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('DOM'),i=b('DOMDimensions'),j=b('Log'),k=b('URI'),l=b('UserAgent'),m=b('copyProperties'),n=b('resolveWindow'),o='fb_xdm_frame_'+location.protocol.replace(':',''),p={_callbacks:[],_opts:{autoResize:false,allowShrink:true,channelUrl:null,hideOverflow:false,resizeTimeout:100,resizeWidth:false,expectResizeAck:false,resizeAckTimeout:6000},_lastResizeAckId:0,_resizeCount:0,_resizeTimestamp:0,_shrinker:null,init:function(r){this._opts=m(m({},this._opts),r);if(this._opts.autoResize)this._startResizeMonitor();g.subscribe('Connect.Unsafe.resize.ack',function(s,t){if(!t.id)t.id=this._resizeCount;if(t.id>this._lastResizeAckId)this._lastResizeAckId=t.id;}.bind(this));},send:function(r,s){s=s||this._opts.channelUrl;if(!s)return;if(!(/xd_arbiter\.php/.test(s))){if(s.substr(0,4)!='http')return;var t=s+'&'+k.implodeQuery(r),u='f'+(Math.random()*(1<<30)).toString(16).replace('.',''),v=document.body.appendChild(document.createElement('div')),w=false;v.style.position='absolute';v.style.top='-10000px';v.style.width='1px';v.style.height='1px';p._callbacks[u]=function(){if(w){(function(){v.parentNode.removeChild(v);}).defer(3000);delete p._callbacks[u];}};if(l.ie()){var x,y=document.createElement('div');x='<iframe onload="XD._callbacks.'+u+'()"></iframe>';y.innerHTML=x;y.firstChild.setAttribute('src',t);x=y.innerHTML;v.innerHTML='<iframe src="javascript:false"></iframe>';w=true;(function(){v.innerHTML=x;}).defer();}else{var z=document.createElement('iframe');z.onload=p._callbacks[u];v.appendChild(z);w=true;z.src=t;}return;}var aa={},ba=new k(s);m(aa,r);m(aa,k.explodeQuery(ba.getFragment()));var ca=new k(aa.origin),da=ca.getDomain()+(ca.getPort()?':'+ca.getPort():''),ea=n(aa.relation.replace(/^parent\./,'')),fa=ea.frames[o];fa?fa.proxyMessage(k.implodeQuery(aa),[da]):j.warn('No such frame "'+o+'" to proxyMessage to');},_computeSize:function(){var r=i.getDocumentDimensions(),s=0;if(this._opts.resizeWidth){var t=h.getDocumentBodyElement();if(t.clientWidth<t.scrollWidth){s=r.width;}else{var u=t.childNodes;for(var v=0;v<u.length;v++){var w=u[v],x=w.offsetLeft+w.offsetWidth;if(x>s)s=x;}}s=Math.max(s,p.forced_min_width);}r.width=s;if(this._opts.allowShrink){if(!this._shrinker)this._shrinker=h.create('div');h.appendContent(h.getDocumentBodyElement(),this._shrinker);r.height=this._shrinker.offsetTop;}return r;},_startResizeMonitor:function(){var r,s=document.documentElement;if(this._opts.hideOverflow){s.style.overflow='hidden';document.body.style.overflow='hidden';}setInterval((function(){var t=this._computeSize(),u=Date.now(),v=this._lastResizeAckId<this._resizeCount&&(u-this._resizeTimestamp)>this._opts.resizeAckTimeout;if(!r||(this._opts.expectResizeAck&&v)||(this._opts.allowShrink&&r.width!=t.width)||(!this._opts.allowShrink&&r.width<t.width)||(this._opts.allowShrink&&r.height!=t.height)||(!this._opts.allowShrink&&r.height<t.height)){r=t;this._resizeCount++;this._resizeTimestamp=u;var w={type:'resize',height:t.height,ackData:{id:this._resizeCount}};if(t.width&&t.width!=0)w.width=t.width;try{if(k(document.referrer).isFacebookURI()&&window.parent!=window&&window.name&&window.parent.location&&window.parent.location.toString&&k(window.parent.location).isFacebookURI()){var y=window.parent.document.getElementsByTagName('iframe');for(var z=0;z<y.length;z=z+1)if(y[z].name==window.name){if(this._opts.resizeWidth)y[z].style.width=w.width+'px';y[z].style.height=w.height+'px';}}this.send(w);}catch(x){this.send(w);}}}).bind(this),this._opts.resizeTimeout);}},q=m({},p);e.exports.UnverifiedXD=q;e.exports.XD=p;a.UnverifiedXD=q;a.XD=p;});
__d("legacy:connect-xd",["XD"],function(a,b,c,d){a.UnverifiedXD=b('XD').UnverifiedXD;a.XD=b('XD').XD;},3);
var Base64=(function(){var a='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';function b(e){e=(e.charCodeAt(0)<<16)|(e.charCodeAt(1)<<8)|e.charCodeAt(2);return String.fromCharCode(a.charCodeAt(e>>>18),a.charCodeAt((e>>>12)&63),a.charCodeAt((e>>>6)&63),a.charCodeAt(e&63));}var c='>___?456789:;<=_______'+'\0\1\2\3\4\5\6\7\b\t\n\13\f\r\16\17\20\21\22\23\24\25\26\27\30\31'+'______\32\33\34\35\36\37 !"#$%&\'()*+,-./0123';function d(e){e=(c.charCodeAt(e.charCodeAt(0)-43)<<18)|(c.charCodeAt(e.charCodeAt(1)-43)<<12)|(c.charCodeAt(e.charCodeAt(2)-43)<<6)|c.charCodeAt(e.charCodeAt(3)-43);return String.fromCharCode(e>>>16,(e>>>8)&255,e&255);}return {encode:function(e){e=unescape(encodeURI(e));var f=(e.length+2)%3;e=(e+'\0\0'.slice(f)).replace(/[\s\S]{3}/g,b);return e.slice(0,e.length+f-2)+'=='.slice(f);},decode:function(e){e=e.replace(/[^A-Za-z0-9+\/]/g,'');var f=(e.length+3)&3;e=(e+'AAA'.slice(f)).replace(/..../g,d);e=e.slice(0,e.length+f-3);try{return decodeURIComponent(escape(e));}catch(g){throw new Error('Not valid UTF-8');}},encodeObject:function(e){return Base64.encode(JSON.stringify(e));},decodeObject:function(e){return JSON.parse(Base64.decode(e));},encodeNums:function(e){return String.fromCharCode.apply(String,e.map(function(f){return a.charCodeAt((f|-(f>63))&-(f>0)&63);}));}};})();
__d("legacy:dom-scroll",["DOMScroll"],function(a,b,c,d){a.DOMScroll=b('DOMScroll');},3);
__d("PopoverMenuInterface",["Arbiter","ArbiterMixin","Class","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('copyProperties');function k(){}j(k.prototype,h,{getRoot:bagofholding,onShow:bagofholding,onHide:bagofholding,focusAnItem:bagof(false),blur:bagofholding,handleKeydown:bagof(false),done:function(){this.inform('done');}});e.exports=k;});
__d("Popover",["event-extensions","Arbiter","ArbiterMixin","Class","ContextualLayer","CSS","DataStore","DOM","Input","KeyStatus","LayerHideOnEscape","Toggler","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('ContextualLayer'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('Input'),o=b('KeyStatus'),p=b('LayerHideOnEscape'),q=b('Toggler'),r=b('copyProperties');q.subscribe(['show','hide'],function(t,u){var v=l.get(u.getActive(),'Popover');if(v)if(t==='show'){v.showLayer();}else v.hideLayer();});function s(t,u,v,w){this._root=t;this._triggerElem=u;this._behaviors=v;this._config=w;if(!(u.nodeName==='A'&&u.rel==='toggle'))Event.listen(u,'click',function(){q.bootstrap(u);});l.set(t,'Popover',this);}r(s.prototype,h,{_layer:null,_closeListener:null,ensureInit:function(){if(!this._layer)this._init();},showLayer:function(){this.ensureInit();this._layer.show();q.show(this._root);k.addClass(this._root,'selected');this.inform('show');this._triggerElem.setAttribute('aria-expanded','true');},hideLayer:function(){this._layer.hide();this._triggerElem.setAttribute('aria-expanded','false');},isShown:function(){return this._layer.isShown();},setLayerContent:function(t){this.ensureInit();this._layer.setContent(t);},_init:function(){var t=new j({context:this._triggerElem,position:'below'},m.create('div'));t.enableBehavior(p);q.createInstance(t.getRoot()).setSticky(false);t.subscribe('hide',this._onLayerHide.bind(this));this._behaviors&&t.enableBehaviors(this._behaviors);this._layer=t;if(this._config.alignh)this._layer.setAlignment(this._config.alignh);if(this._config.layer_content)this._layer.setContent(this._config.layer_content);this.inform('init',null,g.BEHAVIOR_PERSISTENT);},_onLayerHide:function(){q.hide(this._root);k.removeClass(this._root,'selected');this.inform('hide');if(o.isKeyDown())n.focus(this._triggerElem);}});e.exports=s;});
__d("PopoverMenu",["Arbiter","ArbiterMixin","ARIA","BehaviorsMixin","Class","Input","Keys","KeyStatus","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ARIA'),j=b('BehaviorsMixin'),k=b('Class'),l=b('Input'),m=b('Keys'),n=b('KeyStatus'),o=b('copyProperties');function p(q,r,s,t){this._popover=q;this._triggerElem=r;this._initialMenu=s;q.subscribe('init',this._onLayerInit.bind(this));q.subscribe('show',this._onPopoverShow.bind(this));q.subscribe('hide',this._onPopoverHide.bind(this));t&&this.enableBehaviors(t);}o(p.prototype,h,j);o(p.prototype,{_keydownListener:null,_popoverShown:false,setMenu:function(q){this._menu=q;var r=q.getRoot();this._popover.setLayerContent(r);q.subscribe('done',this._onMenuDone.bind(this));if(this._popoverShown)this._menu.onShow();i.owns(this._triggerElem,r);this.inform('setMenu',null,g.BEHAVIOR_PERSISTENT);},getPopover:function(){return this._popover;},getTriggerElem:function(){return this._triggerElem;},getMenu:function(){return this._menu;},_onLayerInit:function(){this.setMenu(this._initialMenu);},_onPopoverShow:function(){if(this._menu){this._menu.onShow();if(n.isKeyDown())this._menu.focusAnItem();this._keydownListener=Event.listen(document.documentElement,'keydown',this._handleKeydown.bind(this));}this._popoverShown=true;},_onPopoverHide:function(){if(this._menu)this._menu.onHide();if(this._keydownListener){this._keydownListener.remove();this._keydownListener=null;}this._popoverShown=false;},_handleKeydown:function(q){if(q.getModifiers().any)return;var r=Event.getKeyCode(q);switch(r){case m.RETURN:return;case m.UP:case m.DOWN:this._menu.handleKeydown(r);break;default:if(this._menu.handleKeydown(r)===false){this._menu.blur();this._menu.handleKeydown(r);}break;}q.prevent();},_onMenuDone:function(q){this._popover.hideLayer.bind(this._popover).defer();if(n.isKeyDown())l.focus(this._triggerElem);}});e.exports=p;});
__d("PopoverAsyncMenuLoading",["Class","copyProperties","DOM","PopoverMenuInterface"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('DOM'),j=b('PopoverMenuInterface');function k(l){this.parent.construct(this);this._className=l||'';}g.extend(k,j);h(k.prototype,{_root:null,getRoot:function(){if(!this._root)this._root=i.$N('div',{className:this._className},i.$N('div',{className:'uiMenuX uiMenuXLoading'},i.$N('span',{className:'spinner'})));return this._root;}});e.exports=k;});
__d("PopoverAsyncMenu",["AsyncRequest","Class","copyProperties","CSS","DOM","PopoverMenu","PopoverAsyncMenuLoading"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Class'),i=b('copyProperties'),j=b('CSS'),k=b('DOM'),l=b('PopoverMenu'),m=b('PopoverAsyncMenuLoading'),n={},o=0;function p(q,r,s,t,u){this._endpoint=t;this._loadingMenu=s;this._instanceId=o++;n[this._instanceId]=this;this._mouseoverListener=Event.listen(r,'mouseover',this._fetchMenu.bind(this));this.parent.construct(this,q,r,null,u);}p.setMenu=function(q,r){n[q].setMenu(r);};h.extend(p,l);i(p.prototype,{_fetched:false,_mouseoverListener:null,_onLayerInit:function(){if(!this._menu)this.setMenu(this._loadingMenu);this._fetchMenu();},_fetchMenu:function(){if(this._fetched)return;new g().setURI(this._endpoint).setData({pmid:this._instanceId}).send();this._fetched=true;if(this._mouseoverListener){this._mouseoverListener.remove();this._mouseoverListener=null;}}});e.exports=p;});
__d("PopoverMenuOverlappingBorder",["function-extensions","CSS","DOM","Style","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('copyProperties');function k(l){this._popoverMenu=l;this._popover=l.getPopover();this._triggerElem=l.getTriggerElem();}j(k.prototype,{_shortBorder:null,_setMenuSubscription:null,_showSubscription:null,_menuSubscription:null,enable:function(){this._setMenuSubscription=this._popoverMenu.subscribe('setMenu',this._onSetMenu.bind(this));},disable:function(){this._popoverMenu.unsubscribe(this._setMenuSubscription);this._setMenuSubscription=null;this._removeBorderSubscriptions();this._removeShortBorder();},_onSetMenu:function(){this._removeBorderSubscriptions();this._menu=this._popoverMenu.getMenu();this._renderShortBorder(this._menu.getRoot());this._showSubscription=this._popover.subscribe('show',this._updateBorder.bind(this));this._menuSubscription=this._menu.subscribe(['change','resize'],Function.prototype.defer.shield(this._updateBorder.bind(this)));this._updateBorder();},_updateBorder:function(){var l=this._menu.getRoot(),m=this._triggerElem.offsetWidth;i.set(l,'min-width',m+'px');var n=Math.max(l.offsetWidth-m,0);i.set(this._shortBorder,'width',n+'px');},_renderShortBorder:function(l){this._shortBorder=h.$N('div',{className:'uiMenuXShortBorder'});h.appendContent(l,this._shortBorder);g.addClass(l,'uiMenuXWithShortBorder');},_removeShortBorder:function(){if(this._shortBorder){h.remove(this._shortBorder);this._shortBorder=null;g.removeClass(this._popoverMenu.getMenu().getRoot(),'uiMenuXShortBorder');}},_removeBorderSubscriptions:function(){if(this._showSubscription){this._popover.unsubscribe(this._showSubscription);this._showSubscription=null;}if(this._menuSubscription){this._menu.unsubscribe(this._menuSubscription);this._menuSubscription=null;}}});e.exports=k;});
function tz_calculate(a){var b=new Date(),c=b.getTimezoneOffset()/30,d=b.getTime()/1000,e=Math.round((a-d)/1800),f=Math.round(c+e)%48;if(f==0){return 0;}else if(f>24){f-=Math.ceil(f/48)*48;}else if(f<-28)f+=Math.ceil(f/-48)*48;return f*30;}function tz_autoset(a,b){if(!a||undefined==b)return;if(window.tz_autoset.calculated)return;window.tz_autoset.calculated=true;var c=-tz_calculate(a);if(c!=b){var d='/ajax/autoset_timezone_ajax.php';new AsyncRequest().setURI(d).setData({gmt_off:c}).setErrorHandler(bagofholding).setTransportErrorHandler(bagofholding).setOption('suppressErrorAlerts',true).send();}}
__d("FBDesktopDetect",["UserAgent"],function(a,b,c,d,e,f){var g=b('UserAgent'),h='facebook.desktopplugin',i={mimeType:'application/x-facebook-desktop-1',isPluginInstalled:function(){if(g.osx())return false;var j=null;if(a.ActiveXObject){try{j=new a.ActiveXObject(h);if(j)return true;}catch(k){}}else if(a.navigator&&a.navigator.plugins){a.navigator.plugins.refresh(false);for(var l=0,m=a.navigator.plugins.length;l<m;l++){j=a.navigator.plugins[l];if(j.length&&j[0].type===this.mimeType)return true;}}return false;}};e.exports=i;});
__d("legacy:fbdesktop-detect",["FBDesktopDetect"],function(a,b,c,d){a.FbDesktopDetect=b('FBDesktopDetect');},3);
__d("legacy:bind",["bind"],function(a,b,c,d){a.bind=b('bind');},3);
__d("LiveTimer",["CSS","DOM","UserAgent","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('UserAgent'),j=b('tx'),k={restart:function(l){this.serverTime=l;this.localStartTime=Date.now()/1000;this.updateTimeStamps();},getApproximateServerTime:function(){return (this.serverTime-this.localStartTime)*1000+Date.now();},updateTimeStamps:function(){k.timestamps=h.scry(document.body,'abbr.livetimestamp');k.startLoop(20000);},addTimeStamps:function(l){if(!l)return;k.timestamps=k.timestamps||[];if(h.isNodeOfType(l,'abbr')&&g.hasClass(l,'livetimestamp')){k.timestamps.push(l);}else{var m=h.scry(l,'abbr.livetimestamp');for(var n=0;n<m.length;++n)k.timestamps.push(m[n]);}k.startLoop(0);},startLoop:function(l){this.stop();this.timeout=setTimeout(function(){k.loop();},l);},stop:function(){clearTimeout(this.timeout);},updateNode:function(l,m){k.updateNode=(i.ie()<7)?function(n,o){n.nextSibling.nodeValue=o;}:function(n,o){n.firstChild.nodeValue=o;};k.updateNode(l,m);},loop:function(l){if(l)k.updateTimeStamps();var m=Math.floor(k.getApproximateServerTime()/1000),n=-1;k.timestamps&&k.timestamps.forEach(function(p){var q=p.getAttribute('data-utime'),r=k.renderRelativeTime(m,q);if(r.text)k.updateNode(p,r.text);if(r.next!=-1&&(r.next<n||n==-1))n=r.next;});if(n!=-1){var o=Math.max(20000,n*1000);k.timeout=setTimeout(function(){k.loop();},o);}},renderRelativeTime:function(l,m){var n={text:"",next:-1};if(l-m>(12*3600)||(new Date(l*1000).getDay()!=new Date(m*1000).getDay()))return n;var o=l-m,p=Math.floor(o/60),q=Math.floor(p/60);if(p<1){n.text="muutama sekunti sitten";n.next=60-o%60;return n;}if(q<1){if(p==1){n.text="noin minuutti sitten";}else n.text=j._("{number} minuuttia sitten",{number:p});n.next=60-o%60;return n;}if(q!=11)n.next=3600-o%3600;if(q==1){n.text="noin tunti sitten";return n;}n.text=j._("{number} tuntia sitten",{number:q});return n;}};e.exports=k;});
__d("legacy:live-timer",["LiveTimer"],function(a,b,c,d){a.LiveTimer=b('LiveTimer');},3);
__d("ContextualLayerUpdateOnScroll",["event-extensions","Class","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('copyProperties');function i(j){this._layer=j;}h(i.prototype,{_subscriptions:[],enable:function(){this._subscriptions=[this._layer.subscribe('show',this._attachScrollListener.bind(this)),this._layer.subscribe('hide',this._removeScrollListener.bind(this))];},disable:function(){while(this._subscriptions.length)this._layer.unsubscribe(this._subscriptions.pop());this.detach();},_attachScrollListener:function(){if(this._listener)return;var j=this._layer.getContextScrollParent();this._listener=Event.listen(j,'scroll',this._layer.updatePosition.bind(this._layer));},_removeScrollListener:function(){this._listener&&this._listener.remove();this._listener=null;}});e.exports=i;});
__d("Quickling",["AjaxPipeRequest","Arbiter","Class","DataStore","DocumentTitle","DOM","HTML","OnloadHooks","PageTransitions","Run","URI","UserAgent","copyProperties","goOrReplace","isEmpty"],function(a,b,c,d,e,f){var g=b('AjaxPipeRequest'),h=b('Arbiter'),i=b('Class'),j=b('DataStore'),k=b('DocumentTitle'),l=b('DOM'),m=b('HTML'),n=b('OnloadHooks'),o=b('PageTransitions'),p=b('Run'),q=b('URI'),r=b('UserAgent'),s=b('copyProperties'),t=b('goOrReplace'),u=b('isEmpty'),v={isActive:function(){return v._is_active||false;},init:function(x,y,z){if(v._is_initialized)return;s(v,{_is_initialized:true,_is_active:true,_session_length:y,_is_in_transition:false,_title_interval:false,_ie_cache_title:'',_version:x});v._instrumentTimeoutFunc('setInterval');v._instrumentTimeoutFunc('setTimeout');v._inactivePageRegex=new RegExp(z);o.registerHandler(v._transitionHandler,1);},_startQuicklingTransition:function(){v._is_in_transition=true;},_stopQuicklingTransition:function(){(function(){v._is_in_transition=false;}).defer();},isPageActive:function(x){if(x=='#')return false;x=new q(x);if(x.getDomain()&&x.getDomain()!=q().getDomain())return false;if(x.getPath()=='/l.php'){var y=x.getQueryData().u;if(y){y=q(unescape(y)).getDomain();if(y&&y!=q().getDomain())return false;}}var z=x.getPath(),aa=x.getQueryData();if(!u(aa))z+='?'+q.implodeQuery(aa);return !v._inactivePageRegex.test(z);},_setHTML:function(x,y){if(r.ie()<=6){x.innerHTML=y;}else l.setContent(x,m(y).setDeferred(true));},_transitionHandler:function(x){g.setCurrentRequest(null);if(v._isTimeToRefresh())return false;if(!v.isPageActive(x))return false;window.ExitTime=(new Date()).getTime();p.__removeHook('onafterloadhooks');p.__removeHook('onloadhooks');n.runHooks('onleavehooks');h.inform('onload/exit',true);v._startQuicklingTransition();new w(x).setCanvasId('content').send();return true;},_changePageTitle:function(x){x=x||'Facebook';k.set(x);if(r.ie()){v._ie_cache_title=x;if(!v._title_interval)v._title_interval=window.setInterval(function(){var y=v._ie_cache_title,z=k.get();if(y!=z)k.set(y);},5000,false);}},_replaceSyndicationLinks:function(x){var y=document.getElementsByTagName('link');for(var z=0;z<y.length;++z){if(y[z].rel!='alternate')continue;l.remove(y[z]);}if(x.length){var aa=l.find(document,'head');aa&&l.appendContent(aa,m(x[0]));}},_isTimeToRefresh:function(){v._load_count=(v._load_count||0)+1;return v._load_count>=v._session_length;},_instrumentTimeoutFunc:function(x){window[x+'_native']=(function(y){var z=function aa(ba,ca){return y(ba,ca);};return z;})(window[x]);window[x]=function y(z,aa,ba){var ca=window[x+'_native'](z,aa);if(aa>0)if(ba!==false)p.onLeave(function(){clearInterval(ca);});return ca;};}};function w(x){var y={version:v._version};this.parent.construct(this,x,{quickling:y});}i.extend(w,g);s(w.prototype,{_preBootloadFirstResponse:function(x){return true;},_fireDomContentCallback:function(){this._request.cavalry&&this._request.cavalry.setTimeStamp('t_domcontent');v._stopQuicklingTransition();o.transitionComplete();this._onPageDisplayed&&this._onPageDisplayed(this.pipe);this.parent._fireDomContentCallback();},_fireOnloadCallback:function(){if(this._request.cavalry){this._request.cavalry.setTimeStamp('t_hooks');this._request.cavalry.setTimeStamp('t_layout');this._request.cavalry.setTimeStamp('t_onload');}this.parent._fireOnloadCallback();},isPageActive:function(x){return v.isPageActive(x);},_versionCheck:function(x){if(x.version!=v._version){var y=['quickling','ajaxpipe','ajaxpipe_token'];t(window.location,q(x.uri).removeQueryData(y),true);return false;}else return true;},_processFirstResponse:function(x){var y=x.getPayload();v._changePageTitle(y.title);v._replaceSyndicationLinks(y.syndication||[]);window.scrollTo(0,0);var z=y.body_class||'';document.body.className=z;},getSanitizedParameters:function(){return ['quickling'];}});e.exports=v;});
__d("TinyViewport",["event-extensions","CSS","DOM","debounce"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('debounce'),j=i(function(){var k=document.documentElement,l=h.getDocumentScrollElement(),m=k.clientHeight<400||l.clientWidth<l.scrollWidth;g.conditionClass(k,'tinyViewport',m);g.conditionClass(k,'canHaveFixedElements',!m);});j();Event.listen(window,'resize',j);});
__d("ClearableTypeahead",["event-extensions"],function(a,b,c,d,e,f){b('event-extensions');var g={resetOnCloseButtonClick:function(h,i){Event.listen(i,'click',function(){var j=h.getCore();j.reset();j.getElement().focus();});}};e.exports=g;});
var MegaphoneHelper={hideStory:function(a,b,c,d,e){var f={mp_id:a,location:b,context:d};new AsyncRequest().setURI('/ajax/megaphone/megaphone_hide.php').setMethod('POST').setData(f).setHandler(function(h){e&&e(h);}).send();var g=ge(c);if(g)animation(g).to('height',0).duration(500).hide().go();},createModalStory:function(a,b,c,d){var e;if(!a.buttons||!a.buttons.length){a.buttons=Dialog.CLOSE;e=this.hideStory.bind(this,b,c,d,null);}var f=new Dialog(a);if(e)f.setHandler(e);f.show();},buttonOnClick:function(a,b,c,d,e,f){var g=function(){if(e){new AsyncRequest().setURI(d).send();}else document.location.href=d;};if(f){this.hideStory(a,b,'',c,function(){g();});}else g();}};
__d("Cookie",["Env"],function(a,b,c,d,e,f){var g=b('Env'),h={set:function(i,j,k,l,m){if(g.no_cookies&&i!='tpa')return;document.cookie=i+"="+encodeURIComponent(j)+"; "+(k?"expires="+(new Date(Date.now()+k)).toGMTString()+"; ":"")+"path="+(l||'/')+"; domain="+window.location.hostname.replace(/^.*(\.facebook\..*)$/i,'$1')+(m?"; secure":"");},clear:function(i){document.cookie=i+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; "+"path=/; domain="+window.location.hostname.replace(/^.*(\.facebook\..*)$/i,'$1');},get:function(i){var j=document.cookie.match('(?:^|;\\s*)'+i+'=(.*?)(?:;|$)');return (j?decodeURIComponent(j[1]):j);}};e.exports=h;});
__d("legacy:cookie",["Cookie"],function(a,b,c,d){var e=b('Cookie');a.getCookie=e.get;a.setCookie=e.set;a.clearCookie=e.clear;},3);
__d("AsyncSignal",["Env"],function(a,b,c,d,e,f){var g=b('Env');function h(i,j){this.data=j||{};if(g.tracking_domain&&i.charAt(0)=='/')i=g.tracking_domain+i;this.uri=i;this.handler=null;}h.prototype.setHandler=function(i){this.handler=i;return this;};h.prototype.send=function(){var i=this.handler,j=this.data,k=this.uri,l=[],m=new Image(),n=g.fb_dtsg;j.asyncSignal=Math.floor(Math.random()*10000)+1;if(n)j.fb_dtsg=n;j.__user=g.user;if(g.fb_isb)j.fb_isb=g.fb_isb;for(var o in j)l.push(encodeURIComponent(o)+'='+encodeURIComponent(j[o]));if(k.indexOf('?')==-1)k+='?';k+=l.join('&');if(i)m.onload=m.onerror=(function(p,q){return function(){q((p.height==1));};})(m,i);m.src=k;return this;};e.exports=h;});
__d("legacy:async-signal",["AsyncSignal"],function(a,b,c,d){a.AsyncSignal=b('AsyncSignal');},3);
__d("URI",["copyProperties","goURI"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('goURI');function i(j){if(!(this instanceof i))return new i(j||window.location.href);this.parse(j||'');}g(i,{getRequestURI:function(j,k){j=j===undefined||j;if(j&&window.PageTransitions&&PageTransitions.isInitialized()){return PageTransitions.getCurrentURI(!!k).getQualifiedURI();}else return new i(window.location.href);},getMostRecentURI:function(){if(window.PageTransitions&&PageTransitions.isInitialized()){return PageTransitions.getMostRecentURI().getQualifiedURI();}else return new i(window.location.href);},getNextURI:function(){if(window.PageTransitions&&PageTransitions.isInitialized()){return PageTransitions.getNextURI().getQualifiedURI();}else return new i(window.location.href);},expression:/(((\w+):\/\/)([^\/:]*)(:(\d+))?)?([^#?]*)(\?([^#]*))?(#(.*))?/,arrayQueryExpression:/^(\w+)((?:\[\w*\])+)=?(.*)/,explodeQuery:function(j){if(!j)return {};var k={};j=j.replace(/%5B/ig,'[').replace(/%5D/ig,']');j=j.split('&');for(var l=0,m=j.length;l<m;l++){var n=j[l].match(i.arrayQueryExpression);if(!n){var o=j[l].split('=');k[i.decodeComponent(o[0])]=o[1]===undefined?null:i.decodeComponent(o[1]);}else{var p=n[2].split(/\]\[|\[|\]/).slice(0,-1),q=n[1],r=i.decodeComponent(n[3]||'');p[0]=q;var s=k;for(var t=0;t<p.length-1;t++)if(p[t]){if(s[p[t]]===undefined)if(p[t+1]&&!p[t+1].match(/^\d+$/)){s[p[t]]={};}else s[p[t]]=[];s=s[p[t]];}else{if(p[t+1]&&!p[t+1].match(/^\d+$/)){s.push({});}else s.push([]);s=s[s.length-1];}if(s instanceof Array&&p[p.length-1]===''){s.push(r);}else s[p[p.length-1]]=r;}}return k;},implodeQuery:function(j,k,l){k=k||'';if(l===undefined)l=true;var m=[];if(j===null||j===undefined){m.push(l?i.encodeComponent(k):k);}else if(j instanceof Array){for(var n=0;n<j.length;++n)try{if(j[n]!==undefined)m.push(i.implodeQuery(j[n],k?(k+'['+n+']'):n));}catch(o){}}else if(typeof(j)=='object'){if(('nodeName' in j)&&('nodeType' in j)){m.push('{node}');}else for(var p in j)try{if(j[p]!==undefined)m.push(i.implodeQuery(j[p],k?(k+'['+p+']'):p));}catch(o){}}else if(l){m.push(i.encodeComponent(k)+'='+i.encodeComponent(j));}else m.push(k+'='+j);return m.join('&');},encodeComponent:function(j){return encodeURIComponent(j).replace(/%5D/g,"]").replace(/%5B/g,"[");},decodeComponent:function(j){return decodeURIComponent(j.replace(/\+/g,' '));},INVALID_DOMAIN:'invalid.invalid',sanitizeDomain:function(j){var k=new RegExp('[\\x00-\\x2c\\x2f\\x3b-\\x40\\x5c\\x5e\\x60\\x7b-\\x7f'+'\\uFDD0-\\uFDEF\\uFFF0-\\uFFFF'+'\\u2047\\u2048\\uFE56\\uFE5F\\uFF03\\uFF0F\\uFF1F]');if(k.test(j)){return i.INVALID_DOMAIN;}else return j;}});g(i.prototype,{parse:function(j){var k=j.toString().match(i.expression);g(this,{protocol:k[3]||'',domain:i.sanitizeDomain(k[4]||''),port:k[6]||'',path:k[7]||'',query_s:k[9]||'',fragment:k[11]||''});return this;},setProtocol:function(j){this.protocol=j;return this;},getProtocol:function(){return this.protocol;},setQueryData:function(j){this.query_s=i.implodeQuery(j);return this;},addQueryData:function(j){return this.setQueryData(g(this.getQueryData(),j));},removeQueryData:function(j){if(!(j instanceof Array))j=[j];var k=this.getQueryData();for(var l=0,m=j.length;l<m;++l)delete k[j[l]];return this.setQueryData(k);},getQueryData:function(){return i.explodeQuery(this.query_s);},setFragment:function(j){this.fragment=j;return this;},getFragment:function(){return this.fragment;},setDomain:function(j){this.domain=i.sanitizeDomain(j);return this;},getDomain:function(){return this.domain;},setPort:function(j){this.port=j;return this;},getPort:function(){return this.port;},setPath:function(j){this.path=j;return this;},getPath:function(){return this.path.replace(/^\/+/,'/');},isEmpty:function(){return !(this.path||this.protocol||this.domain||this.port||this.query_s||this.fragment);},toString:function(){var j='';this.protocol&&(j+=this.protocol+'://');this.domain&&(j+=this.domain);this.port&&(j+=':'+this.port);if(this.domain&&!this.path)j+='/';this.path&&(j+=this.path);this.query_s&&(j+='?'+this.query_s);this.fragment&&(j+='#'+this.fragment);return j;},valueOf:function(){return this.toString();},isFacebookURI:function(){if(!i._facebookURIRegex)i._facebookURIRegex=new RegExp('(^|\\.)facebook\\.com([^.]*)$','i');return (!this.domain||i._facebookURIRegex.test(this.domain));},isQuicklingEnabled:function(){return window.Quickling&&Quickling.isActive()&&Quickling.isPageActive(this);},getRegisteredDomain:function(){if(!this.domain)return '';if(!this.isFacebookURI())return null;var j=this.domain.split('.'),k=j.indexOf('facebook');return j.slice(k).join('.');},getUnqualifiedURI:function(){return new i(this).setProtocol(null).setDomain(null).setPort(null);},getQualifiedURI:function(){var j=new i(this);if(!j.getDomain()){var k=i();j.setProtocol(k.getProtocol()).setDomain(k.getDomain()).setPort(k.getPort());}return j;},isSameOrigin:function(j){var k=j||window.location.href;if(!(k instanceof i))k=new i(k.toString());if(this.getProtocol()&&this.getProtocol()!=k.getProtocol())return false;if(this.getDomain()&&this.getDomain()!=k.getDomain())return false;return true;},go:function(j){h(this,j);},setSubdomain:function(j){var k=new i(this).getQualifiedURI(),l=k.getDomain().split('.');if(l.length<=2){l.unshift(j);}else l[0]=j;return k.setDomain(l.join('.'));},getSubdomain:function(){if(!this.getDomain())return '';var j=this.getDomain().split('.');if(j.length<=2){return '';}else return j[0];},setSecure:function(j){return this.setProtocol(j?'https':'http');},isSecure:function(){return this.getProtocol()=='https';}});e.exports=i;});
__d("legacy:uri",["URI"],function(a,b,c,d){a.URI=b('URI');},3);
function detect_broken_proxy_cache(a,b){var c=getCookie(b);if((c!=a)&&(c!=null)&&(a!='0')){var d={c:'si_detect_broken_proxy_cache',m:b+' '+a+' '+c},e=new URI('/common/scribe_endpoint.php').getQualifiedURI().toString();new AsyncSignal(e,d).send();}}
__d("DataStore",[],function(a,b,c,d,e,f){var g={},h=1;function i(l){if(typeof l=='string'){return 'str_'+l;}else return 'elem_'+(l.__FB_TOKEN||(l.__FB_TOKEN=[h++]))[0];}function j(l){var m=i(l);return g[m]||(g[m]={});}var k={set:function(l,m,n){var o=j(l);o[m]=n;return l;},get:function(l,m,n){var o=j(l),p=o[m];if(typeof p==='undefined'&&l.getAttribute){var q=l.getAttribute('data-'+m);p=(null===q)?undefined:q;}if((n!==undefined)&&(p===undefined))p=o[m]=n;return p;},remove:function(l,m){var n=j(l),o=n[m];delete n[m];return o;},purge:function(l){delete g[i(l)];}};e.exports=k;});
__d("UserAgent",[],function(a,b,c,d,e,f){var g=false,h,i,j,k,l,m,n,o,p,q,r,s,t,u;function v(){if(g)return;g=true;var x=navigator.userAgent,y=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))/.exec(x),z=/(Mac OS X)|(Windows)|(Linux)/.exec(x);r=/\b(iPhone|iP[ao]d)/.exec(x);s=/\b(iP[ao]d)/.exec(x);p=/Android/i.exec(x);t=/FBAN\/\w+;/i.exec(x);u=/Mobile/i.exec(x);q=!!(/Win64/.exec(x));if(y){h=y[1]?parseFloat(y[1]):NaN;if(h&&document.documentMode)h=document.documentMode;i=y[2]?parseFloat(y[2]):NaN;j=y[3]?parseFloat(y[3]):NaN;k=y[4]?parseFloat(y[4]):NaN;if(k){y=/(?:Chrome\/(\d+\.\d+))/.exec(x);l=y&&y[1]?parseFloat(y[1]):NaN;}else l=NaN;}else h=i=j=l=k=NaN;if(z){if(z[1]){var aa=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(x);m=aa?parseFloat(aa[1].replace('_','.')):true;}else m=false;n=!!z[2];o=!!z[3];}else m=n=o=false;}var w={ie:function(){return v()||h;},ie64:function(){return w.ie()&&q;},firefox:function(){return v()||i;},opera:function(){return v()||j;},safari:function(){return v()||k;},chrome:function(){return v()||l;},windows:function(){return v()||n;},osx:function(){return v()||m;},linux:function(){return v()||o;},iphone:function(){return v()||r;},mobile:function(){return v()||(r||s||p||u);},nativeApp:function(){return v()||t;},android:function(){return v()||p;},ipad:function(){return v()||s;}};e.exports=w;});
__d("createObjectFrom",["hasArrayNature"],function(a,b,c,d,e,f){var g=b('hasArrayNature');function h(i,j){var k={},l=g(j);if(typeof j=='undefined')j=true;for(var m=i.length;m--;)k[i[m]]=l?j[m]:j;return k;}e.exports=h;});
__d("DOMQuery",["CSS","UserAgent","createArrayFrom","createObjectFrom","ge"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('UserAgent'),i=b('createArrayFrom'),j=b('createObjectFrom'),k=b('ge'),l={find:function(m,n){var o=l.scry(m,n);return o[0];},scry:function(m,n){if(!m||!m.getElementsByTagName)return [];var o=n.split(' '),p=[m];for(var q=0;q<o.length;q++){if(p.length===0)break;if(o[q]==='')continue;var r=o[q],s=o[q],t=[],u=false;if(r.charAt(0)=='^')if(q===0){u=true;r=r.slice(1);}else return [];r=r.replace(/\./g,' .');r=r.replace(/\#/g,' #');r=r.replace(/\[/g,' [');var v=r.split(' '),w=v[0]||'*',x=w=='*',y=v[1]&&v[1].charAt(0)=='#';if(y){var z=k(v[1].slice(1),true);if(z&&(x||z.tagName.toLowerCase()==w))for(var aa=0;aa<p.length;aa++)if(u&&l.contains(z,p[aa])){t=[z];break;}else if(document==p[aa]||l.contains(p[aa],z)){t=[z];break;}}else{var ba=[],ca=p.length,da,ea=!u&&s.indexOf('[')<0&&document.querySelectorAll;for(var fa=0;fa<ca;fa++){if(u){da=[];var ga=p[fa].parentNode;while(l.isElementNode(ga)){if(x||ga.tagName.toLowerCase()==w)da.push(ga);ga=ga.parentNode;}}else if(ea){da=p[fa].querySelectorAll(s);}else da=p[fa].getElementsByTagName(w);var ha=da.length;for(var ia=0;ia<ha;ia++)ba.push(da[ia]);}if(!ea)for(var ja=1;ja<v.length;ja++){var ka=v[ja],la=ka.charAt(0)=='.',ma=ka.substring(1);for(fa=0;fa<ba.length;fa++){var na=ba[fa];if(!na)continue;if(la){if(!g.hasClass(na,ma))delete ba[fa];continue;}else{var oa=ka.slice(1,ka.length-1);if(oa.indexOf('=')==-1){if(na.getAttribute(oa)===null){delete ba[fa];continue;}}else{var pa=oa.split('='),qa=pa[0],ra=pa[1];ra=ra.slice(1,ra.length-1);if(na.getAttribute(qa)!=ra){delete ba[fa];continue;}}}}}for(fa=0;fa<ba.length;fa++)if(ba[fa]){t.push(ba[fa]);if(u)break;}}p=t;}return p;},getText:(function(){var m=document.createElement('div'),n=m.textContent!=null?'textContent':'innerText';return function(o){if(l.isTextNode(o)){return o.data;}else if(l.isElementNode(o)){return o[n];}else return '';};})(),getSelection:function(){var m=window.getSelection,n=document.selection;if(m){return m()+'';}else if(n)return n.createRange().text;return null;},contains:function(m,n){m=k(m);n=k(n);if(!m||!n){return false;}else if(m===n){return true;}else if(l.isTextNode(m)){return false;}else if(l.isTextNode(n)){return l.contains(m,n.parentNode);}else if(m.contains){return m.contains(n);}else if(m.compareDocumentPosition){return !!(m.compareDocumentPosition(n)&16);}else return false;},getRootElement:function(){var m=null;if(window.Quickling&&Quickling.isActive())m=k('content');return m||document.body;},isNode:function(m){return !!(m&&(typeof Node=='object'?m instanceof Node:typeof m=="object"&&typeof m.nodeType=='number'&&typeof m.nodeName=='string'));},isNodeOfType:function(m,n){var o=i(n).join('|').toUpperCase().split('|'),p=j(o);return l.isNode(m)&&m.nodeName in p;},isElementNode:function(m){return l.isNode(m)&&m.nodeType==1;},isTextNode:function(m){return l.isNode(m)&&m.nodeType==3;},getDocumentScrollElement:function(m){m=m||document;if(g.hasClass(m.documentElement,'wrapped')){var n=m.getElementById('body');if(n)return n;}var o=h.chrome()||h.safari();return !o&&m.compatMode==='CSS1Compat'?m.documentElement:m.body;},getDocumentBodyElement:function(m){m=m||document;if(g.hasClass(m.documentElement,'wrapped')){var n=m.getElementById('body');if(n)return n;}return m.body;}};e.exports=l;});
__d("getObjectValues",["hasArrayNature"],function(a,b,c,d,e,f){var g=b('hasArrayNature');function h(i){var j=[];for(var k in i)j.push(i[k]);return j;}e.exports=h;});
__d("event-extensions",["event-form-bubbling","DataStore","DOMQuery","ErrorUtils","Parent","UserAgent","$","copyProperties","getObjectValues","userAction"],function(a,b,c,d,e,f){b('event-form-bubbling');var g=b('DataStore'),h=b('DOMQuery'),i=b('ErrorUtils'),j=b('Parent'),k=b('UserAgent'),l=b('$'),m=b('copyProperties'),n=b('getObjectValues'),o=b('userAction');Event.DATASTORE_KEY='Event.listeners';if(!Event.prototype)Event.prototype={};function p(y,z,aa){this.target=y;this.type=z;this.data=aa;}m(p.prototype,{getData:function(){this.data=this.data||{};return this.data;},stop:function(){this.cancelBubble=true;this.stopPropagation&&this.stopPropagation();return this;},prevent:function(){this.returnValue=false;this.preventDefault&&this.preventDefault();return this;},kill:function(){this.stop().prevent();return false;},getTarget:function(){var y=this.target||this.srcElement;return y?l(y):null;}});function q(y){if(y instanceof p)return y;y=y||window.event||{};if(!y._inherits_from_prototype)for(var z in Event.prototype)try{y[z]=Event.prototype[z];}catch(aa){}return y;}m(Event.prototype,{_inherits_from_prototype:true,getRelatedTarget:function(){var y=this.relatedTarget||(this.fromElement===this.srcElement?this.toElement:this.fromElement);return y?l(y):null;},getModifiers:function(){var y={control:!!this.ctrlKey,shift:!!this.shiftKey,alt:!!this.altKey,meta:!!this.metaKey};y.access=k.osx()?y.control:y.alt;y.any=y.control||y.shift||y.alt||y.meta;return y;},isMiddleClick:function(){if(this.which)return this.which===2;return this.button&&this.button===4;}});m(Event.prototype,p.prototype);m(Event,{listen:function(y,z,aa,ba){if(typeof y=='string')y=l(y);if(typeof ba=='undefined')ba=Event.Priority.NORMAL;if(typeof z=='object'){var ca={};for(var da in z)ca[da]=Event.listen(y,da,z[da],ba);return ca;}if(z.match(/^on/i))throw new TypeError("Bad event name `"+event+"': use `click', not `onclick'.");if(y.nodeName=='LABEL'&&z=='click'){var ea=y.getElementsByTagName('input');y=ea.length==1?ea[0]:y;}else if(y===window&&z==='scroll'){var fa=h.getDocumentScrollElement();if(fa!==document.documentElement&&fa!==document.body)y=fa;}var ga=g.get(y,s,{});if(u[z]){var ha=u[z];z=ha.base;aa=ha.wrap(aa);}v(y,z);var ia=ga[z];if(!(ba in ia))ia[ba]=[];var ja=ia[ba].length,ka=new x(aa,ia[ba],ja);ia[ba].push(ka);return ka;},stop:function(y){return q(y).stop();},prevent:function(y){return q(y).prevent();},kill:function(y){return q(y).kill();},getKeyCode:function(event){event=q(event);if(!event)return false;switch(event.keyCode){case 63232:return 38;case 63233:return 40;case 63234:return 37;case 63235:return 39;case 63272:case 63273:case 63275:return null;case 63276:return 33;case 63277:return 34;}if(event.shiftKey)switch(event.keyCode){case 33:case 34:case 37:case 38:case 39:case 40:return null;}return event.keyCode;},getPriorities:function(){if(!r){var y=n(Event.Priority);y.sort(function(z,aa){return z-aa;});r=y;}return r;},fire:function(y,z,aa){var ba=new p(y,z,aa),ca;do{var da=Event.__getHandler(y,z);if(da)ca=da(ba);y=y.parentNode;}while(y&&ca!==false&&!ba.cancelBubble);return ca!==false;},__fire:function(y,z,event){var aa=Event.__getHandler(y,z);if(aa)return aa(q(event));},__getHandler:function(y,z){return g.get(y,Event.DATASTORE_KEY+z);},getPosition:function(y){y=q(y);var z=h.getDocumentScrollElement(),aa=y.clientX+z.scrollLeft,ba=y.clientY+z.scrollTop;return {x:aa,y:ba};}});var r=null,s=Event.DATASTORE_KEY,t=function(y){return function(z){if(!h.contains(this,z.getRelatedTarget()))return y.call(this,z);};},u={mouseenter:{base:'mouseover',wrap:t},mouseleave:{base:'mouseout',wrap:t}},v=function(y,z){var aa='on'+z,ba=w.bind(y),ca=g.get(y,s);if(z in ca)return;ca[z]={};if(y.addEventListener){y.addEventListener(z,ba,false);}else if(y.attachEvent)y.attachEvent(aa,ba);g.set(y,s+z,ba);if(y[aa]){var da=y===document.documentElement?Event.Priority._BUBBLE:Event.Priority.TRADITIONAL,ea=y[aa];y[aa]=null;Event.listen(y,z,ea,da);}if(y.nodeName==='FORM'&&z==='submit')Event.listen(y,z,Event.__bubbleSubmit.curry(y),Event.Priority._BUBBLE);},w=function(event){event=q(event);var y=event.type;if(!g.get(this,s))throw new Error("Bad listenHandler context.");var z=g.get(this,s)[y];if(!z)throw new Error("No registered handlers for `"+y+"'.");if(y=='click'){var aa=j.byTag(event.getTarget(),'a'),ba=o('click',aa,event).set_namespace('evt_ext');if(window.ArbiterMonitor)window.ArbiterMonitor.initUA(ba,[aa]);}var ca=Event.getPriorities();for(var da=0;da<ca.length;da++){var ea=ca[da];if(ea in z){var fa=z[ea];for(var ga=0;ga<fa.length;ga++){if(!fa[ga])continue;var ha=fa[ga].fire(this,event);if(ha===false){return event.kill();}else if(event.cancelBubble)event.stop();}}}return event.returnValue;};Event.Priority={URGENT:-20,TRADITIONAL:-10,NORMAL:0,_BUBBLE:1000};function x(y,z,aa){this._handler=y;this._container=z;this._index=aa;}m(x.prototype,{remove:function(){delete this._handler;delete this._container[this._index];},fire:function(y,event){return i.applyWithGuard(this._handler,y,[event],function(z){z.event_type=event.type;z.dom_element=y.name||y.id;z.category='eventhandler';});}});a.$E=f.$E=q;});
__d("evalGlobal",[],function(a,b,c,d,e,f){function g(h){if(typeof h!='string')throw new TypeError('JS sent to evalGlobal is not a string. Only strings are permitted.');if(!h)return;var i=document.createElement('script');try{i.appendChild(document.createTextNode(h));}catch(j){i.text=h;}var k=document.getElementsByTagName('head')[0]||document.documentElement;k.appendChild(i);k.removeChild(i);}e.exports=g;});
__d("HTML",["function-extensions","Bootloader","UserAgent","copyProperties","createArrayFrom","evalGlobal"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Bootloader'),h=b('UserAgent'),i=b('copyProperties'),j=b('createArrayFrom'),k=b('evalGlobal');function l(m){if(m&&m.__html)m=m.__html;if(!(this instanceof l)){if(m instanceof l)return m;return new l(m);}this._content=m;this._defer=false;this._extra_action='';this._nodes=null;this._inline_js=bagofholding;this._rootNode=null;return this;}l.isHTML=function(m){return m&&(m instanceof l||m.__html!==undefined);};l.replaceJSONWrapper=function(m){return m&&m.__html!==undefined?new l(m.__html):m;};i(l.prototype,{toString:function(){var m=this._content||'';if(this._extra_action)m+='<script type="text/javascript">'+this._extra_action+'</scr'+'ipt>';return m;},setAction:function(m){this._extra_action=m;return this;},getAction:function(){this._fillCache();var m=function(){this._inline_js();k(this._extra_action);}.bind(this);if(this.getDeferred()){return m.defer.bind(m);}else return m;},setDeferred:function(m){this._defer=!!m;return this;},getDeferred:function(){return this._defer;},getContent:function(){return this._content;},getNodes:function(){this._fillCache();return this._nodes;},getRootNode:function(){var m=this.getNodes();if(m.length===1){this._rootNode=m[0];}else{var n=document.createDocumentFragment();for(var o=0;o<m.length;o++)n.appendChild(m[o]);this._rootNode=n;}return this._rootNode;},_fillCache:function(){if(null!==this._nodes)return;var m=this._content;if(!m){this._nodes=[];return;}m=m.replace(/(<(\w+)[^>]*?)\/>/g,function(x,y,z){return z.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?x:y+'></'+z+'>';});var n=m.trim().toLowerCase(),o=document.createElement('div'),p=false,q=(!n.indexOf('<opt')&&[1,'<select multiple="multiple" class="__WRAPPER">','</select>'])||(!n.indexOf('<leg')&&[1,'<fieldset class="__WRAPPER">','</fieldset>'])||(n.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,'<table class="__WRAPPER">','</table>'])||(!n.indexOf('<tr')&&[2,'<table><tbody class="__WRAPPER">','</tbody></table>'])||((!n.indexOf('<td')||!n.indexOf('<th'))&&[3,'<table><tbody><tr class="__WRAPPER">','</tr></tbody></table>'])||(!n.indexOf('<col')&&[2,'<table><tbody></tbody><colgroup class="__WRAPPER">','</colgroup></table>'])||null;if(null===q){o.className='__WRAPPER';if(h.ie()){q=[0,'<span style="display:none">&nbsp;</span>',''];p=true;}else q=[0,'',''];}o.innerHTML=q[1]+m+q[2];while(q[0]--)o=o.lastChild;if(p)o.removeChild(o.firstChild);o.className!='__WRAPPER';if(h.ie()){var r;if(!n.indexOf('<table')&&-1==n.indexOf('<tbody')){r=o.firstChild&&o.firstChild.childNodes;}else if(q[1]=='<table>'&&-1==n.indexOf('<tbody')){r=o.childNodes;}else r=[];for(var s=r.length-1;s>=0;--s)if(r[s].nodeName&&r[s].nodeName.toLowerCase()=='tbody'&&r[s].childNodes.length==0)r[s].parentNode.removeChild(r[s]);}var t=o.getElementsByTagName('script'),u=[];for(var v=0;v<t.length;v++)if(t[v].src){u.push(g.requestResource.bind(g,'js',t[v].src));}else u.push(k.bind(null,t[v].innerHTML));for(var v=t.length-1;v>=0;v--)t[v].parentNode.removeChild(t[v]);var w=function(){for(var x=0;x<u.length;x++)u[x]();};this._nodes=j(o.childNodes);this._inline_js=w;}});e.exports=l;});
__d("isScalar",[],function(a,b,c,d,e,f){function g(h){return (/string|number|boolean/).test(typeof h);}e.exports=g;});
__d("DOM",["event-extensions","CSS","DOMQuery","HTML","UserAgent","$","copyProperties","createArrayFrom","isScalar","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOMQuery'),i=b('HTML'),j=b('UserAgent'),k=b('$'),l=b('copyProperties'),m=b('createArrayFrom'),n=b('isScalar'),o=b('tx'),p='js_',q=0,r={};l(r,h);l(r,{create:function(v,w,x){var y=document.createElement(v);if(w)r.setAttributes(y,w);if(x!=null)r.setContent(y,x);return y;},setAttributes:function(v,w){if(w.type)v.type=w.type;for(var x in w){var y=w[x],z=(/^on/i).test(x);if(x=='type'){continue;}else if(x=='style'){if(typeof y=='string'){v.style.cssText=y;}else l(v.style,y);}else if(z){Event.listen(v,x.substr(2),y);}else if(x in v){v[x]=y;}else if(v.setAttribute)v.setAttribute(x,y);}},prependContent:function(v,w){return s(w,v,function(x){v.firstChild?v.insertBefore(x,v.firstChild):v.appendChild(x);});},insertAfter:function(v,w){var x=v.parentNode;return s(w,x,function(y){v.nextSibling?x.insertBefore(y,v.nextSibling):x.appendChild(y);});},insertBefore:function(v,w){var x=v.parentNode;return s(w,x,function(y){x.insertBefore(y,v);});},setContent:function(v,w){r.empty(v);return r.appendContent(v,w);},appendContent:function(v,w){return s(w,v,function(x){v.appendChild(x);});},replace:function(v,w){var x=v.parentNode;return s(w,x,function(y){x.replaceChild(y,v);});},remove:function(v){v=k(v);if(v.parentNode)v.parentNode.removeChild(v);},empty:function(v){v=k(v);while(v.firstChild)r.remove(v.firstChild);},getID:function(v){var w=v.id;if(!w){w=p+q++;v.id=w;}return w;}});function s(v,w,x){v=i.replaceJSONWrapper(v);if(v instanceof i&&''===w.innerHTML&&-1===v.toString().indexOf('<scr'+'ipt')){var y=j.ie();if(!y||(y>7&&!h.isNodeOfType(w,['table','tbody','thead','tfoot','tr','select','fieldset']))){var z=y?'<em style="display:none;">&nbsp;</em>':'';w.innerHTML=z+v;y&&w.removeChild(w.firstChild);return m(w.childNodes);}}else if(h.isTextNode(w)){w.data=v;return [v];}var aa=document.createDocumentFragment(),ba,ca=[],da=[];if(!Array.isArray(v))v=[v];for(var ea=0;ea<v.length;ea++){ba=i.replaceJSONWrapper(v[ea]);if(ba instanceof i){da.push(ba.getAction());var fa=ba.getNodes();for(var ga=0;ga<fa.length;ga++){ca.push(fa[ga]);aa.appendChild(fa[ga]);}}else if(n(ba)){var ha=document.createTextNode(ba);ca.push(ha);aa.appendChild(ha);}else if(h.isNode(ba)){ca.push(ba);aa.appendChild(ba);}}x(aa);da.forEach(function(ia){ia();});return ca;}function t(v){function w(x){return r.create('div',{},x).innerHTML;}return function(x,y){var z={};if(y)for(var aa in y)z[aa]=w(y[aa]);return i(v(x,z));};}r.tx=t(o);r.tx._=r._tx=t(o._);function u(v,w,x){if(typeof w!='object'||h.isNode(w)||Array.isArray(w)||i.isHTML(w)){x=w;w=null;}return r.create(v,w,x);}r.$N=u;e.exports=r;});
__d("DropdownContextualHelpLink",["copyProperties","DOM","ge"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('DOM'),i=b('ge'),j={set:function(k){var l=i('navHelpCenter');if(l!==null)h.replace(l,k);}};e.exports=j;});
__d("Style",["DOMQuery","$"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h=b('$');function i(l){return l.replace(/([A-Z])/g,'-$1').toLowerCase();}function j(l,m){var n=k.get(l,m);return (n==='auto'||n==='scroll');}var k={set:function(l,m,n){switch(m){case 'opacity':l.style.opacity=n;l.style.filter=n!==''?'alpha(opacity='+n*100+')':'';break;case 'float':l.style.cssFloat=l.style.styleFloat=n;break;default:m=m.replace(/-(.)/g,function(o,p){return p.toUpperCase();});l.style[m]=n;}return l;},get:function(l,m){l=h(l);m=m.replace(/-(.)/g,function(o,p){return p.toUpperCase();});var n;if(window.getComputedStyle){n=window.getComputedStyle(l,null);if(n)return n.getPropertyValue(i(m));}if(document.defaultView&&document.defaultView.getComputedStyle){n=document.defaultView.getComputedStyle(l,null);if(n)return n.getPropertyValue(i(m));if(m=="display")return "none";}if(l.currentStyle)return l.currentStyle[m];return l.style&&l.style[m];},getFloat:function(l,m){return parseFloat(k.get(l,m),10);},getOpacity:function(l){l=h(l);var m=k.get(l,'filter'),n=null;if(m&&(n=/(\d+(?:\.\d+)?)/.exec(m))){return parseFloat(n.pop())/100;}else if(m=k.get(l,'opacity')){return parseFloat(m);}else return 1;},isFixed:function(l){while(l&&l!==document.documentElement){if(k.get(l,'position')==='fixed')return true;l=l.parentNode;}return false;},getScrollParent:function(l){if(!l)return null;while(l!==document.body){if(j(l,'overflow')||j(l,'overflowY')||j(l,'overflowX'))return l;l=l.parentNode;}return window;}};e.exports=k;});
__d("legacy:css",["Style","copyProperties","CSS"],function(a,b,c,d){var e=b('Style'),f=b('copyProperties'),g=b('CSS');f(g,{setStyle:e.set,getStyle:e.get,getStyleFloat:e.getFloat,getOpacity:e.getOpacity,isFixed:e.isFixed,getScrollParent:e.getScrollParent});a.CSS=g;},3);
__d("css-support",["CSS","copyProperties"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('copyProperties');h(g,{supportsBorderRadius:function(){var i=['KhtmlBorderRadius','OBorderRadius','MozBorderRadius','WebkitBorderRadius','msBorderRadius','borderRadius'],j=false,k=document.createElement('div');for(var l=i.length;l>=0;l--)if(j=k.style[i[l]]!==undefined)break;g.supportsBorderRadius=bagof(j);return j;}});e.exports=g;},3);
__d("legacy:dom",["DOM"],function(a,b,c,d){var e=b('DOM');a.DOM=e;a.$N=e.$N;},3);
function show(){for(var a=0;a<arguments.length;a++){var b=ge(arguments[a]);if(b&&b.style)b.style.display='';}return false;}function hide(){for(var a=0;a<arguments.length;a++){var b=ge(arguments[a]);if(b&&b.style)b.style.display='none';}return false;}function shown(a){a=ge(a);return (a.style.display!='none'&&!(a.style.display==''&&a.offsetWidth==0));}function toggle(){for(var a=0;a<arguments.length;a++){var b=$(arguments[a]);b.style.display=CSS.getStyle(b,"display")=='block'?'none':'block';}return false;}function toggleDisplayNone(){for(var a=0;a<arguments.length;a++){var b=$(arguments[a]);if(shown(b)){hide(b);}else show(b);}return false;}
__d("UntrustedLink",["DOM","event-extensions","URI","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('event-extensions'),i=b('URI'),j=b('UserAgent'),k=b('copyProperties');function l(m,n,o,p){this.dom=m;this.url=m.href;this.hash=n;this.func_get_params=p||function(){return {};};Event.listen(this.dom,'click',this.onclick.bind(this));Event.listen(this.dom,'mousedown',this.onmousedown.bind(this));Event.listen(this.dom,'mouseup',this.onmouseup.bind(this));Event.listen(this.dom,'mouseout',this.onmouseout.bind(this));this.onmousedown(h.$E(o));}l.bootstrap=function(m,n,o,p){if(m.__untrusted)return;m.__untrusted=true;new l(m,n,o,p);};l.prototype.getRewrittenURI=function(){var m=k({u:this.url,h:this.hash},this.func_get_params(this.dom)),n=new i('/l.php');return n.setQueryData(m).setSubdomain('www').setProtocol('http');};l.prototype.onclick=function(){(function(){this.setHref(this.url);}).bind(this).defer(100);this.setHref(this.getRewrittenURI());};l.prototype.onmousedown=function(m){if(m.button==2)this.setHref(this.getRewrittenURI());};l.prototype.onmouseup=function(){this.setHref(this.getRewrittenURI());};l.prototype.onmouseout=function(){this.setHref(this.url);};l.prototype.setHref=function(m){if(j.ie()<9){var n=g.create('span');g.appendContent(this.dom,n);this.dom.href=m;g.remove(n);}else this.dom.href=m;};e.exports=l;});
__d("legacy:dom-untrusted",["UntrustedLink"],function(a,b,c,d){a.UntrustedLink=b('UntrustedLink');},3);
__d("legacy:event-extensions",["event-extensions"],function(a,b,c,d){b('event-extensions');},3);
__d("OnloadHooks",["Arbiter","ErrorUtils","InitialJSLoader","OnloadEvent"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ErrorUtils'),i=b('InitialJSLoader'),j=b('OnloadEvent');function k(){var r=a.CavalryLogger;if(!window.loaded&&r)r.getInstance().setTimeStamp('t_prehooks');n('onloadhooks');if(!window.loaded&&r)r.getInstance().setTimeStamp('t_hooks');window.loaded=true;g.inform('uipage_onload',true,g.BEHAVIOR_STATE);}function l(){n('onafterloadhooks');window.afterloaded=true;}function m(r,s){return h.applyWithGuard(r,null,null,function(t){t.event_type=s;t.category='runhook';});}function n(r){var s=(r=='onbeforeleavehooks')||(r=='onbeforeunloadhooks');do{var t=window[r];if(!t)break;if(!s)window[r]=null;for(var u=0;u<t.length;u++){var v=m(t[u],r);if(s&&v)return v;}}while(!s&&window[r]);}function o(){if(!window.loaded){window.loaded=true;n('onloadhooks');}if(!window.afterloaded){window.afterloaded=true;n('onafterloadhooks');}}function p(){g.registerCallback(k,[j.ONLOAD_DOMCONTENT_CALLBACK,i.INITIAL_JS_READY]);g.registerCallback(l,[j.ONLOAD_DOMCONTENT_CALLBACK,j.ONLOAD_CALLBACK,i.INITIAL_JS_READY]);g.subscribe(j.ONBEFOREUNLOAD,function(r,s){s.warn=n('onbeforeleavehooks')||n('onbeforeunloadhooks');if(!s.warn){window.loaded=false;window.afterloaded=false;}},g.SUBSCRIBE_NEW);g.subscribe(j.ONUNLOAD,function(r,s){n('onunloadhooks');},g.SUBSCRIBE_NEW);}var q={_onloadHook:k,_onafterloadHook:l,runHook:m,runHooks:n,keepWindowSetAsLoaded:o};p();a.OnloadHooks=e.exports=q;});
__d("legacy:onload-action",["OnloadHooks"],function(a,b,c,d){var e=b('OnloadHooks');a._onloadHook=e._onloadHook;a._onafterloadHook=e._onafterloadHook;a.runHook=e.runHook;a.runHooks=e.runHooks;a.keep_window_set_as_loaded=e.keepWindowSetAsLoaded;},3);
__d("DOMControl",["DataStore","$","copyProperties"],function(a,b,c,d,e,f){var g=b('DataStore'),h=b('$'),i=b('copyProperties');function j(k){this.root=h(k);this.updating=false;g.set(k,'DOMControl',this);}i(j.prototype,{getRoot:function(){return this.root;},beginUpdate:function(){if(this.updating)return false;this.updating=true;return true;},endUpdate:function(){this.updating=false;},update:function(k){if(!this.beginUpdate())return this;this.onupdate(k);this.endUpdate();},onupdate:function(k){}});j.getInstance=function(k){return g.get(k,'DOMControl');};e.exports=j;});
__d("Input",["CSS","DOMQuery","DOMControl"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOMQuery'),i=b('DOMControl'),j=function(l){var m=l.getAttribute('maxlength');if(m&&m>0)d(['enforceMaxLength'],function(n){n(l,m);});},k={focus:function(l){try{l.focus();}catch(m){}},isEmpty:function(l){return !(/\S/).test(l.value||'')||g.hasClass(l,'DOMControl_placeholder');},getValue:function(l){return k.isEmpty(l)?'':l.value;},setValue:function(l,m){g.removeClass(l,'DOMControl_placeholder');l.value=m||'';j(l);var n=i.getInstance(l);n&&n.resetHeight&&n.resetHeight();},setPlaceholder:function(l,m){l.setAttribute('title',m);l.setAttribute('placeholder',m);if(l==document.activeElement)return;if(k.isEmpty(l)){g.conditionClass(l,'DOMControl_placeholder',m);l.value=m||'';}},reset:function(l){var m=l!==document.activeElement?(l.getAttribute('placeholder')||''):'';l.value=m;g.conditionClass(l,'DOMControl_placeholder',m);l.style.height='';},setSubmitOnEnter:function(l,m){g.conditionClass(l,'enter_submit',m);},getSubmitOnEnter:function(l){return g.hasClass(l,'enter_submit');},setMaxLength:function(l,m){if(m>0){l.setAttribute('maxlength',m);j(l);}else l.removeAttribute('maxlength');}};e.exports=k;});
__d("legacy:input-methods",["Input","copyProperties"],function(a,b,c,d){var e=b('Input'),f=b('copyProperties');f(a.Input||(a.Input={}),e);},3);
function link_rel_preload(){var a=/async(?:-post)?|dialog(?:-pipe|-post)?|theater|toggle/;document.documentElement.onmousedown=function(b){b=b||window.event;var c=b.target||b.srcElement,d=Parent.byTag(c,'A');if(!d)return;var e=d.getAttribute('ajaxify'),f=d.href,g=e||f;if(e&&f&&!(/#$/).test(f)){var h=b.which&&b.which!=1,i=b.altKey||b.ctrlKey||b.metaKey||b.shiftKey;if(h||i)return;}var j=d.rel&&d.rel.match(a);j=j&&j[0];switch(j){case 'dialog':case 'dialog-post':Bootloader.loadComponents('dialog');break;case 'dialog-pipe':Bootloader.loadComponents(['ajaxpipe','dialog']);break;case 'async':case 'async-post':Bootloader.loadComponents('async');break;case 'theater':Bootloader.loadComponents('PhotoSnowlift',function(){PhotoSnowlift.preload(g,d);});break;case 'toggle':Bootloader.loadComponents('Toggler');break;}return;};}
__d("DOMDimensions",["DOMQuery"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h={getElementDimensions:function(i){return {width:i.offsetWidth||0,height:i.offsetHeight||0};},getViewportDimensions:function(){var i=(window&&window.innerWidth)||(document&&document.documentElement&&document.documentElement.clientWidth)||(document&&document.body&&document.body.clientWidth)||0,j=(window&&window.innerHeight)||(document&&document.documentElement&&document.documentElement.clientHeight)||(document&&document.body&&document.body.clientHeight)||0;return {width:i,height:j};},getDocumentDimensions:function(i){i=i||document;var j=g.getDocumentScrollElement(i),k=j.scrollWidth||0,l=j.scrollHeight||0;return {width:k,height:l};}};e.exports=h;});
__d("DOMPosition",["DOMQuery"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h={getScrollPosition:function(){var i=g.getDocumentScrollElement();return {x:i.scrollLeft,y:i.scrollTop};},getElementPosition:function(i){if(!i)return;if(!('getBoundingClientRect' in i))return {x:0,y:0};var j=i.getBoundingClientRect(),k=document.documentElement,l=Math.round(j.left)-k.clientLeft,m=Math.round(j.top)-k.clientTop;return {x:l,y:m};}};e.exports=h;});
__d("Vector",["event-extensions","DOMDimensions","DOMPosition","DOMQuery","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOMDimensions'),h=b('DOMPosition'),i=b('DOMQuery'),j=b('copyProperties');function k(l,m,n){j(this,{x:parseFloat(l),y:parseFloat(m),domain:n||'pure'});}j(k.prototype,{toString:function(){return '('+this.x+', '+this.y+')';},add:function(l,m){if(arguments.length==1){if(l.domain!='pure')l=l.convertTo(this.domain);return this.add(l.x,l.y);}var n=parseFloat(l),o=parseFloat(m);return new k(this.x+n,this.y+o,this.domain);},mul:function(l,m){if(typeof m=="undefined")m=l;return new k(this.x*l,this.y*m,this.domain);},sub:function(l,m){if(arguments.length==1){return this.add(l.mul(-1));}else return this.add(-l,-m);},distanceTo:function(l){return this.sub(l).magnitude();},magnitude:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y));},convertTo:function(l){if(l!='pure'&&l!='viewport'&&l!='document')return new k(0,0);if(l==this.domain)return new k(this.x,this.y,this.domain);if(l=='pure')return new k(this.x,this.y);if(this.domain=='pure')return new k(0,0);var m=k.getScrollPosition('document'),n=this.x,o=this.y;if(this.domain=='document'){n-=m.x;o-=m.y;}else{n+=m.x;o+=m.y;}return new k(n,o,l);},setElementPosition:function(l){var m=this.convertTo('document');l.style.left=parseInt(m.x)+'px';l.style.top=parseInt(m.y)+'px';return this;},setElementDimensions:function(l){return this.setElementWidth(l).setElementHeight(l);},setElementWidth:function(l){l.style.width=parseInt(this.x,10)+'px';return this;},setElementHeight:function(l){l.style.height=parseInt(this.y,10)+'px';return this;},scrollElementBy:function(l){if(l==document.body){window.scrollBy(this.x,this.y);}else{l.scrollLeft+=this.x;l.scrollTop+=this.y;}return this;}});j(k,{getEventPosition:function(l,m){m=m||'document';var n=Event.getPosition(l),o=new k(n.x,n.y,'document');return o.convertTo(m);},getScrollPosition:function(l){l=l||'document';var m=h.getScrollPosition();return new k(m.x,m.y,'document').convertTo(l);},getElementPosition:function(l,m){m=m||'document';var n;if(l!==i.getDocumentBodyElement()||l===document.body){n=h.getElementPosition(l);}else n={x:-l.scrollLeft,y:-l.scrollTop};return new k(n.x,n.y,'viewport').convertTo(m);},getElementDimensions:function(l){var m=g.getElementDimensions(l);return new k(m.width,m.height);},getViewportDimensions:function(){var l=g.getViewportDimensions();return new k(l.width,l.height,'viewport');},getDocumentDimensions:function(l){var m=g.getDocumentDimensions(l);return new k(m.width,m.height,'document');},deserialize:function(l){var m=l.split(',');return new k(m[0],m[1]);}});e.exports=k;});
__d("legacy:vector",["Vector"],function(a,b,c,d){a.Vector2=b('Vector');},3);
__d("AsyncDOM",["CSS","DOM"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i={invoke:function(j,k){for(var l=0;l<j.length;++l){var m=j[l],n=m[0],o=m[1],p=m[2],q=m[3],r=(p&&k)||null;if(o)r=h.scry(r||document.documentElement,o)[0];switch(n){case 'eval':(new Function(q)).apply(r);break;case 'hide':g.hide(r);break;case 'show':g.show(r);break;case 'setContent':h.setContent(r,q);break;case 'appendContent':h.appendContent(r,q);break;case 'prependContent':h.prependContent(r,q);break;case 'insertAfter':h.insertAfter(r,q);break;case 'insertBefore':h.insertBefore(r,q);break;case 'remove':h.remove(r);break;case 'replace':h.replace(r,q);break;default:}}}};e.exports=i;});
__d("AsyncResponse",["Bootloader","Env","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('Env'),i=b('copyProperties'),j=b('tx');function k(l,m){i(this,{error:0,errorSummary:null,errorDescription:null,onload:null,replay:false,payload:m||null,request:l||null,silentError:false,is_last:true});return this;}i(k,{defaultErrorHandler:function(l){try{if(!l.silentError){k.verboseErrorHandler(l);}else l.logErrorByGroup('silent',10);}catch(m){alert(l);}},verboseErrorHandler:function(l){try{var n=l.getErrorSummary(),o=l.getErrorDescription();l.logErrorByGroup('popup',10);if(l.silentError&&o=='')o="Jotakin meni pieleen. Yrit\u00e4mme saada virheen korjatuksi mahdollisimman pian. Voit mahdollisesti yritt\u00e4\u00e4 uudelleen.";g.loadModules(['Dialog'],function(p){new p().setTitle(n).setBody(o).setButtons([p.OK]).setModal(true).setCausalElement(this.relativeTo).show();});}catch(m){alert(l);}}});i(k.prototype,{getRequest:function(){return this.request;},getPayload:function(){return this.payload;},getError:function(){return this.error;},getErrorSummary:function(){return this.errorSummary;},setErrorSummary:function(l){l=(l===undefined?null:l);this.errorSummary=l;return this;},getErrorDescription:function(){return this.errorDescription;},getErrorIsWarning:function(){return this.errorIsWarning;},logError:function(l,m){if(window.send_error_signal){var n={err_code:this.error,vip:(h.vip||'-')};if(m){n.duration=m.duration;n.xfb_ip=m.xfb_ip;}var o=this.request.getURI();n.path=o||'-';n.aid=this.request.userActionID;if(o&&o.indexOf('scribe_endpoint.php')!=-1)l='async_error_double';send_error_signal(l,JSON.stringify(n));}},logErrorByGroup:function(l,m){if(Math.floor(Math.random()*m)==0)if(this.error==1357010||this.error<15000){this.logError('async_error_oops_'+l);}else this.logError('async_error_logic_'+l);}});e.exports=k;});
__d("XHR",[],function(a,b,c,d,e,f){var g={create:function(){try{return a.XMLHttpRequest?new a.XMLHttpRequest():new ActiveXObject("MSXML2.XMLHTTP.3.0");}catch(h){}}};e.exports=g;});
__d("bind",[],function(a,b,c,d,e,f){function g(h,i){var j=Array.prototype.slice.call(arguments,2);if(typeof i!='string')return Function.prototype.bind.apply(i,[h].concat(j));function k(){var l=j.concat(Array.prototype.slice.call(arguments));if(h[i])return h[i].apply(h,l);}k.toString=function(){return 'bound lazily: '+h[i];};return k;}e.exports=g;});
__d("AsyncRequest",["event-extensions","Arbiter","AsyncDOM","AsyncResponse","Bootloader","Cookie","CSS","Env","JSCC","Parent","Run","ServerJS","URI","UserAgent","XHR","bind","copyProperties","evalGlobal","ge","goURI","isEmpty","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncDOM'),i=b('AsyncResponse'),j=b('Bootloader'),k=b('Cookie'),l=b('CSS'),m=b('Env'),n=b('JSCC'),o=b('Parent'),p=b('Run'),q=b('ServerJS'),r=b('URI'),s=b('UserAgent'),t=b('XHR'),u=b('bind'),v=b('copyProperties'),w=b('evalGlobal'),x=b('ge'),y=b('goURI'),z=b('isEmpty'),aa=b('tx');function ba(){try{return !window.loaded;}catch(ja){return true;}}function ca(ja){return ('upload' in ja)&&('onprogress' in ja.upload);}function da(ja){return ja.status in {0:1,12029:1,12030:1,12031:1,12152:1};}function ea(ja){var ka=!ja||typeof(ja)==='function';return ka;}var fa=2,ga=fa;g.subscribe('page_transition',function(ja,ka){ga=ka.id;});function ha(ja){v(this,{transport:null,method:'POST',uri:'',timeout:null,timer:null,initialHandler:bagofholding,handler:null,uploadProgressHandler:null,errorHandler:null,transportErrorHandler:null,timeoutHandler:null,finallyHandler:bagofholding,serverDialogCancelHandler:null,relativeTo:null,statusElement:null,statusClass:'',data:{},file:null,context:{},readOnly:false,writeRequiredParams:[],remainingRetries:0,userActionID:'-'});this.option={asynchronous:true,suppressErrorHandlerWarning:false,suppressEvaluation:false,suppressErrorAlerts:false,retries:0,jsonp:false,bundle:false,useIframeTransport:false,tfbEndpoint:true,handleErrorAfterUnload:false};this.errorHandler=i.defaultErrorHandler;this.transportErrorHandler=u(this,'errorHandler');if(ja!==undefined)this.setURI(ja);}v(ha,{bootstrap:function(ja,ka,la){var ma='GET',na=true,oa={};if(la||ka&&(ka.rel=='async-post'||ka.getAttribute&&ka.getAttribute('forcemethod')=='post')){ma='POST';na=false;if(ja){ja=r(ja);oa=ja.getQueryData();ja.setQueryData({});}}var pa=o.byClass(ka,'stat_elem')||ka;if(pa&&l.hasClass(pa,'async_saving'))return false;var qa=new ha(ja).setReadOnly(na).setMethod(ma).setData(oa).setNectarModuleDataSafe(ka).setRelativeTo(ka);if(ka){qa.setHandler(function(sa){Event.fire(ka,'success',{response:sa});});qa.setErrorHandler(function(sa){if(Event.fire(ka,'error',{response:sa})!==false)i.defaultErrorHandler(sa);});}if(pa){qa.setStatusElement(pa);var ra=pa.getAttribute('data-status-class');ra&&qa.setStatusClass(ra);}if(ka)Event.fire(ka,'AsyncRequest/send',{request:qa});qa.send();return false;},post:function(ja,ka){new ha(ja).setReadOnly(false).setMethod('POST').setData(ka).send();return false;},getLastID:function(){return fa;},suppressOnloadToken:{},_inflight:[],_inflightCount:0,_inflightAdd:bagofholding,_inflightPurge:bagofholding,getInflightCount:function(){return this._inflightCount;},_inflightEnable:function(){if(s.ie()){v(ha,{_inflightAdd:function(ja){this._inflight.push(ja);},_inflightPurge:function(){ha._inflight=ha._inflight.filter(function(ja){return ja.transport&&ja.transport.readyState<4;});}});p.onUnload(function(){ha._inflight.forEach(function(ja){if(ja.transport&&ja.transport.readyState<4){ja.transport.abort();delete ja.transport;}});});}}});v(ha.prototype,{_dispatchResponse:function(ja){try{this.clearStatusIndicator();if(!this._isRelevant()){this._invokeErrorHandler(1010);return;}if(this.initialHandler(ja)===false)return;clearTimeout(this.timer);if(ja.jscc_map){var la=(eval)(ja.jscc_map);n.init(la);}var ma;if(this.handler)try{ma=this._shouldSuppressJS(this.handler(ja));}catch(na){ja.is_last&&this.finallyHandler(ja);throw na;}if(!ma)this._handleJSResponse(ja);ja.is_last&&this.finallyHandler(ja);}catch(ka){}},_shouldSuppressJS:function(ja){return ja===ha.suppressOnloadToken;},_handleJSResponse:function(ja){var ka=this.getRelativeTo(),la=ja.domops,ma=ja.jsmods,na=new q().setRelativeTo(ka);if(ma&&(ma.define||ma.instances||ma.markup)){na.handle({define:ma.define,instances:ma.instances,markup:ma.markup});delete ma.define;delete ma.instances;delete ma.markup;}if(la)h.invoke(la,ka);if(ma)na.handle(ma);this._handleJSRegisters(ja,'onload');if(this.lid)g.inform('tti_ajax',{s:this.lid,d:[this._sendTimeStamp||0,(this._sendTimeStamp&&this._responseTime)?(this._responseTime-this._sendTimeStamp):0]},g.BEHAVIOR_EVENT);this._handleJSRegisters(ja,'onafterload');},_handleJSRegisters:function(ja,ka){var la=ja[ka];if(!la)return;for(var ma=0;ma<la.length;ma++)try{(new Function(la[ma])).apply(this);}catch(na){}},invokeResponseHandler:function(ja){if(typeof(ja.redirect)!=='undefined'){(function(){this.setURI(ja.redirect).send();}).bind(this).defer();return;}if(!this.handler&&!this.errorHandler&&!this.transportErrorHandler)return;if(typeof(ja.asyncResponse)!=='undefined'){if(!this._isRelevant()){this._invokeErrorHandler(1010);return;}var ka=ja.asyncResponse;if(ka.inlinejs)w(ka.inlinejs);if(ka.lid){this._responseTime=Date.now();if(a.CavalryLogger)this.cavalry=a.CavalryLogger.getInstance(ka.lid);this.lid=ka.lid;}j.setResourceMap(ka.resource_map);if(ka.bootloadable)j.enableBootload(ka.bootloadable);var la;if(ka.getError()&&!ka.getErrorIsWarning()){var ma=this.errorHandler.bind(this);la=this._dispatchErrorResponse.bind(this,ka,ma);}else la=this._dispatchResponse.bind(this,ka);la=la.defer.bind(la);var na=false;if(this.preBootloadHandler)na=this.preBootloadHandler(ka);ka.css=ka.css||[];ka.js=ka.js||[];j.loadResources(ka.css.concat(ka.js),la,na,this.getURI());}else if(typeof(ja.transportError)!=='undefined'){if(this._xFbServer){this._invokeErrorHandler(1008);}else this._invokeErrorHandler(1012);}else this._invokeErrorHandler(1007);},_invokeErrorHandler:function(ja){if(ba()&&!this.getOption('handleErrorAfterUnload'))return;var ka;if(this.responseText===''){ka=1002;}else if(this._requestAborted){ka=1011;}else{try{ka=ja||this.transport.status||1004;}catch(la){ka=1005;}if(false===navigator.onLine)ka=1006;}if(!this.transportErrorHandler)return;var ma=this.transportErrorHandler.bind(this),na,oa,pa=true;if(ka===1006){oa="Ei verkkoyhteytt\u00e4";na="Selaimesi n\u00e4ytt\u00e4\u00e4 olevan yhteydett\u00f6m\u00e4ss\u00e4 tilassa. Tarkista internetyhteytesi ja yrit\u00e4 uudelleen.";}else if(ka>=300&&ka<=399){oa="Uudelleenohjaus";na="Kolmas osapuoli uudelleenohjasi tai esti yhteytesi Facebookiin. Ota yhteytt\u00e4 internetpalveluntarjoajaasi tai lataa sivu uudelleen.";var qa=this.transport.getResponseHeader("Location");if(qa)y(qa,true);pa=true;}else{oa="Hups!";na="Jotakin meni pieleen. Yrit\u00e4mme saada virheen korjatuksi mahdollisimman pian. Voit mahdollisesti yritt\u00e4\u00e4 uudelleen.";}!this.getOption('suppressErrorAlerts');var ra=new i(this);v(ra,{error:ka,errorSummary:oa,errorDescription:na,silentError:pa});this._dispatchErrorResponse(ra,ma);},_dispatchErrorResponse:function(ja,ka){var la=ja.getError();try{this.clearStatusIndicator();var na=this._sendTimeStamp&&{duration:Date.now()-this._sendTimeStamp,xfb_ip:this._xFbServer||'-'};ja.logError('async_error',na);if(!this._isRelevant()||la===1010)return;if(la==1357008||la==1357007||la==1442002||la==1357001){var oa=la==1357008||la==1357007;this._displayServerDialog(ja,oa);}else if(this.initialHandler(ja)!==false){clearTimeout(this.timer);try{ka(ja);}catch(pa){this.finallyHandler(ja);throw pa;}this.finallyHandler(ja);}}catch(ma){}},_displayServerDialog:function(ja,ka){var la=ja.getPayload().__dialog;j.loadModules(['Dialog'],function(ma){var na=new ma(la);if(ka)na.setHandler(this._displayConfirmationHandler.bind(this,na));na.setCancelHandler(function(){var oa=this.getServerDialogCancelHandler();try{oa&&oa();}catch(pa){throw pa;}finally{this.finallyHandler(ja);}}.bind(this)).setCausalElement(this.relativeTo).show();}.bind(this));},_displayConfirmationHandler:function(ja){this.data.confirmed=1;v(this.data,ja.getFormData());this.send();},_handleJSONPResponse:function(ja){this.is_first=(this.is_first===undefined);var ka=this._interpretResponse(ja);ka.asyncResponse.is_first=this.is_first;ka.asyncResponse.is_last=this.transport.hasFinished();this.invokeResponseHandler(ka);if(this.transport.hasFinished())delete this.transport;},_handleXHRResponse:function(ja){var ka;if(this.getOption('suppressEvaluation')){ka={asyncResponse:new i(this,ja)};}else{var la=ja.responseText,ma=null;try{var oa=this._unshieldResponseText(la);try{var pa=(eval)('('+oa+')');ka=this._interpretResponse(pa);}catch(na){ma='excep';ka={transportError:'eval() failed on async to '+this.getURI()};}}catch(na){ma='empty';ka={transportError:na.message};}if(ma)a.send_error_signal&&a.send_error_signal('async_xport_resp',[(this._xFbServer?'1008_':'1012_')+ma,this._xFbServer||'-',this.getURI(),la.length,la.substr(0,1600)].join(':'));}this.invokeResponseHandler(ka);},_unshieldResponseText:function(ja){var ka="for (;;);",la=ka.length;if(ja.length<=la)throw new Error('Response too short on async to '+this.getURI());var ma=0;while(ja.charAt(ma)==" "||ja.charAt(ma)=="\n")ma++;ma&&ja.substring(ma,ma+la)==ka;return ja.substring(ma+la);},_interpretResponse:function(ja){if(ja.redirect)return {redirect:ja.redirect};var ka=new i(this);if(ja.__ar!=1){ka.payload=ja;}else v(ka,ja);return {asyncResponse:ka};},_onStateChange:function(){try{if(this.transport.readyState==4){ha._inflightCount--;ha._inflightPurge();try{if(typeof(this.transport.getResponseHeader)!=='undefined'&&this.transport.getResponseHeader('X-FB-Debug'))this._xFbServer=this.transport.getResponseHeader('X-FB-Debug');}catch(ka){}if(this.transport.status>=200&&this.transport.status<300){ha.lastSuccessTime=Date.now();this._handleXHRResponse(this.transport);}else if(s.safari()&&(typeof(this.transport.status)=='undefined')){this._invokeErrorHandler(1002);}else if(m.retry_ajax_on_network_error&&da(this.transport)&&this.remainingRetries>0){this.remainingRetries--;delete this.transport;this.send(true);return;}else this._invokeErrorHandler();if(this.getOption('asynchronous')!==false)delete this.transport;}}catch(ja){if(ba())return;delete this.transport;if(this.remainingRetries>0){this.remainingRetries--;this.send(true);}else{!this.getOption('suppressErrorAlerts');a.send_error_signal&&a.send_error_signal('async_xport_resp',[1007,this._xFbServer||'-',this.getURI(),ja.message].join(':'));this._invokeErrorHandler(1007);}}},_isMultiplexable:function(){if(this.getOption('jsonp')||this.getOption('useIframeTransport'))return false;if(!this.uri.isFacebookURI())return false;if(!this.getOption('asynchronous'))return false;return true;},handleResponse:function(ja){var ka=this._interpretResponse(ja);this.invokeResponseHandler(ka);},setMethod:function(ja){this.method=ja.toString().toUpperCase();return this;},getMethod:function(){return this.method;},setData:function(ja){this.data=ja;return this;},_setDataHash:function(){if(this.method!='POST'||!this.getOption('tfbEndpoint')||this.data.phstamp)return;var ja=r.implodeQuery(this.data).length,ka='';for(var la=0;la<this.data.fb_dtsg.length;la++)ka+=this.data.fb_dtsg.charCodeAt(la);this.data.phstamp='1'+ka+ja;},setRawData:function(ja){this.rawData=ja;return this;},getData:function(){return this.data;},setContextData:function(ja,ka,la){la=la===undefined?true:la;if(la)this.context['_log_'+ja]=ka;return this;},_setUserActionID:function(){var ja=a.ArbiterMonitor&&a.ArbiterMonitor.getUE()||'-';this.userActionID=(a.EagleEye&&a.EagleEye.getSessionID()||'-')+'/'+ja;},setURI:function(ja){var ka=r(ja);if(this.getOption('useIframeTransport')&&!ka.isFacebookURI())return this;if(!this.getOption('jsonp')&&!this.getOption('useIframeTransport')&&!ka.isSameOrigin())return this;this._setUserActionID();if(!ja||ka.isEmpty()){if(a.send_error_signal&&a.get_error_stack){var la={err_code:1013,vip:'-',duration:0,xfb_ip:'-',path:window.location.href,aid:this.userActionID};a.send_error_signal('async_error',JSON.stringify(la));a.send_error_signal('async_xport_stack',[1013,window.location.href,null,a.get_error_stack()].join(':'));}return this;}this.uri=ka;return this;},getURI:function(){return this.uri.toString();},setInitialHandler:function(ja){this.initialHandler=ja;return this;},setHandler:function(ja){if(ea(ja))this.handler=ja;return this;},getHandler:function(){return this.handler;},setUploadProgressHandler:function(ja){if(ea(ja))this.uploadProgressHandler=ja;return this;},setErrorHandler:function(ja){if(ea(ja))this.errorHandler=ja;return this;},setTransportErrorHandler:function(ja){this.transportErrorHandler=ja;return this;},getErrorHandler:function(){return this.errorHandler;},getTransportErrorHandler:function(){return this.transportErrorHandler;},setTimeoutHandler:function(ja,ka){if(ea(ka)){this.timeout=ja;this.timeoutHandler=ka;}return this;},resetTimeout:function(ja){if(!(this.timeoutHandler===null))if(ja===null){this.timeout=null;clearTimeout(this.timer);this.timer=null;}else{var ka=!this._allowCrossPageTransition;this.timeout=ja;clearTimeout(this.timer);this.timer=this._handleTimeout.bind(this).defer(this.timeout,ka);}return this;},_handleTimeout:function(){this.abandon();this.timeoutHandler(this);},setNewSerial:function(){this.id=++fa;return this;},setFinallyHandler:function(ja){this.finallyHandler=ja;return this;},getServerDialogCancelHandler:function(){return this.serverDialogCancelHandler;},setServerDialogCancelHandler:function(ja){this.serverDialogCancelHandler=ja;return this;},setPreBootloadHandler:function(ja){this.preBootloadHandler=ja;return this;},setReadOnly:function(ja){if(!(typeof(ja)!='boolean'))this.readOnly=ja;return this;},setFBMLForm:function(){this.writeRequiredParams=["fb_sig"];return this;},getReadOnly:function(){return this.readOnly;},setRelativeTo:function(ja){this.relativeTo=ja;return this;},getRelativeTo:function(){return this.relativeTo;},setStatusClass:function(ja){this.statusClass=ja;return this;},setStatusElement:function(ja){this.statusElement=ja;return this;},getStatusElement:function(){return x(this.statusElement);},_isRelevant:function(){if(this._allowCrossPageTransition)return true;if(!this.id)return true;return this.id>ga;},clearStatusIndicator:function(){var ja=this.getStatusElement();if(ja){l.removeClass(ja,'async_saving');l.removeClass(ja,this.statusClass);}},addStatusIndicator:function(){var ja=this.getStatusElement();if(ja){l.addClass(ja,'async_saving');l.addClass(ja,this.statusClass);}},specifiesWriteRequiredParams:function(){return this.writeRequiredParams.every(function(ja){this.data[ja]=this.data[ja]||m[ja]||(x(ja)||{}).value;if(this.data[ja]!==undefined)return true;return false;},this);},setOption:function(ja,ka){if(typeof(this.option[ja])!='undefined')this.option[ja]=ka;return this;},getOption:function(ja){typeof(this.option[ja])=='undefined';return this.option[ja];},abort:function(){if(this.transport){var ja=this.getTransportErrorHandler();this.setOption('suppressErrorAlerts',true);this.setTransportErrorHandler(bagofholding);this._requestAborted=true;this.transport.abort();this.setTransportErrorHandler(ja);}},abandon:function(){clearTimeout(this.timer);this.setOption('suppressErrorAlerts',true).setHandler(bagofholding).setErrorHandler(bagofholding).setTransportErrorHandler(bagofholding);if(this.transport){this._requestAborted=true;this.transport.abort();}},setNectarData:function(ja){if(ja){if(this.data.nctr===undefined)this.data.nctr={};v(this.data.nctr,ja);}return this;},setNectarModuleDataSafe:function(ja){if(this.setNectarModuleData)this.setNectarModuleData(ja);return this;},setNectarImpressionIdSafe:function(){if(this.setNectarImpressionId)this.setNectarImpressionId();return this;},setAllowCrossPageTransition:function(ja){this._allowCrossPageTransition=!!ja;if(this.timer)this.resetTimeout(this.timeout);return this;},send:function(ja){ja=ja||false;if(!this.uri)return false;!this.errorHandler&&!this.getOption('suppressErrorHandlerWarning');if(this.getOption('jsonp')&&this.method!='GET')this.setMethod('GET');if(this.getOption('useIframeTransport')&&this.method!='GET')this.setMethod('GET');this.timeoutHandler!==null&&(this.getOption('jsonp')||this.getOption('useIframeTransport'));if(!this.getReadOnly()){this.specifiesWriteRequiredParams();if(this.method!='POST')return false;}if(this.method=='POST'&&this.getOption('tfbEndpoint')){this.data.fb_dtsg=m.fb_dtsg;this.data.lsd=k.get('lsd');if(!this.data.lsd)delete this.data.lsd;}if(!z(this.context)&&this.getOption('tfbEndpoint')){v(this.data,this.context);this.data.ajax_log=1;}if(m.force_param)v(this.data,m.force_param);this.data.__user=m.user;this._setUserActionID();if(this.getOption('bundle')&&this._isMultiplexable()){ia.schedule(this);return true;}this.setNewSerial();if(this.getOption('tfbEndpoint')){this.uri.addQueryData({__a:1});if(!this.getOption('asynchronous'))this.uri.addQueryData({__s:1});if(m.fb_isb)this.uri.addQueryData({fb_isb:m.fb_isb});}this.finallyHandler=a.async_callback(this.finallyHandler,'final');var ka,la;if(this.method=='GET'||this.rawData){ka=this.uri.addQueryData(this.data).toString();la=this.rawData||'';}else{ka=this.uri.toString();this._setDataHash();la=r.implodeQuery(this.data);}if(this.transport)return false;if(this.getOption('jsonp')||this.getOption('useIframeTransport')){d(['JSONPTransport'],function(pa){this.transport=new pa(this.getOption('jsonp')?'jsonp':'iframe',this.uri,this._handleJSONPResponse.bind(this));this.transport.send();}.bind(this));return true;}var ma=t.create();if(!ma)return false;ma.onreadystatechange=a.async_callback(this._onStateChange.bind(this),'xhr');if(this.uploadProgressHandler&&ca(ma))ma.upload.onprogress=this.uploadProgressHandler.bind(this);if(!ja)this.remainingRetries=this.getOption('retries');if(a.send_error_signal||a.ArbiterMonitor)this._sendTimeStamp=this._sendTimeStamp||Date.now();this.transport=ma;try{this.transport.open(this.method,ka,this.getOption('asynchronous'));}catch(na){return false;}var oa=m.svn_rev;if(oa)this.transport.setRequestHeader('X-SVN-Rev',String(oa));if(this.method=='POST'&&!this.rawData)this.transport.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this.addStatusIndicator();this.transport.send(la);if(this.timeout!==null)this.resetTimeout(this.timeout);ha._inflightCount++;ha._inflightAdd(this);return true;}});function ia(){this._requests=[];}v(ia,{multiplex:null,schedule:function(ja){if(!ia.multiplex){ia.multiplex=new ia();(function(){ia.multiplex.send();ia.multiplex=null;}).defer();}ia.multiplex.add(ja);}});v(ia.prototype,{add:function(ja){this._requests.push(ja);},send:function(){var ja=this._requests;if(!ja.length)return;var ka;if(ja.length===1){ka=ja[0];}else{var la=ja.map(function(ma){return [ma.uri.getPath(),r.implodeQuery(ma.data)];});ka=new ha('/ajax/proxy.php').setAllowCrossPageTransition(true).setData({data:la}).setHandler(this._handler.bind(this)).setTransportErrorHandler(this._transportErrorHandler.bind(this));}ka.setOption('bundle',false).send();},_handler:function(ja){var ka=ja.getPayload().responses;if(ka.length!==this._requests.length)return;for(var la=0;la<this._requests.length;la++){var ma=this._requests[la],na=ma.uri.getPath();ma.id=this.id;if(ka[la][0]!==na){ma.invokeResponseHandler({transportError:'Wrong response order in bundled request to '+na});continue;}ma.handleResponse(ka[la][1]);}},_transportErrorHandler:function(ja){var ka={transportError:ja.errorDescription},la=this._requests.map(function(ma){ma.id=this.id;ma.invokeResponseHandler(ka);return ma.uri.getPath();});}});e.exports=ha;});
__d("legacy:async",["AsyncRequest","AsyncResponse"],function(a,b,c,d){a.AsyncRequest=b('AsyncRequest');a.AsyncResponse=b('AsyncResponse');},3);
__d("startsWith",[],function(a,b,c,d,e,f){function g(h,i){return h.lastIndexOf(i,0)===0;}e.exports=g;});
__d("AsyncRequestNectarLogging",["AsyncRequest","Env","copyProperties","startsWith"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Env'),i=b('copyProperties'),j=b('startsWith');i(g.prototype,{setNectarModuleData:function(k){if(this.method=='POST'){var l=h.module;if(k&&l===undefined){var m={fbpage_fan_confirm:1},n=null;for(var o=k;o&&o!=document.body;o=o.parentNode){if(!o.id||typeof o.id!=='string')continue;if(j(o.id,'pagelet_')){l=o.id;break;}if(!n&&m[o.id])n=o.id;}if(l===undefined&&n)l=n;}if(l!==undefined){if(this.data.nctr===undefined)this.data.nctr={};this.data.nctr._mod=l;}}},setNectarImpressionId:function(){if(this.method=='POST'){var k=h.impid;if(k!==undefined){if(this.data.nctr===undefined)this.data.nctr={};this.data.nctr._impid=k;}}}});});
__d("legacy:async-postlude",["AsyncRequestNectarLogging"],function(a,b,c,d){b('AsyncRequestNectarLogging');},3);
__d("legacy:ua",["UserAgent"],function(a,b,c,d){a.ua=b('UserAgent');},3);
__d("Animation",["CSS","DOM","Style","UserAgent"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('UserAgent');function k(l){if(a==this){return new k(l);}else{this.obj=l;this._reset_state();this.queue=[];this.last_attr=null;}}k.resolution=20;k.offset=0;k.prototype._reset_state=function(){this.state={attrs:{},duration:500};};k.prototype.stop=function(){this._reset_state();this.queue=[];return this;};k.prototype._build_container=function(){if(this.container_div){this._refresh_container();return;}if(this.obj.firstChild&&this.obj.firstChild.__animation_refs){this.container_div=this.obj.firstChild;this.container_div.__animation_refs++;this._refresh_container();return;}var l=document.createElement('div');l.style.padding='0px';l.style.margin='0px';l.style.border='0px';l.__animation_refs=1;var m=this.obj.childNodes;while(m.length)l.appendChild(m[0]);this.obj.appendChild(l);this._orig_overflow=this.obj.style.overflow;this.obj.style.overflow='hidden';this.container_div=l;this._refresh_container();};k.prototype._refresh_container=function(){this.container_div.style.height='auto';this.container_div.style.width='auto';this.container_div.style.height=this.container_div.offsetHeight+'px';this.container_div.style.width=this.container_div.offsetWidth+'px';};k.prototype._destroy_container=function(){if(!this.container_div)return;if(!--this.container_div.__animation_refs){var l=this.container_div.childNodes;while(l.length)this.obj.appendChild(l[0]);this.obj.removeChild(this.container_div);}this.container_div=null;this.obj.style.overflow=this._orig_overflow;};k.ATTR_TO=1;k.ATTR_BY=2;k.ATTR_FROM=3;k.prototype._attr=function(l,m,n){l=l.replace(/-[a-z]/gi,function(p){return p.substring(1).toUpperCase();});var o=false;switch(l){case 'background':this._attr('backgroundColor',m,n);return this;case 'margin':m=k.parse_group(m);this._attr('marginBottom',m[0],n);this._attr('marginLeft',m[1],n);this._attr('marginRight',m[2],n);this._attr('marginTop',m[3],n);return this;case 'padding':m=k.parse_group(m);this._attr('paddingBottom',m[0],n);this._attr('paddingLeft',m[1],n);this._attr('paddingRight',m[2],n);this._attr('paddingTop',m[3],n);return this;case 'backgroundColor':case 'borderColor':case 'color':m=k.parse_color(m);break;case 'opacity':m=parseFloat(m,10);break;case 'height':case 'width':if(m=='auto'){o=true;}else m=parseInt(m,10);break;case 'borderWidth':case 'lineHeight':case 'fontSize':case 'marginBottom':case 'marginLeft':case 'marginRight':case 'marginTop':case 'paddingBottom':case 'paddingLeft':case 'paddingRight':case 'paddingTop':case 'bottom':case 'left':case 'right':case 'top':case 'scrollTop':case 'scrollLeft':m=parseInt(m,10);break;default:throw new Error(l+' is not a supported attribute!');}if(this.state.attrs[l]===undefined)this.state.attrs[l]={};if(o)this.state.attrs[l].auto=true;switch(n){case k.ATTR_FROM:this.state.attrs[l].start=m;break;case k.ATTR_BY:this.state.attrs[l].by=true;case k.ATTR_TO:this.state.attrs[l].value=m;break;}};k._get_box_width=function(l){var m=parseInt(i.get(l,'paddingLeft'),10),n=parseInt(i.get(l,'paddingRight'),10),o=parseInt(i.get(l,'borderLeftWidth'),10),p=parseInt(i.get(l,'borderRightWidth'),10);return l.offsetWidth-(m?m:0)-(n?n:0)-(o?o:0)-(p?p:0);};k._get_box_height=function(l){var m=parseInt(i.get(l,'paddingTop'),10),n=parseInt(i.get(l,'paddingBottom'),10),o=parseInt(i.get(l,'borderTopWidth'),10),p=parseInt(i.get(l,'borderBottomWidth'),10);return l.offsetHeight-(m?m:0)-(n?n:0)-(o?o:0)-(p?p:0);};k.prototype.to=function(l,m){if(m===undefined){this._attr(this.last_attr,l,k.ATTR_TO);}else{this._attr(l,m,k.ATTR_TO);this.last_attr=l;}return this;};k.prototype.by=function(l,m){if(m===undefined){this._attr(this.last_attr,l,k.ATTR_BY);}else{this._attr(l,m,k.ATTR_BY);this.last_attr=l;}return this;};k.prototype.from=function(l,m){if(m===undefined){this._attr(this.last_attr,l,k.ATTR_FROM);}else{this._attr(l,m,k.ATTR_FROM);this.last_attr=l;}return this;};k.prototype.duration=function(l){this.state.duration=l?l:0;return this;};k.prototype.checkpoint=function(l,m){if(l===undefined)l=1;this.state.checkpoint=l;this.queue.push(this.state);this._reset_state();this.state.checkpointcb=m;return this;};k.prototype.blind=function(){this.state.blind=true;return this;};k.prototype.hide=function(){this.state.hide=true;return this;};k.prototype.show=function(){this.state.show=true;return this;};k.prototype.ease=function(l){this.state.ease=l;return this;};k.prototype.go=function(){var l=(new Date()).getTime();this.queue.push(this.state);for(var m=0;m<this.queue.length;m++){this.queue[m].start=l-k.offset;if(this.queue[m].checkpoint)l+=this.queue[m].checkpoint*this.queue[m].duration;}k.push(this);return this;};k.prototype._show=function(){g.show(this.obj);};k.prototype._hide=function(){g.hide(this.obj);};k.prototype._frame=function(l){var m=true,n=false,o=false,p;function q(aa){return document.documentElement[aa]||document.body[aa];}for(var r=0;r<this.queue.length;r++){var s=this.queue[r];if(s.start>l){m=false;continue;}if(s.checkpointcb){this._callback(s.checkpointcb,l-s.start);s.checkpointcb=null;}if(s.started===undefined){if(s.show)this._show();for(var t in s.attrs){if(s.attrs[t].start!==undefined)continue;switch(t){case 'backgroundColor':case 'borderColor':case 'color':p=k.parse_color(i.get(this.obj,t=='borderColor'?'borderLeftColor':t));if(s.attrs[t].by){s.attrs[t].value[0]=Math.min(255,Math.max(0,s.attrs[t].value[0]+p[0]));s.attrs[t].value[1]=Math.min(255,Math.max(0,s.attrs[t].value[1]+p[1]));s.attrs[t].value[2]=Math.min(255,Math.max(0,s.attrs[t].value[2]+p[2]));}break;case 'opacity':p=i.getOpacity(this.obj);if(s.attrs[t].by)s.attrs[t].value=Math.min(1,Math.max(0,s.attrs[t].value+p));break;case 'height':p=k._get_box_height(this.obj);if(s.attrs[t].by)s.attrs[t].value+=p;break;case 'width':p=k._get_box_width(this.obj);if(s.attrs[t].by)s.attrs[t].value+=p;break;case 'scrollLeft':case 'scrollTop':p=(this.obj===document.body)?q(t):this.obj[t];if(s.attrs[t].by)s.attrs[t].value+=p;s['last'+t]=p;break;default:p=parseInt(i.get(this.obj,t),10)||0;if(s.attrs[t].by)s.attrs[t].value+=p;break;}s.attrs[t].start=p;}if((s.attrs.height&&s.attrs.height.auto)||(s.attrs.width&&s.attrs.width.auto)){if(j.firefox()<3)o=true;this._destroy_container();for(var t in {height:1,width:1,fontSize:1,borderLeftWidth:1,borderRightWidth:1,borderTopWidth:1,borderBottomWidth:1,paddingLeft:1,paddingRight:1,paddingTop:1,paddingBottom:1})if(s.attrs[t])this.obj.style[t]=s.attrs[t].value+(typeof s.attrs[t].value=='number'?'px':'');if(s.attrs.height&&s.attrs.height.auto)s.attrs.height.value=k._get_box_height(this.obj);if(s.attrs.width&&s.attrs.width.auto)s.attrs.width.value=k._get_box_width(this.obj);}s.started=true;if(s.blind)this._build_container();}var u=(l-s.start)/s.duration;if(u>=1){u=1;if(s.hide)this._hide();}else m=false;var v=s.ease?s.ease(u):u;if(!n&&u!=1&&s.blind)n=true;if(o&&this.obj.parentNode){var w=this.obj.parentNode,x=this.obj.nextSibling;w.removeChild(this.obj);}for(var t in s.attrs)switch(t){case 'backgroundColor':case 'borderColor':case 'color':this.obj.style[t]='rgb('+k.calc_tween(v,s.attrs[t].start[0],s.attrs[t].value[0],true)+','+k.calc_tween(v,s.attrs[t].start[1],s.attrs[t].value[1],true)+','+k.calc_tween(v,s.attrs[t].start[2],s.attrs[t].value[2],true)+')';break;case 'opacity':i.set(this.obj,'opacity',k.calc_tween(v,s.attrs[t].start,s.attrs[t].value));break;case 'height':case 'width':this.obj.style[t]=v==1&&s.attrs[t].auto?'auto':k.calc_tween(v,s.attrs[t].start,s.attrs[t].value,true)+'px';break;case 'scrollLeft':case 'scrollTop':var y=this.obj===document.body;p=y?q(t):this.obj[t];if(s['last'+t]!==p){delete s.attrs[t];}else{var z=k.calc_tween(v,s.attrs[t].start,s.attrs[t].value,true);if(!y){z=this.obj[t]=z;}else{if(t=='scrollLeft'){a.scrollTo(z,q('scrollTop'));}else a.scrollTo(q('scrollLeft'),z);z=q(t);}s['last'+t]=z;}break;default:this.obj.style[t]=k.calc_tween(v,s.attrs[t].start,s.attrs[t].value,true)+'px';break;}if(u==1){this.queue.splice(r--,1);this._callback(s.ondone,l-s.start-s.duration);}}if(o)w[x?'insertBefore':'appendChild'](this.obj,x);if(!n&&this.container_div)this._destroy_container();return !m;};k.prototype.ondone=function(l){this.state.ondone=l;return this;};k.prototype._callback=function(l,m){if(l){k.offset=m;l.call(this);k.offset=0;}};k.calc_tween=function(l,m,n,o){return (o?parseInt:parseFloat)((n-m)*l+m,10);};k.parse_color=function(l){var m=/^#([a-f0-9]{1,2})([a-f0-9]{1,2})([a-f0-9]{1,2})$/i.exec(l);if(m){return [parseInt(m[1].length==1?m[1]+m[1]:m[1],16),parseInt(m[2].length==1?m[2]+m[2]:m[2],16),parseInt(m[3].length==1?m[3]+m[3]:m[3],16)];}else{var n=/^rgba? *\(([0-9]+), *([0-9]+), *([0-9]+)(?:, *([0-9]+))?\)$/.exec(l);if(n){if(n[4]==='0'){return [255,255,255];}else return [parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)];}else if(l=='transparent'){return [255,255,255];}else throw 'Named color attributes are not supported.';}};k.parse_group=function(l){l=l.trim().split(/ +/);if(l.length==4){return l;}else if(l.length==3){return [l[0],l[1],l[2],l[1]];}else if(l.length==2){return [l[0],l[1],l[0],l[1]];}else return [l[0],l[0],l[0],l[0]];};k.push=function(l){if(!k.active)k.active=[];k.active.push(l);if(k.active.length===1){if(!k.requestAnimationFrame){var m=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame;if(m)k.requestAnimationFrame=m.bind(a);}if(k.requestAnimationFrame){k.requestAnimationFrame(k._animate);}else k.timeout=setInterval(k._animate,k.resolution,false);}if(k.requestAnimationFrame)k._updateEndingTimer();k._animate(Date.now(),true);};k._updateEndingTimer=function(){if(!k.requestAnimationFrame)throw new Error('Ending timer only valid with requestAnimationFrame');var l=0;for(var m=0;m<k.active.length;m++){var n=k.active[m];for(var o=0;o<n.queue.length;o++){var p=n.queue[o].start+n.queue[o].duration;if(p>l)l=p;}}if(k.timeout){clearTimeout(k.timeout);delete k.timeout;}var q=Date.now();if(l>q)k.timeout=setTimeout(k._animate.shield(),l-q,false);};k._animate=function(l,m){l=l||Date.now();for(var n=(m===true)?k.active.length-1:0;n<k.active.length;n++)try{if(!k.active[n]._frame(l))k.active.splice(n--,1);}catch(o){k.active.splice(n--,1);}if(k.active.length===0){if(k.timeout){if(k.requestAnimationFrame){clearTimeout(k.timeout);}else clearInterval(k.timeout);delete k.timeout;}}else if(k.requestAnimationFrame)k.requestAnimationFrame(k._animate);};k.ease={};k.ease.begin=function(l){return Math.sin(Math.PI/2*(l-1))+1;};k.ease.end=function(l){return Math.sin(.5*Math.PI*l);};k.ease.both=function(l){return .5*Math.sin(Math.PI*(l-.5))+.5;};k.prependInsert=function(l,m){k.insert(l,m,h.prependContent);};k.appendInsert=function(l,m){k.insert(l,m,h.appendContent);};k.insert=function(l,m,n){i.set(m,'opacity',0);n(l,m);new k(m).from('opacity',0).to('opacity',1).duration(400).go();};e.exports=k;});
__d("legacy:animation",["Animation"],function(a,b,c,d){a.animation=b('Animation');},3);
__d("goOrReplace",["URI","UserAgent"],function(a,b,c,d,e,f){var g=b('URI'),h=b('UserAgent');function i(j,k,l){var m=new g(k);if(j.pathname=='/'&&m.getPath()!='/'&&m.isQuicklingEnabled()){var n=j.search?{}:{q:''};m=new g().setPath('/').setQueryData(n).setFragment(m.getUnqualifiedURI()).toString();k=m.toString();}if(l&&!(h.ie()<8)){j.replace(k);}else if(j.href==k){j.reload();}else j.href=k;}e.exports=i;});
__d("AjaxPipeRequest",["Arbiter","AsyncRequest","BigPipe","DOM","Env","JSCC","copyProperties","goOrReplace","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('BigPipe'),j=b('DOM'),k=b('Env'),l=b('JSCC'),m=b('copyProperties'),n=b('goOrReplace'),o=b('ge'),p;function q(t,u){var v=o(t);if(v){if(!u)v.style.minHeight='600px';for(var w in i.pageletIDs)if(t!==w&&j.contains(v,w)){l.clearForPagelet(w);delete i.pageletIDs[w];}j.empty(v);}}function r(t,u){var v=o(t);if(v)if(!u)v.style.minHeight='100px';}function s(t,u){this._uri=t;this._query_data=u;this._request=new h();this._canvas_id=null;this._allow_cross_page_transition=true;}m(s.prototype,{setCanvasId:function(t){this._canvas_id=t;return this;},setURI:function(t){this._uri=t;return this;},setData:function(t){this._query_data=t;return this;},getData:function(t){return this._query_data;},setAllowCrossPageTransition:function(t){this._allow_cross_page_transition=t;return this;},setAppend:function(t){this._append=t;return this;},send:function(){this._request.setOption('useIframeTransport',true).setURI(this._uri).setData(m({ajaxpipe:1,ajaxpipe_token:k.ajaxpipe_token},this._query_data)).setPreBootloadHandler(this._preBootloadHandler.bind(this)).setInitialHandler(this._onInitialResponse.bind(this)).setHandler(this._onResponse.bind(this)).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(this._allow_cross_page_transition);p=this._request;this._request.send();return this;},_preBootloadFirstResponse:function(t){return false;},_fireDomContentCallback:function(){this._arbiter.inform('ajaxpipe/domcontent_callback',true,g.BEHAVIOR_STATE);},_fireOnloadCallback:function(){this._arbiter.inform('ajaxpipe/onload_callback',true,g.BEHAVIOR_STATE);},_isRelevant:function(t){return this._request==p||this._jsNonBlock;},_preBootloadHandler:function(t){var u=t.getPayload();if(!u||u.redirect||!this._isRelevant(t))return false;var v=false;if(t.is_first){!this._append&&!this._displayCallback&&q(this._canvas_id,this._constHeight);this._arbiter=new g();v=this._preBootloadFirstResponse(t);this.pipe=new i({arbiter:this._arbiter,rootNodeID:this._canvas_id,lid:this._request.lid,isAjax:true,domContentCallback:this._fireDomContentCallback.bind(this),onloadCallback:this._fireOnloadCallback.bind(this),domContentEvt:'ajaxpipe/domcontent_callback',onloadEvt:'ajaxpipe/onload_callback',jsNonBlock:this._jsNonBlock,displayCallback:this._displayCallback});}return v;},_redirect:function(t){if(t.redirect){if(t.force||!this.isPageActive(t.redirect)){var u=['ajaxpipe','ajaxpipe_token'].concat(this.getSanitizedParameters());n(window.location,URI(t.redirect).removeQueryData(u),true);}else PageTransitions.go(t.redirect,true);return true;}else return false;},isPageActive:function(t){return true;},getSanitizedParameters:function(){return [];},_versionCheck:function(t){return true;},_onInitialResponse:function(t){var u=t.getPayload();if(!this._isRelevant(t))return false;if(!u)return true;if(this._redirect(u)||!this._versionCheck(u))return false;return true;},_processFirstResponse:function(t){var u=t.getPayload();if(o(this._canvas_id)&&u.canvas_class!==null)CSS.setClass(this._canvas_id,u.canvas_class);},setFirstResponseCallback:function(t){this._firstResponseCallback=t;return this;},setFirstResponseHandler:function(t){this._processFirstResponse=t;return this;},_onResponse:function(t){var u=t.payload;if(!this._isRelevant(t))return h.suppressOnloadToken;if(t.is_first){this._processFirstResponse(t);this._firstResponseCallback&&this._firstResponseCallback();u.provides=u.provides||[];u.provides.push('uipage_onload');if(this._append)u.append=this._canvas_id;}if(u){if('content' in u.content&&this._canvas_id!==null&&this._canvas_id!='content'){u.content[this._canvas_id]=u.content.content;delete u.content.content;}this.pipe.onPageletArrive(u);}if(t.is_last)r(this._canvas_id,this._constHeight);return h.suppressOnloadToken;},setNectarModuleDataSafe:function(t){this._request.setNectarModuleDataSafe(t);return this;},setFinallyHandler:function(t){this._request.setFinallyHandler(t);return this;},setErrorHandler:function(t){this._request.setErrorHandler(t);return this;},abort:function(){this._request.abort();if(p==this._request)p=null;this._request=null;return this;},setJSNonBlock:function(t){this._jsNonBlock=t;return this;},setDisplayCallback:function(t){this._displayCallback=t;return this;},setConstHeight:function(t){this._constHeight=t;return this;},getAsyncRequest:function(){return this._request;}});m(s,{getCurrentRequest:function(){return p;},setCurrentRequest:function(t){p=t;}});e.exports=s;});
__d("Button",["event-extensions","CSS","DataStore","DOM","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('Parent'),k=(function(){var l='uiButtonDisabled',m='uiButtonDepressed',n='button:blocker',o='href';function p(s,t){var u=h.get(s,n);if(t){if(u){u.remove();h.remove(s,n);}}else if(!u)h.set(s,n,Event.listen(s,'click',bagof(false),Event.Priority.URGENT));}function q(s){var t=j.byClass(s,'uiButton');if(!t)throw new Error('invalid use case');return t;}function r(s){return i.isNodeOfType(s,'a');}return {getInputElement:function(s){s=q(s);if(r(s))throw new Error('invalid use case');return i.find(s,'input');},isEnabled:function(s){return !g.hasClass(q(s),l);},setEnabled:function(s,t){s=q(s);g.conditionClass(s,l,!t);if(r(s)){var u=s.href,v=h.get(s,o,'#');if(t){if(!u)s.href=v;}else{if(u&&u!==v)h.set(s,o,u);s.removeAttribute('href');}p(s,t);}else{var w=k.getInputElement(s);w.disabled=!t;p(w,t);}},setDepressed:function(s,t){g.conditionClass(q(s),m,t);},isDepressed:function(s){return g.hasClass(q(s),m);},setLabel:function(s,t){s=q(s);if(r(s)){var u=i.find(s,'span.uiButtonText');i.setContent(u,t);}else k.getInputElement(s).value=t;g.conditionClass(s,'uiButtonNoText',!t);},setIcon:function(s,t){if(!i.isNode(t))return;g.addClass(t,'customimg');s=q(s);var u=i.scry(s,'.img')[0];if(u!=t)if(u){i.replace(u,t);}else i.prependContent(s,t);}};})();a.Button=e.exports=k;},3);
__d("Form",["event-extensions","AsyncRequest","AsyncResponse","CSS","DOM","DOMPosition","DOMQuery","DataStore","Env","Input","Parent","URI","createArrayFrom","trackReferrer"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('AsyncResponse'),i=b('CSS'),j=b('DOM'),k=b('DOMPosition'),l=b('DOMQuery'),m=b('DataStore'),n=b('Env'),o=b('Input'),p=b('Parent'),q=b('URI'),r=b('createArrayFrom'),s=b('trackReferrer'),t={getInputs:function(u){u=u||document;return [].concat(r(l.scry(u,'input')),r(l.scry(u,'select')),r(l.scry(u,'textarea')),r(l.scry(u,'button')));},getSelectValue:function(u){return u.options[u.selectedIndex].value;},setSelectValue:function(u,v){for(var w=0;w<u.options.length;++w)if(u.options[w].value==v){u.selectedIndex=w;break;}},getRadioValue:function(u){for(var v=0;v<u.length;v++)if(u[v].checked)return u[v].value;return null;},getElements:function(u){return r(u.tagName=='FORM'?u.elements:t.getInputs(u));},getAttribute:function(u,v){return (u.getAttributeNode(v)||{}).value||null;},setDisabled:function(u,v){t.getElements(u).forEach(function(w){if(w.disabled!=undefined){var x=m.get(w,'origDisabledState');if(v){if(x===undefined)m.set(w,'origDisabledState',w.disabled);w.disabled=v;}else if(x!==true)w.disabled=false;}});},bootstrap:function(u,v){var w=(t.getAttribute(u,'method')||'GET').toUpperCase();v=p.byTag(v,'button')||v;var x=p.byClass(v,'stat_elem')||u;if(i.hasClass(x,'async_saving'))return;if(v&&(v.form!==u||(v.nodeName!='INPUT'&&v.nodeName!='BUTTON')||v.type!='submit')){var y=l.scry(u,'.enter_submit_target')[0];y&&(v=y);}var z=t.serialize(u,v);t.setDisabled(u,true);var aa=t.getAttribute(u,'ajaxify')||t.getAttribute(u,'action');s(u,aa);var ba=new g(aa);ba.setData(z).setNectarModuleDataSafe(u).setReadOnly(w=='GET').setMethod(w).setRelativeTo(u).setStatusElement(x).setInitialHandler(t.setDisabled.curry(u,false)).setHandler(function(ca){Event.fire(u,'success',{response:ca});}).setErrorHandler(function(ca){if(Event.fire(u,'error',{response:ca})!==false)h.defaultErrorHandler(ca);}).setFinallyHandler(t.setDisabled.curry(u,false)).send();},serialize:function(u,v){var w={};t.getElements(u).forEach(function(x){if(x.name&&!x.disabled&&x.type!='submit')if(!x.type||((x.type=='radio'||x.type=='checkbox')&&x.checked)||x.type=='text'||x.type=='password'||x.type=='hidden'||x.tagName=='TEXTAREA'){t._serializeHelper(w,x.name,o.getValue(x));}else if(x.tagName=='SELECT')for(var y=0,z=x.options.length;y<z;++y){var aa=x.options[y];if(aa.selected)t._serializeHelper(w,x.name,aa.value);}});if(v&&v.name&&'submit'==v.type&&l.contains(u,v)&&l.isNodeOfType(v,['input','button']))t._serializeHelper(w,v.name,v.value);return t._serializeFix(w);},_serializeHelper:function(u,v,w){var x=/([^\]]+)\[([^\]]*)\](.*)/.exec(v);if(x){u[x[1]]=u[x[1]]||{};if(x[2]==''){var y=0;while(u[x[1]][y]!=undefined)y++;}else y=x[2];if(x[3]==''){u[x[1]][y]=w;}else t._serializeHelper(u[x[1]],y.concat(x[3]),w);}else u[v]=w;},_serializeFix:function(u){var v=[];for(var w in u){if(u[w] instanceof Object)u[w]=t._serializeFix(u[w]);v.push(w);}if(v.length>0){var x=0,y=true;v.sort().forEach(function(aa){if(aa!=x++)y=false;});if(y){var z=[];v.forEach(function(aa){z[aa]=u[aa];});return z;}}return u;},post:function(u,v,w){var x=document.createElement('form');x.action=u.toString();x.method='POST';x.style.display='none';if(w)x.target=w;v.fb_dtsg=n.fb_dtsg;t.createHiddenInputs(v,x);l.getRootElement().appendChild(x);x.submit();return false;},createHiddenInputs:function(u,v,w,x){w=w||{};var y,z=q.implodeQuery(u,'',false),aa=z.split('&');for(var ba=0;ba<aa.length;ba++)if(aa[ba]){var ca=aa[ba].split('='),da=ca[0],ea=ca[1];if(da===undefined||ea===undefined)continue;ea=q.decodeComponent(ea);if(w[da]&&x){w[da].value=ea;}else{y=j.create('input',{type:'hidden',name:da,value:ea});w[da]=y;v.appendChild(y);}}return w;},getFirstElement:function(u,v){v=v||['input[type="text"]','textarea','input[type="password"]','input[type="button"]','input[type="submit"]'];var w=[];for(var x=0;x<v.length;x++){w=l.scry(u,v[x]);for(var y=0;y<w.length;y++){var z=w[y];try{var ba=k.getElementPosition(z);if(ba.y>0&&ba.x>0)return z;}catch(aa){}}}return null;},focusFirst:function(u){var v=t.getFirstElement(u);if(v){v.focus();return true;}return false;}};e.exports=t;});
__d("Keys",[],function(a,b,c,d,e,f){var g={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,COMMA:188};e.exports=g;});
__d("Locale",["Style"],function(a,b,c,d,e,f){var g=b('Style'),h,i={isRTL:function(){if(h===undefined)h=('rtl'===g.get(document.body,'direction'));return h;}};e.exports=i;});
__d("getOverlayZIndex",["Style"],function(a,b,c,d,e,f){var g=b('Style');function h(i,j){j=j||document.body;var k=[];while(i&&i!==j){k.push(i);i=i.parentNode;}if(i!==j)return 0;for(var l=k.length-1;l>=0;l--){var m=k[l];if(g.get(m,'position')!='static'){var n=parseInt(g.get(m,'z-index'),10);if(!isNaN(n))return n;}}return 0;}e.exports=h;});
__d("Dialog",["array-extensions","event-extensions","AjaxPipeRequest","Animation","Arbiter","AsyncRequest","Bootloader","Button","css-support","DOM","Form","HTML","Input","Keys","Locale","Parent","Run","Style","URI","UserAgent","Vector","bind","copyProperties","createArrayFrom","getObjectValues","getOverlayZIndex","tx"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('AjaxPipeRequest'),h=b('Animation'),i=b('Arbiter'),j=b('AsyncRequest'),k=b('Bootloader'),l=b('Button'),m=b('css-support'),n=b('DOM'),o=b('Form'),p=b('HTML'),q=b('Input'),r=b('Keys'),s=b('Locale'),t=b('Parent'),u=b('Run'),v=b('Style'),w=b('URI'),x=b('UserAgent'),y=b('Vector'),z=b('bind'),aa=b('copyProperties'),ba=b('createArrayFrom'),ca=b('getObjectValues'),da=b('getOverlayZIndex'),ea=b('tx'),fa=function(){var ha=document.body,ia=document.createElement('div'),ja=document.createElement('div');ha.insertBefore(ia,ha.firstChild);ha.insertBefore(ja,ha.firstChild);ia.style.position='fixed';ia.style.top='20px';var ka=ia.offsetTop!==ja.offsetTop;ha.removeChild(ia);ha.removeChild(ja);fa=bagof(ka);return ka;};function ga(ha){this._show_loading=true;this._auto_focus=true;this._submit_on_enter=false;this._fade_enabled=true;this._onload_handlers=[];this._top=125;this._uniqueID='dialog_'+ga._globalCount++;this._content=null;this._obj=null;this._popup=null;this._overlay=null;this._shim=null;this._causal_elem=null;this._previous_focus=null;this._buttons=[];this._buildDialog();if(ha)this._setFromModel(ha);ga._init();}aa(ga,{OK:{name:'ok',label:"OK"},CANCEL:{name:'cancel',label:"Peruuta",className:'inputaux'},CLOSE:{name:'close',label:"Sulje"},NEXT:{name:'next',label:"Seuraava"},SAVE:{name:'save',label:"Tallenna"},SUBMIT:{name:'submit',label:"L\u00e4het\u00e4"},CONFIRM:{name:'confirm',label:"Vahvista"},DELETE:{name:'delete',label:"Poista"},_globalCount:0,_bottoms:[0],max_bottom:0,_updateMaxBottom:function(){ga.max_bottom=Math.max.apply(Math,ga._bottoms);}});aa(ga,{OK_AND_CANCEL:[ga.OK,ga.CANCEL],_STANDARD_BUTTONS:[ga.OK,ga.CANCEL,ga.CLOSE,ga.SAVE,ga.SUBMIT,ga.CONFIRM,ga.DELETE],SIZE:{WIDE:555,STANDARD:445},_HALO_WIDTH:10,_BORDER_WIDTH:1,_PADDING_WIDTH:10,_PAGE_MARGIN:40,_stack:[],_isUsingCSSBorders:function(){return m.supportsBorderRadius()||x.ie()<7;},newButton:function(ha,ia,ja,ka){var la={name:ha,label:ia};if(ja)la.className=ja;if(ka)la.handler=ka;return la;},getCurrent:function(){var ha=ga._stack;return ha.length?ha[ha.length-1]:null;},hideCurrent:function(){var ha=ga.getCurrent();ha&&ha.hide();},bootstrap:function(ha,ia,ja,ka,la,ma){ia=ia||{};var na=ma&&ma.rel=='dialog-pipe';aa(ia,new w(ha).getQueryData());ka=ka||(ja?'GET':'POST');var oa=t.byClass(ma,'stat_elem')||ma;if(oa&&m.hasClass(oa,'async_saving'))return false;var pa;if(na){pa=new g();}else pa=new j().setReadOnly(!!ja).setMethod(ka).setRelativeTo(ma).setStatusElement(oa);pa.setURI(ha).setNectarModuleDataSafe(ma).setData(ia);var qa=new ga(la).setCausalElement(ma).setAsync(pa,na);qa.show();return false;},showFromModel:function(ha,ia){var ja=new ga(ha).setCausalElement(ia).show();if(ha.hiding)ja.hide();},_init:function(){this._init=bagofholding;u.onLeave(ga._tearDown.shield(null,false));i.subscribe('page_transition',ga._tearDown.shield(null,true));Event.listen(document.documentElement,'keydown',function(event){if(Event.getKeyCode(event)==r.ESC&&!event.getModifiers().any){if(ga._escape())event.kill();}else if(Event.getKeyCode(event)==r.RETURN&&!event.getModifiers().any)if(ga._enter())event.kill();});Event.listen(window,'resize',function(event){var ha=ga.getCurrent();ha&&ha._resetDialogObj();});},_findButton:function(ha,ia){if(ha)for(var ja=0;ja<ha.length;++ja)if(ha[ja].name==ia)return ha[ja];return null;},_tearDown:function(ha){var ia=ga._stack.slice();for(var ja=ia.length-1;ja>=0;ja--)if((ha&&!ia[ja]._cross_transition)||(!ha&&!ia[ja]._cross_quickling))ia[ja].hide();},_escape:function(){var ha=ga.getCurrent();if(!ha)return false;var ia=ha._semi_modal,ja=ha._buttons;if(!ja.length&&!ia)return false;if(ia&&!ja.length){ha.hide();return true;}var ka,la=ga._findButton(ja,'cancel');if(ha._cancelHandler){ha.cancel();return true;}else if(la){ka=la;}else if(ja.length==1){ka=ja[0];}else return false;ha._handleButton(ka);return true;},_enter:function(){var ha=ga.getCurrent();if(!ha||!ha._submit_on_enter)return false;if(document.activeElement!=ha._frame)return false;var ia=ha._buttons;if(!ia)return false;ha._handleButton(ia[0]);return true;},call_or_eval:function(ha,ia,ja){if(!ia)return undefined;ja=ja||{};if(typeof ia=='string'){var ka=Object.keys(ja).join(', ');ia=(eval)('({f: function('+ka+') { '+ia+'}})').f;}return ia.apply(ha,ca(ja));}});aa(ga.prototype,{_cross_quickling:false,_cross_transition:false,_loading:false,_showing:false,show:function(){this._showing=true;if(this._async_request){if(this._show_loading)this.showLoading();}else this._update();return this;},showLoading:function(){this._loading=true;m.addClass(this._frame,'dialog_loading_shown');this._renderDialog();return this;},hide:function(){if(!this._showing&&!this._loading)return this;this._showing=false;if(this._autohide_timeout){clearTimeout(this._autohide_timeout);this._autohide_timeout=null;}if(this._fade_enabled&&ga._stack.length<=1){this._fadeOut();}else this._hide();return this;},cancel:function(){if(!this._cancelHandler||this._cancelHandler()!==false)this.hide();},getRoot:function(){return this._obj;},getBody:function(){return n.scry(this._obj,'div.dialog_body')[0];},getButtonElement:function(ha){if(typeof ha=='string')ha=ga._findButton(this._buttons,ha);if(!ha||!ha.name)return null;var ia=n.scry(this._popup,'input'),ja=function(ka){return ka.name==ha.name;};return ia.filter(ja)[0]||null;},getContentNode:function(){return n.find(this._content,'div.dialog_content');},getFormData:function(){return o.serialize(this.getContentNode());},setAllowCrossPageTransition:function(ha){this._cross_transition=ha;return this;},setAllowCrossQuicklingNavigation:function(ha){this._cross_quickling=ha;return this;},setShowing:function(){this.show();return this;},setHiding:function(){this.hide();return this;},setTitle:function(ha){var ia=this._nodes.title,ja=this._nodes.title_inner,ka=this._nodes.content;n.setContent(ja,this._format(ha||''));m.conditionShow(ia,!!ha);m.conditionClass(ka,'dialog_content_titleless',!ha);return this;},setBody:function(ha){n.setContent(this._nodes.body,this._format(ha));return this;},setExtraData:function(ha){this._extra_data=ha;return this;},setReturnData:function(ha){this._return_data=ha;return this;},setShowLoading:function(ha){this._show_loading=ha;return this;},setFullBleed:function(ha){this._full_bleed=ha;this._updateWidth();m.conditionClass(this._obj,'full_bleed',ha);return this;},setCausalElement:function(ha){this._causal_elem=ha;return this;},setUserData:function(ha){this._user_data=ha;return this;},getUserData:function(){return this._user_data;},setAutohide:function(ha){if(ha){if(this._showing){this._autohide_timeout=setTimeout(this.hide.shield(this),ha);}else this._autohide=ha;}else{this._autohide=null;if(this._autohide_timeout){clearTimeout(this._autohide_timeout);this._autohide_timeout=null;}}return this;},setSummary:function(ha){var ia=this._nodes.summary;n.setContent(ia,this._format(ha||''));m.conditionShow(ia,!!ha);return this;},setButtons:function(ha){var ia,ja;if(!(ha instanceof Array)){ia=ba(arguments);}else ia=ha;for(var ka=0;ka<ia.length;++ka)if(typeof ia[ka]=='string'){ja=ga._findButton(ga._STANDARD_BUTTONS,ia[ka]);ia[ka]=ja;}this._buttons=ia;var la=[];if(ia&&ia.length>0)for(var ma=0;ma<ia.length;ma++){ja=ia[ma];var na=n.$N('input',{type:'button',name:ja.name||'',value:ja.label}),oa=n.$N('label',{className:'uiButton uiButtonLarge uiButtonConfirm'},na);if(ja.className){ja.className.split(/\s+/).forEach(function(qa){m.addClass(oa,qa);});if(m.hasClass(oa,'inputaux')){m.removeClass(oa,'inputaux');m.removeClass(oa,'uiButtonConfirm');}if(m.hasClass(oa,'uiButtonSpecial'))m.removeClass(oa,'uiButtonConfirm');}if(ja.icon)n.prependContent(oa,n.$N('img',{src:ja.icon,className:'img mrs'}));if(ja.disabled)l.setEnabled(oa,false);Event.listen(na,'click',this._handleButton.bind(this,ja.name));for(var pa in ja)if(pa.indexOf('data-')===0&&pa.length>5)na.setAttribute(pa,ja[pa]);la.push(oa);}n.setContent(this._nodes.buttons,la);this._updateButtonVisibility();return this;},setButtonsMessage:function(ha){n.setContent(this._nodes.button_message,this._format(ha||''));this._has_button_message=!!ha;this._updateButtonVisibility();return this;},_updateButtonVisibility:function(){var ha=this._buttons.length>0||this._has_button_message;m.conditionShow(this._nodes.button_wrapper,ha);m.conditionClass(this._obj,'omitDialogFooter',!ha);},setClickButtonOnEnter:function(ha,ia){this._clickOnEnterTarget=ha;if(!this._clickOnEnterListener)this._clickOnEnterListener=Event.listen(this._nodes.body,'keypress',function(event){var ja=event.getTarget();if(ja&&ja.id===this._clickOnEnterTarget)if(Event.getKeyCode(event)==r.RETURN){this._handleButton(ia);event.kill();}return true;}.bind(this));return this;},setStackable:function(ha,ia){this._is_stackable=ha;this._shown_while_stacked=ha&&ia;return this;},setHandler:function(ha){this._handler=ha;return this;},setCancelHandler:function(ha){this._cancelHandler=ga.call_or_eval.bind(null,this,ha);return this;},setCloseHandler:function(ha){this._close_handler=ga.call_or_eval.bind(null,this,ha);return this;},clearHandler:function(){return this.setHandler(null);},setPostURI:function(ha,ia){if(ia===undefined)ia=true;if(ia){this.setHandler(this._submitForm.bind(this,'POST',ha));}else this.setHandler(function(){o.post(ha,this.getFormData());this.hide();}.bind(this));return this;},setGetURI:function(ha){this.setHandler(this._submitForm.bind(this,'GET',ha));return this;},setModal:function(ha){this._modal=ha;m.conditionClass(this._obj,'generic_dialog_modal',ha);return this;},setSemiModal:function(ha){if(ha){this.setModal(true);this._semiModalListener=Event.listen(this._obj,'click',function(ia){if(!n.contains(this._popup,ia.getTarget()))this.hide();}.bind(this));}else this._semiModalListener&&this._semiModalListener.remove();this._semi_modal=ha;return this;},setWideDialog:function(ha){this._wide_dialog=ha;this._updateWidth();return this;},setContentWidth:function(ha){this._content_width=ha;this._updateWidth();return this;},setTitleLoading:function(ha){if(ha===undefined)ha=true;var ia=n.find(this._popup,'h2.dialog_title');if(ia)m.conditionClass(ia,'loading',ha);return this;},setSecure:function(ha){m.conditionClass(this._nodes.title,'secure',ha);return this;},setClassName:function(ha){ha.split(/\s+/).forEach(m.addClass.bind(m,this._obj));return this;},setFadeEnabled:function(ha){this._fade_enabled=ha;return this;},setFooter:function(ha){var ia=this._nodes.footer;n.setContent(ia,this._format(ha||''));m.conditionShow(ia,!!ha);return this;},setAutoFocus:function(ha){this._auto_focus=ha;return this;},setTop:function(ha){this._top=ha;this._resetDialogObj();return this;},onloadRegister:function(ha){ba(ha).forEach(function(ia){if(typeof ia=='string')ia=new Function(ia);this._onload_handlers.push(ia.bind(this));}.bind(this));return this;},setAsyncURL:function(ha){return this.setAsync(new j(ha));},setAsync:function(ha,ia){var ja=function(ra){if(this._async_request!=ha)return;this._async_request=null;var sa=ra.getPayload(),ta=sa,ua=function(){if(this._loading)this._showing=true;if(typeof ta=='string'){this.setBody(ta);}else this._setFromModel(ta);this._update();}.bind(this);if(ia){ta=sa.dialog;k.setResourceMap(sa.resource_map);k.loadResources(sa.css,ua);}else ua();}.bind(this),ka=ha.getData();ka.__d=1;ha.setData(ka);var la;if(ia){ha.setFirstResponseHandler(ja);la=ha.getAsyncRequest();}else{var ma=ha.getHandler()||bagofholding;ha.setHandler(function(ra){ma(ra);ja(ra);});la=ha;}var na=la.getErrorHandler()||bagofholding,oa=la.getTransportErrorHandler()||bagofholding,pa=function(){this._async_request=null;this._loading=false;if(this._showing&&this._shown_while_stacked){this._update();}else this._hide(this._is_stackable);}.bind(this),qa=la.getServerDialogCancelHandler()||pa;la.setAllowCrossPageTransition(this._cross_transition).setErrorHandler(function(ra){pa();na(ra);}).setTransportErrorHandler(function(ra){pa();oa(ra);}).setServerDialogCancelHandler(qa);ha.send();this._async_request=ha;if(this._showing)this.show();return this;},_format:function(ha){if(typeof ha=='string'){ha=p(ha);}else ha=p.replaceJSONWrapper(ha);if(ha instanceof p)ha.setDeferred(true);return ha;},_update:function(){if(!this._showing)return;if(this._autohide&&!this._async_request&&!this._autohide_timeout)this._autohide_timeout=setTimeout(z(this,'hide'),this._autohide);m.removeClass(this._frame,'dialog_loading_shown');this._loading=false;this._renderDialog();this._runOnloads();this._previous_focus=document.activeElement;q.focus(this._frame);},_runOnloads:function(){for(var ha=0;ha<this._onload_handlers.length;++ha)try{this._onload_handlers[ha]();}catch(ia){}this._onload_handlers=[];},_updateWidth:function(){var ha=2*ga._BORDER_WIDTH;if(ga._isUsingCSSBorders())ha+=2*ga._HALO_WIDTH;if(this._content_width){ha+=this._content_width;if(!this._full_bleed)ha+=2*ga._PADDING_WIDTH;}else if(this._wide_dialog){ha+=ga.SIZE.WIDE;}else ha+=ga.SIZE.STANDARD;this._popup.style.width=ha+'px';},_updateZIndex:function(){if(!this._hasSetZIndex&&this._causal_elem){var ha=da(this._causal_elem);this._hasSetZIndex=ha>(this._modal?400:200);v.set(this._obj,'z-index',this._hasSetZIndex?ha:'');}},_renderDialog:function(){this._updateZIndex();this._pushOntoStack();this._obj.style.height=(this._modal&&x.ie()<7)?y.getDocumentDimensions().y+'px':null;if(this._obj&&this._obj.style.display){this._obj.style.visibility='hidden';this._obj.style.display='';this.resetDialogPosition();this._obj.style.visibility='';this._obj.dialog=this;}else this.resetDialogPosition();clearInterval(this.active_hiding);this.active_hiding=setInterval(this._activeResize.bind(this),500);this._submit_on_enter=false;if(this._auto_focus){var ha=o.getFirstElement(this._content,['input[type="text"]','textarea','input[type="password"]']);if(ha){o.focusFirst.bind(this,this._content).defer();}else this._submit_on_enter=true;}var ia=y.getElementDimensions(this._content).y+y.getElementPosition(this._content).y;ga._bottoms.push(ia);this._bottom=ia;ga._updateMaxBottom();return this;},_buildDialog:function(){this._obj=n.$N('div',{className:'generic_dialog',id:this._uniqueID});this._obj.style.display='none';n.appendContent(n.getDocumentBodyElement(),this._obj);if(!this._popup)this._popup=n.$N('div',{className:'generic_dialog_popup'});this._obj.appendChild(this._popup);if(x.ie()<7&&!this._shim)k.loadModules(['IframeShim'],function(ta){this._shim=new ta(this._popup);});m.addClass(this._obj,'pop_dialog');if(s.isRTL())m.addClass(this._obj,'pop_dialog_rtl');var ha;if(ga._isUsingCSSBorders()){ha='<div class="pop_container_advanced">'+'<div class="pop_content" id="pop_content"></div>'+'</div>';}else ha='<div class="pop_container">'+'<div class="pop_verticalslab"></div>'+'<div class="pop_horizontalslab"></div>'+'<div class="pop_topleft"></div>'+'<div class="pop_topright"></div>'+'<div class="pop_bottomright"></div>'+'<div class="pop_bottomleft"></div>'+'<div class="pop_content pop_content_old" id="pop_content"></div>'+'</div>';n.setContent(this._popup,p(ha));var ia=n.find(this._popup,'div.pop_content');ia.setAttribute('tabIndex','0');ia.setAttribute('role','alertdialog');this._frame=this._content=ia;var ja=n.$N('div',{className:'dialog_loading'},"Ladataan..."),ka=n.$N('span'),la=n.$N('h2',{className:'dialog_title hidden_elem',id:'title_'+this._uniqueID},ka),ma=n.$N('div',{className:'dialog_summary hidden_elem'}),na=n.$N('div',{className:'dialog_body'}),oa=n.$N('div'),pa=n.$N('div',{className:'dialog_buttons_msg'}),qa=n.$N('div',{className:'dialog_buttons clearfix hidden_elem'},[pa,oa]),ra=n.$N('div',{className:'dialog_footer hidden_elem'}),sa=n.$N('div',{className:'dialog_content'},[ma,na,qa,ra]);this._nodes={summary:ma,body:na,buttons:oa,button_message:pa,button_wrapper:qa,footer:ra,content:sa,title:la,title_inner:ka};n.setContent(this._frame,[la,sa,ja]);},_updateShim:function(){return this._shim&&this._shim.show();},_activeResize:function(){if(this.last_offset_height!=this._content.offsetHeight){this.last_offset_height=this._content.offsetHeight;this.resetDialogPosition();}},resetDialogPosition:function(){if(!this._popup)return;this._resetDialogObj();this._updateShim();},_resetDialogObj:function(){var ha=2*ga._PAGE_MARGIN,ia=y.getViewportDimensions(),ja=ia.x-ha,ka=ia.y-ha,la=2*ga._HALO_WIDTH,ma=y.getElementDimensions(this._content),na=ma.x+la,oa=ma.y+la,pa=this._top,qa=ja-na,ra=ka-oa;if(ra<0){pa=ga._PAGE_MARGIN;}else if(pa>ra)pa=ga._PAGE_MARGIN+(Math.max(ra,0)/2);var sa=fa();if(!sa)pa+=y.getScrollPosition().y;v.set(this._popup,'marginTop',pa+'px');var ta=sa&&(qa<0||ra<0);m.conditionClass(this._obj,'generic_dialog_fixed_overflow',ta);m.conditionClass(document.documentElement,'generic_dialog_overflow_mode',ta);},_fadeOut:function(ha){if(!this._popup)return;try{new h(this._obj).duration(0).checkpoint().to('opacity',0).hide().duration(250).ondone(this._hide.bind(this,ha)).go();}catch(ia){this._hide(ha);}},_hide:function(ha){if(this._obj)this._obj.style.display='none';m.removeClass(document.documentElement,'generic_dialog_overflow_mode');this._updateShim();clearInterval(this.active_hiding);if(this._bottom){var ia=ga._bottoms;ia.splice(ia.indexOf(this._bottom),1);ga._updateMaxBottom();}if(this._previous_focus&&document.activeElement&&n.contains(this._obj,document.activeElement))q.focus(this._previous_focus);if(ha)return;this.destroy();},destroy:function(){this._popFromStack();if(this._obj){n.remove(this._obj);this._obj=null;this._shim&&this._shim.hide();this._shim=null;}this._clickOnEnterListener&&this._clickOnEnterListener.remove();if(this._close_handler)this._close_handler({return_data:this._return_data});},_handleButton:function(ha){if(typeof ha=='string')ha=ga._findButton(this._buttons,ha);var ia=ga.call_or_eval(ha,ha.handler);if(ia===false)return;if(ha.name=='cancel'){this.cancel();}else if(ga.call_or_eval(this,this._handler,{button:ha})!==false)this.hide();},_submitForm:function(ha,ia,ja){var ka=this.getFormData();if(ja)ka[ja.name]=ja.label;if(this._extra_data)aa(ka,this._extra_data);var la=new j().setURI(ia).setData(ka).setMethod(ha).setNectarModuleDataSafe(this._causal_elem).setReadOnly(ha=='GET');this.setAsync(la);return false;},_setFromModel:function(ha){var ia={};aa(ia,ha);for(var ja in ia){if(ja=='onloadRegister'){this.onloadRegister(ia[ja]);continue;}var ka=this['set'+ja.substr(0,1).toUpperCase()+ja.substr(1)];ka.apply(this,ba(ia[ja]));}},_updateBottom:function(){var ha=y.getElementDimensions(this._content).y+y.getElementPosition(this._content).y;ga._bottoms[ga._bottoms.length-1]=ha;ga._updateMaxBottom();},_pushOntoStack:function(){var ha=ga._stack;if(!ha.length)i.inform('layer_shown',{type:'Dialog'});ha.remove(this);ha.push(this);for(var ia=ha.length-2;ia>=0;ia--){var ja=ha[ia];if(!ja._is_stackable&&!ja._async_request){ja._hide();}else if(!ja._shown_while_stacked)ja._hide(true);}},_popFromStack:function(){var ha=ga._stack,ia=(ha[ha.length-1]===this);ha.remove(this);if(ha.length){if(ia)ha[ha.length-1].show();}else i.inform('layer_hidden',{type:'Dialog'});}});e.exports=ga;});
__d("legacy:dialog",["Dialog"],function(a,b,c,d){var e=b('Dialog');a.Dialog=e;},3);
__d("legacy:array-utils",["createArrayFrom","hasArrayNature"],function(a,b,c,d){a.$A=b('createArrayFrom');a.hasArrayNature=b('hasArrayNature');},3);
__d("legacy:data-store",["DataStore"],function(a,b,c,d){a.DataStore=a.DataStore||b('DataStore');},3);
__d("legacy:env",["Env"],function(a,b,c,d){var e=b('Env');a.Env=e;},3);
__d("PlaceholderOnsubmitFormListener",["event-extensions","Input"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Input');Event.listen(document.documentElement,'submit',function(h){var i=h.getTarget().getElementsByTagName('*');for(var j=0;j<i.length;j++)if(i[j].getAttribute('placeholder')&&g.isEmpty(i[j]))g.setValue(i[j],'');});});
__d("Banzai",["Arbiter","Env","Run","XHR","copyProperties","BanzaiConfig"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Env'),i=b('Run'),j=b('XHR'),k=c('BanzaiConfig'),l=b('copyProperties'),m=new g(),n='/ajax/banzai/banzai.php',o={},p=0,q=Date.now(),r,s;if(a.sessionStorage){i.onUnload(function w(){a.sessionStorage.setItem('Banzai',JSON.stringify(o));});if('Banzai' in a.sessionStorage){o=JSON.parse(a.sessionStorage.getItem('Banzai'));a.sessionStorage.removeItem('Banzai');}}function t(w,x){if(!o[w]){p+=w.length;o[w]=[];}x=JSON.stringify(x);p+=x.length;o[w].push(JSON.parse(x));if(p>k.MAX_SIZE||(Date.now()-q)>k.MAX_WAIT){v();}else if(!r)r=setTimeout(v,k.MAX_WAIT,false);return m;}function u(){if(!s)return;if(s.readyState<4)s.abort();s=s.onreadystatechange=null;}function v(){if(s)return;var w=o;o={};r=clearTimeout(r);q=Date.now();p=0;s=j.create();s.open('POST',n,true);s.setRequestHeader('Content-Type','application/x-www-form-urlencoded');s.onreadystatechange=function(){if(s.readyState>=4){var x=s.status;u();m.inform(x==200?m.OK:m.ERROR);}};setTimeout(u,15000,false);m.inform(m.SEND);s.send('__a=1&__user='+h.user+'&fb_dtsg='+h.fb_dtsg+'&routes='+encodeURIComponent(JSON.stringify(w)));}l(m,{SEND:'Banzai:SEND',OK:'Banzai:OK',ERROR:'Banzai:ERROR',isEnabled:function(){return k.enabled;},post:t,send:v});e.exports=m;});
__d("BehaviorsMixin",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(l){this._behavior=l;this._enabled=false;}g(h.prototype,{enable:function(){if(!this._enabled){this._enabled=true;this._behavior.enable();}},disable:function(){if(this._enabled){this._enabled=false;this._behavior.disable();}}});var i=1;function j(l){if(!l.__BEHAVIOR_ID)l.__BEHAVIOR_ID=i++;return l.__BEHAVIOR_ID;}var k={enableBehavior:function(l){if(!this._behaviors)this._behaviors={};var m=j(l);if(!this._behaviors[m])this._behaviors[m]=new h(new l(this));this._behaviors[m].enable();return this;},disableBehavior:function(l){if(this._behaviors){var m=j(l);if(this._behaviors[m])this._behaviors[m].disable();}return this;},enableBehaviors:function(l){l.forEach(this.enableBehavior.bind(this));return this;},destroyBehaviors:function(){if(this._behaviors){for(var l in this._behaviors)this._behaviors[l].disable();this._behaviors={};}}};e.exports=k;});
__d("DimensionTracking",["event-extensions","AsyncSignal","Cookie","DOMDimensions","Run"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncSignal'),h=b('Cookie'),i=b('DOMDimensions'),j=b('Run');function k(){var l=i.getViewportDimensions();h.set('wd',l.width+'x'+l.height);if(Math.random()<.01)new g('/ajax/dimension_context.php',{x:l.width,y:l.height}).send();}if(window==window.top)j.onAfterLoad(function(){setTimeout(k,100);Event.listen(window,'resize',k);Event.listen(window,'focus',k);});});
__d("JSONPTransport",["DOM","HTML","URI","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('HTML'),i=b('URI'),j=b('copyProperties'),k={},l=2,m='jsonp',n='iframe';function o(p,q,r){this._type=p;this._uri=q;this._handler=r;k[this.getID()]=this;}j(o,{respond:function(p,q,r){var s=k[p];if(s){if(!r)delete k[p];if(s._type==n)q=JSON.parse(JSON.stringify(q));a.async_callback(s.handleResponse.bind(s),'json')(q);}else if(a.logJSError&&!r)a.logJSError('ajax',{error:'UnexpectedJsonResponse',extra:{id:p,uri:(q.payload&&q.payload.uri)||''}});}});j(o.prototype,{getID:function(){return this._id||(this._id=l++);},hasFinished:function(){return !(this.getID() in k);},getRequestURI:function(){return i(this._uri).addQueryData({__a:1,__adt:this.getID()});},createTransportFrame:function(){var p='transport_frame_'+this.getID(),q=h('<iframe name="'+p+'" class="hidden_elem" />');return g.appendContent(document.body,q)[0];},send:function(){if(this._type===m){(function(){g.appendContent(document.body,g.create('script',{src:this.getRequestURI().toString(),type:'text/javascript'}));}).bind(this).defer();}else{this._iframe=this.createTransportFrame();this._iframe.src=this.getRequestURI().toString();}},handleResponse:function(p){if(!this._aborted)this._handler(p);if(this.hasFinished())if(this._iframe){g.remove.curry(this._iframe).defer();this._iframe=null;}},abort:function(){this._aborted=true;}});e.exports=o;});
__d("KeyStatus",["event-extensions"],function(a,b,c,d,e,f){b('event-extensions');var g=null,h=null;function i(){if(!h)h=Event.listen(window,'blur',function(){g=null;j();});}function j(){if(h){h.remove();h=null;}}Event.listen(document.documentElement,'keydown',function(l){g=Event.getKeyCode(l);i();},Event.Priority.URGENT);Event.listen(document.documentElement,'keyup',function(l){g=null;j();},Event.Priority.URGENT);var k={isKeyDown:function(){return !!g;},getKeyDownCode:function(){return g;}};e.exports=k;});
__d("LinkController",["event-extensions","DataStore","Parent","trackReferrer"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DataStore'),h=b('Parent'),i=b('trackReferrer'),j='LinkControllerHandler',k=[],l=[];function m(event){var q=h.byTag(event.getTarget(),'a'),r=q&&q.getAttribute('href',2);if(!r||q.rel||!o(r)||g.get(q,j))return;var s=Event.listen(q,'click',function(t){if(r.charAt(r.length-1)=='#'){t.prevent();return;}i(q,r);n(q,t);});g.set(q,j,s);}function n(q,event){if(q.target||event.getModifiers().any||(event.which&&event.which!=1))return;var r=k.concat(l);for(var s=0,t=r.length;s<t;s++)if(r[s](q,event)===false)return event.kill();}function o(q){var r=q.match(/^(\w+):/);return !r||r[1].match(/^http/i);}var p={registerHandler:function(q){k.push(q);},registerFallbackHandler:function(q){l.push(q);}};Event.listen(document.documentElement,'mousedown',m);Event.listen(document.documentElement,'keydown',m);e.exports=p;});
__d("InputSelection",["DOM","Input"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Input'),i={get:function(j){if(!document.selection)return {start:j.selectionStart,end:j.selectionEnd};var k=document.selection.createRange();if(k.parentElement()!==j)return {start:0,end:0};var l=j.value.length;if(g.isNodeOfType(j,'input')){return {start:-k.moveStart('character',-l),end:-k.moveEnd('character',-l)};}else{var m=k.duplicate();m.moveToElementText(j);m.setEndPoint('StartToEnd',k);var n=l-m.text.length;m.setEndPoint('StartToStart',k);return {start:l-m.text.length,end:n};}},set:function(j,k,l){if(typeof l=='undefined')l=k;if(document.selection){if(j.tagName=='TEXTAREA'){var m=(j.value.slice(0,k).match(/\r/g)||[]).length,n=(j.value.slice(k,l).match(/\r/g)||[]).length;k-=m;l-=m+n;}var o=j.createTextRange();o.collapse(true);o.moveStart('character',k);o.moveEnd('character',l-k);o.select();}else{j.selectionStart=k;j.selectionEnd=Math.min(l,j.value.length);h.focus(j);}}};e.exports=i;});
__d("StringEscape",[],function(a,b,c,d,e,f){var g={escapeJSQuotes:function(h){if(typeof h=='undefined'||h==null||!h.valueOf())return '';return h.toString().replace(/\\/g,'\\\\').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/"/g,'\\x22').replace(/'/g,'\\\'').replace(/</g,'\\x3c').replace(/>/g,'\\x3e').replace(/&/g,'\\x26');},htmlSpecialChars:function(h){if(typeof h=='undefined'||h===null||!h.toString)return '';if(h===false){return '0';}else if(h===true)return '1';return h.toString().replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#039;').replace(/</g,'&lt;').replace(/>/g,'&gt;');},htmlize:function(h){return g.htmlSpecialChars(h).replace(/\r\n|[\r\n]/g,'<br />');}};e.exports=g;});
__d("enforceMaxLength",["event-extensions","function-extensions","DOM","Input","InputSelection"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('DOM'),h=b('Input'),i=b('InputSelection'),j=function(l,m){var n=h.getValue(l),o=n.length,p=o-m;if(p>0){var q,r;try{q=i.get(l);r=q.end;}catch(s){q=null;r=0;}if(r>=p)o=r;var t=o-p;if(t&&(n.charCodeAt(t-1)&64512)===55296)t--;r=Math.min(r,t);h.setValue(l,n.slice(0,t)+n.slice(o));if(q)i.set(l,Math.min(q.start,r),r);}},k=function(event){var l=event.getTarget(),m=l.getAttribute&&parseInt(l.getAttribute('maxlength'),10);if(m>0&&g.isNodeOfType(l,['input','textarea']))j.bind(null,l,m).defer();};Event.listen(document.documentElement,{keydown:k,paste:k});e.exports=j;});
__d("areObjectsEqual",[],function(a,b,c,d,e,f){function g(h,i){return JSON.stringify(h)==JSON.stringify(i);}e.exports=g;});
__d("throttle",["debounce"],function(a,b,c,d,e,f){var g=b('debounce');function h(i,j,k){return g(i,j,k,false,true);}e.exports=h;});
__d("FormDisableOnSubmit",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._form=i;}g(h.prototype,{_subscription:null,_disabled:false,enable:function(){this._subscription=this._form.subscribe(['submit','reset'],this._handle.bind(this));},disable:function(){this._form.unsubscribe(this._subscription);this._subscription=null;},_handle:function(i,j){if(i=='submit'){if(this._disabled)return false;this._disabled=true;return true;}this._disabled=false;}});e.exports=h;});
__d("FormSubmitOnChange",["event-extensions","copyProperties","DOM"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('DOM');function i(j){this._form=j;}g(i.prototype,{_listener:null,enable:function(){this._listener=Event.listen(this._form.getRoot(),'change',this._submit.bind(this));},disable:function(){this._listener.remove();this._listener=null;},_submit:function(){var j=this._form.getRoot(),k=h.scry(j,'input[type="submit"]')[0];if(!k){k=h.create('input',{type:'submit',className:'hidden_elem'});h.appendContent(j,k);}k.click();}});e.exports=i;});
__d("UIForm",["event-extensions","ArbiterMixin","BehaviorsMixin","Class","DOM","Form","FormDisableOnSubmit","FormSubmitOnChange","Run","areObjectsEqual","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('BehaviorsMixin'),i=b('Class'),j=b('DOM'),k=b('Form'),l=b('FormDisableOnSubmit'),m=b('FormSubmitOnChange'),n=b('Run'),o=b('areObjectsEqual'),p=b('copyProperties');function q(r,s,t,u){this._root=r;this.controller=r;this._message=s;n.onAfterLoad(function(){this._originalState=k.serialize(this._root);}.bind(this));this._forceDirty=t;this._submitted=false;Event.listen(this._root,'submit',this._handleSubmit.bind(this));if(u&&u.length)this.enableBehaviors(u);var v=true;n.onBeforeUnload(this.checkUnsaved.bind(this),v);}p(q.prototype,g,h,{getRoot:function(){return this._root;},setSubmitOnChange:function(r){if(r)this.enableBehavior(m);},setDisableOnSubmit:function(r){if(r)this.enableBehavior(l);},_handleSubmit:function(){if(this.inform('submit')===false)return false;this._submitted=true;return true;},reset:function(){this.inform('reset');this._submitted=false;},isDirty:function(){if(this._submitted||!j.contains(document.body,this._root))return false;if(this._forceDirty)return true;var r=k.serialize(this._root);return !o(r,this._originalState);},checkUnsaved:function(){if(this.isDirty())return this._message;return null;}});e.exports=a.UIForm||q;});
__d("SubMenu",["event-extensions","Arbiter","copyProperties","CSS"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('copyProperties'),i=b('CSS');function j(){}h(j.prototype,{_subMenu:null,_mainMenu:null,_forward:null,_backward:null,init:function(k,l,m,n){this._subMenu=k;this._mainMenu=l;this._forward=m;this._backward=n;g.subscribe('SubMenu/Reset',this._goToMainMenu.bind(this));Event.listen(m,'click',this._goToSubMenu.bind(this));Event.listen(n,'click',this._goToMainMenu.bind(this));},initAsyncChildMenu:function(k){Event.listen(this._forward,'click',function(){this._goToSubMenu();k.load();}.bind(this));},_goToMainMenu:function(){i.hide(this._subMenu);i.show(this._mainMenu);},_goToSubMenu:function(){i.hide(this._mainMenu);i.show(this._subMenu);}});e.exports=j;});
__d("legacy:ui-submenu",["SubMenu"],function(a,b,c,d){a.SubMenu=b('SubMenu');},3);
__d("AsyncMenu",["AsyncRequest","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('copyProperties');function i(){}h(i.prototype,{_uri:null,_elem:null,init:function(j,k){this._uri=j;this._elem=k;},load:function(){this.load=bagofholding;g.bootstrap(this._uri,this._elem);}});e.exports=i;});
__d("legacy:ui-asyncmenu",["AsyncMenu"],function(a,b,c,d){a.AsyncMenu=b('AsyncMenu');},3);
__d("legacy:key-event-constants",["Keys"],function(a,b,c,d){a.KEYS=b('Keys');},3);
__d("ErrorDialog",["Dialog"],function(a,b,c,d,e,f){var g=b('Dialog'),h={showAsyncError:function(i){try{return h.show(i.getErrorSummary(),i.getErrorDescription());}catch(j){alert(i);}},show:function(i,j,k,l){return (new g()).setTitle(i).setBody(j).setButtons([g.OK]).setStackable(true).setModal(true).setHandler(k||bagofholding).setButtonsMessage(l||'').show();}};e.exports=h;});
__d("legacy:error-dialog",["ErrorDialog"],function(a,b,c,d){var e=b('ErrorDialog');a.ErrorDialog=e;},3);
__d("DynamicIconSelector",["Button","CSS","DOM","Selector"],function(a,b,c,d,e,f){var g=b('Button'),h=b('CSS'),i=b('DOM'),j=b('Selector'),k={swapIcon:function(l){var m=j.getSelectedOptions(l)[0],n=m&&i.scry(m,'.itemIcon')[0],o=j.getSelectorButton(l);if(n){g.setIcon(o,n.cloneNode(true));}else{var p=i.scry(o,'.img')[0];p&&i.remove(p);}h.conditionClass(o,'uiSelectorChevronOnly',!n);}};j.subscribe('change',function(l,m){var n=m.selector;if(h.hasClass(n,'dynamicIconSelector'))k.swapIcon(n);});e.exports=k;});
__d("AudienceSelector",["Arbiter","CSS","DOM","DynamicIconSelector","PrivacyConst","Selector"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('DynamicIconSelector'),k=b('PrivacyConst'),l=b('Selector');l.subscribe('select',function(m,n){if(!h.hasClass(n.selector,'audienceSelector'))return;var o=l.getOptionValue(n.option);g.inform('AudienceSelector/changed',n);if(o==k.BaseValue.CUSTOM&&!h.hasClass(n.option,'noDialog')){l.toggle(n.selector);return false;}if(h.hasClass(n.selector,'dataTooltip')){var p=i.find(n.option,'.itemAnchor').getAttribute('data-tooltip');l.setButtonTooltip(n.selector,p||null);}if(!h.hasClass(n.option,'specialOption'))return;var q=i.find(n.option,'a').getAttribute('data-type');if(h.hasClass(n.option,'moreOption')){h.addClass(n.selector,q);h.addClass(n.selector,'showSecondaryOptions');return false;}else if(h.hasClass(n.option,'returnOption')){h.removeClass(n.selector,'showSecondaryOptions');h.removeClass(n.selector,'friendList');return false;}});g.subscribe('CustomPrivacyOption/update',function(m,n){if(!h.hasClass(n.selector,'audienceSelector'))return;l.setSelected(n.selector,l.getOptionValue(n.option));j.swapIcon(n.selector);l.setButtonTooltip(n.selector,n.tooltip);g.inform('AudienceSelector/update',n.selector);});});
__d("PrivacyModel",["PrivacyConst","copyProperties"],function(a,b,c,d,e,f){var g=b('PrivacyConst'),h=b('copyProperties');function i(){this.value=g.BaseValue.ALL_FRIENDS;this.friends=g.FriendsValue.NO_FRIENDS;this.networks=[];this.objects=[];this.lists=[];this.lists_x=[];this.list_anon=0;this.ids_anon=[];this.list_x_anon=0;this.ids_x_anon=[];this.tdata={};return this;}h(i.prototype,{init:function(j,k,l,m,n,o,p,q,r,s,t){this.value=j;this.friends=k;this.networks=l.slice();this.objects=m.slice();this.lists=n.slice();this.lists_x=o.slice();this.list_anon=p;this.ids_anon=q.slice();this.list_x_anon=r;this.ids_x_anon=s.slice();t=t||{};h(this.tdata,t);},clone:function(){var j=new i();j.init(this.value,this.friends,this.networks,this.objects,this.lists,this.lists_x,this.list_anon,this.ids_anon,this.list_x_anon,this.ids_x_anon,this.tdata);return j;},getData:function(){var j=['value','friends','networks','objects','lists','lists_x','list_anon','ids_anon','list_x_anon','ids_x_anon'],k={};for(var l=0;l<j.length;++l){var m=j[l];k[m]=this[m];}return k;}});e.exports=i;});
__d("legacy:AudienceSelector",["AudienceSelector"],function(a,b,c,d){b('AudienceSelector');},3);
__d("legacy:privacy-common",["PrivacyConst","PrivacyModel"],function(a,b,c,d){var e=b('PrivacyConst');a.PrivacyModel=b('PrivacyModel');a.PrivacyBaseValue=e.BaseValue;a.PrivacyFriendsValue=e.FriendsValue;a.PrivacyNetworksAll=e.NetworksAll;a.PrivacyNetworkTypes=e.NetworkTypes;a.PrivacySpecialPreset=e.SpecialPreset;},3);
__d("ScrollingPager",["Arbiter","copyProperties","CSS","OnVisible","UIPagelet","$","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('CSS'),j=b('OnVisible'),k=b('UIPagelet'),l=b('$'),m=b('ge'),n={};function o(p,q,r,s){this.scroll_loader_id=p;this.pagelet_src=q;this.data=r;this.options=s||{};if(this.options.target_id){this.target_id=this.options.target_id;this.options.append=true;}else this.target_id=p;this.handler=null;}h(o,{getInstance:function(p){return n[p];}});h(o.prototype,{setBuffer:function(p){this.options.buffer=p;this.onvisible&&this.onvisible.setBuffer(p);},getBuffer:function(){return this.options.buffer;},register:function(){this.onvisible=new j(l(this.scroll_loader_id),this.getHandler(),false,this.options.buffer,this.options);n[this.scroll_loader_id]=this;},getInstance:function(p){return n[p];},getHandler:function(){if(this.handler)return this.handler;function p(q){var r=m(this.scroll_loader_id);if(!r){this.onvisible.remove();return;}i.addClass(r.firstChild,'async_saving');var s=this.options.handler;this.options.handler=function(){g.inform('ScrollingPager/loadingComplete');s&&s.apply(null,arguments);};if(q)this.data.pager_fired_on_init=true;k.loadFromEndpoint(this.pagelet_src,this.target_id,this.data,this.options);}return p.bind(this);},setHandler:function(p){this.handler=p;},removeOnVisible:function(){this.onvisible.remove();}});e.exports=o;});
__d("ButtonGroup",["function-extensions","copyProperties","createArrayFrom","CSS","DataStore","Parent"],function(a,b,c,d,e,f){b('function-extensions');var g=b('copyProperties'),h=b('createArrayFrom'),i=b('CSS'),j=b('DataStore'),k=b('Parent'),l='firstItem',m='lastItem';function n(s,t){var u=k.byClass(s,t);if(!u)throw new Error('invalid use case');return u;}function o(s){return i.shown(s)&&h(s.childNodes).some(i.shown);}function p(s){var t,u,v;h(s.childNodes).forEach(function(w){v=o(w);i.removeClass(w,l);i.removeClass(w,m);i.conditionShow(w,v);if(v){t=t||w;u=w;}});t&&i.addClass(t,l);u&&i.addClass(u,m);i.conditionShow(s,t);}function q(s,t){var u=n(t,'uiButtonGroupItem');s(u);p(u.parentNode);}function r(s){this._root=n(s,'uiButtonGroup');j.set(this._root,'ButtonGroup',this);p(this._root);}r.getInstance=function(s){var t=n(s,'uiButtonGroup'),u=j.get(t,'ButtonGroup');return u||new r(t);};g(r.prototype,{hideItem:q.curry(i.hide),showItem:q.curry(i.show),toggleItem:q.curry(i.toggle)});e.exports=r;});
__d("legacy:ui-scrolling-pager-js",["ScrollingPager"],function(a,b,c,d){a.ScrollingPager=b('ScrollingPager');},3);
__d("RequiredFormListener",["event-extensions","Input"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Input');Event.listen(document.documentElement,'submit',function(h){var i=h.getTarget().getElementsByTagName('*');for(var j=0;j<i.length;j++)if(i[j].getAttribute('required')&&g.isEmpty(i[j])){i[j].focus();return false;}},Event.Priority.URGENT);});
__d("CustomPrivacyOption",["event-extensions","AsyncRequest","Dialog","DOM","Form","Parent","Selector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('Dialog'),i=b('DOM'),j=b('Form'),k=b('Parent'),l=b('Selector'),m=b('copyProperties');function n(){}m(n,{_instances:{},update:function(o,p,q,r){var s=n._instances[o];s._update(p,q)._updateOption(q,r);Arbiter.inform('Form/change',{node:s._container});},getData:function(o){return n._instances[o]._privacyData;}});m(n.prototype,{init:function(o,p,q,r,s){(function(){var t=this.initCustomState(o,p);if(!t)return;Event.listen(t,'click',function(event){this.openCustomDialog(event,o,q,s);}.bind(this));this._initSelector(t,r);}).bind(this).defer();},_initSelector:function(o,p){this._selector=k.byClass(o,'uiSelector');l.listen(this._selector,'select',function(q){if(q.option._id!=this._id)this.clearCustomState();}.bind(this));if(p)l.setButtonTooltip(this._selector,p);},_updateOption:function(o,p){var q=l.getOption(this._selector,o)||l.getOption(this._selector,PrivacyBaseValue.CUSTOM+'');Arbiter.inform('CustomPrivacyOption/update',{selector:this._selector,option:q,tooltip:p});return this;},_update:function(o,p){var q=p==PrivacyBaseValue.CUSTOM||!l.getOption(this._selector,p),r=this._selector.getAttribute('data-name');this.updateCustomState(o,q,r);return this;},initCustomState:function(o,p){var q=ge(o);if(!q)return q;n._instances[o]=this;this._container=i.find(q,'.customPrivacyInputs');this._id=p;this._privacyData={};var r=j.serialize(this._container);if(r.audience)this._privacyData=r.audience[p];return q;},openCustomDialog:function(event,o,p,q){var r=new g('/ajax/privacy/custom_dialog/').setData({option_id:o,id:this._id,privacy_data:this._privacyData,explain_tags:p,autosave:q});new h().setAsync(r).setModal(true).setCausalElement(event.getTarget()).show();},updateCustomState:function(o,p,q){this.clearCustomState();this._privacyData=m({},o);if(p)if(q){q=q.slice(0,-'[value]'.length);var r={};r[q]=o;j.createHiddenInputs(r,this._container,null,true);}},clearCustomState:function(){this._privacyData={};i.empty(this._container);}});e.exports=n;});
__d("legacy:CustomPrivacyOption",["CustomPrivacyOption"],function(a,b,c,d){a.CustomPrivacyOption=b('CustomPrivacyOption');},3);
var FriendListPrivacyOptions=(function(){var a=false,b=false,c=null,d={},e=function(f){if(is_empty(d))PageTransitions.registerHandler(function(){d={};a=false;b=false;});var g=f.getAttribute('data-name');d[g]=f;Selector.listen(f,'select',function(h){var i=h.option,j=DOM.find(i,'a.itemAnchor'),k=j.getAttribute('data-flid');if(!k)return;var l=j.getAttribute('data-dynamic');if(l&&a){FriendListPrivacyOptions.showSmartListNux(i,k);}else if(!l&&b)FriendListPrivacyOptions.showDumbListNux([k]);});};return {listen:function(f,g,h){var i=ge(f);if(!i)return;var j=Parent.byClass(i,'audienceSelector');if(j){e(j);a=g;b=h;}},showSmartListNux:function(f,g){new AsyncRequest('/ajax/friends/lists/smart_list_publish_nux.php').setData({option_id:f.id,flid:g}).send();a=false;},setContextualDialog:function(f,g){var h=Parent.byClass(g,'audienceSelector');if(h){f.setContext(h);f.show();var i=Arbiter.subscribe('composer/publish',function(){f.hide();});f.subscribe('hide',function(){i.unsubscribe();});}},showDumbListNux:function(f){new AsyncRequest('/ajax/friends/lists/dumb_list_publish_nux.php').setData({flids:f}).send();b=false;},showBothListsNux:function(f,g){c=f;FriendListPrivacyOptions.showDumbListNux(g);},setDialog:function(){if(!c)return;var f=Dialog.getCurrent();if(f)f.setCloseHandler(function(){FriendListPrivacyOptions.showSmartListNux(c);c=null;});}};})();
function OnlyMePrivacyOption(){}copy_properties(OnlyMePrivacyOption.prototype,{init:function(a){this._selector=Parent.byClass(a,'composerAudienceSelector');if(!this._selector)return;this._elem=a;this._taggedIDs=[];this._tags=[];this._recalculateTooltipAndLabel();this._updateSelector();Arbiter.subscribe('Composer/changedtags',function(b,c){this._tags=c.withTags.map(function(e){return e.getText();});this._taggedIDs=c.withTags.map(function(e){return e.getValue();});for(var d in c.mention)if(c.mention[d].type=='user'&&c.mention[d].uid!=Env.user){this._tags.push(c.mention[d].text);this._taggedIDs.push(c.mention[d].uid);}if(this._recalculateTooltipAndLabel()&&this._updateSelector())Arbiter.inform('SelectedPrivacyOption/changed',this._getChangedData());}.bind(this));Selector.listen(this._selector,'change',this._updateSelector.bind(this));},_getChangedData:function(){return {tags:this._taggedIDs,privacy:PrivacyFriendsValue.SELF};},_recalculateTooltipAndLabel:function(){var a=this._tooltip,b=this._label;if(this._taggedIDs.length){this._tooltip="Kaikki merkityt";this._label="Mukautettu";}else{this._tooltip="Vain sin\u00e4";this._label="Vain min\u00e4";}return (a!=this._tooltip)||(b!=this._label);},_updateSelector:function(){if(!Selector.isOptionSelected(this._elem))return false;Selector.setButtonLabel(this._selector,this._label);Selector.setButtonTooltip(this._selector,this._tooltip);return true;}});
__d("curry",["bind"],function(a,b,c,d,e,f){var g=b('bind'),h=g(null,g,null);e.exports=h;});
__d("highlight",["Animation","Style"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Style');function i(j,k,l){new g(j).from('background','#fff9d7').to('background',l||'#fff').ease(g.ease.both).duration(2000).ondone(function(){h.set(j,'background','');k&&k();}).go();}e.exports=i;});
__d("ScrollHighlight",["DOMScroll","highlight","CSS"],function(a,b,c,d,e,f){var g=b('DOMScroll'),h=b('highlight'),i=b('CSS'),j={actOn:function(k){g.scrollTo(k);h(k,null,'#EDEFF4');i.removeClass(k,'highlightComment');}};e.exports=j;});
__d("legacy:layer",["Layer"],function(a,b,c,d){a.Layer=b('Layer');},3);
var StreamShareVideo={_endpoints:[],_thumbs:[],registerThumb:function(a,b,c,d){StreamShareVideo._endpoints[a+' '+c]=d;StreamShareVideo._thumbs[a+' '+c]=b;},clickTitle:function(a,b,event){if(StreamShareVideo._shouldFollowHref(event))return true;var c=ge(StreamShareVideo._thumbs[a+' '+b]);if(c){CSS.addClass(c,"uiVideoThumbLoading");AsyncRequest.bootstrap(StreamShareVideo._endpoints[a+' '+b],c);return false;}return true;},clickTimeline:function(a,b,event){if(StreamShareVideo._shouldFollowHref(event))return true;CSS.addClass(a,'externalShareLoading');CSS.removeClass(a,'externalShareUnitVideo');AsyncRequest.bootstrap(b,a);return false;},_shouldFollowHref:function(event){event=$E(event);if(!event)return false;if(event.getModifiers().any||event.isMiddleClick())return true;return false;}};