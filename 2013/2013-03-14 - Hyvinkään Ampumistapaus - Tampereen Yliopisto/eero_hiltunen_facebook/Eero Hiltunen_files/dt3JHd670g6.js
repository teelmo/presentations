/*1337887673,176833974*/

if (window.CavalryLogger) { CavalryLogger.start_js(["60Yxl"]); }

__d("DragDropFileUpload",[],function(a,b,c,d,e,f){f.isSupported=function(){return typeof(FileList)!=="undefined";};});
__d("ArbiterDragDrop",["Arbiter","DragDropFileUpload"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DragDropFileUpload'),i='dnd/drag/in',j='dnd/drag/out',k='dnd/drag/drop',l=false,m=function(){if(l)return;l=true;if(!h.isSupported())return;if(!document.addEventListener)return;var o=0;document.addEventListener('dragenter',function(r){if(o===0)g.inform(i,r,g.BEHAVIOR_EVENT);o++;},false);document.addEventListener('dragleave',function(r){o--;if(o===0)g.inform(j,r,g.BEHAVIOR_EVENT);},false);document.addEventListener('drop',function(r){g.inform(k,r,g.BEHAVIOR_EVENT);r.preventDefault();},false);document.addEventListener('dragover',function(r){r.preventDefault();},false);var p=null,q=function(){o=0;g.inform(j,null,g.BEHAVIOR_EVENT);};document.addEventListener('dragover',function(r){p&&window.clearTimeout(p);p=window.setTimeout(q,839);},true);},n=function(o){m();return o;};e.exports={dragEnter:n.bind(null,i),dragLeave:n.bind(null,j),dragDrop:n.bind(null,k)};});
__d("css_on_global_drag",["ArbiterDragDrop","Arbiter","CSS"],function(a,b,c,d,e,f){var g=b('ArbiterDragDrop'),h=b('Arbiter'),i=b('CSS');e.exports=function(j,k){var l=h.subscribe(g.dragEnter(),i.addClass.bind(i,j,k),h.SUBSCRIBE_NEW),m=h.subscribe(g.dragLeave(),i.removeClass.bind(i,j,k),h.SUBSCRIBE_NEW);return function(){l.unsubscribe();m.unsubscribe();};};});
__d("DragDropTarget",["CSS","DragDropFileUpload","copyProperties","css_on_global_drag"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DragDropFileUpload'),i=b('copyProperties'),j=b('css_on_global_drag');function k(l,m){this.element=l;this.preprocess=function(n){return n;};this.onDrop=m;}i(k.prototype,{setPreprocessor:function(l){this.preprocess=l;return this;},activate:function(){if(!h.isSupported())return;if(!document.addEventListener)return;var l=j(this.element,'fbWantsDragDrop'),m=0;this.element.addEventListener('dragenter',(function(){if(m===0)g.addClass(this.element,'fbDropReady');m++;}).bind(this),false);var n=g.removeClass.bind(g,this.element,'fbDropReady');this.element.addEventListener('dragleave',(function(){m=Math.max(m-1,0);if(m===0)n();}).bind(this),false);this.element.addEventListener('dragover',function(o){o.preventDefault();o.stopPropagation();},false);this.element.addEventListener('drop',(function(o){o.preventDefault();o.stopPropagation();var p=this.preprocess(o.dataTransfer.files);m=0;n();if(p.length)this.onDrop(p);}).bind(this),false);}});e.exports=k;});
__d("FileUpload",["Arbiter","CSS","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('copyProperties'),j=function(k){this.file=k;this.failureCode=null;this.failureSummary=null;this.failureDescription=null;this.serverPayload=null;};i(j.prototype,{getFile:function(){return this.file;},isComplete:function(){return !!this.serverPayload;},complete:function(k){this.serverPayload=k;return this;},isSuccess:function(){return this.isComplete()&&!this.failureCode;},getResponsePayload:function(){return this.serverPayload;},fail:function(k,l,m){this.failureCode=k;this.failureSummary=l;this.failureDescription=m;return this;},getFailureCode:function(){return this.failureCode;},getFailureSummary:function(){return this.failureSummary;},getFailureDescription:function(){return this.failureDescription;}});e.exports=j;});
__d("AJAXFileUploader",["AsyncRequest","FileUpload","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('FileUpload'),i=b('copyProperties');function j(k,l,m){this.files=k;this.uploadURI=l;this.uploads=[];this.finishedCount=0;this.succeeded=[];this.failed=[];this.onComplete=m;this.relativeElem=null;for(var n=0;n<k.length;n++)this.uploads.push(new h(k[n]));}i(j.prototype,{startUpload:function(){for(var k=0;k<this.uploads.length;k++)new g().setURI(this.uploadURI).setRawData(this.files[k]).setRelativeTo(this.relativeElem).setStatusElement(this.relativeElem).setHandler(this.handler.bind(this,k)).setErrorHandler(this.errorHandler.bind(this,k)).send();},setRelativeTo:function(k){this.relativeElem=k;return this;},handler:function(k,l){this.uploads[k].complete(l.getPayload());this.succeeded.push(this.uploads[k]);this.onResponse();},errorHandler:function(k,l){this.uploads[k].fail(l.getError(),l.getErrorSummary(),l.getErrorDescription());if(l.getPayload())this.uploads[k].complete(l.getPayload());this.failed.push(this.uploads[k]);this.onResponse();},onResponse:function(){this.finishedCount++;if(this.finishedCount===this.uploads.length)this.onComplete(this.succeeded,this.failed);}});e.exports=j;});
__d("FileUploadTarget",["AJAXFileUploader","DragDropFileUpload","DragDropTarget","copyProperties"],function(a,b,c,d,e,f){var g=b('AJAXFileUploader'),h=b('DragDropFileUpload'),i=b('DragDropTarget'),j=b('copyProperties');function k(l,m){var n=(function(o){new g(o,m,this.onCompleteCallback).setRelativeTo(l).startUpload();}).bind(this);this.dragDropTarget=new i(l,(function(o){o.length&&this.asyncProcess(o,function(p){p.length&&n(p);});}).bind(this));this.asyncProcess=function(o,p){p(o);};this.preprocess=function(o){return o;};this.onCompleteCallback=bagofholding;}j(k.prototype,{setPreprocessor:function(l){this.preprocess=l;return this;},setAsyncProcessor:function(l){this.asyncProcess=l;return this;},onComplete:function(l){this.onCompleteCallback=l;return this;},activate:function(){if(!h.isSupported())return;this.dragDropTarget.setPreprocessor(this.preprocess).activate();}});e.exports=k;});
__d("SinglePictureUploadTarget",["Bootloader","Dialog","ErrorDialog","FileUploadTarget","StringEscape","tx","copyProperties"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('Dialog'),i=b('ErrorDialog'),j=b('FileUploadTarget'),k=b('StringEscape'),l=b('tx'),m=b('copyProperties');function n(o,p){this.fileUploadTarget=new j(o,p);this.preprocessCallback=bagofholding;this.oncompleteCallback=bagofholding;this.afterSuccessCallback=bagofholding;this.maxWidth=null;this.maxHeight=null;}m(n.prototype,{setPreprocessCallback:function(o){this.preprocessCallback=o;return this;},setOncompleteCallback:function(o){this.oncompleteCallback=o;return this;},setAfterSuccessCallback:function(o){this.afterSuccessCallback=o;return this;},setMaximumDimensions:function(o,p){this.maxWidth=o;this.maxHeight=p;return this;},activate:function(){var o=function(s){return k.htmlSpecialChars(s.name);},p=(function(s){if(s.length>1){i.show("Latausvirhe",l._("Voit valita vain {max-photos} kuvaa ladattavaksi t\u00e4h\u00e4n albumiin. Vain ensimm\u00e4iset {max-photos} valitsemaasi kuvaa ladataan.",{'max-photos':1}));s=[s[0]];}var t=s[0];if(!t.type.match(/^image\//)){i.show("Latausvirhe",l._("Emme ymm\u00e4rt\u00e4neer tiedoston {filename} sis\u00e4lt\u00f6\u00e4. Varmista, ett\u00e4 tiedostomuoto on jpg, gif tai png.",{filename:o(t)}));return [];}this.preprocessCallback(s);return s;}).bind(this),q=(function(s,t){var u=1024*1024*16,v=1024*1024*1,w=function(y){if(y.size>u){i.show("Latausvirhe",l._("{filename} on liian iso. Pienenn\u00e4 kuvan kokoa, jotta se on alle\n8000 x 8000 pikseli\u00e4 ja yrit\u00e4 uudelleen.",{filename:o(s[0])}));t([]);}else t([y]);},x=s[0];if((x.size<v)||(!this.maxWidth&&!this.maxHeight)){w(x);}else g.loadModules(['ImageExif','ImageResizer'],function(y,z){if(!z.isSupported()){w(x);return;}var aa=new z(x,this.maxWidth,this.maxHeight);aa.subscribe('resized',function(ba,ca){if(ca.size>x.size){w(x);}else w(ca);}.bind(this));aa.subscribe('error',function(){w(x);}.bind(this));y.readFromFile(x,function(ba){ba&&aa.setOrientation(ba.Orientation);aa.resize();});});}).bind(this),r=(function(s,t){this.oncompleteCallback(s,t);if(s.length){var u=s[0].getResponsePayload();this.afterSuccessCallback(u);}else{var v=t[0];if(v.serverPayload&&v.serverPayload.__dialog){var w=new h();w._setFromModel(v.serverPayload.__dialog);w.setButtons(h.OK).show();}else i.show(v.failureSummary,v.failureDescription);}}).bind(this);return this.fileUploadTarget.onComplete(r).setPreprocessor(p).setAsyncProcessor(q).activate();}});e.exports=n;});
__d("TimelineProfilePic",["Arbiter","CSS","Dialog","DOM","HTML","Run","$","ge","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('Dialog'),j=b('DOM'),k=b('HTML'),l=b('Run'),m=b('$'),n=b('ge'),o=b('copyProperties');function p(q,r,s,t){p.destroyInstance();p._instance=this;this.leavingMessage=r;this.elemID=s||'fbProfileCover';this.elemClass=t||'.profilePicThumb';this._arbiterTokens=[g.subscribe(q.LOADING,this.startLoading.bind(this)),g.subscribe(q.SUCCESS,this.onUploadSuccess.bind(this))];l.onBeforeUnload(this.onBeforeUnload.bind(this));l.onLeave(this.destroy.bind(this));}o(p,{_instance:null,destroyInstance:function(){this._instance&&this._instance.destroy();}});o(p.prototype,{_setLoadingIndicator:function(q){this._loading=q;h.conditionClass(j.find(m(this.elemID),this.elemClass),'profilePicLoading',q);},destroy:function(){this._arbiterTokens.forEach(function(q){q.unsubscribe();});this._arbiterTokens=[];p._instance=null;},startLoading:function(q,r){this._setLoadingIndicator(r.isLoading);if(n('fbProfilePicSelector'))h.removeClass(m('fbProfilePicSelector'),'fbTimelineNullProfilePicSelector');},onUploadSuccess:function(q,r){this._setLoadingIndicator(false);var s=i.getCurrent();if(s)s.hide();j.replace(j.find(m(this.elemID),this.elemClass),k(r.newPic));},onBeforeUnload:function(){if(p._instance===this&&this._loading)return this.leavingMessage;}});e.exports=p;});
var TimelineStar={STAR_CSS_ONLY:1,STAR_ASYNC_REQUIRED:2,ACTION_STAR:7,ACTION_UNSTAR:8,starClicked:false,starUnit:function(a,b,c){var d=a.parentNode;if(!c)DOM.setContent(d,b);CSS.removeClass(d,'fbTimelineTwoColumn');CSS.addClass(d,'fbTimelineOneColumn');d.removeAttribute('data-side');d.setAttribute('data-size','2');Tooltip.hide();TimelineCapsule.balanceCapsule.curry(d.parentNode).defer();},unstarUnit:function(a,b,c){var d=a.parentNode;if(!c)DOM.setContent(d,b);CSS.removeClass(d,'fbTimelineOneColumn');CSS.addClass(d,'fbTimelineTwoColumn');d.setAttribute('data-side','l');d.setAttribute('data-size','1');Tooltip.hide();TimelineCapsule.balanceCapsule.curry(d.parentNode).defer();},listenToButton:function(a,b){var c=ge(a);if(!c)return;switch(b){case TimelineStar.STAR_CSS_ONLY:Event.listen(c,'click',function(event){Button.setEnabled(c,false);var e=Parent.byClass(c,'timelineUnitContainer'),f=TimelineStar.unstarUnit;CSS.toggleClass(c,'fbTimelineStarButtonSelected');CSS.toggleClass(c,'selected');if(e.parentNode.getAttribute('data-size')=='1')f=TimelineStar.starUnit;f(Parent.byClass(c,'timelineUnitContainer'),null,true);var g=new URI(c.getAttribute('ajaxify')),h=g.getQueryData().customize_action==TimelineStar.ACTION_STAR?TimelineStar.ACTION_UNSTAR:TimelineStar.ACTION_STAR;g.addQueryData({customize_action:h});c.setAttribute.bind(c,'ajaxify',g).defer();});var d=Parent.byClass(c,'stat_elem');d&&CSS.removeClass(d,'stat_elem');break;case TimelineStar.STAR_ASYNC_REQUIRED:break;}}};
__d("timeline-cover-dragdrop-edit",["SinglePictureUploadTarget","TimelineCover"],function(a,b,c,d,e,f){var g=b('SinglePictureUploadTarget'),h=b('TimelineCover'),i=function(m,n){var o=h.getInstance();o.hideLoadingIndicator();},j=function(m){var n=h.getInstance(),o=m.id,p=m.photo_html;n.updateCoverImage(o,p);},k=function(m){h.getInstance().showLoadingIndicator();},l=function(m,n,o,p){new g(m,n).setMaximumDimensions(o,p).setPreprocessCallback(k).setOncompleteCallback(i).setAfterSuccessCallback(j).activate();};f.initialize_timeline_cover_drop_target=l;});
__d("TimelineAudienceSelector",["Arbiter","CSS","DOM","Parent","PrivacyConst","Selector"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('Parent'),k=b('PrivacyConst'),l=b('Selector');function m(){var p='timelineOnlyMeBorder';return [i.create('div',{className:p}),i.create('div',{className:p+' timelineOnlyMeBorderBottom'})];}function n(){return i.create('img',{alt:' ',className:'timelinePrivacyCorner',height:34,src:'/images/profile/timeline/privacy_corner.png',width:34});}function o(p){var q=i.scry(p,'.photoUnit a.photo');return q.filter(function(r){return !i.scry(r,'.timelinePrivacyCorner').length;});}g.subscribe('AudienceSelector/changed',function(p,q){var r=l.getOptionValue(q.option),s=j.byClass(q.selector,'timelineUnitContainer')||j.byClass(q.clone,'fbTimelineTwoColumn');if(!s)return;if(r==k.BaseValue.SELF){h.addClass(s,'timelineOnlyMeUnit');var t=o(s);for(var u=0,v=t.length;u<v;++u)i.appendContent(t[u],n());if(!i.scry(s,'div.timelineOnlyMeBorder').length){var w=m();i.prependContent(s,w[0]);i.appendContent(s,w[1]);}}else h.removeClass(s,'timelineOnlyMeUnit');});});
__d("profile-pic-dragdrop-edit",["Arbiter","SinglePictureUploadTarget","TimelineProfilePic"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('SinglePictureUploadTarget'),i=b('TimelineProfilePic');f.initialize_profile_pic_drop_target=function(j,k,l,m){new i(l,m);new h(j,k).setPreprocessCallback(function(n){g.inform(l.LOADING,{isLoading:1},g.BEHAVIOR_STATE);}).setOncompleteCallback(function(n,o){g.inform(l.LOADING,{isLoading:0},g.BEHAVIOR_STATE);}).setAfterSuccessCallback(function(n){g.inform(l.SUCCESS,{newPic:n.photo_html},g.BEHAVIOR_STATE);}).activate();};});
function FutureProfileSideNav(){this.parent.construct(this);}Class.extend(FutureProfileSideNav,'FutureSideNav');copy_properties(FutureProfileSideNav.prototype,{init:function(){this.parent.init.apply(this,arguments);this.ajaxPipe=true;this.altKeyParam='v';this.sidecol=false;},_constructItem:function(a,b){return new FutureProfileSideNavItem(a,b);},_doPageTransition:function(a,b){if(!this._profileChanged(b)&&!this._scopeChanged(a))return this.parent._doPageTransition(a,b);},_profileChanged:function(a){var b=a.getQueryData(),c=this.uri.getQueryData();return (b.id!==c.id||b.viewas!==c.viewas||b.and!==c.and);},_scopeChanged:function(a){return (!this.selected||a.layoutType!==this.selected.layoutType);},_getKey:function(a){return this.parent._getKey(a)||a[this.altKeyParam];}});function FutureProfileSideNavItem(a,b){this.parent.construct(this,a,b);this.layoutType=a.layouttype;}Class.extend(FutureProfileSideNavItem,'FutureSideNavItem');
__d("SubscriptionLevels",[],function(a,b,c,d,e,f){var g={ALL:'162318810514679',DEFAULT:'271670892858696',TOP:'266156873403755'};e.exports=g;});
__d("EditSubscriptions",["event-extensions","function-extensions","Arbiter","AsyncRequest","CSS","DOM","ge","Menu","Parent","SubscriptionLevels"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('ge'),l=b('Menu'),m=b('Parent'),n=b('SubscriptionLevels'),o=13,p=45,q=[n.ALL,n.DEFAULT,n.TOP],r={},s={},t={},u={},v={},w={},x={},y={},z={},aa={},ba="/ajax/follow/follow_profile.php",ca="/ajax/follow/unfollow_profile.php";function da(va){return q.contains(va);}function ea(va,wa,xa,ya){var za=m.byClass(ya,'uiMenuItem')||m.byClass(ya,'uiMenuXItem');if(!za||!j.contains(va,za)){return;}else if(i.hasClass(za,'SubscribeMenuSubscribeCheckbox')){if(t[wa]){ha(va,wa);}else ga(va,wa);return false;}else if(i.hasClass(za,'SubscribeMenuUnsubscribe')){ha(va,wa);return false;}else if(i.hasClass(za,'SubscribeMenuSettingsItem')){ta(va,true);return false;}else if(i.hasClass(za,'SubscriptionMenuGoBack')){ta(va,false);return false;}else if(i.hasClass(za,'SubscriptionMenuItem')){fa(va,wa,xa,za);return false;}}function fa(va,wa,xa,ya){if(i.hasClass(ya,'SubscriptionMenuLevel')){if(l.isItemChecked(ya))return;ra(va,wa,la(ya),true,xa);}else if(i.hasClass(ya,'SubscriptionMenuCategory'))pa(wa,ya,!l.isItemChecked(ya),true,xa);}function ga(va,wa){var xa={profile_id:wa};g.inform('FollowingUser',xa);new h().setURI(ba).setMethod('POST').setData({profile_id:wa,location:ia(va)}).setErrorHandler(g.inform.curry('FollowUserFail',xa)).send();}function ha(va,wa){var xa={profile_id:wa};g.inform('UnfollowingUser',xa);new h().setURI(ca).setMethod('POST').setData({profile_id:wa,location:ia(va)}).setErrorHandler(g.inform.curry('UnfollowUserFail',xa)).send();}function ia(va){if(i.hasClass(va,'followButtonFlyout')){return o;}else return p;}function ja(va,wa,xa){var ya={profile_id:va,level:x[va],custom_categories:y[va],location:xa};new h().setURI('/ajax/follow/manage_subscriptions.php').setData(ya).send();}function ka(va,wa){var xa=y[wa]||[],ya=l.getItems(va);ya.forEach(function(za){if(i.hasClass(za,'SubscriptionMenuCategory')){var ab=la(za);if(xa.contains(ab)){na(za);}else oa(za);}});ra(va,wa,x[wa],false);}function la(va){var wa=j.scry(va,'input')[0];return wa&&wa.value;}function ma(va){return j.find(va,'a.itemAnchor');}function na(va){i.addClass(va,'checked');ma(va).setAttribute('aria-checked',true);}function oa(va){i.removeClass(va,'checked');ma(va).setAttribute('aria-checked',false);}function pa(va,wa,xa,ya,za){if(xa){na(wa);}else oa(wa);var ab=la(wa);if(da(ab)){xa&&qa(va,ab);}else if(xa){if(!y[va].contains(ab))y[va].push(ab);}else{var bb=y[va].indexOf(ab);if(bb!==-1)y[va].splice(bb,1);}if(ya)ja(va,ab,za);}function qa(va,wa){x[va]=wa;g.inform('SubscriptionLevelUpdated',{profile_id:va,level:wa});}function ra(va,wa,xa,ya,za){var ab=j.scry(va,'.SubscriptionMenuLevel'),bb=null;ab.forEach(function(cb){if(la(cb)==xa){bb=cb;}else if(l.isItemChecked(cb))pa(wa,cb,false,false);});bb&&pa(wa,bb,true,ya,za);}function sa(va,wa,xa){t[wa]=xa;i.conditionClass(va,'isUnsubscribed',!xa);var ya=j.scry(va,'li.SubscribeMenuSubscribeCheckbox');if(ya.length!==0){var za=ya[0];if(xa){na(za);}else oa(za);}}function ta(va,wa){i.conditionClass(va,'subscriptionMenuOpen',wa);}g.subscribe('UnfollowUser',function(va,wa){if(z[wa.profile_id]){qa(wa.profile_id,z[wa.profile_id]);y[wa.profile_id]=aa[wa.profile_id].slice();}});g.subscribe('UpdateSubscriptionLevel',function(va,wa){var xa=wa.profile_id+'',ya=wa.level+'';qa(xa,ya);var za;for(za in r)if(r[za]===xa){var ab=k(za);ab&&ra(ab,xa,ya,false);}});var ua={init:function(va,wa,xa){var ya=j.getID(va);if(!r[ya])Event.listen(va,'click',function(za){return ea(va,r[ya],xa,za.getTarget());});if(x[wa])ka(va,wa);r[ya]=wa;i.conditionClass(va,'NonFriendSubscriptionMenu',!s[wa]);i.conditionClass(va,'cannotSubscribe',!u[wa]);i.conditionClass(va,'noSubscriptionLevels',v[wa]&&!w[wa]);i.conditionClass(va,'noSubscribeCheckbox',!s[wa]&&!v[wa]);sa(va,wa,t[wa]);g.subscribe(['FollowUser','FollowingUser','UnfollowUserFail'],function(za,ab){sa(va,wa,true);}.bind(this));g.subscribe(['UnfollowUser','UnfollowingUser','FollowUserFail'],function(za,ab){g.inform('SubMenu/Reset');sa(va,wa,false);}.bind(this));ta(va,false);},getSubscriptions:function(va){return {level:x[va],custom_categories:y[va]};},setSubscriptions:function(va,wa,xa,ya,za,ab,bb,cb,db,eb){qa(va,bb+'');s[va]=wa;t[va]=xa;u[va]=ya;v[va]=za;w[va]=ab;z[va]=db+'';y[va]=cb.map(String);aa[va]=eb.map(String);}};e.exports=a.EditSubscriptions||ua;});
__d("DynamicFriendListEducation",["event-extensions","Arbiter","AsyncRequest","Dialog","PageTransitions","createArrayFrom"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Dialog'),j=b('PageTransitions'),k=b('createArrayFrom'),l,m,n,o,p,q;function r(){n&&n.hide();o&&o.hide();}function s(v){m.remove(v);r();p({accept_tag_education:true});}function t(){r();p({nux_cancel:true});}var u={init:function(v,w){l=v;m=k(w).map(String);j.registerHandler(function(){r();l=false;p=undefined;m=[];});},showDialog:function(v,w,x){if(l&&m.contains(v)){r();g.inform('DynamicFriendListEducation/dialogOpen',{uid:w,flid:v});p=x;n=new i().setAsync(new h('/ajax/friends/lists/smart_list_education.php').setMethod('GET').setData({flid:v,uid:w}).setReadOnly(true)).setHandler(s.bind(this,v)).setCloseHandler(function(){g.inform('DynamicFriendListEducation/dialogClosed',{uid:w,flid:v});}).setCancelHandler(function(){g.inform('DynamicFriendListEducation/dialogCancel',{uid:w,flid:v});}).show();}else x();},showContextualDialog:function(v,w,x,y){if(l&&m.contains(v)){r();q=x;p=y;new h('/ajax/friends/lists/smart_list_contextual_education.php').setMethod('GET').setData({flid:v,uid:w}).setReadOnly(true).send();}else y();},setContextualDialog:function(v,w,x,y){o=v;o.setContext(q);o.show();Event.listen(w,'click',s.bind(this,y));Event.listen(x,'click',t);}};e.exports=u;});
__d("FriendStatus",["array-extensions","function-extensions","Arbiter","AsyncRequest","copyProperties","createArrayFrom"],function(a,b,c,d,e,f){b('array-extensions');b('function-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('createArrayFrom');function k(o,p,q){this.id=o;this.update(p,q);}i(k.prototype,{update:function(o,p){o&&(this.status=o);if(p){this.lists=j(p).map(String);this._informListChange();}},isComplete:function(){return !!this.lists;},addToList:function(o){if(this.lists&&!this.lists.contains(o))this.lists.push(o);this._informListChange();},removeFromList:function(o){if(this.lists){var p=this.lists.indexOf(o);p!==-1&&this.lists.splice(p,1);}this._informListChange();},updateList:function(o,p){p?this.addToList(o):this.removeFromList(o);},_informListChange:function(){g.inform('FriendListMembershipChange',{uid:this.id,lists:this.lists});}});i(k,{ARE_FRIENDS:1,INCOMING_REQUEST:2,OUTGOING_REQUEST:3,CAN_REQUEST:4});var l={},m={};function n(o,p,q){if(!l[q.uid]){l[q.uid]=new k(q.uid,o);}else l[q.uid].update(o);g.inform('FriendRequest/change',{uid:q.uid,status:o});}g.subscribe(['FriendRequest/cancel','FriendRequest/unfriend','FriendRequest/sendFail'],n.curry(k.CAN_REQUEST));g.subscribe(['FriendRequest/confirmFail'],n.curry(k.INCOMING_REQUEST));g.subscribe(['FriendRequest/cancelFail','FriendRequest/sent','FriendRequest/sending'],n.curry(k.OUTGOING_REQUEST));g.subscribe(['FriendRequest/confirm','FriendRequest/confirming'],n.curry(k.ARE_FRIENDS));i(k,{CLOSE_FRIENDS:null,ACQUAINTANCES:null,getFriend:function(o,p){if(l[o]&&l[o].isComplete()){p(l[o]);}else if(m[o]){m[o].push(p);}else{m[o]=[p];new h().setURI("/ajax/friends/status.php").setData({friend:o}).setHandler(function(q){var r=q.getPayload();k.initFriend.bind(k,o,r.status,r.lists).defer();}).send();}},initFriend:function(o,p,q){var r=l[o]||new k(o);r.update(r.status||p,r.lists||q);l[o]=r;m[o]&&m[o].forEach(function(s){s(r);});m[o]=null;},setSpecialLists:function(o){k.CLOSE_FRIENDS=o.close+'';k.ACQUAINTANCES=o.acq+'';}});e.exports=k;});
__d("FriendEditLists",["Arbiter","AsyncRequest","CSS","DOMQuery","DynamicFriendListEducation","EditSubscriptions","FriendStatus","Menu","Parent","ScrollableArea","URI","$","copyProperties","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOMQuery'),k=b('DynamicFriendListEducation'),l=b('EditSubscriptions'),m=b('FriendStatus'),n=b('Menu'),o=b('Parent'),p=b('ScrollableArea'),q=b('URI'),r=b('$'),s=b('copyProperties'),t=b('ge'),u=5,v={},w="/ajax/profile/removefriendconfirm.php",x='/ajax/friends/requests/cancel.php',y;function z(ia,ja,ka){var la=v[ia.id],ma=function(na){var oa={action:ka?'add_list':'del_list',to_friend:la.id,friendlists:[ja],source:y};if(na)s(oa,na);la.updateList(ja,ka);var pa;if(ka&&ja==m.CLOSE_FRIENDS){pa=ca(ia,m.ACQUAINTANCES);if(n.isItemChecked(pa)){n.toggleItem(pa);z(ia,m.ACQUAINTANCES,false);}}else if(ka&&ja==m.ACQUAINTANCES){pa=ca(ia,m.CLOSE_FRIENDS);if(n.isItemChecked(pa)){n.toggleItem(pa);z(ia,m.CLOSE_FRIENDS,false);}}var qa={flid:ja,uid:la.id},ra=ka?'FriendListHovercard/add':'FriendListHovercard/remove';g.inform(ra,qa);new h().setURI('/ajax/add_friend/action.php').setData(oa).send();};if(ka){k.showDialog(ja,la.id,ma);}else ma();}function aa(ia){var ja=j.scry(ia,'input')[0];return ja&&ja.value;}function ba(ia,ja,ka){var la={uid:ja.id};new h().setURI(x).setMethod('POST').setData({friend:ja.id}).setHandler(g.inform.bind(g,'FriendRequest/cancel',la)).setErrorHandler(g.inform.bind(g,'FriendRequest/cancelFail',la)).setStatusElement(ka).send();}function ca(ia,ja){var ka=n.getItems(ia);for(var la=0;la<ka.length;la++)if(aa(ka[la])==ja)return ka[la];return null;}function da(ia,ja){var ka=n.getItems(ia);ka.forEach(function(la){var ma=aa(la),na=ja.lists.contains(ma);if(n.isItemChecked(la)!==na)n.toggleItem(la);});}function ea(ia){var ja=n.getItems(ia),ka=!i.hasClass(ia,'followButtonFlyout')&&!i.hasClass(ia,'likeButtonFlyout'),la=[],ma=[],na=0,oa=0;ja.forEach(function(ta){if(i.hasClass(ta,'neverHide')){i.removeClass(ta,'underShowMore');na++;}else if(n.isItemChecked(ta)){la.push(ta);}else if(i.hasClass(ta,'neverShow')||i.hasClass(ta,'FriendListCreateTrigger')||(!ka&&i.hasClass(ta,'friendOptionsOnly'))){i.addClass(ta,'underShowMore');oa++;}else ma.push(ta);});var pa=u-na,qa=la.concat(ma),ra=oa;qa.forEach(function(ta){if(i.hasClass(ta,'ShowMoreItem')){pa--;return;}if(pa){i.removeClass(ta,'underShowMore');pa--;}else{i.addClass(ta,'underShowMore');ra=true;}});i.conditionClass(ia,'hasMoreFriendListItems',ra);var sa=j.scry(ia,'.FriendListMenuShowMore');sa.forEach(function(ta){i.removeClass(ta,'FriendListMenuShowMore');});}function fa(ia,ja){var ka=j.scry(ia,'.FriendListUnfriend')[0],la=j.scry(ia,'.FriendListCancel')[0];if(la)i.conditionShow(la,ja.status==m.OUTGOING_REQUEST);if(ka){i.conditionShow(ka,ja.status==m.ARE_FRIENDS);j.find(ka,'a').setAttribute('ajaxify',q(w).addQueryData({uid:ja.id}).toString());}}function ga(ia,ja){var ka=j.scry(ia,'div.FriendListSubscriptionsMenu');if(ka.length!==0)l.init(ia,ja,45);}g.subscribe('FriendRequest/change',function(ia,ja){for(var ka in v){var la=t(ka),ma=v[ka];if(la&&ma&&ma.id==ja.uid){da(la,ma);fa(la,ma);ea(la);}}});n.subscribe('select',function(ia,ja){if(i.hasClass(ja.item,'ShowMoreItem')&&i.hasClass(ja.menu,'FriendListMenu')){i.addClass(ja.menu,'FriendListMenuShowMore');p.poke(ja.item);}});var ha={init:function(ia,ja,ka){ia=r(ia);y=ka;if(!v[ia.id])n.subscribe('select',function(la,ma){if(j.contains(ia,ma.item))if(o.byClass(ma.item,'FriendListItem')){n.toggleItem(ma.item);var na=aa(ma.item);z(ia,na,n.isItemChecked(ma.item));}else if(o.byClass(ma.item,'FriendListCancel')){ba(ia,v[ia.id],ma.item);}else if(o.byClass(ma.item,'FriendListUnfriend'))g.inform('FriendEditLists/unfriend');});i.addClass(ia,'async_saving');m.getFriend(ja,function(la){da(ia,la);fa(ia,la);v[ia.id]=la;ea(ia);ga(ia,ja);i.removeClass(ia,'async_saving');}.bind(this));}};e.exports=a.FriendEditLists||ha;});
__d("FriendListFlyoutController",["event-extensions","Arbiter","AsyncRequest","Button","CSS","DataStore","Dialog","DOM","FriendEditLists","FriendStatus","Layer","Parent","ScrollableArea","UserAgent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Button'),j=b('CSS'),k=b('DataStore'),l=b('Dialog'),m=b('DOM'),n=b('FriendEditLists'),o=b('FriendStatus'),p=b('Layer'),q=b('Parent'),r=b('ScrollableArea'),s=b('UserAgent'),t,u,v=null,w=null,x,y,z,aa,ba,ca,da=1500,ea={init:function(ra){ea.init=bagofholding;t=ra;t.subscribe('mouseenter',fa);t.subscribe('mouseleave',ma);t.subscribe('hide',ga);if(v)m.setContent(t.getContent(),[v,w]);Event.listen(document.documentElement,'mouseover',function(sa){var ta=q.byClass(sa.getTarget(),'enableFriendListFlyout');if(ta)if(x===ta){clearTimeout(aa);}else{u&&oa();la(ta);}});g.subscribe('FriendEditLists/unfriend',oa);g.subscribe('DynamicFriendListEducation/dialogOpen',function(){ca=true;});g.subscribe('DynamicFriendListEducation/dialogClosed',function(){ca=false;ma();});},initContent:function(ra){m.appendContent(document.body,ra);(function(){if(!v){v=ra;t&&m.setContent(t.getContent(),[v,w]);j.show(v);Event.listen(v,'click',pa);u&&ja(x);}else{m.remove(ra);ra=null;}}).defer();},initNux:function(ra){if(w)return;w=ra;t&&m.setContent(t.getContent(),[v,w]);},show:function(ra){ka(ra);},hide:function(ra){ra===false?oa():ma();},setActiveNode:function(ra){u&&oa();x=ra;y=Event.listen(ra,'mouseleave',function(){x=null;y&&y.remove();});},setCloseListener:function(ra,sa){k.set(ra,'flfcloselistener',sa);if(x!=ra)k.set(ra,'flfcloselistenertimeout',qa.curry(ra).defer(da));},setCloseListenerTimeout:function(ra){da=ra;}};function fa(){clearTimeout(aa);}function ga(){if(x){j.removeClass(x,'selected');j.removeClass(x,'uiButtonHover');if(k.get(x,'flfcloselistener')){var ra=x;k.set(x,'flfcloselistenertimeout',qa.curry(ra).defer(da));}}u=false;ia();x=null;}function ha(ra){if(m.isNodeOfType(ra,'label')&&j.hasClass(ra,'uiButton'))ra=i.getInputElement(ra);return k.get(ra,'profileid');}function ia(){y&&y.remove();y=null;ba&&p.unsubscribe(ba);ba=null;aa&&clearTimeout(aa);aa=null;}function ja(ra){var sa=ha(ra),ta=k.get(ra,'flloc');n.init(v,sa,ta);j.conditionClass(v,'followButtonFlyout',j.hasClass(ra,'profileFollowButton'));j.conditionClass(v,'friendButtonFlyout',j.hasClass(ra,'FriendRequestFriends')||j.hasClass(ra,'FriendRequestIncoming')||j.hasClass(ra,'FriendRequestOutgoing'));j.conditionClass(v,'likeButtonFlyout',j.hasClass(ra,'profileLikeButton'));var ua=m.scry(v,'div.uiScrollableArea')[0];ua&&r.poke(ua);}function ka(ra){if(!t||u)return;t.setContext(ra);j.addClass(ra,'selected');j.addClass(ra,'uiButtonHover');t.setFixed(j.isFixed(ra)).show();x=ra;u=true;if(v){ja(ra);}else new h().setURI('/ajax/friends/lists/flyout_content.php').setStatusElement(t.getContent()).send();ia();y=Event.listen(ra,'mouseleave',ma);ba=p.subscribe('show',oa);if(k.get(ra,'flfcloselistener'))clearTimeout(k.remove(ra,'flfcloselistenertimeout'));var sa=ha(ra);o.getFriend(sa,function(ta){if(!w)return;if(ta.status==o.OUTGOING_REQUEST){j.show(w);h.bootstrap('/ajax/friends/lists/nux_flyout.php',null,true);}else j.hide(w);});}function la(ra){x=ra;z=ka.curry(ra).defer(350);y=Event.listen(ra,'mouseleave',function(){clearTimeout(z);x=null;y&&y.remove();});}function ma(){aa=oa.defer(150);}function na(){var ra=l.getCurrent(),sa=ra&&ra.getBody();return !!(sa&&m.scry(sa,'.friendListDialogTourCarousel')[0]);}function oa(){if(ca||na())return;s.ie()<8&&document.documentElement.focus();t&&t.hide();}function pa(event){var ra=q.byTag(event.getTarget(),'a');if(ra&&j.hasClass(ra,'FriendListActionItem'))ma();}function qa(ra){var sa=k.remove(ra,'flfcloselistener');sa&&sa();}e.exports=a.FriendListFlyoutController||ea;});
__d("legacy:FriendListFlyoutController",["FriendListFlyoutController"],function(a,b,c,d){a.FriendListFlyoutController=b('FriendListFlyoutController');},3);
__d("legacy:FriendStatus",["FriendStatus"],function(a,b,c,d){a.FriendStatus=b('FriendStatus');},3);
var AddFriendButton={ERROR_ALREADY_ADDED:1431005,init:function(a,b,c,d,e,f,g,h,i,j,k){var l=null,m=DOM.scry(a,'.addButton')[0],n=DOM.scry(a,'.outgoingButton')[0],o=DOM.scry(a,'.incomingButton')[0],p=DOM.scry(a,'.friendButton')[0];function q(v,w,x){var y=new URI(m.getAttribute('ajaxify'));link_data=collect_data_attribs(a,['ft','gt']);new AsyncRequest().setURI(f).setData({to_friend:b,action:v,how_found:d,ref_param:e,link_data:link_data,outgoing_id:n.id,xids:y.getQueryData().xids,logging_location:g,no_flyout_on_click:h,ego_log_data:i,http_referer:k}).setErrorHandler(w).setServerDialogCancelHandler(x).setRelativeTo(n).send();}function r(v,w){m&&CSS.hide(m);n&&CSS.hide(n);o&&CSS.hide(o);p&&CSS.hide(p);if(v)CSS.show(v);if('Outgoing'==w&&l!=w&&j)animation(v).from('backgroundColor','#FFF8CC').to('backgroundColor','#FFFFFF').from('borderColor','#FFE222').to('borderColor','#FFFFFF').duration(2000).go();l&&CSS.removeClass(a,'fStatus'+l);l=w;CSS.addClass(a,'fStatus'+w);}function s(v){if(CSS.hasClass(v,'enableFriendListFlyout')){FriendListFlyoutController.show(v);}else FriendListFlyoutController.hide();}var t=Arbiter.subscribe('FriendRequest/change',function(v,w){if(w.uid!=b)return;switch(w.status){case FriendStatus.ARE_FRIENDS:return r(p,'Friends');case FriendStatus.INCOMING_REQUEST:return r(o,'Incoming');case FriendStatus.OUTGOING_REQUEST:return r(n,'Outgoing');case FriendStatus.CAN_REQUEST:return r(m,'Requestable');}}),u;if(c)u=Arbiter.subscribe('FriendRequest/confirm',function(v,w){w.uid==b&&goURI(c);});m&&Event.listen(m,'click',function(){Arbiter.inform('FriendRequest/sending',{uid:b});if(h){FriendListFlyoutController.setActiveNode(n);}else s(n);q("add_friend",function(v){var w=v.error==AddFriendButton.ERROR_ALREADY_ADDED?'FriendRequest/sent':'FriendRequest/sendFail';Arbiter.inform(w,{uid:b});FriendListFlyoutController.hide();AsyncResponse.defaultErrorHandler(v);},function(v){Arbiter.inform('FriendRequest/sendFail',{uid:b});FriendListFlyoutController.hide();});});PageTransitions.registerHandler(function(){t.unsubscribe();u&&u.unsubscribe();});}};
function StreamProfileComposer(){}copy_properties(StreamProfileComposer.prototype,{init:function(a){var b=$(a);Arbiter.subscribe('composer/publish',function(event,c){if(c.streamStory)animation.prependInsert(b,c.streamStory);});}});
__d("legacy:EditSubscriptions",["SubscriptionLevels","EditSubscriptions"],function(a,b,c,d){a.SubscriptionLevels=b('SubscriptionLevels');a.EditSubscriptions=b('EditSubscriptions');},3);
__d("RespondToRequestButton",["event-extensions","CSS","Menu"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('Menu'),i={init:function(j,k,l,m){Event.listen(k,'click',function(){g.addClass(k,'uiButtonConfirm');g.addClass(k,'selected');l.show();});l.subscribe('hide',function(){g.removeClass(k,'uiButtonConfirm');g.removeClass(k,'selected');});h.subscribe('select',function(n,o){if(!g.hasClass(o.menu,'requestResponseMenu'))return;if(o.item.firstChild.getAttribute('data-profileid')!=j)return;if(g.hasClass(o.item,'reject')){g.hide(k);g.show(m);}l.hide();});}};e.exports=i;});
__d("legacy:RespondToRequestButton",["RespondToRequestButton"],function(a,b,c,d){a.RespondToRequestButton=b('RespondToRequestButton');},3);
__d("legacy:menu-legacy",["Menu"],function(a,b,c,d){a.Menu=b('Menu');},3);
var FriendButtonIcon={init:function(a,b,c){var d=DOM.find(b,'.defaultIcon'),e=DOM.find(b,'.closeIcon'),f=DOM.find(b,'.acqIcon');Arbiter.subscribe('FriendListMembershipChange',function(g,h){if(h.uid==c){var i=h.lists.contains(FriendStatus.CLOSE_FRIENDS),j=h.lists.contains(FriendStatus.ACQUAINTANCES);if(i&&!j){Button.setIcon(a,e);}else if(j&&!i){Button.setIcon(a,f);}else Button.setIcon(a,d);}});}};
var PageLikeButton=window.PageLikeButton||(function(){function a(b,c,d,e,f){fbpage_set_fan_status(b,c,d,false,function(){Arbiter.inform(PageLikeButton.LIKED_SUCCESS,{profile_id:c});},e,{fan_origin:f});}return {LIKED:'liked',UNLIKED:'unliked',LIKED_SUCCESS:'liked_success',init:function(b,c,d,e,f,g){Arbiter.subscribe(PageLikeButton.LIKED,function(h,i){if(e===i.profile_id)b.swap();});Arbiter.subscribe(PageLikeButton.UNLIKED,function(h,i){if(e===i.profile_id){b.unswap();d.hideFlyout();}});Event.listen(c,'click',function(event){a(event.getTarget(),e,true,function(){Arbiter.inform(PageLikeButton.UNLIKED,{profile_id:e});},f);Arbiter.inform(PageLikeButton.LIKED,{profile_id:e});if(g)Arbiter.subscribe(PageLikeButton.LIKED_SUCCESS,function(h,i){app_data=URI.getRequestURI().getQueryData().app_data;if(i.profile_id==e)new AsyncRequest().setURI('/ajax/pages/fetch_app_column.php').setData({profile_id:e,tab_key:g,app_data:app_data}).send();});});},initUnlike:function(b,c,d){Event.listen(b,'click',function(event){a(event.getTarget(),c,false,function(){Arbiter.inform(PageLikeButton.LIKED,{profile_id:c});},d);Arbiter.inform.bind(Arbiter,PageLikeButton.UNLIKED,{profile_id:c}).defer();});}};})();
var TimelineAggregatePost={init:function(a){Event.listen(a,'click',function(b){var c=b.getModifiers();if(b.isMiddleClick()||c.access||c.meta)return true;var d=Parent.byTag(b.getTarget(),'li');if(!CSS.hasClass(d,'wallPostMorePager'))new AsyncRequest().setURI(DataStore.get(d,'url')).send();});},initPage:function(a){Event.listen(a,'click',function(b){var c=Parent.byClass(b.getTarget(),'uiCloseButton');if(c)return;var d=Parent.byTag(b.getTarget(),'li');new AsyncRequest().setURI(DataStore.get(d,'url')).send();});},poke:function(a){ScrollableArea.poke(a);},setScrollHeight:function(a){var b=DOM.find(a,'.sArea');CSS.setStyle(b,'height',a.offsetHeight+'px');}};
__d("SwapButton",["event-extensions","copyProperties","CSS"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('CSS');function i(j,k){if(j&&k){this._swapperButton=j;this._swappeeButton=k;Event.listen(j,'click',this.swap.bind(this));}}g(i.prototype,{_swapperButton:null,_swappeeButton:null,swap:function(){h.hide(this._swapperButton);h.show(this._swappeeButton);},unswap:function(){h.show(this._swapperButton);h.hide(this._swappeeButton);},init:function(j,k){this._swapperButton=j;this._swappeeButton=k;Event.listen(j,'click',this.swap.bind(this));}});e.exports=i;});
__d("HoverButton",["AsyncRequest","CSS","DOM","URI","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('URI'),k=b('copyProperties');function l(m,n,o,p){if(m&&n){this._button=m;this._flyout=n;this._flyoutAjaxify=p;this._flyoutContent=o;n.subscribe('show',this._onShow.bind(this));n.subscribe('hide',this._onHide.bind(this));}}k(l.prototype,{_button:null,_flyout:null,_flyoutAjaxify:null,_flyoutContent:null,init:function(m,n,o,p){this._button=m;this._flyout=n;this._flyoutAjaxify=p;this._flyoutContent=o;n.subscribe('show',this._onShow.bind(this));n.subscribe('hide',this._onHide.bind(this));},showFlyoutBriefly:function(){this.showFlyout();this._flyout.hideFlyoutDelayed(5000);},showFlyout:function(){this._flyout.showFlyout(this._button,true);this._flyout.inform('show',this._button);},hideFlyout:function(){this._flyout.hideFlyout(true);this._flyout.inform('hide',this._button);},_onShow:function(m,n){h.addClass(n,'uiHoverButtonSelected');h.addClass(n,'selected');if(this._flyoutAjaxify){h.addClass(this._flyoutContent,'async_saving');new g().setURI(new j(this._flyoutAjaxify)).setHandler(function(o){h.removeClass(this._flyoutContent,'async_saving');i.setContent(this._flyoutContent,o.payload);}.bind(this)).send();this._flyoutAjaxify=null;}},_onHide:function(m,n){h.removeClass(n,'uiHoverButtonSelected');h.removeClass(n,'selected');},destroy:function(){this.hideFlyout();this._flyout.destroy();}});e.exports=l;});
__d("legacy:TooltipLink",["TooltipLink"],function(a,b,c,d){a.TooltipLink=b('TooltipLink');},3);
__d("HoverFlyout",["event-extensions","ArbiterMixin","Class","DataStore","LayerDestroyOnHide","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('DataStore'),j=b('LayerDestroyOnHide'),k=b('copyProperties');function l(m,n,o,p){if(m){this._showDelay=o;this._hideDelay=p;this.init(m);if(n)this.initNode(n);}}k(l.prototype,g,{init:function(m){this._flyout=m;this._showDelay=this._showDelay||0;this._hideDelay=this._hideDelay||100;this._showTimeout=null;this._hideTimeout=null;this._flyoutSubscriptions=[this._flyout.subscribe('mouseenter',this._onFlyoutMouseEnter.bind(this)),this._flyout.subscribe('mouseleave',this.hideFlyout.shield(this))];this._nodes=[];this._dataStoreUnique='HoverFlyout_'+Date.now()+'_listeners';this._flyout.disableBehavior(j);return this;},initNode:function(m){if(this._nodes.contains(m))return this;this._nodes.push(m);i.set(m,this._dataStoreUnique,[Event.listen(m,'mouseenter',this._onNodeMouseEnter.bind(this,m)),Event.listen(m,'mouseleave',this.hideFlyout.shield(this))]);return this;},deactivateNode:function(m){var n=i.get(m,this._dataStoreUnique);if(n)while(n.length)n.pop().remove();this._nodes.remove(m);},setShowDelay:function(m){this._showDelay=m;return this;},setHideDelay:function(m){this._hideDelay=m;return this;},showFlyout:function(m,n){this.setActiveNode(m);if(n){this._flyout.setContext(m).show();this.inform('show',m);}else this._showTimeout=this.showFlyout.bind(this,m,true).defer(this._showDelay);return this;},hideFlyout:function(m){clearTimeout(this._showTimeout);if(m){this._flyout.hide();this._activeNode&&this.inform('hide',this._activeNode);this._activeNode=null;}else this._hideTimeout=this.hideFlyout.bind(this,true).defer(this._hideDelay);},hideFlyoutDelayed:function(m){clearTimeout(this._showTimeout);clearTimeout(this._hideTimeout);this._hideTimeout=this.hideFlyout.bind(this,true).defer(m);},getActiveNode:function(){return this._activeNode;},setActiveNode:function(m){clearTimeout(this._hideTimeout);if(this._activeNode&&this._activeNode!==m)this.hideFlyout(true);this._activeNode=m;return this;},clearNodes:function(){for(var m=this._nodes.length;m>0;m--)this.deactivateNode(this._nodes[m-1]);},destroy:function(){while(this._flyoutSubscriptions.length)this._flyout.unsubscribe(this._flyoutSubscriptions.pop());this.clearNodes();},_onNodeMouseEnter:function(m){if(this._activeNode===m){clearTimeout(this._hideTimeout);}else this.showFlyout(m);},_onFlyoutMouseEnter:function(){clearTimeout(this._hideTimeout);}});e.exports=a.HoverFlyout||l;});
__d("StickyController",["event-extensions","CSS","Vector","Style","copyProperties","throttle"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('Vector'),i=b('Style'),j=b('copyProperties'),k=b('throttle');function l(m,n,o,p){this._element=m;this._marginTop=n;this._onchange=o;this._proxy=p||m.parentNode;}j(l.prototype,{handleScroll:function(){var m=h.getElementPosition(this._proxy,'viewport').y<=this._marginTop;if(this.isFixed()!==m){i.set(this._element,'top',m?this._marginTop+'px':'');g.conditionClass(this._element,'fixed_elem',m);this._onchange&&this._onchange(m);}},start:function(){if(this._event)return;this._event=Event.listen(window,'scroll',k(this.handleScroll,100,this));this.handleScroll.bind(this).defer();},stop:function(){this._event&&this._event.remove();this._event=null;},isFixed:function(){return g.hasClass(this._element,'fixed_elem');}});a.StickyController=e.exports=l;},3);
function fbpage_set_fan_status(a,b,c,d,e,f,g){e=e?e:function(j){_fbpage_show_change_status_feedback(a,j.getPayload());};var h={fbpage_id:b,add:c,reload:d};if(g!=null)copy_properties(h,g);var i=new AsyncRequest().setURI('/ajax/pages/fan_status.php').setData(h).setNectarModuleDataSafe(a).setHandler(e);if(f)i.setErrorHandler(f);i.send();return false;}function fbpage_set_favorite_status(a,b,c){var d=function(){_fbpage_show_change_status_feedback(a,this.getUserData());},e={fbpage_id:b,add:c},f=new AsyncRequest().setMethod('POST').setURI('/ajax/pages/favorite_status.php').setData(e);new Dialog().setAsync(f).setCloseHandler(d).show();return false;}function _fbpage_show_change_status_feedback(a,b){if(!b||!a)return;if(b.reload){fbpage_reload_on_fan_status_changed(b.preserve_tab);}else fbpage_redraw_on_fan_status_changed(a,b.feedback);}function fbpage_reload_on_fan_status_changed(a){var b=URI.getRequestURI();if(a){var c=FutureSideNav.getInstance().selected.textKey;if(!b.getQueryData().sk&&c)b.addQueryData({sk:c});}window.location.href=b;}function fbpage_redraw_on_fan_status_changed(a,b){if(!b)return;if(Parent.byClass(a,'fbTimelineEscapeSectionItem'))a=Parent.byClass(a,'fan_status_inactive')||a;var c=DOM.create('span',{className:'fan_status_inactive'},b);a.parentNode.replaceChild(c,a);var d=function(){if(data.can_repeat_action)c.parentNode.replaceChild(a,c);};animation(c).duration(3000).checkpoint().to('backgroundColor','#FFFFFF').duration(1000).ondone(d).go();}function fbpage_toggle_like_on_fan_status_changed(a,b){var c=$('liked_pages_like_action_'+a),d=$('liked_pages_undo_action_'+a);CSS.conditionClass(c,'hidden_elem',b);CSS.conditionClass(d,'hidden_elem',!b);}
__d("TimelineConstants",[],function(a,b,c,d,e,f){var g={DS_HEIGHT:'timeline-unit-height',DS_LOADED:'timeline-capsule-loaded',DS_SIDEORG:'timeline-unit-sideorg',DS_TAILBALANCE:'timeline-capsule-tailbalance',DS_COLUMN_HEIGHT_DIFFERENTIAL:'timeline-column-diff-height',FIXED_SIDE_LEFT:'left',FIXED_SIDE_RIGHT:'right',FIXED_SIDE_BOTH:'both',SCROLL_TO_OFFSET:30,SUBSECTION_SCROLL_TO_OFFSET:90};e.exports=g;});
__d("TimelineURI",["URI"],function(a,b,c,d,e,f){var g=b('URI'),h={TIMELINE_KEY:'timeline',WALL_KEY:'wall',parseURI:function(i){i=g(i);var j=i.getQueryData(),k=i.getPath(),l=k.split('/').slice(1);if(l[0]=='people'||l[0]=='pages')l=l.slice(2);var m=j.sk||l[1]||h.TIMELINE_KEY;if(m==h.WALL_KEY)m=h.TIMELINE_KEY;var n=null,o=null;if(m==h.TIMELINE_KEY){o=parseInt(l[2],10)||null;n=parseInt(l[3],10)||null;}return {path:k,id:j.id||l[0],key:m,viewas:j.viewas?j.viewas:0,filter:j.filter?j.filter:null,year:o,month:n,friendship:!!j.and};}};e.exports=h;});
__d("TimelineController",["event-extensions","Arbiter","CSS","DataStore","DOM","Run","ScrollingPager","TimelineConstants","TimelineURI","Vector","ge","$","throttle"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('CSS'),i=b('DataStore'),j=b('DOM'),k=b('Run'),l=b('ScrollingPager'),m=b('TimelineConstants'),n=b('TimelineURI'),o=b('Vector'),p=b('ge'),q=b('$'),r=b('throttle'),s=484,t=48,u=740,v=1285,w=null,x=false,y,z,aa={},ba={},ca=[],da=null,ea=0,fa=false,ga=false,ha=false,ia={allactivity:true,approve:true,games:true,map:true,music:true,video:true};ia[n.TIMELINE_KEY]=true;var ja=[],ka=false;function la(ua,va,wa){wa=wa||[];if(aa[ua])return aa[ua][va].apply(aa[ua],wa);ba[ua]=ba[ua]||{};ba[ua][va]=wa;return false;}function ma(){if(!(fa||ha||ga)){da.remove();da=null;return;}var ua=o.getScrollPosition();fa=fa&&oa(q('rightCol'),ua,'paddingTop',true);ga=ga&&oa(q('pagelet_above_header_timeline'),ua,'top');ha=ha&&oa(q('blueBar'),ua,'paddingTop');}function na(){var ua=o.getScrollPosition(),va=ea===0||ua.y>=ea;la(ta.STICKY_HEADER,'toggle',[va]);la(ta.CONTENT,'checkCurrentSectionChange');}function oa(ua,va,wa,xa){if(va.y<=0){pa(ua,wa);return false;}else{var ya=xa&&ta.getCurrentScrubber();if((ya&&h.hasClass(ya.getRoot(),'fixed_elem'))||h.isFixed(p('pagelet_timeline_friends'))){pa(ua,wa);return false;}else{var za=parseInt(ua.style[wa],10)||0;if(va.y<za){h.addClass(ua,'timeline_fixed');ua.style[wa]=va.y+'px';}else h.removeClass(ua,'timeline_fixed');}}return true;}function pa(ua,va){ua.style[va]='0px';h.removeClass(ua,'timeline_fixed');}function qa(){la(ta.ADS,'adjustAdsType',[ta.shouldShowWideAds()]);la(ta.ADS,'adjustAdsToFit');la(ta.CONTENT,'adjustContentPadding');la(ta.STICKY_HEADER_NAV,'adjustMenuHeights');}function ra(ua,va){if(ua=='sidebar/initialized')ka=true;la(ta.ADS,'adjustAdsType',[ta.shouldShowWideAds()]);}function sa(){while(ca.length)ca.pop().remove();for(var ua in aa)aa[ua].reset&&aa[ua].reset();da&&da.remove();da=null;z.unsubscribe();z=null;w=null;y=null;aa={};ba={};ea=0;ga=false;if(fa){q('rightCol').style.paddingTop='';h.removeClass(q('rightCol'),'timeline_fixed');}fa=false;if(ha){q('blueBar').style.paddingTop='';h.removeClass(q('blueBar'),'timeline_fixed');}ha=false;ja=[];ka=false;x=false;i.purge(m.DS_HEIGHT);i.purge(m.DS_LOADED);i.purge(m.DS_SIDEORG);i.purge(m.DS_TAILBALANCE);i.purge(m.DS_COLUMN_HEIGHT_DIFFERENTIAL);}var ta={NAV:'nav',STICKY_HEADER:'sticky_header',STICKY_HEADER_NAV:'sticky_header_nav',SCRUBBER:'scrubber',CONTENT:'content',ADS:'ads',COVER:'cover',LOGGING:'logging',SECTION_LOADING:'TimelineController/sectionLoading',SECTION_LOADED:'TimelineController/sectionLoaded',SECTION_FULLY_LOADED:'TimelineController/sectionFullyLoaded',SECTION_REGISTERED:'TimelineController/sectionRegistered',SCRUBBER_DEFAULT_OFFSET:38,init:function(ua,va){if(x)return;if(va==n.WALL_KEY)va=n.TIMELINE_KEY;x=true;y=ua;la(ta.CONTENT,'adjustContentPadding');ca.push(Event.listen(window,'scroll',r(na,100)),Event.listen(window,'resize',r(qa,100)));z=g.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide'],ra);k.onLeave(sa);ta.registerCurrentKey(va);},setAdsTracking:function(ua){la(ta.ADS,'start',[ua]);},coverHasExpanded:function(ua){q('rightCol').style.paddingTop=ua+'px';fa=true;var va=q('pagelet_above_header_timeline');if(va.firstChild){q('above_header_timeline_placeholder').style.height=va.offsetHeight+'px';va.style.top=ua+'px';ga=true;}var wa=document.documentElement;ha=wa.clientHeight<400||wa.clientWidth<wa.scrollWidth;if(ha)q('blueBar').style.paddingTop=ua+'px';da=Event.listen(window,'scroll',ma);},pageHasScrubber:function(ua){return !ua||ua.match(/^(og_)?app_/)||(ua in ia);},registerCurrentKey:function(ua){w=ua;var va=o.getViewportDimensions().y<u;la(ta.ADS,'setShortMode',[va,ua]);la(ta.ADS,'updateCurrentKey',[ua]);ea=ua==n.TIMELINE_KEY?s-t:0;},getCurrentKey:function(){return w;},getCurrentScrubber:function(){return aa[ta.SCRUBBER];},getCurrentStickyHeaderNav:function(){return aa[ta.STICKY_HEADER_NAV];},getSection:function(ua){return la(ta.CONTENT,'getSection',[ua]);},scrubberHasLoaded:function(ua){la(ta.STICKY_HEADER_NAV,'addTimePeriods',[ja]);la(ta.ADS,'registerScrubber',[ua]);},registerSectionKey:function(ua,va){if(ta.getCurrentScrubber()&&aa[ta.STICKY_HEADER_NAV]){la(ta.STICKY_HEADER_NAV,'addTimePeriod',[ua]);}else ja[va]=ua;},scrubberHasChangedState:function(){la(ta.ADS,'adjustAdsToFit');},scrubberWasClicked:function(ua){la(ta.LOGGING,'logScrubberClick',[ua]);},sectionHasChanged:function(ua,va){la(ta.STICKY_HEADER_NAV,'updateSection',[ua,va]);la(ta.SCRUBBER,'updateSection',[ua,va]);la(ta.ADS,'loadAdsFromUserActivity');la(ta.LOGGING,'logSectionChange',[ua,va]);},navigateToSection:function(ua){la(ta.CONTENT,'navigateToSection',[ua]);},shouldShowWideAds:function(){if(!ka)return false;var ua=v;if(a.ChatSidebar&&a.ChatSidebar.isVisible())ua+=a.ChatSidebar.getVisibleWidth();return o.getViewportDimensions().x>=ua;},sidebarInitialized:function(){return ka;},adjustStickyHeaderWidth:function(){la(ta.STICKY_HEADER,'adjustWidth');},register:function(ua,va){aa[ua]=va;if(ba[ua]){for(var wa in ba[ua])la(ua,wa,ba[ua][wa]);delete ba[ua];}},adjustScrollingPagerBuffer:function(ua,va){var wa=i.get(m.DS_COLUMN_HEIGHT_DIFFERENTIAL,va);if(!wa)return;var xa=l.getInstance(ua);xa&&xa.setBuffer(xa.getBuffer()+Math.abs(wa));},runOnceWhenSectionFullyLoaded:function(ua,va,wa){if(la(ta.CONTENT,'getSection',[va])){var xa=false;j.scry(aa[ta.CONTENT].getSection(va).node,'ol.fbTimelineCapsule').forEach(function(za){if(!xa&&i.get(m.DS_LOADED,za.id)===wa){ua();xa=true;}});if(xa)return;}var ya=g.subscribe(ta.SECTION_FULLY_LOADED,function(za,ab){if(ab.scrubberKey===va&&ab.pageIndex===wa){ua();ya.unsubscribe();}});}};e.exports=ta;});
__d("legacy:TimelineController",["TimelineController"],function(a,b,c,d){a.TimelineController=b('TimelineController');},3);
__d("TimelineDrag",["event-extensions","ArbiterMixin","Class","Locale","Style","Vector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('Locale'),j=b('Style'),k=b('Vector'),l=b('copyProperties');function m(n,o,p){p=p||{};this._listenOn=p.listenOn;this._offsetInput=o;this._defaultOffset=p.default_offset;this._killClicks=p.killClicks;this._vertical=true;this._RTLXSwitch=false;this.setPicture(n,p);}l(m.prototype,g,{setPicture:function(n,o){if(!n)return false;o=o||{};this._picture=n;this._defaultOffset=o.default_offset;if(o.vertical!==undefined)this._vertical=o.vertical;if(this._vertical){if(o.height)this._containerHeight=o.height;this._offsetType='top';this._eventCoord='y';}else{if(o.width)this._containerWidth=o.width;this._RTLXSwitch=i.isRTL();this._offsetType='left';this._eventCoord='x';}if(this._picture.complete){this._initialLoad();}else this._loadListener=Event.listen(this._picture,'load',function(){this._loadListener.remove();this._initialLoad();}.bind(this));},destroy:function(){this._stopDrag();this._saveOffset();this._mousedown&&this._mousedown.remove();this._onclick&&this._onclick.remove();this._loadListener&&this._loadListener.remove();},_initialLoad:function(){var n=this._listenOn?this._listenOn:this._picture;this._mousedown&&this._mousedown.remove();this._mousedown=Event.listen(n,'mousedown',this._onMouseDown.bind(this));if(this._vertical){this._maxOffset=this._containerHeight-this._picture.offsetHeight;}else this._maxOffset=this._containerWidth-this._picture.width;if(this._defaultOffset!==undefined)this._setOffset(this._defaultOffset);this._onclick&&this._onclick.remove();if(this._killClicks)this._onclick=Event.listen(n,'click',this._onClick.bind(this));this._saveOffset();},_onClick:function(event){event.kill();},_onMouseDown:function(event){var n=parseInt(j.get(this._picture,this._offsetType),10)||0;this._pictureStartDragOffset=n-k.getEventPosition(event)[this._eventCoord];this._startDrag();event.kill();},_startDrag:function(){if(!this._dragStarted){this.inform('startdrag',this);this._dragTokens=[Event.listen(document.documentElement,'mouseup',this._onMouseUp.bind(this)),Event.listen(document.documentElement,'mousemove',this._onMouseMove.bind(this))];this._dragStarted=true;}},_saveOffset:function(){var n=parseInt(j.get(this._picture,this._offsetType),10);if(this._RTLXSwitch){this._offsetInput.value=n+this._containerWidth-this._picture.offsetWidth;}else this._offsetInput.value=n;},_stopDrag:function(){if(this._dragStarted){this.inform('stopdrag',this);this._dragStarted=false;this._dragTokens.forEach(function(n){n.remove();});this._saveOffset();}},_onMouseUp:function(event){this._stopDrag();event.kill();},_setOffset:function(n){if(this._RTLXSwitch){n=Math.max(0,Math.min(n,-this._maxOffset));}else n=Math.min(0,Math.max(n,this._maxOffset));j.set(this._picture,this._offsetType,n+'px');},_onMouseMove:function(event){this._setOffset(this._pictureStartDragOffset+k.getEventPosition(event)[this._eventCoord]);event.kill();}});e.exports=m;});
__d("TimelineCover",["Button","CSS","DOM","HTML","Parent","DOMScroll","Vector","TimelineController","TimelineDrag","Style","copyProperties","ge"],function(a,b,c,d,e,f){var g=b('Button'),h=b('CSS'),i=b('DOM'),j=b('HTML'),k=b('Parent'),l=b('DOMScroll'),m=b('Vector'),n=b('TimelineController'),o=b('TimelineDrag'),p=b('Style'),q=b('copyProperties'),r=b('ge');function s(){}s.instance=null;s.getInstance=function(){return s.instance;};q(s.prototype,{init:function(t,u,v){this.root=t;this._parentSection=k.byClass(this.root,'fbTimelineSection');this._coverHeight=u;this.cover=i.find(this.root,'.cover');s.instance=this;this.previewing=v;this.editing=false;if(v){this.updateCoverImage(v);}else if(this.cover.getAttribute('data-collapse'))this._expandCover(parseInt(this.cover.getAttribute('data-collapse'),10));if(this.previewing)this.editMode();n.register(n.COVER,this);},showLoadingIndicator:function(){var t=r('fbCoverImageContainer');if(t)h.addClass(t,'opaquedLoading');},hideLoadingIndicator:function(){var t=r('fbCoverImageContainer');if(t)h.removeClass(t,'opaquedLoading');},editMode:function(){g.setEnabled(i.find(this.root,'label.cancelButton'),true);g.setEnabled(i.find(this.root,'label.saveButton'),true);this.hideLoadingIndicator();this._coverImage=i.scry(this.root,'.coverImage')[0];var t=i.scry(this._coverImage,'.coverWrap')[0];if(t)this._originalOffset=p.get(i.find(t,'.coverPhotoImg'),'top');h.addClass(this._parentSection,'fbEditCover');l.scrollTo(i.getDocumentBodyElement());if(this.previewing){i.remove(this._coverImage);h.show(this._coverImage);}var u=i.scry(this._coverImage,'.coverPhotoImg')[0];if(u)this._createDragger();this.editing=true;},_expandCover:function(t){this.cover.style.marginTop='0px';if(t!=m.getScrollPosition().y){window.scrollBy(0,t);n.coverHasExpanded(t);}},_exitEditMode:function(){if(this._timelineDrag){this._timelineDrag.destroy();this._timelineDrag=null;}i.find(this.root,'input.hiddenPhotoID').value=null;i.find(this.root,'input.hiddenVideoID').value=null;g.setEnabled(i.find(this.root,'label.cancelButton'),false);g.setEnabled(i.find(this.root,'label.saveButton'),false);h.removeClass(this._parentSection,'fbEditCover');this.hideLoadingIndicator();},_createDragger:function(){this._timelineDrag=new o(i.find(this.root,'.coverImage .coverPhotoImg'),i.find(this.root,'input.photoOffsetInput'),{height:this._coverHeight,listenOn:this.cover,vertical:true,killClicks:true});},updateCoverImage:function(t,u,v){this.videoID=v;if(u)this.editMode();i.find(this.root,'input.hiddenPhotoID').value=t;i.find(this.root,'input.hiddenVideoID').value=v||null;g.setEnabled(i.find(this.root,'label.saveButton'),true);if(u)i.replace(i.find(this.root,'.coverImage'),j(u));if(this._timelineDrag){this._timelineDrag.setPicture(i.find(i.find(this.root,'.coverImage'),'.coverPhotoImg'));}else this._createDragger();},cancelUpdate:function(){i.remove(i.scry(this.root,'.coverImage')[0]);i.prependContent(this.cover,this._coverImage);if(this._originalOffset!==undefined)p.set(i.find(this._coverImage,'.coverPhotoImg'),'top',this._originalOffset);this._exitEditMode();},saveComplete:function(){this._coverImage=i.scry(this.root,'.coverImage')[0];this._exitEditMode();},isInEditMode:function(){return this.editing;}});a.TimelineCover=e.exports=s;},3);
__d("legacy:TimelineURI",["TimelineURI"],function(a,b,c,d){a.TimelineURI=b('TimelineURI');},3);
var TimelineNavigation=(function(){var a=4,b=110,c=20,d=119,e=328,f=10,g=3,h=false,i=21,j,k,l,m=[],n=[],o,p=0,q,r=0,s=0,t,u=a,v=false,w=false,x,y=false,z,aa,ba=false;function ca(pa,qa,ra){if(!qa.firstChild){DOM.remove(qa);return;}n.push(qa);fa(ra.recent);CSS.removeClass(Parent.byTag(qa,'li'),'empty');if(o&&(r>a||s>0))CSS.removeClass(o,'notready');ea();if(ra.async){ja();la();}}function da(pa,qa,ra){DOM.remove(Parent.byTag(qa,'li'));if(!ra.async){t++;}else{r--;ja();la();}ea();}function ea(){var pa=o?0:i;if(r<=a){var qa=e+d*Math.max(0,a-r)+pa;q.style.width=qa+'px';u=r;ga();}}function fa(pa){if(pa){s++;}else r++;ga();}function ga(){if(!z)return;var pa=Math.max(0,r-a)+s;if(p&&o){DOM.setContent(p,pa===0?" ":pa);CSS.conditionClass(o,'fbTimelineMoreButtonZero',pa===0);if(!v)CSS.conditionShow(o,pa>0);}}function ha(){var pa=DOM.scry($('fbTimelineNavTopRow'),'li.tile'),qa=0,ra=0,sa=Math.max(0,a-u),ta=false;for(var ua=0;ua<pa.length;ua++){if(pa[ua]==q||pa[ua]==o)continue;ta=((qa+sa)%a===0);CSS.conditionClass(pa[ua],'leftMost',(qa!==0&&ta));if(!CSS.hasClass(pa[ua],'empty'))ra=qa;qa++;}ta=((ra+1+sa)%a===0);var va=pa.length-1-sa;if(ta){if(v&&(ra+1+sa)/a<g){va=Math.min(va,ra+a);w=true;}else va=ra;}else{var wa=((ra+1+sa)%a);va=ra+(a-wa);w=false;}ua=0;for(ua=0;ua<=va;ua++)if(pa[ua]&&(pa[ua]==q||pa[ua]==o)){va++;}else pa[ua]&&CSS.hasClass(pa[ua],'empty')&&CSS.removeClass(pa[ua],'hidden_elem');}function ia(pa,qa,ra){var sa=DOM.scry(pa,'li.tile');if(!qa)qa=0;var ta=false;for(var ua=qa;ua<sa.length;ua++){ta=((ua-ra)%a===0);var va=sa[ua];CSS.conditionClass(va,'leftMost',ta);if(CSS.hasClass(va,'empty'))CSS.removeClass(va,'hidden_elem');}}function ja(){ha();var pa=ge('fbTimelineNavSecondaryRow');pa&&ia(pa,0,0);}function ka(){if(!o)return;if(CSS.hasClass(o,'notready'))return;CSS.toggleClass(o,'fbTimelineMoreButtonOpen');var pa=ge('fbRecentAppTitle');pa&&CSS.conditionClass(pa,'hidden_elem',s===0);if(CSS.hasClass(o,'fbTimelineMoreButtonOpen')){ja();}else ga();la();}function la(){if(o&&!CSS.hasClass(o,'fbTimelineMoreButtonOpen')){j.style.height='';CSS.removeClass(j,'expanded');}else{var pa=r+(a-u),qa=((s>0)?f:0)+b*(Math.ceil(s/a))+b*(Math.ceil(pa/a))+b*(w?1:0)+c;CSS.addClass(j,'expanded');j.style.height=qa+'px';}}function ma(pa){var qa=pa==TimelineURI.TIMELINE_KEY||pa==TimelineURI.WALL_KEY,ra=Parent.byClass(j,'fbTimelineTopSectionBase'),sa=ge('timeline_tour_toolbar');if(o){CSS.removeClass(o,'fbTimelineMoreButtonOpen');la();}sa&&CSS.conditionShow(sa,qa);if(ra)CSS.conditionClass(ra,'collapsedHead',!qa);}function na(event){if(ba)return true;if(!Parent.byTag(event.getTarget(),'a')){var pa=DOM.find(q,'a.title');PageTransitions.go(pa.href);}}function oa(){if(o)(function(){o.removeAttribute('ajaxify');o.removeAttribute('rel');}).defer();_removeAjaxifyRef.remove();}return {UPDATE_PAGE:'TimelineNavigation/updatePage',init:function(pa,qa,ra,sa){if(h)return;h=true;j=pa;o=qa;k=URI.getRequestURI();q=DOM.find(j,'li.about');ma(TimelineController.getCurrentKey());v=sa;Arbiter.inform(TimelineNavigation.UPDATE_PAGE);if(o){p=DOM.find(o,'div.text');_removeAjaxifyRef=Event.listen(o,'click',oa);}x=$('fbTimelineNavigationLoadContainer');DOM.appendContent($('content'),x);aa=Event.listen(q,'click',na);m.forEach(function(ua){if(!ua[2].remove){ca.apply(this,ua);}else da.apply(this,ua);});m=[];var ta=Parent.byClass(pa,'fbTimelineSection');if(ta)DOM.scry(ta,'ul.uiButtonGroup').forEach(function(ua){$A(ua.childNodes).forEach(function(va){va.childNodes.length||DOM.remove(va);});if(ua.firstChild){CSS.addClass(ua.firstChild,'firstItem');}else DOM.remove(ua);});TimelineController.register(TimelineController.NAV,TimelineNavigation);},reset:function(){aa&&aa.remove();aa=null;z&&z.remove();z=null;h=false;j=null;l=null;n=[];o=null;p=null;q=null;r=0;s=0;t=0;u=a;v=false;w=false;x=null;y=false;ba=false;},initializeMorePager:function(){if(z)return;if(o)z=Event.listen(o,'click',ka);},registerNav:function(pa,qa,ra){h?(ra.remove?da.apply(this,arguments):ca.apply(this,arguments)):m.push(arguments);},redraw:function(){ja();la();},setEditMode:function(pa){ba=pa;}};})();
var TimelineSideAds=(function(){var a=2,b=3,c=75,d='data-height',e=310,f=30000,g=false,h,i,j,k=[],l,m=false,n,o=Infinity,p=5,q=false,r,s,t,u,v=false;function w(na,oa,pa){var qa=0;if(ge('pagelet_timeline_friends'))qa+=e;if(oa)qa+=oa.getHeight();if(!qa)return;na-=qa;var ra=0;for(var sa=0;sa<pa;sa++)ra+=ga(sa);if(oa)if(na<ra){na+=oa.fold(ra-na);}else if(na>ra)na-=oa.unfold(na-ra);return na;}function x(){var na=h.cloneNode(true);na.id='';var oa=true;DOM.scry(na,'div.ego_unit').forEach(function(pa){if(oa){oa=false;}else DOM.remove(pa);});CSS.addClass(na,'fixed_elem');return na;}function y(){if(!TimelineController.pageHasScrubber(l)){ca(p);ea();}else if(s){da(h,false);var na=t;t&&DOM.remove(t);t=x();if(na)la();ca(TimelineController.sidebarInitialized()&&m?b:a);ea();if(!n){var oa=TimelineController.getCurrentScrubber();oa&&ka(oa);}n&&n.start();}else TimelineSideAds.adjustAdsToFit();}function z(){var na=ge('pagelet_timeline_friends');if(na)CSS.conditionClass($('pagelet_timeline_friends'),'fixed_elem',!s);}function aa(){if(t){DOM.remove(t);t=null;}if(n){n.stop();n=null;}CSS.conditionClass(h,'fixed_elem',!s&&TimelineController.pageHasScrubber(l));z();}function ba(na){var oa=Vector2.getViewportDimensions().y,pa=TimelineController.getCurrentScrubber(),qa=pa?pa.getOffset():TimelineController.SCRUBBER_DEFAULT_OFFSET,ra=oa-qa-c;if(pa||ge('pagelet_timeline_friends'))return w(ra,pa,na);}function ca(na){j=Math.min(na,k.length);for(var oa=0;oa<k.length;oa++)da(k[oa],oa>=j);da(h,j===0);}function da(na,oa){CSS.conditionClass(na,'fbTimelineSideAdsOffScreen',oa);na.setAttribute('aria-hidden',oa?'true':'false');}function ea(){if(!u)return;for(var na=j-1;na>=0;--na){if(n&&n.isFixed()&&((na!==0)||(t&&!CSS.shown(t))))continue;var oa=DOM.find(k[na],'div.fbAdUnit'),pa=oa.getAttribute('data-ad'),qa=JSON.parse(pa).adid;if(!u[qa])return;var ra=$N('iframe',{src:URI('/ai.php').addQueryData({aed:u[qa]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});ra.setAttribute('aria-hidden','true');DOM.appendContent(h,ra);delete u[qa];}}function fa(na){var oa=0;while(na>0&&oa<p){na-=ga(oa);if(na>=0)oa++;}return oa;}function ga(na){var oa=k[na];if(!oa)return 0;if(!oa.getAttribute(d))ha(oa);return parseInt(oa.getAttribute(d),10);}function ha(na){na.setAttribute(d,na.offsetHeight);}function ia(){for(var na=0;na<k.length;na++){var oa=k[na];if(!oa)continue;ha(oa);}}function ja(){k=DOM.scry(h,'div.ego_unit');var na=k.length;if(!na)return;q=na;y();var oa=function(pa){ha(pa);q=--na;TimelineSideAds.adjustAdsToFit();if(!q)o=Date.now();};k.forEach(function(pa){function qa(){oa.curry(pa).defer();}var ra=DOM.scry(pa,'img.img')[0];if(ra.complete){qa();}else Event.listen(ra,{load:qa,error:qa,abort:qa});});}function ka(na){n=new StickyController(na.getRoot(),na.getOffset(),function(oa){if(oa){la();}else{DOM.remove(t);ea();}});if(t)n.start();}function la(){DOM.insertAfter(h,t);ma();}function ma(){CSS.conditionShow(t,ga(0)<=ba(1)&&!CSS.hasClass(document.documentElement,'tinyViewport'));}return {init:function(na,oa,pa){if(g)return;p=pa;g=true;i=oa;h=na;TimelineSideAds.adjustAdsType(TimelineController.shouldShowWideAds());TimelineController.register(TimelineController.ADS,TimelineSideAds);},setShortMode:function(na,oa){s=oa!=='map'&&!ge('pagelet_timeline_friends')&&na&&TimelineController.pageHasScrubber(oa);},start:function(na){u=na;r=null;ja();},updateCurrentKey:function(na){if(na==l)return;l=na;aa();},loadAds:function(na){if(q||r)return;o=Infinity;r=UIPagelet.loadFromEndpoint('WebEgoPane',h.id,{pid:33,data:[i,false,'timeline_'+na,s?b:p]},{crossPage:true});},registerScrubber:function(na){CSS.conditionClass(na.getRoot(),'fixed_elem',!s);z();if(s)ka(na);!r&&TimelineSideAds.adjustAdsToFit();},loadAdsFromUserActivity:function(){if((Date.now()-o>=f)&&!CSS.hasClass(document.documentElement,'tinyViewport')&&(!n||n.isFixed())&&(!u||!u[k[0]]))TimelineSideAds.loadAds(l+'_refresh');TimelineSideAds.adjustAdsToFit();},adjustAdsType:function(na){if(na!=m){CSS.conditionClass(h,'fbTimelineVerticalAds',!na);t&&CSS.conditionClass(t,'fbTimelineVerticalAds',!na);m=na;ia();TimelineSideAds.adjustAdsToFit();}},adjustAdsToFit:function(){if(!h||v)return;v=true;var na=m?b:a;if(s){if(n&&t){n.handleScroll();if(n.isFixed()){CSS.conditionShow(t,ga(0)<=ba(1)&&!CSS.hasClass(document.documentElement,'tinyViewport'));}else ca(na);ea();}}else{var oa=ba(na);if(typeof oa!=='undefined'){ca(fa(oa));if(!q)ea();}}v=false;},reset:function(){n&&n.stop();r&&r.cancel();k=[];m=false;h=null;n=null;r=null;q=null;s=null;t=null;l=null;g=false;}};})();
__d("TimelineStickyHeader",["Arbiter","CSS","DOM","TimelineController"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('TimelineController'),k=false,l=false,m,n,o,p={VISIBLE:'TimelineStickyHeader/visible',ADJUST_WIDTH:'TimelineStickyHeader/adjustWidth',init:function(q){if(k)return;k=true;m=q;n=i.find(q,'div.name');o=i.find(q,'div.actions');j.register(j.STICKY_HEADER,p);},reset:function(){k=false;l=false;m=null;n=null;o=null;},toggle:function(q){h.conditionClass(m,'fbTimelineStickyHeaderHidden',!q);if(q!==l){l=q;g.inform(p.VISIBLE,q);}},adjustWidth:function(){g.inform(p.ADJUST_WIDTH,n,g.BEHAVIOR_STATE);},getRoot:function(){return m;},setActions:function(q){if(k&&q){i.replace(o,q);o=q;}}};e.exports=a.TimelineStickyHeader||p;});
__d("legacy:TimelineStickyHeader",["TimelineStickyHeader"],function(a,b,c,d){a.TimelineStickyHeader=b('TimelineStickyHeader');},3);
__d("TimelineStickyHeaderNav",["array-extensions","event-extensions","function-extensions","Arbiter","ButtonGroup","CSS","DOM","Parent","Selector","Style","TimelineController","URI","UserAgent","Vector","ge"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ButtonGroup'),i=b('CSS'),j=b('DOM'),k=b('Parent'),l=b('Selector'),m=b('Style'),n=b('TimelineController'),o=b('URI'),p=b('UserAgent'),q=b('Vector'),r=b('ge'),s=false,t,u,v,w,x,y,z,aa,ba,ca,da,ea={},fa={},ga=[],ha=false,ia=[],ja=[],ka=[],la=[];function ma(event){var ab=k.byTag(event.getTarget(),'a');if(ab){n.navigateToSection(ab.getAttribute('data-key'));event.prevent();}}function na(ab,bb){var cb=l.getValue(bb);if(cb==='allStories')n.getSection(ab).expandSubSections();if(cb!=='activityLog')oa(bb);}function oa(ab){xa(ab,'highlights');xa(ab,'allStories');var bb=j.find(ab,'li.separator');i.conditionShow(bb,bb.previousSibling);}function pa(ab){if(ba[ab]&&!u.custom_subsection_menu){ua(ab);}else sa();n.adjustStickyHeaderWidth();}function qa(ab,bb){var cb=bb.key;if(ca[cb]){va(cb);pa(cb);}}function ra(ab,bb){var cb=bb.scrubberKey;va(cb);if(v===cb)pa(cb);}function sa(){w.hideItem(z);}function ta(ab){var bb=aa[ab],cb=ba[ab];if(!bb&&cb){bb=aa[ab]=z.cloneNode(true);var db=j.scry(bb,'li.activityLog a')[0];if(db)db.href=o(db.href).addQueryData({key:ab});var eb=n.getCurrentScrubber();if(cb.length)i.show(j.find(bb,'li.separator'));for(var fb=0;fb<cb.length;fb++){var gb=cb[fb].scrubberKey,hb=eb.getLabelForSubnav(cb[fb].parentKey,gb);if(hb)wa(bb,{key:gb,label:hb});}if(ya()){oa(bb);l.setSelected(bb,j.scry(bb,'option')[1].value,true);}la.push(l.listen(bb,'change',na.curry(ab,bb)));ja.push(Event.listen(bb,'click',ma));}return bb;}function ua(ab){var bb=ta(ab);j.insertAfter(z,bb);i.hide(z);for(var cb in aa){var db=aa[cb];i.conditionShow(db,db===bb);}w.showItem(z);}function va(ab){ba[ab]=n.getSection(ab).subSections;}function wa(ab,bb){var cb=j.create('a',{href:'#',rel:'ignore',className:'itemAnchor',tabIndex:0},j.create('span',{className:'itemLabel fsm'},bb.label));cb.setAttribute('data-key',bb.key);cb.setAttribute('aria-checked',false);var db=j.create('li',{className:'uiMenuItem uiMenuItemRadio uiSelectorOption'},cb);db.setAttribute('data-label',bb.label);var eb=j.find(ab,'ul.uiMenuInner'),fb=j.create('option',{value:bb.key},bb.label),gb=j.find(ab,'select');if(bb.key==='recent'){j.prependContent(eb,db);j.insertAfter(gb.options[0],fb);}else{j.appendContent(eb,db);j.appendContent(gb,fb);}}function xa(ab,bb){var cb=j.scry(ab,'li.uiMenuItem');if(!cb)return;for(var db=0;db<cb.length;db++){var eb=cb[db];if(i.hasClass(eb,bb)||eb.firstChild.getAttribute('data-key')==bb){j.remove(eb);break;}}var fb=j.find(ab,'select'),gb=j.scry(fb,'option');for(db=0;db<gb.length;db++)if(gb[db].value===bb){j.remove(gb[db]);return;}}function ya(){return n.getCurrentKey()==='allactivity'||n.getCurrentKey()==='approve';}var za={init:function(ab,bb){if(s)return;s=true;t=ab;u=bb||{};x=j.find(t,'div.pageMenu');y=j.find(t,'div.sectionMenu');z=j.find(t,'div.subsectionMenu');da=j.find(x,'li.uiMenuSeparator');w=h.getInstance(x);aa={};ba={};ca={};za.adjustMenuHeights();n.register(n.STICKY_HEADER_NAV,za);},reset:function(){s=false;u={};ga=[];ea={};fa={};ha=false;ia=[];t=null;x=null;y=null;z=null;da=null;aa={};ba={};ca={};while(ja.length)ja.pop().remove();ka.forEach(g.unsubscribe);la.forEach(l.unsubscribe.bind(l));},addTimePeriods:function(ab){if(!ab.length)return;if(u.pull_from_scrubber){j.setContent(j.find(y,'ul.uiMenuInner'),'');j.remove(j.find(y,'select').children[1]);while(ab.length){var bb=ab.shift();bb&&za.addTimePeriod(bb);}w.showItem(y);}var cb=l.getSelectorMenu(y);ja.push(Event.listen(cb,'click',ma));var db=ya()?n.SECTION_REGISTERED:n.SECTION_LOADED,eb=ya()?ra:qa;ka.push(g.subscribe(db,eb));},addTimePeriod:function(ab){var bb=n.getCurrentScrubber().getLabelForNav(ab);if(!bb)return;wa(y,{key:ab,label:bb});var cb=j.find(y,'ul.uiMenuInner');if(ab==='recent'||cb.children.length<2)l.setSelected(y,ab,true);},updateSection:function(ab,bb){if(bb){var cb=ta(ab);if(cb){l.setSelected(cb,bb);oa(cb);}else v=ab;}else{ca[ab]=true;va(ab);}l.setSelected(y,ab,true);pa(ab);},adjustMenuHeights:function(){if(p.ie()<=7)return;[x,y].forEach(function(ab){var bb='';if(!i.hasClass(document.documentElement,'tinyViewport')){bb=q.getViewportDimensions().y-q.getElementDimensions(r('blueBar')).y-80;bb+='px';}m.set(j.find(ab,'ul.uiMenuInner'),'maxHeight',bb);});},initPageMenu:function(ab,bb){function cb(db,eb){db.forEach(function(fb){var gb=fa[fb]=j.create('li');i.hide(gb);eb?j.insertBefore(da,gb):j.appendContent(j.find(x,'ul.uiMenuInner'),gb);});}cb(ab,true);cb(bb,false);ea.info=j.scry(x,'li')[0];ga=bb;ha=true;if(ia.length)ia.forEach(function(db){za.registerPageMenuItem(db.key,db.item);});},registerPageMenuItem:function(ab,bb){if(!ha){ia.push({key:ab,item:bb});return;}if(fa[ab]){j.replace(fa[ab],bb);ea[ab]=bb.getNodes()[0];delete fa[ab];if(ga.indexOf(ab)>=0)i.show(da);}},removeTimePeriod:function(ab){xa(y,ab);}};e.exports=za;});
__d("legacy:TimelineStickyHeaderNav",["TimelineStickyHeaderNav"],function(a,b,c,d){a.TimelineStickyHeaderNav=b('TimelineStickyHeaderNav');},3);
__d("TimelineSmartInsert",["CSS","DOM","Run","UserAgent","Vector"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Run'),j=b('UserAgent'),k=b('Vector'),l=false,m=false;function n(){if(m)return;i.onLeave(o);m=true;}function o(){l=false;m=false;}var p={BUFFER:100,run:function(q,r){n();if(!l||j.ie()<=8){r();return;}var s=q.offsetHeight;r();var t=q.offsetHeight;if(t-s!==0&&k.getElementPosition(q).y+s<k.getScrollPosition().y+p.BUFFER)window.scrollBy(0,t-s);},enable:function(){l=true;}};e.exports=p;});
__d("legacy:TimelineCover",["TimelineCover"],function(a,b,c,d){a.TimelineCover=b('TimelineCover');},3);
__d("HubsTypeaheadView",["Class","ContextualTypeaheadView","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('ContextualTypeaheadView'),i=b('copyProperties');function j(k,l){this.parent.construct(this,k,l);}g.extend(j,h);i(j.prototype,{render:function(k,l,m){if(this.alwaysRender&&k!==''){var n=k.toLowerCase().trim(),o=false;for(var p=0;p<l.length;p++)if(n==l[p].text.toLowerCase()){o=true;break;}if(!o)l.push({text:k,type:'calltoaction'});}return this.parent.render(k,l,m);}});e.exports=j;});
__d("TypeaheadSetPhotoOnSelect",["event-extensions","function-extensions","CSS","DOM","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('CSS'),h=b('DOM'),i=b('copyProperties');function j(k){this._typeahead=k;}i(j.prototype,{_eventListener:null,_subscription:null,enable:function(){var k=h.scry(this._typeahead.getElement(),'.photo')[0];if(k){if(!h.isNodeOfType(k,'img')){var l=h.create('img',{className:k.className});h.replace(k,l);k=l;}var m=g.hide.curry(k),n=g.show.curry(k);this._eventListener=Event.listen(k,{load:n,error:m,abort:m});this._subscription=this._typeahead.subscribe('select',function(o,p){var q=p.selected.photo||this._typeahead.view.fallbackPhoto;q?k.setAttribute('src',q):m();}.bind(this));}},disable:function(){this._eventListener.remove();this._eventListener=null;this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=j;});
__d("legacy:SetPhotoOnSelectTypeaheadBehavior",["TypeaheadSetPhotoOnSelect"],function(a,b,c,d){var e=b('TypeaheadSetPhotoOnSelect');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.setPhotoOnSelect=function(f){f.enableBehavior(e);};},3);
__d("legacy:LayerHideOnBlur",["LayerHideOnBlur"],function(a,b,c,d){a.LayerHideOnBlur=b('LayerHideOnBlur');},3);
__d("TimelinePerfConfig",[],function(a,b,c,d,e,f){var g=null,h=function(){if(g===null)return false;return true;},i={init:function(j){g=j;},getDisablePageletThrottle:function(){return h()&&(g.disablePageletThrottle||g.disableAllThrottle);},getDisableAllThrottle:function(){return h()&&g.disableAllThrottle;},getDisableSpineHeight:function(){return h()&&g.disableSpineHeight;}};e.exports=i;});
__d("TimelineThrottler",["event-extensions","Arbiter","TimelinePerfConfig","copyProperties","debounce","throttle"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('TimelinePerfConfig'),i=b('copyProperties'),j=b('debounce'),k=b('throttle');function l(m){this.id=m;this.idle=true;this.keys={};this.queue=[];this.config={};this.configure();l.instances[m]=this;}l.getInstance=function(m){return l.instances[m]||new l(m);};l.instances={};l.config={};l.REQUEUE='requeue';g.subscribe("Timeline/throttle",function(m,n){l.config=n;for(var o in l.instances)l.instances[o].configure();});i(l.prototype,{configure:function(){if(this._handle)this._handle.remove();var m=j(function(){this.idle=true;this._process();},l.config.scrollDelay||400,this),n=k(function(){this.idle=false;m();},l.config.scrollThrottle||100,this);this._handle=Event.listen(window,'scroll',n);i(this.config,l.config[this.id]);},cancel:function(){this.idle=true;this.keys={};this.queue=[];this.config={};this._handle&&this._handle.remove();},_limit:function(m,n,o){if(h.getDisableAllThrottle()){m();return;}var p=m;if(n){if(this.keys[n])if(o){this.queue.splice(this.queue.indexOf(this.keys[n]),1);}else return;this.keys[n]=m;p=function(){delete this.keys[n];m();}.bind(this);}this.queue.push(p);this._process();},throttle:function(m,n){this._limit(m,n,false);},debounce:function(m,n){this._limit(m,n,true);},_process:function(){if(this.idle&&this.queue.length){var m=this.queue.shift(),n=m();if(n===l.REQUEUE)this.queue.push(m);setTimeout(this._process.bind(this),this.config.delay||0);}}});e.exports=l;});
__d("TimelineContentLoader",["Arbiter","CSS","DOM","DOMScroll","OnVisible","ScrollingPager","TimelineConstants","TimelineController","TimelinePerfConfig","TimelineSmartInsert","TimelineThrottler","TimelineURI","UIPagelet","UserAgent","Vector","$","copyProperties","createArrayFrom","debounce","ge","startsWith","tx","userAction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('DOMScroll'),k=b('OnVisible'),l=b('ScrollingPager'),m=b('TimelineConstants'),n=b('TimelineController'),o=b('TimelinePerfConfig'),p=b('TimelineSmartInsert'),q=b('TimelineThrottler'),r=b('TimelineURI'),s=b('UIPagelet'),t=b('UserAgent'),u=b('Vector'),v=b('$'),w=b('copyProperties'),x=b('createArrayFrom'),y=b('debounce'),z=b('ge'),aa=b('startsWith'),ba=b('tx'),ca=b('userAction'),da=false,ea=false,fa,ga={},ha=null,ia={},ja=[],ka=[],la={},ma={},na={},oa=null,pa=null,qa=null,ra=false,sa=null;function ta(eb,fb,gb,hb,ib){this.node=eb;this.loaded=hb;this.canScrollLoad=true;this.canUnload=fb!=db.RECENT;this.scrubberKey=fb;this.historicUnitCount=ib;this._pageletLoadData=gb;this._expandPageletLoadData={};}w(ta.prototype,{load:function(eb){if(this.loaded)return;var fb=this._pageletLoadData;g.inform(n.SECTION_LOADING,{data:fb,scrubberKey:this.scrubberKey});this.loaded=true;h.removeClass(this.node,'fbTimelineTimePeriodUnexpanded');h.removeClass(this.node,'fbTimelineTimePeriodSuppressed');var gb='ProfileTimelineSectionPagelet';if(this.scrubberKey==db.WAY_BACK)gb='ProfileTimelineRemainingYearsPagelet';fb.time_cutoff=db.getTimeCutoff();fb.highlight_unit_data=eb;fb.parent_key=this.parentKey;fb.force_no_friend_activity=ra;h.addClass(this.node,'fbTimelineSectionLoading');var hb=null;if(!eb&&!o.getDisablePageletThrottle())hb=xa.curry(this.node);if(this.canUnload&&ea){var ib=this.node.firstChild.cloneNode(true);h.hide(ib);i.insertAfter(this.node,ib);}else this.canScrollLoad=false;na[this.scrubberKey]=s.loadFromEndpoint(gb,this.node.id,fb,{usePipe:true,jsNonblock:true,constHeight:true,displayCallback:hb});cb(this.scrubberKey);},preload:function(){h.addClass(this.node,'fbTimelineTimePeriodSuppressed');h.removeClass(this.node,'fbTimelineTimePeriodUnexpanded');var eb=i.find(this.node,'span.sectionLabel');if(eb.getAttribute('data-original-label')){i.setContent(eb,eb.getAttribute('data-original-label'));eb.removeAttribute('data-original-label');}},unload:function(){if(!this.loaded||!this.canUnload)return;this.loaded=false;na[this.scrubberKey]&&na[this.scrubberKey].cancel();h.addClass(this.node,'fbTimelineTimePeriodUnexpanded');h.removeClass(this.node,'fbTimelineTimePeriodSuppressed');if(this.node.nextSibling&&h.hasClass(this.node.nextSibling,'fbTimelineSection')){i.setContent(this.node,this.node.nextSibling);h.show(this.node.firstChild);}else i.empty(this.node);this.deactivateScrollLoad();},activateScrollLoad:function(){this.canScrollLoad=true;h.removeClass(this.node,'fbTimelineTimePeriodSuppressed');h.addClass(this.node,'fbTimelineTimePeriodUnexpanded');ma[this.scrubberKey]&&ma[this.scrubberKey].reset();},deactivateScrollLoad:function(){if(!this.loaded){this.canScrollLoad=false;h.removeClass(this.node,'fbTimelineTimePeriodUnexpanded');h.addClass(this.node,'fbTimelineTimePeriodSuppressed');ma[this.scrubberKey]&&ma[this.scrubberKey].remove();}},setExpandLoadData:function(eb){this._expandPageletLoadData=eb;return this;},expandSubSections:function(){if(this.subSections.length)db.navigateToSection(this.subSections[0].scrubberKey);},expand:function(eb){if(!this.loaded)return;qa.add_event('expand_'+this.scrubberKey);var fb=i.find(this.node,'.fbTimelineSectionExpander');h.addClass(fb.firstChild,'async_saving');eb&&h.addClass(eb,'async_saving');this._expandPageletLoadData.time_cutoff=db.getTimeCutoff();db.navigateToSection(this.scrubberKey);i.scry(this.node,'ol.fbTimelineCapsule').forEach(i.remove);this._expandPageletLoadData.new_expand=true;na[this.scrubberKey]&&na[this.scrubberKey].cancel();na[this.scrubberKey]=s.loadFromEndpoint('ProfileTimelineSectionPagelet',fb.id,this._expandPageletLoadData,{usePipe:true,jsNonblock:true,constHeight:true});},isPermalinkPeriod:function(){return this._pageletLoadData.is_permalink_period;}});function ua(){if(da)return;n.register(n.CONTENT,db);qa=ca('scrubber').set_namespace('timeline').set_ua_id('scrubber');da=true;if(t.ie()<=7)ea=true;}var va=y(function(eb,fb,gb){var hb=db.getSection(eb).historicUnitCount;fb-=hb;gb-=1;if(hb==-1||gb<=0||fb<0)return;var ib=db.getNextSectionKey(eb);if(ib){db.getSection(ib).load();va(ib,fb,gb);}},500),wa={};function xa(eb,fb){oa=q.getInstance('displayPagelet');oa.throttle(function(){var gb=u.getViewportDimensions().y,hb=u.getScrollPosition().y,ib=hb+gb,jb=hb+gb*(oa.config.fociRatio||.5),kb=u.getElementPosition(eb).y;if(kb>jb)if(kb<ib){wa[eb.id]=(wa[eb.id]||0)+1;if(wa[eb.id]<(oa.config.fociPenalty||3))return q.REQUEUE;}else{delete wa[eb.id];return q.REQUEUE;}delete wa[eb.id];fb();});}function ya(eb,fb,gb){var hb=db.getNextSectionKey(fb);if(hb)ma[hb]=new k(eb,za.curry(hb,eb),false,gb||1000);}function za(eb,fb){if(ga[eb].canScrollLoad){qa.add_event("scroll_load_"+eb);if(ea){db.getSection(eb).preload();}else{db.getSection(eb).load();if(sa)va(eb,sa.required_units,sa.max_parallelism);}fb&&i.remove(fb);}}function ab(){var eb,fb,gb=false;for(var hb=0;hb<ja.length;hb++){var ib=ja[hb];if(!ib)continue;var jb=db.getSection(ib);if(jb.canScrollLoad||jb.loaded){if(!jb.loaded){h.removeClass(jb.node,'fbTimelineTimePeriodSuppressed');h.addClass(jb.node,'fbTimelineTimePeriodUnexpanded');}if(eb&&fb){bb(eb,fb);if(gb)eb.deactivateScrollLoad();gb=true;}eb=null;fb=null;continue;}else if(eb){fb=jb;jb.deactivateScrollLoad();}else{eb=jb;if(gb)jb.activateScrollLoad();}h.removeClass(jb.node,'fbTimelineTimePeriodSuppressed');h.addClass(jb.node,'fbTimelineTimePeriodUnexpanded');}}function bb(eb,fb){h.removeClass(fb.node,'fbTimelineTimePeriodUnexpanded');h.addClass(fb.node,'fbTimelineTimePeriodSuppressed');var gb=i.find(eb.node,'span.sectionLabel'),hb=i.find(fb.node,'span.sectionLabel');if(!hb.getAttribute('data-original-label'))hb.setAttribute('data-original-label',i.getText(hb));if(gb.getAttribute('data-month')&&hb.getAttribute('data-month')&&gb.getAttribute('data-year')==hb.getAttribute('data-year')){i.setContent(hb,ba._("N\u00e4yt\u00e4 {month1} - {month2} {year}",{month1:hb.getAttribute('data-month'),month2:gb.getAttribute('data-month'),year:gb.getAttribute('data-year')}));}else if(gb.getAttribute('data-year')!==hb.getAttribute('data-year')){i.setContent(hb,ba._("N\u00e4yt\u00e4 {year1} - {year2}",{year1:hb.getAttribute('data-year'),year2:gb.getAttribute('data-year')}));}else i.setContent(hb,ba._("N\u00e4yt\u00e4 {year}",{year:hb.getAttribute('data-year')}));}function cb(eb){if(ea)for(var fb=0;fb<ja.length-1;fb++){var gb=ja[fb];if(!gb)continue;if(gb!=eb){var hb=ga[gb];if(hb.loaded&&hb.canUnload)hb.unload();}}ab();}var db={WAY_BACK:'way_back',RECENT:'recent',HEADER_SCROLL_CUTOFF:80,CURRENT_SECTION_OFFSET:150,registerTimePeriod:function(eb,fb,gb,hb,ib,jb,kb){ua();if(ka.contains(fb))return;var lb=new ta(eb,fb,gb,hb,kb);if(!ib){ja[jb]=fb;ia[fb]=true;}else{lb.parentKey=ib;ga[ib].subSections=ga[ib].subSections||[];ga[ib].subSections[jb]=lb;}ga[fb]=lb;db.checkCurrentSectionChange();g.inform(n.SECTION_REGISTERED,{scrubberKey:fb});n.registerSectionKey(fb,jb);},reset:function(){for(var eb in ma)ma[eb].remove();for(var fb in na)na[fb].cancel();fa&&fa.unsubscribe();fa=null;oa&&oa.cancel();oa=null;ga={};ha=null;ia={};ja=[];ka=[];la={};ma={};na={};pa=null;qa=null;ra=false;da=false;},checkCurrentSectionChange:function(){var eb=db.getCurrentSection(),fb=ha&&ha.scrubberKey;if(eb&&eb.scrubberKey!==fb&&!eb.isPermalinkPeriod()){ha=eb;var gb=eb.scrubberKey,hb=eb.parentKey;if(!hb){hb=gb;gb=null;}n.sectionHasChanged(hb,gb);}},setTimeCutoff:function(eb){pa=eb;},getTimeCutoff:function(){return pa;},setParallelLoadConfig:function(eb){sa=eb;},getCurrentSection:function(){var eb={};for(var fb in ga){var gb=ga[fb];if(!gb.loaded||la[gb.scrubberKey])continue;var hb=u.getElementPosition(gb.node,'viewport').y;if(gb.scrubberKey=='recent')hb--;if(hb<db.CURRENT_SECTION_OFFSET)eb[hb]=gb;}var ib=Math.max.apply(null,Object.keys(eb)),jb=ib==-Infinity;if(!jb){return eb[ib];}else if(ja[0])return ga[ja[0]];return null;},capsuleForCurrentSection:function(){var eb=db.getCurrentSection();return eb&&i.scry(eb.node,'ol.fbTimelineCapsule')[0];},enableScrollLoad:function(eb,fb,gb){var hb=i.scry(eb.parentNode,'ol.fbTimelineCapsule')[0];if(!hb)return;ya(eb,fb,gb);},getSection:function(eb){return ga[eb];},getNextSectionKey:function(eb){for(var fb=0;fb<ja.length-1;fb++)if(ja[fb]==eb){while(fb<ja.length-1&&!ja[fb+1])fb++;return ja[fb+1];}var gb=db.getSection(eb);if(!gb||!gb.parentKey)return;var hb=db.getSection(gb.parentKey);if(!hb)return;for(var ib=0;ib<hb.subSections.length-1;ib++)if(hb.subSections[ib].scrubberKey==eb)return hb.subSections[ib+1].scrubberKey;},hideSection:function(eb){var fb=db.getSection(eb);fb&&h.hide(fb.node);var gb=n.getCurrentScrubber();if(gb){var hb=n.getCurrentScrubber().getNav(eb);hb&&h.hide(hb);}var ib=n.getCurrentStickyHeaderNav();ib&&ib.removeTimePeriod(eb);la[eb]=true;},removeSection:function(eb){for(var fb in ja)if(ja[fb]==eb){ja[fb]=null;break;}delete ga[eb];delete ia[eb];if(eb in ma){ma[eb].remove();delete ma[eb];}var gb=n.getCurrentStickyHeaderNav();gb&&gb.removeTimePeriod(eb);ka.push(eb);},navigateToSection:function(eb,fb,gb){qa.add_event("nav_"+eb);fb=!!fb;var hb=eb,ib=db.getSection(eb);if(!ib)return;if(!ib.loaded)p.enable();if(!ia[eb]){ib.node.style.minHeight=u.getViewportDimensions().y+'px';var jb=g.subscribe(n.SECTION_FULLY_LOADED,function(qb,rb){if(rb.scrubberKey===eb){ib.node.style.minHeight='';jb.unsubscribe();}});hb=ib.parentKey;var kb=db.getSection(hb).node;if(!h.hasClass(kb,'fbTimelineSectionExpanded')){j.scrollTo(kb,0);h.addClass(kb,'fbTimelineSectionExpanded');i.scry(kb,'ol.fbTimelineCapsule').forEach(i.remove);i.scry(kb,'div.fbTimelineSectionExpandPager').forEach(i.remove);i.scry(kb,'div.fbTimelineContentHeader').forEach(i.remove);}}for(var lb=0;lb<ja.length;lb++){var mb=ja[lb];if(!mb)continue;if(mb==hb)break;db.getSection(mb).deactivateScrollLoad();i.scry(v('timeline_tab_content'),'.fbTimelineSectionExpandPager').forEach(function(qb){var rb=l.getInstance(qb.id);rb&&rb.removeOnVisible();});}db.adjustContentPadding();ib.load(gb);ab();var nb=u.getScrollPosition().x,ob=u.getElementPosition(ib.node).y;if(!fb){var pb=ia[eb]?m.SCROLL_TO_OFFSET:m.SUBSECTION_SCROLL_TO_OFFSET;j.scrollTo(new u(nb,ob-pb,'document'),true,false,false,function(){var qb=u.getElementPosition(ib.node).y;j.scrollTo(new u(nb,qb-pb,'document'),false);var rb=i.scry(ib.node,'h3.uiHeaderTitle')[0];rb&&rb.focus();});}},adjustContentPadding:function(){var eb=z('timeline_tab_content');if(!eb)return;var fb=n.getCurrentKey()||r.TIMELINE_KEY;if(fb!==r.TIMELINE_KEY)return;var gb=db.getSection(db.WAY_BACK);eb.style.paddingBottom=gb&&gb.loaded?null:u.getViewportDimensions().y-db.CURRENT_SECTION_OFFSET-db.HEADER_SCROLL_CUTOFF+'px';},suppressSectionsAbove:function(eb){var fb,gb;for(var hb=0;hb<ja.length;hb++){var ib=ja[hb];if(!ib)continue;fb=db.getSection(ib).node;gb=null;if(x(eb.parentNode.children).indexOf(eb)<=x(fb.parentNode.children).indexOf(fb)){gb=ib;break;}db.getSection(ib).deactivateScrollLoad();}if(gb)db.navigateToSection(gb,true);},forceNoFriendActivity:function(){ra=true;},removeDupes:function(eb){var fb=z(eb);if(!fb)return;var gb=i.scry(fb,'li.fbTimelineUnit'),hb={};for(var ib=0;ib<gb.length;ib++){var jb=gb[ib];if(jb.id&&aa(jb.id,'tl_unit_')){var kb=jb.id.substring(8,jb.id.length),lb=(jb.getAttribute('data-unit')=='ExperienceSummaryUnit'?jb.getAttribute('data-time'):1);if(hb.hasOwnProperty(kb)&&hb[kb]==lb){i.remove(jb);}else hb[kb]=lb;}}}};e.exports=a.TimelineContentLoader||db;});
__d("TimelineCapsule",["$","Arbiter","createArrayFrom","CSS","DataStore","DOM","DOMScroll","ge","Hovercard","Parent","TimelineConstants","TimelineContentLoader","TimelineController","TimelineSmartInsert","TimelineThrottler","UserAgent","Vector","isEmpty"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('createArrayFrom'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('DOMScroll'),n=b('ge'),o=b('Hovercard'),p=b('Parent'),q=b('TimelineConstants'),r=b('TimelineContentLoader'),s=b('TimelineController'),t=b('TimelineSmartInsert'),u=b('TimelineThrottler'),v=b('UserAgent'),w=b('Vector'),x=b('isEmpty'),y=(function(){var z=45,aa=15,ba={},ca={},da={},ea={};function fa(xa){return j.hasClass(xa,'fbTimelineBalancer');}function ga(xa){return xa.getAttribute('data-spine');}function ha(xa){return j.hasClass(xa,'placeholderUnit');}function ia(xa){return xa.getAttribute('data-fixed');}function ja(xa,ya){if(ya)return (k.get(q.DS_SIDEORG,xa.id)||xa.getAttribute('data-side'));return xa.getAttribute('data-side');}var ka=function(xa,ya){if(v.ie()<=6){ka=function(za,ab){k.set(q.DS_SIDEORG,za.id,ja(za,true));za.setAttribute('data-side',ab);j.removeClass(za,'leftColumn');j.removeClass(za,'rightColumn');j.addClass(za,ab=='l'?'leftColumn':'rightColumn');};}else ka=function(za,ab){k.set(q.DS_SIDEORG,za.id,ja(za,true));za.setAttribute('data-side',ab);};ka(xa,ya);};function la(xa){return xa.getAttribute('data-size');}var ma=function(xa,ya){if(fa(xa))return;if(ya){j.addClass(xa,'balancingCapsule');}else j.removeClass(xa,'balancingCapsule');};function na(xa){if(j.hasClass(xa,'fbTimelineIndeterminateContent'))return 0;return aa;}function oa(xa){var ya=0;if(j.shown(xa)&&!j.hasClass(xa,'placeholderUnit'))ya=xa.offsetHeight+na(xa);k.set(q.DS_HEIGHT,xa.id,ya);}function pa(xa){var ya=k.get(q.DS_HEIGHT,xa.id,null);return ya;}function qa(xa,ya){if(la(ya)=='2'){return 0;}else if(ja(ya)=='r'){return xa+pa(ya);}else return xa-pa(ya);}function ra(xa){var ya=xa.parentNode;if(!ya)return;var za=document.createDocumentFragment(),ab=xa.firstChild;while(ab.firstChild)za.appendChild(ab.firstChild);t.run(ya,l.replace.curry(xa,za));h.inform('TimelineCapsule/balanced',{capsule:ya});}function sa(xa){for(var ya=0;ya<xa.children.length;ya++){var za=xa.children[ya];if(!za.getAttribute('data-endmarker'))continue;var ab=za.getAttribute('data-endmarker'),bb=za.getAttribute('data-pageindex'),cb=function(){k.set(q.DS_LOADED,xa.id,bb);l.remove(za);h.inform(s.SECTION_FULLY_LOADED,{scrubberKey:ab,pageIndex:bb,capsuleID:xa.id,childCount:xa.children.length});};if(r.getSection(ab)){cb();}else var db=h.subscribe(s.SECTION_REGISTERED,function(eb,fb){if(fb.scrubberKey===ab){cb();db.unsubscribe();}});break;}}function ta(xa,ya,za){while(ya[0])ka(ya.pop(),'l');while(za[0])ka(za.pop(),'r');if(fa(xa))ra(xa);sa(xa);}function ua(xa){var ya=fa(xa)?xa.firstChild:xa,za=ya.childNodes.length,ab=[],bb;if(ba[xa.id]){if(x(ba[xa.id]))return;var cb={},db,eb,fb,gb;for(db=0;db<za;db++){eb=ya.childNodes[db];if(!ga(eb))cb[eb.id]=eb.offsetTop;}for(db=0;db<za;++db){eb=ya.childNodes[db];if(ga(eb)){continue;}else if(ba[xa.id][eb.id]){ab.push(eb);continue;}else if(bb&&ab.length&&la(bb)!='2'){fb=cb[bb.id]+z;gb=cb[eb.id];if(la(eb)=='2')gb-=z;var hb;while(fb<=gb){hb=ab.shift();if(!hb)break;j.show(hb);hb.style.top=fb+"px";fb+=z;}while(ab[0])j.hide(ab.pop());}bb=eb;}while(ab[0])j.hide(ab.pop());}ma(xa,false);}function va(xa,ya){var za=p.byAttribute(xa,'data-size');if(za){if(j.hasClass(xa.parentNode,'timelineReportContent')){ya(xa);}else ya(za);y.balanceCapsule(p.byClass(za,'fbTimelineCapsule'));}}function wa(xa){var ya=0;for(var za=0;za<xa.childNodes.length;za++)if(j.hasClass(xa.childNodes[za],'fbTimelineUnit'))ya++;return ya;}return {getUnitsWithTime:function(xa){return l.scry(xa,'.timelineUnitContainer').filter(function(ya){return (ya.parentNode.parentNode===xa&&ya.getAttribute('data-time'));});},removeUnit:function(xa){va(xa,function(ya){l.remove(ya);});},hideUnit:function(xa){va(xa,function(ya){j.addClass(ya,'fbTimelineColumnHidden');});},undoHideUnit:function(xa,ya){l.remove(p.byClass(ya,'hiddenText'));va(xa,function(za){j.removeClass(za,'fbTimelineColumnHidden');});},unplacehold:function(xa){var ya=g(xa);ya.style.top=null;j.removeClass(ya,'visiblePlaceholder');j.removeClass(ya,'placeholder');var za=p.byClass(ya,'fbTimelineCapsule');delete ba[za.id][xa];y.balanceCapsule(za);},scrollToCapsule:function(xa){if(!ea.hasOwnProperty(xa.id)){var ya=w.getElementPosition(xa.parentNode);m.scrollTo(new w(w.getScrollPosition().x,ya.y-q.SUBSECTION_SCROLL_TO_OFFSET,'document'));ea[xa.id]=true;}},setFirstUnit:function(xa){var ya=true,za=xa.childNodes.length;for(var ab=0;ab<za;ab++){var bb=xa.childNodes[ab];if(bb.id.indexOf('tl_unit_')===0)if(ya){ya=false;j.addClass(bb,'firstUnit');}else{j.removeClass(bb,'firstUnit');break;}}},balanceCapsule:function(xa,ya){if(!xa)return;if(xa.getAttribute('data-layout')=='fixed'){u.getInstance('balanceCapsuleFixed').debounce(y.balanceFixed.curry(xa,ya),xa.id);}else u.getInstance('balanceCapsule').throttle(y.balance.curry(xa,0),xa.id);},balanceFixed:function(xa,ya){if(!xa)return;if(v.chrome()||v.safari())j.toggleClass(xa,'webkitFix');var za=0,ab,bb=document.createDocumentFragment(),cb=[],db=[],eb=[],fb=false;for(var gb=0;gb<xa.childNodes.length;gb++){ab=xa.childNodes[gb];if(ga(ab)){continue;}else if(fa(ab)){i(ab.firstChild.childNodes).forEach(oa);continue;}oa(ab);if(ja(ab,true)=='r'){db.push(ab);}else cb.push(ab);eb.push(ab);if(la(ab)!='2')if((za>0&&ja(ab)=='r')||(za<0&&ja(ab)=='l'))fb=true;za=qa(za,ab);}var hb=[],ib=[],jb=[];l.scry(xa,'li.fbTimelineBalancer').forEach(function(mb){var nb=i(mb.firstChild.childNodes);if(mb.getAttribute('data-nonunits')){jb=jb.concat(nb);}else if(ja(mb)=='left'){hb=hb.concat(nb);}else if(ja(mb)=='right')ib=ib.concat(nb);});if(fb){xa.style.minHeight=xa.offsetHeight;cb.forEach(function(mb){if(la(mb)!='2')ka(mb,'l');});db.forEach(function(mb){if(la(mb)!='2')ka(mb,'r');});var kb=l.create('li',{className:'fbTimelineBalancer'},l.create('ol',null,cb));kb.setAttribute('data-side','left');l.prependContent(xa,kb);hb=cb.concat(hb);var lb=l.create('li',{className:'fbTimelineBalancer'},l.create('ol',null,db));lb.setAttribute('data-side','right');l.prependContent(xa,lb);ib=db.concat(ib);za=0;}while((za>=0&&hb.length)||(za<0&&ib.length)){if(za>=0){ab=hb.shift();}else ab=ib.shift();bb.appendChild(ab);za=qa(za,ab);}while(jb.length)bb.appendChild(jb.shift());xa.appendChild(bb);l.scry(xa,'li.fbTimelineBalancer').forEach(function(mb){if(!mb.firstChild.childNodes.length)l.remove(mb);});if(ya&&ya.tail_balance){za=y.tailBalance(xa,za,ya.tail_balance);}else if(k.get(q.DS_TAILBALANCE,xa.id))za=y.tailBalance(xa,za,q.FIXED_SIDE_BOTH);if(fb){eb.forEach(function(mb){if(mb.parentNode!==xa){xa.appendChild(mb);za=qa(za,mb);}});xa.style.minHeight=null;}k.set(q.DS_COLUMN_HEIGHT_DIFFERENTIAL,p.byClass(xa,'fbTimelineSection').id,za);ba[xa.id]={};l.scry(xa,'li.placeholderUnit').forEach(function(mb){ba[xa.id][mb.id]=mb;});ua(xa);sa(xa);h.inform('TimelineCapsule/balanced',{capsule:xa});},tailBalance:function(xa,ya,za){if(!xa)return ya;var ab=[],bb=[],cb=[],db=[];l.scry(xa,'li.fbTimelineBalancer').forEach(function(fb){var gb=i(fb.firstChild.childNodes);if(fb.getAttribute('data-nonunits')){db=db.concat(gb);}else if(ja(fb)=='left'){bb=bb.concat(gb);}else if(ja(fb)=='right')cb=cb.concat(gb);ab=ab.concat(gb);});if((za==q.FIXED_SIDE_RIGHT&&bb.length)||(za==q.FIXED_SIDE_LEFT&&cb.length))return ya;var eb=document.createDocumentFragment();if(ab)while(ab.length){if(la(ab[0])!='2')if(ya>=0){ka(ab[0],'l');}else ka(ab[0],'r');ya=qa(ya,ab[0]);eb.appendChild(ab.shift());}xa.appendChild(eb);l.scry(xa,'li.fbTimelineBalancer').forEach(function(fb){if(!fb.firstChild.childNodes.length)l.remove(fb);});k.set(q.DS_TAILBALANCE,xa.id,true);return ya;},balance:function(xa,ya,za){if(!xa)return;if(!ba[xa.id])ba[xa.id]={};var ab=fa(xa)?xa.firstChild:xa,bb=ab.childNodes.length,cb=[],db=[];if(v.chrome()||v.safari())j.toggleClass(xa,'webkitFix');for(var eb=0;eb<bb;eb++)oa(ab.childNodes[eb]);var fb=false;for(eb=0;eb<bb;eb++){var gb=ab.childNodes[eb];if(ga(gb))continue;var hb=(ya>=0),ib=gb.nextSibling;if(ia(gb)){if(ja(gb)=='r'){if(ya>0)if(ib&&la(ib)!='2'){var jb=[gb];while(ib&&ia(ib)&&ja(ib)=='r'){jb.push(ib);ib=ib.nextSibling;}if(ib){if(fa(ib)){var kb=ib.firstChild;l.prependContent(kb,jb);oa(kb);bb-=jb.length;}else l.insertBefore(gb,ib);eb--;}continue;}ya+=pa(gb);}else ya-=pa(gb);}else if(gb.id&&(ba[xa.id][gb.id]||ha(gb))){ba[xa.id][gb.id]=gb;continue;}else if(fa(gb)){ya=y.balance(gb,ya);}else if(la(gb)=='2'){if(ib&&ia(ib)&&ja(ib)=='r'&&ya<=0){l.insertBefore(gb,ib);eb--;}else{hb=true;ya=0;}}else if(hb){cb.push(gb);ya-=pa(gb);}else{var lb=false;if(!fb){while(ib&&(!ia(ib)||ja(ib)!='r'))ib=ib.nextSibling;if(ib){l.insertBefore(gb,ib);eb--;lb=true;}else fb=true;}if(!lb){db.push(gb);ya+=pa(gb);}}}ma(xa,true);if(za&&za.nothrottle){ta(xa,cb,db);ua(xa);}else{clearTimeout(da[xa.id]);da[xa.id]=setTimeout(function(){u.getInstance('positionUnits').debounce(ta.curry(xa,cb,db),xa.id);delete da[xa.id];},50);clearTimeout(ca[xa.id]);ca[xa.id]=setTimeout(function(){u.getInstance('adjustPlaceholders').debounce(ua.curry(xa),xa.id);delete ca[xa.id];},150);}return ya;}};})();e.exports=a.TimelineCapsule||y;});
__d("legacy:TimelineCapsule",["TimelineCapsule"],function(a,b,c,d){a.TimelineCapsule=b('TimelineCapsule');},3);
var TimelineComposerUtilities=(function(){var a=86400*31,b=86400000;return {listenToSetEstimatedDate:function(c,d){return Arbiter.subscribe('TimelineBackdatedComposerTagger/initialized',function(event,e){if(e.composer===c)Bootloader.loadComponents('TimelineContentLoader',function(){e.date_picker.subscribe('initialized',function(f,g){TimelineComposerUtilities.setEstimatedDate(g,d());});});});},listenToPublish:function(c,d){return Arbiter.subscribe('composer/publish',function(event,e){if(e.composer===c)Bootloader.loadComponents('TimelineStoryPublisher',function(){TimelineStoryPublisher.publish(e);d&&d();});});},listenToAnotherComposerOpen:function(c,d){return Arbiter.subscribe('composer/mutate',function(e,f){if(f!==c)d();});},listenToCancel:function(c,d){return Event.listen(c,'click',function(event){Parent.byClass(event.getTarget(),'cancelBtn')&&d();});},hidePlaceIfAttachmentsTooTall:function(c){var d=DOM.find(c,'ul.fbTimelineComposerAttachments'),e=Vector2.getElementDimensions(d).y;if(e>50){var f=Parent.byTag(DOM.scry(d,'span.placeAttachment')[0],'li');f&&CSS.hide(f);}},setEstimatedDate:function(c,d){var e,f;if(d&&CSS.hasClass(d,'fbTimelineCapsule')){e=d.getAttribute('data-start');f=d.getAttribute('data-end');if(e&&f){var g=new Date(f*1000);if(f-e>2*a){c.setDate(g.getFullYear());}else c.setDate(g.getFullYear(),g.getMonth()+1);}return;}var h=Parent.byClass(d,'fbTimelineCapsule');if(h){e=h.getAttribute('data-start');f=h.getAttribute('data-end');var i=Vector2.getElementPosition(d).y,j=[f,null],k=[e,null],l=TimelineCapsule.getUnitsWithTime(h);for(var m=0;m<l.length;m++){var n=l[m],o=DOM.scry(n.parentNode,'.spinePointer')[0];if(!o)continue;var p=Vector2.getElementPosition(o).y;if(p<=i){if(!j[1]||p>j[1])j=[n.getAttribute('data-time'),p];}else if(!k[1]||p<k[1])k=[n.getAttribute('data-time'),p];}if(j[0]!==null&&k[0]!==null){var q=Math.round((parseInt(j[0],10)+parseInt(k[0],10))/2)*1000;q=Math.min(new Date()-b,q);c.setDateWithTimestamp(q);}}}};})();
var TimelineBackdatedComposer=(function(){var a;function b(){c();d();}function c(){a.hide();}function d(){Bootloader.loadComponents('TimelineMLE',function(){var e=TimelineMLE.getFlyout();if(e&&CSS.hasClass(e.getContext(),'backdatedDot'))TimelineMLE.hideFlyout();});}return {init:function(e,f){a=f;var g=[TimelineComposerUtilities.listenToPublish(e,b),TimelineComposerUtilities.listenToAnotherComposerOpen(e,b),TimelineComposerUtilities.listenToSetEstimatedDate(e,a.getContext.bind(a)),e.subscribeToMutate(function(){var i=!DOM.scry(e.root,'.cancelBtn')[0]||DOM.scry(e.root,'.attachmentLifeEvents')[0];if(i){a.enableBehavior(LayerHideOnBlur);}else a.disableBehavior(LayerHideOnBlur);}),Arbiter.subscribe('TimelineMLE/mleFlyoutShown',function(i,j){if(CSS.hasClass(j.getContext(),'backdatedDot')){c();}else b();}),Arbiter.subscribe(TimelineNavigation.UPDATE_PAGE,b)],h=TimelineComposerUtilities.listenToCancel(a.getContent(),b);onleaveRegister(function(){g.forEach(Arbiter.unsubscribe.bind(Arbiter));g=[];h.remove();h=null;});Arbiter.inform('TimelineBackdatedComposer/initialized');},getFlyout:function(){return a;}};})();
var TimelineComposer=(function(){var a;function b(f){if(f.isScheduledPost)return;if(!f.streamStory){window.location.reload();return;}if(f.backdatedTime){Bootloader.loadComponents('TimelineStoryPublisher',function(){TimelineStoryPublisher.publish(f);});return;}var g=Parent.byClass(a,'fbTimelineCapsule');if(!g)return;var h=Parent.byClass(a,'timelineUnitContainer').parentNode;if(h.nextSibling.getAttribute('data-spine'))h=h.nextSibling;unit_node=DOM.insertAfter(h,f.streamStory)[0];Bootloader.loadComponents('animation',function(){animation(unit_node.firstChild).from('backgroundColor','#fff8dd').to('backgroundColor','#fff').duration(2000).ease(animation.ease.both).go();});TimelineCapsule.setFirstUnit(g);TimelineCapsule.balanceCapsule(g);}function c(){var f=Parent.byClass(a,'fbTimelineTwoColumn');return DOM.find(f,'.spinePointer');}function d(f){var g=e();CSS.show(g);var h=f.subscribe('hide',function(){CSS.hide(g);f.unsubscribe(h);});}function e(){var f=Parent.byClass(a,'fbTimelineTwoColumn'),g=DOM.scry(f,'div.composerVeil');if(g.length!==1)g=DOM.appendContent(f,$N('div',{className:'composerVeil hidden_elem'}));return g[0];}return {init:function(f){a=$(f);var g=Arbiter.subscribe('composer/publish',function(event,h){if(h.composer.root===a)b(h);});onleaveRegister(function(){g.unsubscribe();});TimelineComposerUtilities.hidePlaceIfAttachmentsTooTall(a);},showMLEFlyout:function(f){f.setContext(c()).show();d(f);}};})();
__d("legacy:TimelineContentLoader",["TimelineContentLoader"],function(a,b,c,d){a.TimelineContentLoader=b('TimelineContentLoader');},3);
function TimelineCoverDisclaimer(a,b,c){if(TimelineCoverDisclaimer.displayed===undefined){TimelineCoverDisclaimer.displayed=true;}else return;new Dialog().setModal(true).setTitle(a).setBody(b).setButtonsMessage(c).setButtons(Dialog.OK).show();}
requireLazy(['Selector'],function(a){add_properties('__behaviors',{});if(__behaviors.TimelineCurationControl)return;__behaviors.TimelineCurationControl=true;a.subscribe('open',function(b,c){var d=c.selector,e=c.clone||d,f=Parent.byClass(e,'fbTimelineCurationControl');if(f){CSS.addClass(f,'editControlsMenuOpen');var g=a.subscribe('close',function(h,i){if(i.selector==d){a.unsubscribe(g);CSS.removeClass.curry(f,'editControlsMenuOpen').defer();}});}});});
var TimelineLogging=(function(){var a=false,b=0,c=null;return {init:function(d){if(a)return;b=d;TimelineController.register(TimelineController.LOGGING,this);},reset:function(){a=false;b=0;c=null;},log:function(d,e){e.profile_id=b;report_data(d,{gt:e});},logSectionChange:function(d,e){var f={timeline_section_change:1,key:d};if(c&&d==c){f.timeline_scrubber=1;c=null;}TimelineLogging.log('timeline',f);},logScrubberClick:function(d){c=d;}};})();
__d("legacy:TimelinePerfConfig",["TimelinePerfConfig"],function(a,b,c,d){a.TimelinePerfConfig=b('TimelinePerfConfig');},3);
__d("legacy:TimelineThrottler",["TimelineThrottler"],function(a,b,c,d){a.TimelineThrottler=b('TimelineThrottler');},3);
function TimelineSpine(){}copy_properties(TimelineSpine,{OFFSET_Y:12,composerFlyout:null,mleFlyout:null,dot:null,loadComposerFlyoutCalled:false,showComposerFlyout:function(a){var b=TimelineSpine.composerFlyout;if(!b){TimelineSpine.loadComposerFlyout(a);TimelineSpine.showComposerFlyoutOnLoad=true;return;}var c=DOM.find(b.getContent(),'div.fbTimelineBackdatedComposer'),d=Composer.getInstance(c);if(d){d.reset();CSS.removeClass(d.root,'uiComposerOpen');}b.enableBehavior(LayerHideOnBlur).setContext(TimelineSpine.dot).updatePosition();b.show();TimelineComposerUtilities.hidePlaceIfAttachmentsTooTall(c);},loadComposerFlyout:function(a){if(TimelineSpine.loadComposerFlyoutCalled||TimelineSpine.composerFlyout)return;TimelineSpine.loadComposerFlyoutCalled=true;onleaveRegister(function(){TimelineSpine.loadComposerFlyoutCalled=false;TimelineSpine.composerFlyout=null;}.bind(this));new AsyncRequest().setURI('/ajax/timeline/backdated_composer.php').setData({targetid:a}).setRelativeTo(TimelineSpine.dot||document.body).send();var b=Arbiter.subscribe('TimelineBackdatedComposer/initialized',function(){TimelineSpine.composerFlyout=TimelineBackdatedComposer.getFlyout();if(TimelineSpine.showComposerFlyoutOnLoad)TimelineSpine.showComposerFlyout(a);TimelineSpine._handleComposerFlyoutDismissed();b.unsubscribe();});},showMLEFlyout:function(a){TimelineSpine.mleFlyout=a;a.setContext(TimelineSpine.dot).show();TimelineSpine.composerFlyout.hide();},_handleComposerFlyoutDismissed:function(){var a=Layer.subscribe('hide',function(b,c){if(TimelineSpine.dot&&c.getContext)if(c.getContext()===TimelineSpine.dot&&!TimelineSpine.mleFlyout){TimelineSpine._hideDot();}else if(c===TimelineSpine.mleFlyout){TimelineSpine.mleFlyout=null;TimelineSpine._hideDot();}});onleaveRegister(function(){Layer.unsubscribe(a);}.bind(this));},_hideDot:function(){DOM.remove(TimelineSpine.dot);TimelineSpine.dot=null;}});copy_properties(TimelineSpine.prototype,{init:function(a,b){this._spine=a;if(!TimelinePerfConfig.getDisableSpineHeight())this._spineHeight=a.offsetHeight;this._plus=DOM.find(a,'.spineHoverPlus');this._capsule=Parent.byClass(a,'fbTimelineCapsule');this._targetid=b;var c=[Event.listen(a,'mouseenter',function(event){TimelineSpine.loadComposerFlyout(this._targetid);this._spineHeight=a.offsetHeight;}.bind(this)),Event.listen(a,'mousemove',this._mouseMoved.bind(this)),Event.listen(a,'click',this._spineClicked.bind(this))];CSS.addClass(this._plus,'spineHoverPlusActive');onleaveRegister(function(){while(c.length)c.pop().remove();}.bind(this));},_mouseMoved:function(event){var a=event.offsetY||event.layerY,b=event.getTarget();if(b!==this._spine)a=b.offsetTop+a;a=Math.min(Math.max(a-TimelineSpine.OFFSET_Y,0),this._spineHeight);this._plus.style.top=a+'px';},_spineClicked:function(event){if(TimelineSpine.mleFlyout){Bootloader.loadComponents('TimelineMLE',TimelineMLE.hideFlyout);return;}TimelineSpine.dot&&DOM.remove(TimelineSpine.dot);TimelineSpine.dot=$N('i',{className:'backdatedDot'});TimelineSpine.dot.style.top=(this._plus.offsetTop-1)+'px';DOM.appendContent(this._spine,TimelineSpine.dot);event.stop();TimelineSpine.showComposerFlyout(this._targetid);}});
__d("TimelineRecentActivity",["event-extensions","CSS","DOM","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('Parent'),j={registerPager:function(k){Event.listen(k,'click',function(l){var m=i.byClass(l.target,'timelineRecentActivityStories');h.remove(k.parentNode);h.scry(m,'.hidden_elem.timelineRecentActivityStory').forEach(g.show);return false;});}};e.exports=j;});
function TimelineScrubber(a){this._root=a;this._navKeys={};this._subNavKeys={};this._rollups={};this._rolledup={};var b=a.childNodes;this._currentNav=b[0];for(var c=0;c<b.length;c++){var d=b[c].getAttribute('data-key');this._navKeys[d]=b[c];var e=DOM.scry(b[c],'ul');this._subNavKeys[d]={};if(e.length){var f=e[0].childNodes;for(var g=0;g<f.length;g++)this._subNavKeys[d][f[g].getAttribute('data-key')]=f[g];}var h=b[c].getAttribute('data-rollup');if(h){this._rollups[h]=this._rollups[h]||[];this._rollups[h].push(b[c]);}}this._clickListener=Event.listen(this._root,'click',this._handleScrub.bind(this));CSS.show(this._root);var i=Vector2.getViewportDimensions().y-this.SCRUBBER_NO_ADS_VERTICAL_BUFFER,j=this.getHeight();if(j>i)this.fold(j-i);TimelineController.register(TimelineController.SCRUBBER,this);TimelineController.scrubberHasLoaded(this);}copy_properties(TimelineScrubber.prototype,{KEY_HEIGHT:23,SUBKEY_HEIGHT:16,OFFSET:38,SCRUBBER_NO_ADS_VERTICAL_BUFFER:125,reset:function(){this._root=null;this._navKeys={};this._subNavKeys={};this._rollups={};this._rolledup={};},getRoot:function(){return this._root;},getNav:function(a){return this._navKeys[a];},getSubnav:function(a,b){return this._subNavKeys[a][b];},getHeight:function(){return this._root.offsetHeight;},getLabelForNav:function(a){var b=this.getNav(a);return b&&DOM.getText(DOM.scry(b,'a')[0]);},getLabelForSubnav:function(a,b){var c=this.getSubnav(a,b);return c&&DOM.getText(DOM.scry(c,'a')[0]);},fold:function(a){return this._adjustFolding(a,true);},unfold:function(a){return this._adjustFolding(a,false);},getOffset:function(){return this.OFFSET;},updateSection:function(a,b){var c=this._navKeys[a].getAttribute('data-rollup');if(this._currentRollup&&this._currentRollup!=c){CSS.removeClass(this._currentRollup,'selected');CSS.removeClass(DOM.scry(this._currentRollup,'ul')[0],'loaded');delete this._currentRollup;}if(c&&this._rolledup[c]){var d=this._rolledup[c];if(d.getAttribute('data-rollup')){this._currentRollup=d;CSS.addClass(this._currentRollup,'selected');CSS.addClass(DOM.scry(this._currentRollup,'ul')[0],'loaded');}}this._currentNav&&CSS.removeClass(this._currentNav,'selected');this._currentSubNav&&CSS.removeClass(this._currentSubNav,'selected');this._currentNav=null;this._currentSubNav=null;if(this._navKeys[a]){this._currentNav=this._navKeys[a];CSS.addClass(this._currentNav,'selected');if(this.decadesAreSelectable&&this._navKeys[b]){this._currentSubNav=this._navKeys[b];CSS.addClass(this._currentSubNav,'selected');}else if(b&&this._subNavKeys[a][b]){this._currentSubNav=this._subNavKeys[a][b];CSS.addClass(this._currentSubNav,'selected');}}},_getRollupSize:function(a){var b=this._currentNav,c=b&&b.getAttribute('data-rollup'),d=this.KEY_HEIGHT*(this._rollups[a].length-1);if(a==c){d+=this.SUBKEY_HEIGHT*DOM.scry(b,'li').length;d-=this.SUBKEY_HEIGHT*(this._rollups[a].length-1);}return d;},_adjustFolding:function(a,b){var c=a,d=keys(this._rollups);while(a>0&&d.length){var e=d[b?'pop':'shift']();if(!b==!this._rolledup[e])continue;var f=this._getRollupSize(e);if(f<=0)continue;if(!b&&f>a)break;this[b?'_collapseRollup':'_expandRollup'](e);a-=f;}return c-a;},_collapseRollup:function(a){var b=this._rollups[a];if(!b||b.length<2||this._rolledup[a])return;var c=b[0].previousSibling,d=b[0],e=$N('a',{href:d.firstChild.href,rel:'ignore'},[a]),f=$N('ul',{className:'clearfix'});for(var g=0;g<b.length;g++)f.appendChild(b[g]);var h=$N('li',{},[e,f]);if(this.decadesAreSelectable){var i=b[b.length-1],j=d.getAttribute('data-key')+i.getAttribute('data-key');h.setAttribute('data-start',i.getAttribute('data-start'));h.setAttribute('data-end',d.getAttribute('data-end'));h.setAttribute('data-key',j);this._navKeys[j]=h;}else h.setAttribute('data-key',d.getAttribute('data-key'));h.setAttribute('data-rollup',a);if(c){DOM.insertAfter(c,h);}else DOM.prependContent(this._root,h);this._rolledup[a]=h;this._checkSelection();},_expandRollup:function(a){if(!this._rolledup[a])return;var b=this._rolledup[a],c=DOM.scry(b,'ul')[0],d=document.createDocumentFragment();while(c.childNodes.length)d.appendChild(c.firstChild);DOM.replace(b,d);this._rolledup[a]=false;this._checkSelection();},_checkSelection:function(){if(this._currentNav){var a=this._currentSubNav&&this._currentSubNav.getAttribute('data-key');this.updateSection(this._currentNav.getAttribute('data-key'),a);}},_handleScrub:function(event){var a=event.getModifiers();if(event.isMiddleClick()||a.access||a.meta)return true;var b=Parent.byTag(event.getTarget(),'a'),c=b&&Parent.byAttribute(b,'data-key');if(c){TimelineController.scrubberWasClicked(c.getAttribute('data-key'));TimelineController.navigateToSection(c.getAttribute('data-key'));return event.prevent();}}});
function TimelineMainScrubber(a){this.parent.construct(this,a);this._subscribe=Arbiter.subscribe(TimelineController.SECTION_LOADED,function(b,c){var d=this._navKeys[c.key],e=d&&DOM.scry(d,'ul')[0];if(e){CSS.addClass(e,'loaded');TimelineController.scrubberHasChangedState();if(c.hideSubSections)CSS.hide(e);}}.bind(this));}Class.extend(TimelineMainScrubber,'TimelineScrubber');copy_properties(TimelineMainScrubber.prototype,{reset:function(){this.parent.reset();this._subscribe&&this._subscribe.unsubscribe();}});
var SubscribeButton=window.SubscribeButton||(function(){return {init:function(a,b,c,d){Event.listen(b,'click',function(){Arbiter.inform('FollowingUser',{profile_id:d});});Arbiter.subscribe('FollowingUser',function(e,f){if(d===f.profile_id)a.swap();});Arbiter.subscribe('UnfollowingUser',function(e,f){if(d===f.profile_id){a.unswap();c.hideFlyout();Arbiter.inform('SubMenu/Reset');}});},initUnsubscribe:function(a,b){Event.listen(a,'click',function(){Arbiter.inform.bind(Arbiter,'UnfollowingUser',{profile_id:b}).defer();});}};})();
var FBXLoadMoreExperiences={reveal:function(a,b){var c=a.offsetHeight;b=DOM.replace(a,b)[0];animation(b).from('height',c).to('height','auto').duration(400).blind().ease(animation.ease.both).go();}};