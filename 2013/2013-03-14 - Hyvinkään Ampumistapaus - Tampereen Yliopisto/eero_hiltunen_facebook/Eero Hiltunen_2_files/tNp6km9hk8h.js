/*1337733507,169775812*/

if (window.CavalryLogger) { CavalryLogger.start_js(["JKUWR"]); }

__d("legacy:curry",["curry"],function(a,b,c,d){a.curry=b('curry');},3);
__d("DOMWrapper",[],function(a,b,c,d,e,f){var g,h,i={setRoot:function(j){g=j;},getRoot:function(){return g||document.body;},setWindow:function(j){h=j;},getWindow:function(){return h||window;}};e.exports=i;});
__d("QueryString",[],function(a,b,c,d,e,f){var g={encode:function(h){var i=[];Object.keys(h).forEach(function(j){var k=h[j];if(typeof k==='undefined')return;if(k===null){i.push(j);return;}i.push(encodeURIComponent(j)+'='+encodeURIComponent(k));});return i.join('&');},decode:function(h){var i={};if(h==='')return i;var j=h.split('&'),k=j.length;while(k--){var l=j[k].split('=',2);i[decodeURIComponent(l[0])]=l.length===2?decodeURIComponent(l[1]):null;}return i;},appendToUrl:function(h,i){return h+(~h.indexOf('?')?'&':'?')+(typeof i==='string'?i:g.encode(i));}};e.exports=g;});
__d("guid",[],function(a,b,c,d,e,f){function g(){return 'f'+(Math.random()*(1<<30)).toString(16).replace('.','');}e.exports=g;});
__d("Flash",["DOMWrapper","QueryString","UserAgent","copyProperties","guid"],function(a,b,c,d,e,f){var g=b('DOMWrapper'),h=b('QueryString'),i=b('UserAgent'),j=b('copyProperties'),k=b('guid'),l={},m,n=g.getWindow().document;function o(t){var u=n.getElementById(t);if(u)u.parentNode.removeChild(u);delete l[t];}function p(){for(var t in l)if(l.hasOwnProperty(t))o(t);}function q(t){return t.replace(/\d+/g,function(u){return '000'.substring(u.length)+u;});}function r(t){if(!m){if(i.ie()>=9)window.attachEvent('onunload',p);m=true;}l[t]=t;}var s={embed:function(t,u,v,w){var x=k();t=encodeURI(t);v=j({allowscriptaccess:'always',flashvars:w,movie:t},v||{});if(typeof v.flashvars=='object')v.flashvars=h.encode(v.flashvars);var y=[];for(var z in v)if(v.hasOwnProperty(z)&&v[z])y.push('<param name="'+encodeURI(z)+'" value="'+encodeURI(v[z])+'">');var aa=n.createElement('div'),ba='<object '+(i.ie()?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ':'type="application/x-shockwave-flash"')+'data="'+t+'" '+'id="'+x+'">'+y.join('')+'</object>';aa.innerHTML=ba;var ca=u.appendChild(aa.firstChild);r(x);return ca;},remove:o,getVersion:function(){var t='Shockwave Flash',u='application/x-shockwave-flash',v='ShockwaveFlash.ShockwaveFlash',w;if(navigator.plugins&&typeof navigator.plugins[t]=='object'){var x=navigator.plugins[t].description;if(x&&navigator.mimeTypes&&navigator.mimeTypes[u]&&navigator.mimeTypes[u].enabledPlugin)w=x.match(/\d+/g);}if(!w)try{w=(new ActiveXObject(v)).GetVariable('$version').match(/(\d+),(\d+),(\d+),(\d+)/);w=Array.prototype.slice.call(w,1);}catch(y){}return w;},checkMinVersion:function(t){var u=s.getVersion();if(!u)return false;return q(u.join('.'))>=q(t);},isAvailable:function(){return !!s.getVersion();}};e.exports=s;});
__d("PhotosUploadWaterfall",["AsyncSignal"],function(a,b,c,d,e,f){var g=b('AsyncSignal'),h={INSTALL_CANCEL:1,INSTALL_INSTALL:2,INSTALL_UPDATE:3,INSTALL_REINSTALL:4,INSTALL_PERMA_CANCEL:5,INSTALL_SILENT_SKIP:6,INSTALL_DOWNLOAD:7,BEGIN:1,INSTALL:2,READY:3,UPLOAD_START:4,ALL_UPLOADS_DONE:6,IMAGES_SELECTED:9,PROCESSING_DONE:10,UPGRADE_REQUIRED:11,UPGRADE_CLICK:12,PAGE_RENDERED:13,PRELOAD_CLICK:14,VERSION:15,COMPRESSOR_READY:17,CANCEL:22,MULLIGAN2_INSTALL_START:31,MULLIGAN2_INSTALL_SUCCESS:32,MULLIGAN2_INSTALL_FAIL:33,MULLIGAN2_UPLOAD_FAIL:35,MULLIGAN2_INSTALL_WAIT_TIMEOUT:36,MULLIGAN2_UPLOAD_RETRYING:37,MULLIGAN2_UPLOAD_CANCELED:38,UPLOAD_STARTED:43,PROGRESS_BAR_STOPPED:44,MISSED_BEAT:45,HEART_ATTACK:46,sendSignal:function(i,j){new g('/ajax/photos/waterfall.php',{data:JSON.stringify(i)}).setHandler(j).send();}};e.exports=h;});
__d("UploadEvent",[],function(a,b,c,d,e,f){var g={DONE:'UploadEvent/DONE',ERROR:'UploadEvent/ERROR',FINISHED_UPLOADING:'UploadEvent/FINISHED_UPLOADING',LOADED:'UploadEvent/LOADED',READY:'UploadEvent/READY',UPLOAD_FAILED:'UploadEvent/UPLOAD_FAILED',UPLOAD_PROGRESS:'UploadEvent/UPLOAD_PROGRESS',COMPRESS_PROGRESS:'UploadEvent/COMPRESS_PROGRESS',HI_RES_ATTACH_START:'UploadEvent/HI_RES_ATTACH_START',IMAGE_COMPRESS_ERROR:'UploadEvent/IMAGE_COMPRESS_ERROR',IMAGE_COMPRESSED:'UploadEvent/IMAGE_COMPRESSED',IMAGE_UPLOAD_ERROR:'UploadEvent/IMAGE_UPLOAD_ERROR',IMAGE_UPLOADED:'UploadEvent/IMAGE_UPLOADED',IMAGES_SELECTED:'UploadEvent/IMAGES_SELECTED',SELECT_CANCELED:'UploadEvent/SELECT_CANCELED',SELECT_DOWN:'UploadEvent/SELECT_DOWN',SELECT_OUT:'UploadEvent/SELECT_OUT',SELECT_OVER:'UploadEvent/SELECT_OVER',SELECT_UP:'UploadEvent/SELECT_UP',HEARTBEAT:'UploadEvent/HEARTBEAT'};e.exports=g;});
__d("FlashUploadController",["array-extensions","Arbiter","AsyncRequest","PhotosUploadWaterfall","Flash","UploadEvent","$","copyProperties","createArrayFrom","getObjectValues"],function(a,b,c,d,e,f){b('array-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('PhotosUploadWaterfall'),j=b('Flash'),k=b('UploadEvent'),l=b('$'),m=b('copyProperties'),n=b('createArrayFrom'),o=b('getObjectValues');function p(q,r,s,t,u){p.init();m(this,{_isRecognitionFinished:false,_flashIDs:[],_initialMaxSelectable:r.maxSelectable,_addedPostParams:[],_queue_name:r.qn,_on_flash_error:s,_albumLimitExceeded:0,_uploading:false,_heartbeats:{},_stopHeartbeat:false,_isReady:{},_errors:[],_subscriptions:[],_recognitionConfig:{pollAttempts:r.recognitionPollAttempts,pollPeriod:r.recognitionPollPeriod,url:r.recognitionUrl,aid:r.aid,owner:r.owner},_flashStats:{},_uploaderName:r.uploaderName});this.registerSwf(q);if(!this.checkMinimumFlash(r.flashVersionInfo.minimumVersion)){i.sendSignal({qn:r.qn,step:i.UPGRADE_REQUIRED,uploader:this._uploaderName});t&&t(p.ERROR_FLASH_UPGRADE_REQUIRED);return;}['flash/ready','flash/failed',k.DONE,k.ERROR,k.FINISHED_UPLOADING,k.IMAGES_SELECTED,k.READY,k.UPLOAD_FAILED,k.UPLOAD_PROGRESS,k.HEARTBEAT].forEach(this._subscribe.bind(this,g.SUBSCRIBE_ALL));var v=g.subscribe('page_transition',function(){this.destroy();v.unsubscribe();}.bind(this),g.SUBSCRIBE_NEW);if(!this.checkMinimumFlash([r.flashVersionInfo.latestVersion]))u&&u();window.setTimeout(function(){if(!this.isReady())s(p.ERROR_FLASH_LOAD_TIMEOUT);}.bind(this),r.flashLoadTimeout);}m(p,{ERROR_FLASH_LOAD_TIMEOUT:1,ERROR_FLASH_LOAD_FAILURE:2,ERROR_FLASH_UPGRADE_REQUIRED:3,_inited:false,init:function(){if(this._inited)return;this._inited=true;}});m(p.prototype,{destroy:function(){while(this._subscriptions.length)g.unsubscribe(this._subscriptions.pop());},_subscribe:function(q,r){this._subscriptions.push(g.subscribe(r,this.arbiterFilter.bind(this),q));},registerSwf:function(q){if(!this._flashIDs.contains(q)){this._flashIDs.push(q);this._flashStats[q]=null;}},_sumStat:function(q){var r=0;o(this._flashStats).forEach(function(s){if(s&&s[q])r+=s[q];});return r;},getMaxSelectable:function(){if(this._initialMaxSelectable===-1)return -1;var q=this._initialMaxSelectable-this.getImagesSelected()+this.getImagesFailed();return Math.max(q,0);},getImagesUploaded:function(){return this._sumStat('filesUploaded');},getImagesFailed:function(){return this._sumStat('filesFailed');},getImagesSelected:function(){return this._sumStat('totalFiles');},isAlbumLimitExceeded:function(){return this._albumLimitExceeded;},isReady:function(){var q=true;this._flashIDs.forEach(function(r){if(!this._isReady[r])q=false;}.bind(this));return q;},isUploading:function(){return this._uploading;},getPercentComplete:function(){var q=this._sumStat('originalFileBytesUploaded'),r=this._sumStat('totalOriginalFileBytes');return q/r*100;},getErrors:function(){return this._errors;},checkMinimumFlash:function(q){for(var r=0;r<q.length;++r)if(j.checkMinVersion(q[r].toString()))return true;return false;},setAid:function(q){this._callAllSWFs(true,'setAid',q);this._recognitionConfig.aid=q;},handleImagesSelected:function(q){this._albumLimitExceeded=q.maxReached;this._flashStats[q.divID]=q.stats;this._callAllSWFs(true,'setMaxSelectable',this.getMaxSelectable());i.sendSignal({qn:this._queue_name,step:i.IMAGES_SELECTED,count:q.count,uploader:this._uploaderName});},addPostParam:function(q,r){this._addedPostParams.push({name:q,value:r});this._flashIDs.forEach(function(s,t){var u=this._flash(t);u.addPostParam&&u.addPostParam(q,r);}.bind(this));},markDeleted:function(q){this._callAllSWFs(false,'markDeleted',q);this.refreshStats();this._callAllSWFs(false,'setMaxSelectable',this.getMaxSelectable());},isEventIntendedForMe:function(q){return 'divID' in q&&this._flashIDs.contains(q.divID);},arbiterFilter:function(q,r){if(!this.isEventIntendedForMe(r))return;switch(q){case 'flash/failed':this.handleFlashFailed();return;case 'flash/ready':this.handleFlashReady.bind(this,r).defer();return;case k.UPLOAD_FAILED:this._uploading=false;return;case k.IMAGES_SELECTED:this.handleImagesSelected(r);return;case k.FINISHED_UPLOADING:this.handleFinishedUploading(r);return;case k.ERROR:this._errors.push(r.metrics);this._flashStats[r.divID]=r.stats;this._callAllSWFs(true,'setMaxSelectable',this.getMaxSelectable());return;case k.UPLOAD_PROGRESS:this._flashStats[r.divID]=r.stats;return;case k.HEARTBEAT:this._heartbeats[r.divID]={stamp:r.timestamp,timer:null};return;default:return;}},handleFinishedUploading:function(q){this._uploading=false;if(this.uploadImages())return;i.sendSignal({qn:this._queue_name,step:i.ALL_UPLOADS_DONE,uploader:this._uploaderName});if(this._frecId&&this._recognitionConfig.url&&!this._recognitionStarted){this._recognitionStarted=true;this.startRecognition();}else this.recognitionFinished();},recognitionFinished:function(){this._isRecognitionFinished=true;g.inform(k.DONE,{divID:this._flashIDs[0]});},isRecognitionFinished:function(){return this._isRecognitionFinished;},handleFlashReady:function(q){if(!this._isReady[q.divID])this._isReady[q.divID]=true;var r=this._flash(this._flashIDs.indexOf(q.divID));this._addedPostParams.forEach(function(s){r.addPostParam(s.name,s.value);});this._callAllSWFs(true,'setMaxSelectable',this.getMaxSelectable());g.inform(k.READY,q);this._heartbeats[q.divID]={stamp:+new Date(),timer:null};this._heartbeat(q.divID);},_heartbeat:function(q){if(this._stopHeartbeat)return;var r=7500,s=+new Date();this._heartbeats[q].stamp<(s-r*2);this._heartbeats[q].timer&&clearTimeout(this._heartbeats[q].timer);this._heartbeats[q].timer=this._heartbeat.bind(this,q).defer(r,true);try{this._flash(this._flashIDs.indexOf(q)).heartbeat(s);}catch(t){}},handleFlashFailed:function(){if(this._on_flash_error)this._on_flash_error(p.ERROR_FLASH_LOAD_FAILURE);},_callAllSWFs:function(q,r){var s=n(arguments).slice(2,arguments.length);for(var t=0;t<this._flashIDs.length;t++){var u=this._flash(t),v=u[r];if(typeof v!=='function')continue;if(q){(function(x,y){try{x.apply(y,s);}catch(z){}}).bind(this,v,u).defer();}else try{v.apply(u,s);}catch(w){}}},_flash:function(q){var r=this._flashIDs[q||0];return l(r);},refreshStats:function(){for(var q=0;q<this._flashIDs.length;q++){var r=this._flash(q);if(r&&r.getStats)this._flashStats[this._flashIDs[q]]=r.getStats();}},getStats:function(q){var r={elapsedTime:0,estimatedTotalTime:null,estimatedTimeToComplete:null,percentCompleted:0,nextPercentTarget:0,estimatedTimeToNextTarget:null,filesUploaded:0,filesFailed:0,bytesUploaded:0,originalFileBytesUploaded:0,totalOriginalFileBytes:0,totalFiles:0,nextFileSize:0};if(q)this.refreshStats();o(this._flashStats).forEach(function(s){if(s){r.elapsedTime+=s.elapsedTime;r.filesUploaded+=s.filesUploaded;r.filesFailed+=s.filesFailed;r.bytesUploaded+=s.bytesUploaded;r.originalFileBytesUploaded+=s.originalFileBytesUploaded;r.totalOriginalFileBytes+=s.totalOriginalFileBytes;r.totalFiles+=s.totalFiles;r.nextFileSize+=s.nextFileSize;}});r.estimatedTotalTime=r.elapsedTime*r.totalOriginalFileBytes/r.originalFileBytesUploaded;r.estimatedTimeToComplete=r.estimatedTotalTime-r.elapsedTime;r.percentCompleted=r.originalFileBytesUploaded/r.totalOriginalFileBytes*100;r.nextPercentTarget=(r.originalFileBytesUploaded+r.nextFileSize)/r.totalOriginalFileBytes*100;r.estimatedTimeToNextTarget=r.elapsedTime*r.nextFileSize/r.originalFileBytesUploaded;if(r.originalFileBytesUploaded===0){r.estimatedTimeToNextTarget=null;r.estimatedTotalTime=null;r.estimatedTimeToComplete=null;}return r;},uploadImages:function(){if(!this.getImagesSelected())return false;if(this._uploading)return true;for(var q=0;q<this._flashIDs.length;q++){var r=this._flashStats[this._flashIDs[q]];if(r&&r.totalFiles>(r.filesUploaded+r.filesFailed)){var s=this._flash(q);if(typeof s.uploadClick!=='function')continue;(function(t,u){this._flashStats[u]=t.uploadClick();}).bind(this,s,this._flashIDs[q]).defer();i.sendSignal({qn:this._queue_name,step:i.UPLOAD_START,count:this.getImagesSelected(),uploader:this._uploaderName});this._uploading=true;return true;}}return false;},getRoot:function(){return l(this._flashIDs[0]);},copyWidth:function(q,r){r=r||this._flashIDs[0];var s=l(r).style;s.width=q.offsetWidth+'px';s.height=q.offsetHeight+'px';},setHiRes:function(q){this._flashIDs.forEach(function(r,s){var t=this._flash(s);if(typeof t.setHiResUpload!=='function')return;var u=t.setHiResUpload(q);this._flashStats[r]=u;if(u&&u.filesUploaded<u.totalFiles)this._uploading=true;}.bind(this));},testFlashUpload:function(){this._flash().testUploader();},testSelectFilesByUrl:function(q,r,s){return this._flash(s).testSelectFilesByUrl(q,r);},setFrecId:function(q){this._frecId=q;this.addPostParam('frecId',q);},getFrecId:function(){return this._frecId;},getRecognitionTimeEstimate:function(){return this._recognitionConfig.pollPeriod*this._recognitionConfig.pollAttempts;},startRecognition:function(){new h().setURI(this._recognitionConfig.url).setData({uid:this._recognitionConfig.owner,aid:this._recognitionConfig.aid,frecId:this._frecId,phase:1}).send();this._recognitionPolls=0;this._recognitionTimeout=window.setTimeout(this.checkRecognitionProgress.bind(this),this._recognitionConfig.pollPeriod);},cancelUpload:function(){this._uploading=false;this._stopHeartbeat=true;this._flashIDs.forEach(function(q,r){(q in this._heartbeats)&&this._heartbeats[q].timer&&clearInterval(this._heartbeats[q].timer);}.bind(this));this._callAllSWFs(true,'cancelUpload');},checkRecognitionProgress:function(){var q=this._recognitionConfig.pollPeriod;if(++this._recognitionPolls>=this._recognitionConfig.pollAttempts){this.recognitionFinished();return;}new h().setURI(this._recognitionConfig.url).setData({uid:this._recognitionConfig.owner,aid:this._recognitionConfig.aid,frecId:this._frecId,phase:2}).setHandler(function(r){var s=r.getPayload();if(!s||s.done){this.recognitionFinished();}else this._recognitionTimeout=window.setTimeout(this.checkRecognitionProgress.bind(this),q);}.bind(this)).setErrorHandler(function(r){this._recognitionTimeout=window.setTimeout(this.checkRecognitionProgress.bind(this),q);}.bind(this)).send();}});e.exports=p;});
__d("legacy:FlashUploadController",["FlashUploadController"],function(a,b,c,d){a.FlashUploadController=b('FlashUploadController');},3);
__d("legacy:photos-upload-waterfall",["PhotosUploadWaterfall"],function(a,b,c,d){a.PhotosUploadWaterfall=b('PhotosUploadWaterfall');},3);
__d("legacy:UploadEvent",["UploadEvent"],function(a,b,c,d){a.UploadEvent=b('UploadEvent');},3);
var FlashUploader=window.FlashUploader||function(){};FlashUploader.instances=window.FlashUploader.instances||{};copy_properties(FlashUploader.prototype,{init:function(a,b,c){this.copyConfig(c);this._flashID=b;this._selectButton=a;this._instanceId=a.id;FlashUploader.instances[this._instanceId]=this;this._controller=new FlashUploadController(b,c,this.onFlashLoadError.bind(this),this.onFlashUpgradeRequired.bind(this),this.onFlashUpgradeSuggested.bind(this));var d=Arbiter.subscribe('page_transition',function(){FlashUploader.instances={};d.unsubscribe();this.destroy();}.bind(this),Arbiter.SUBSCRIBE_NEW);onbeforeunloadRegister(this.handleBeforeUnload.bind(this));onunloadRegister(this.handleUnload.bind(this));this.initArbiter();this.parsePhotoSetToken();},onFlashLoadError:function(a){},onFlashUpgradeRequired:function(a){},onFlashUpgradeSuggested:function(){},initArbiter:function(){[UploadEvent.DONE,UploadEvent.ERROR,UploadEvent.FINISHED_UPLOADING,UploadEvent.LOADED,UploadEvent.READY,UploadEvent.UPLOAD_FAILED,UploadEvent.UPLOAD_PROGRESS,UploadEvent.HI_RES_ATTACH_START,UploadEvent.IMAGE_UPLOAD_ERROR,UploadEvent.IMAGE_UPLOADED,UploadEvent.IMAGES_SELECTED,UploadEvent.SELECT_CANCELED,UploadEvent.SELECT_DOWN,UploadEvent.SELECT_OUT,UploadEvent.SELECT_OVER,UploadEvent.SELECT_UP].forEach(this._subscribe.bind(this));},handleUpgradeHintClick:function(){PhotosUploadWaterfall.sendSignal({qn:this._qn,step:PhotosUploadWaterfall.UPGRADE_CLICK,uploader:this._uploaderName});},copyConfig:function(a){this.checkConfig(a);for(var b in a)this['_'+b]=a[b];copy_properties(this,{_closeOnComplete:true,_dialog:null,_fbx:false,_frecId:false,_hiResDone:false,_isBound:false,_locationSessionID:0,_locationTypeahead:null,_recognitionStarted:false,_showDoneOnComplete:false,_standardDone:false,_subscriptions:[]});},checkConfig:function(a){},destroy:function(){while(this._subscriptions.length)Arbiter.unsubscribe(this._subscriptions.pop());this._controller.destroy();},_subscribe:function(a){this._subscriptions.push(Arbiter.subscribe(a,this.arbiterFilter.bind(this)));},setAid:function(a){this._aid=a;this._controller.setAid(a);},getAid:function(a){return this._aid;},logDeadProgressBar:function(){PhotosUploadWaterfall.sendSignal({qn:this._qn,uploader:this._uploaderName,step:PhotosUploadWaterfall.PROGRESS_BAR_STOPPED,meta:this._controller.getStats(true)});},setUseSpecialAlbum:function(a){this.setAid('0');this._controller.addPostParam('album_type',a);if(this._targetId)this._controller.addPostParam('target_id',this._targetId);return this;},setPhotoSetToken:function(a){this._photoSetToken=a;this._controller.addPostParam('set_token',a);return this;},getPhotoSetToken:function(){return this._photoSetToken;},parsePhotoSetToken:function(){if(!this._photoSetToken)return;var a=this._photoSetToken.split('.');if(this._created||(a[0]&&!a[1])){this._createNewSet=true;this._closeOnComplete=false;}},setFrecId:function(a){this._controller.setFrecId(a);},getUploadQueryData:function(a){query_data={instance_id:this._instanceId,id:this._owner,'new':a};if(this._aid)query_data.aid=this._aid;if(this._targetId)query_data.target=this._targetId;if(this._photoSetToken)query_data.set=this._photoSetToken;return query_data;},arbiterFilter:function(a,b){},cancelUpload:function(){this._controller.cancelUpload();this._canceled=true;PhotosUploadWaterfall.sendSignal({qn:this._qn,uploader:this._uploaderName,step:PhotosUploadWaterfall.CANCEL,meta:{method:'add-more-cancel'}});},cancelNewAlbumOrSet:function(){this._canceled=true;DOM.remove($(this._flashID));PhotosUploadWaterfall.sendSignal({qn:this._qn,uploader:this._uploaderName,step:PhotosUploadWaterfall.CANCEL,meta:{method:'new-album-cancel'}});var a;if(this._createNewSet){a=new AsyncRequest().setURI('/ajax/photos/sets/delete/').setData({set:this._photoSetToken,id:this._owner});}else a=new AsyncRequest().setURI('/ajax/photos/album/delete/').setData({aid:this._aid,id:this._owner});var b=curry(goURI,window.location.href,true);if(this._surveyVisible){new AsyncRequest('/photos/upload/survey_flag/').setMethod('POST').send();b=function(){new Dialog().setAsync(new AsyncRequest('/survey/surveyDialog').setData({survey_id:'216629141722067'})).setCancelHandler(curry(goURI,window.location.href,true)).show();};}a.setHandler(b).send();},getErrorMessage:function(a){switch(a.failureCode){case 0:return tx._("Tiedoston {filename} lataamisessa on ongelmia. Tarkista internetyhteytesi.",{filename:a.filename});case 1:return null;case 2:return tx._("Emme voineet avata tiedostoa {filename}. Varmista, ettei tiedostoa ole poistettu tietokoneestasi.",{filename:a.filename});case 3:return tx._("Emme ymm\u00e4rt\u00e4neer tiedoston {filename} sis\u00e4lt\u00f6\u00e4. Varmista, ett\u00e4 tiedostomuoto on jpg, gif tai png.",{filename:a.filename});case 4:return tx._("{filename} on liian iso. Pienenn\u00e4 kuvan kokoa, jotta se on alle\n8000 x 8000 pikseli\u00e4 ja yrit\u00e4 uudelleen.",{filename:a.filename});}return null;},handleUnload:function(){if(this._controller.isUploading()&&!this._canceled)PhotosUploadWaterfall.sendSignal({qn:this._qn,uploader:this._uploaderName,step:PhotosUploadWaterfall.CANCEL,meta:{method:'nav-away'}});},handleBeforeUnload:function(){if(this._controller.isUploading()&&!this._canceled)return "Kuvia ei ladata, jos poistut t\u00e4lt\u00e4 sivulta.";},allDone:function(){},setHiRes:function(a){this._fbx=a;this._controller.setHiRes(this._fbx);},getHiRes:function(){return this._fbx;}});
function FlashUploaderOverlay(){this.parent.construct(this);this._photos={};}Class.extend(FlashUploaderOverlay,'FlashUploader');FlashUploaderOverlay.bootstrap=function(a,b,c,d){var e=$(b);if(!(a in FlashUploader.instances)){(new FlashUploaderOverlay()).init(e,c,JSON.parse($(c).getAttribute('data-config')));}else FlashUploader.instances[a].registerSwf(c,e);if(d)AsyncRequest.bootstrap(e.getAttribute('ajaxify'),e);};copy_properties(FlashUploaderOverlay.prototype,{MAX_FACE_POLLS:5,BASE_FACE_POLL_TIMEOUT:500,init:function(a,b,c){this._originalDocumentTitle=DocumentTitle.get();this._selectButtons={};this._selectButtons[b]=a;this._fallbackHref=c.fallbackHref;this._pendingAid=null;this._backdatedTime=null;this._showConfirmAlbumDelete=false;this._hideFromNewsfeed=null;this.parent.init(a,b,c);},onFlashLoadError:function(a){if(!this._fallbackHref)return;for(var b in this._selectButtons){var c=this._selectButtons[b],d=URI(this._fallbackHref).addQueryData({error:a}).toString();c.removeAttribute('rel');c.removeAttribute('ajaxify');c.setAttribute('href',d);this.enableButton(c);}},onFlashUpgradeRequired:function(a){this.onFlashLoadError(a);},onFlashUpgradeSuggested:function(){},registerSwf:function(a,b){this._selectButtons[a]=b;this._controller.registerSwf(a);},arbiterFilter:function(a,b){if(!this._controller.isEventIntendedForMe(b))return;switch(a){case UploadEvent.READY:return this.handleReady(b);case UploadEvent.SELECT_OVER:return CSS.addClass(this._selectButton,'selectOver');case UploadEvent.SELECT_OUT:return CSS.removeClass(this._selectButton,'selectOver');case UploadEvent.IMAGES_SELECTED:return this.handleImagesSelected(b);case UploadEvent.ERROR:return this.handleError(b.response);case UploadEvent.HI_RES_ATTACH_START:return this.handleHiResAttachStart(b);case UploadEvent.UPLOAD_PROGRESS:return this.handleImageUploaded(b);case UploadEvent.DONE:return this.done();}},handleReady:function(a){var b=this._selectButtons[a.divID];this.enableButton(b);this._controller.copyWidth(b,a.divID);if(this._pendingAid)this.parent.setAid(this._pendingAid);},setAid:function(a){this.parent.setAid(a);this._pendingAid=a;},enableButton:function(a){var b=Parent.byClass(a,'addPhotosDisabled');if(b){CSS.removeClass(b,'addPhotosDisabled');CSS.addClass(b,'addPhotosEnabled');}},showAlbumLimitExceededDialog:function(){var a=new Dialog().setModal(false).setTitle("Latausvirhe").setBody("T\u00e4m\u00e4 albumi on t\u00e4ynn\u00e4. Jos tahdot ladata lis\u00e4\u00e4 kuvia, luo uusi albumi.").setButtons(Dialog.CLOSE).setModal(true).show();},handleImagesSelected:function(a){if(this._editor){if(a.maxReached)this.showAlbumLimitExceededDialog();if(a.count===0)return;this.addPlaceholders(a.count);this.updateOverallProgress();this.startUpload();return;}var b=deconcept.SWFObjectUtil.getPlayerVersion();PhotosUploadWaterfall.sendSignal({qn:this._qn,step:PhotosUploadWaterfall.VERSION,uploader:'flash',version:b.major+'.'+b.minor+'.'+b.rev});},bindToOverlay:function(a,b,c,d,e,f){this.setAid(d);this._fbid=e;this._controller.setFrecId(f);this._editor=a;this._overallProgressBar=b;this._overlay=c;this._faceRequests={};this._facePollsMade={};this._photosWithUntaggedFaces={};var g=c.getRoot();this._progressWrap=DOM.find(g,'div.progressWrap');this._footer=DOM.find(g,'div.footerBox');this._header=DOM.find(g,'div.headerBox');this._overlayPage=DOM.find(g,'div.uiLayerPage');this._doneButton=DOM.find(g,'.doneButton');var h=this.repositionFixedElements.bind(this),i=[Event.listen(DOM.find(g,'.cancel'),'click',this.showCancelDialog.bind(this)),Event.listen(this._doneButton,'click',this.updateForm.bind(this)),Event.listen(document.documentElement,'keydown',function(l){if(Event.getKeyCode(l)!==KEYS.ESC)return;this.showCancelDialog();l.stop();}.bind(this),Event.Priority.URGENT),Event.listen(g,'scroll',h),Event.listen(window,'resize',h)],j=[Arbiter.subscribe('PhotosBulkEditablePhoto.REMOVED',this.handlePhotoDeleted.bind(this)),Arbiter.subscribe('PhotoBulkEditTagger.TAG_SAVED',function(l,m){this._photosWithUntaggedFaces[m.fbid]=false;if(this._faceRequests[m.fbid]){window.clearTimeout(this._faceRequests[m.fbid]);delete this._faceRequests[m.fbid];}}.bind(this),Arbiter.SUBSCRIBE_NEW),Arbiter.subscribe('PhotosBulkBackdateEditor.SAVED',function(l,m){if(!DOM.contains(this._overlayPage,m.context))return;this._backdatedTime=m.backdatedDate;this._hideFromNewsfeed=m.hideFromNewsfeed;}.bind(this))];this._layerSubscription=Layer.subscribe('hide',function(l,m){if(this._overlay!==m)return;DocumentTitle.set(this._originalDocumentTitle);i.forEach(function(n){n.remove();});i=[];j.forEach(function(n){n.unsubscribe();});j=[];Layer.unsubscribe(this._layerSubscription);this._layerSubscription=null;}.bind(this));var k=DOM.find(this._overlay.getRoot(),'input.fluploader_enable_fbx');this._fbx=k.checked;Event.listen(k,'click',function(){this.setHiRes(k.checked);new AsyncRequest().setURI('/ajax/photos/upload/settings/').setData({resolution:k.checked?'high':'standard'}).send();}.bind(this));this.addPlaceholders(this._controller.getImagesSelected());this.startUpload();if(this._controller.isAlbumLimitExceeded())this.showAlbumLimitExceededDialog();},addPlaceholders:function(a){if(a)CSS.removeClass(this._overlay.getRoot(),'showEmptyState');if(!this._controller.isUploading())a--;var b=[],c=this._editor.getWaitingTemplate().getRoot();for(var d=0;d<a;d++){var e=c.cloneNode(true);CSS.show(e);b.push(e);}DOM.insertAfter(this._editor.getPlaceholder().getRoot(),b);},startUpload:function(){var a=this._editor.getPlaceholder();a.show();this.repositionFixedElements();var b=this._controller.isUploading();if(this._controller.uploadImages()){if(!b)this._editor.getPlaceholder().getProgressBar().setPosition(0).setTarget(95,20000);var c=this._controller.getStats(),d=c.nextPercentTarget,e=c.estimatedTimeToNextTarget;if(e===null)e=20000;this._overallProgressBar.setPosition(this._controller.getPercentComplete()).setCompleteHandler(this.logDeadProgressBar.bind(this)).setTarget(d,e);this.updateStatusText();this.updateButtonState();}},repositionFixedElements:function(){var a=Vector2.getElementPosition(this._overlayPage).y<0;if(a!=CSS.hasClass(this._header,'headerFixed'))this.adjustElementPosition(this._header,a,'headerFixed');var b=Vector2.getViewportDimensions(),c=this._editor.getRoot();if(ua.firefox()){CSS.setStyle(c,'min-height',b.y+'px');if(!CSS.hasClass(this._footer,'footerFixed'))this.adjustElementPosition(this._footer,true,'footerFixed');return;}var d=Vector2.getElementPosition(c).y+Vector2.getElementDimensions(c).y+Vector2.getElementDimensions(this._footer).y,e=d>b.y;if(e!=CSS.hasClass(this._footer,'footerFixed'))this.adjustElementPosition(this._footer,e,'footerFixed');},adjustElementPosition:function(a,b,c){CSS.conditionClass(a,c,b);if(!b){CSS.setStyle(a,'marginLeft','');return;}var d=DOMScroll.getScrollbarSize(),e=Vector2.getElementDimensions(a).x;CSS.setStyle(a,'marginLeft',(-Math.round((e+d)/2))+'px');},handleError:function(a){if(!a)return;var b=a.errorSummary,c=a.errorDescription,d=this._editor.getPlaceholder().getRoot(),e=this._editor.getWaitingTemplate().getRoot(),f=e.cloneNode(true);DOM.insertBefore(d,f);DOM.appendContent(DOM.find(f,'.error .title'),b);DOM.setContent(DOM.find(f,'.error .description'),c);CSS.addClass(f,'editablePhotoErrorPlaceholder');CSS.show(DOM.find(f,'.error'));CSS.show(f);var g=d.nextSibling;if(g&&CSS.hasClass(g,'editablePhoto'))DOM.remove(g);this.updatePlaceholder();this.updateOverallProgress();},done:function(){this.updateOverallProgress();this.updateButtonState();},updateHiResStatus:function(a){if(!this.getHiRes()){CSS.removeClass(a.editablePhoto,'editablePhotoNeedsHiRes');return;}var b=DOM.find(a.editablePhoto,'.statusBar');if(!a.hiRes){CSS.addClass(a.editablePhoto,'editablePhotoNeedsHiRes');DOM.setContent(b,"Suuri tarkkuus: odottaa...");return;}window.clearTimeout(a.hiResTimeout);var c=500/(100-a.hiResPercent);a.hiResTimeout=window.setTimeout(this.updateHiResPercent.bind(this,a,100,c,function(){DOM.setContent(b,"Suuri tarkkuus:"+' \u2714');CSS.removeClass.curry(a.editablePhoto,'editablePhotoNeedsHiRes').defer(2000);}),c);},handleHiResAttachStart:function(a){var b=this._photos[a.response.fbid],c=a.stats.estimatedTimeToNextTarget||20000,d=c/95;b.hiResPercent=1;b.hiResTimeout=window.setTimeout(this.updateHiResPercent.bind(this,b,95,d),d);},updateHiResPercent:function(a,b,c,d){var e=DOM.find(a.editablePhoto,'.statusBar');DOM.setContent(e,tx._("Suuri tarkkuus: {percent} \u0025...",{percent:a.hiResPercent}));if(a.hiResPercent<b){a.hiResPercent++;a.hiResTimeout=window.setTimeout(this.updateHiResPercent.bind(this,a,b,c,d),c);}else if(d)d();},handleImageUploaded:function(a){var b=a.response.fbid,c=this._photos[b];if(c){c.hiRes=a.hiRes;if(c.hiRes)this.updateHiResStatus(c);this.updateOverallProgress();return;}c={fbid:b,hiRes:a.hiRes};this.fetchEditablePhoto(c,{});},fetchEditablePhoto:function(a,b){copy_properties(b,this._editor.needTaggingData()?{need_tagging:true}:{});this._waitingForEditablePhoto=true;var c=new AsyncRequest().setURI(URI('/ajax/photos/photo/edit/'+a.fbid+'/')).setData(b).setHandler(this.handleEditablePhotoReceived.bind(this,a)).setErrorHandler(function(d){this._waitingForEditablePhoto=false;delete this._photos[a.fbid];this.handleError(d);}.bind(this)).send();},handleEditablePhotoReceived:function(a,b){var c=b.getPayload();if(c.retryIn)return this.fetchEditablePhoto.bind(this,a,c).defer(c.retryIn*1000);this._waitingForEditablePhoto=false;var d=this._editor.getPlaceholder(),e=d.getProgressBar(),f=c,g=DOM.insertBefore(d.getRoot(),f);f=g[0];this._registerScaledImageReloader(DOM.find(f,'.editablePhotoImage img'));a.editablePhoto=f;this._photos[a.fbid]=a;this.updateHiResStatus(a);CSS.hide(f);e.setCompleteHandler(this.showNextEditablePhoto.bind(this,f)).setTarget(100,500);this.updateOverallProgress();this.pollFaces(a);},_registerScaledImageReloader:function(a){var b=1,c=200,d=Event.listen(a,'error',function e(f){if((b++)<3){window.setTimeout(function(){a.src=''+a.src;},c);c+=(c*b);return true;}d.remove();});return true;},pollFaces:function(a){if(!this._facePollsMade.hasOwnProperty(a.fbid))this._facePollsMade[a.fbid]=0;var b=this._facePollsMade[a.fbid]++;if(b>=this.MAX_FACE_POLLS)return;var c=this.BASE_FACE_POLL_TIMEOUT*Math.pow(2,b);this._faceRequests[a.fbid]=window.setTimeout(this.requestFaces.bind(this,a),c);},requestFaces:function(a){var b=DOM.find(a.editablePhoto,'div.scaledImage'),c=Vector2.getElementDimensions(b);if(!c.x||!c.y){this.pollFaces(a);return;}new AsyncRequest('/ajax/photos/photo/faceboxes/').setData({fbid:a.fbid,width:c.x,height:c.y}).setMethod('GET').setReadOnly(true).setHandler(function(d){if(!d.getPayload()){this.pollFaces(a);return;}else if(!d.getPayload().html){if(!d.getPayload().detection_done)this.pollFaces(a);return;}else if(!this._faceRequests[a.fbid]){this._photosWithUntaggedFaces[a.fbid]=false;return;}var e=DOM.find(a.editablePhoto,'div.border');DOM.appendContent(e,d.getPayload().html);CSS.addClass.curry(a.editablePhoto,'showRecognitionBoxes').defer();delete this._faceRequests[a.fbid];this._photosWithUntaggedFaces[a.fbid]=true;}.bind(this)).send();},updateStatusText:function(){var a=this._controller.getStats(),b=this._controller.isUploading(),c='';if(a&&a.estimatedTimeToComplete){var d=Math.ceil(a.estimatedTimeToComplete/60000);c=d==1?"yksi minuutti j\u00e4ljell\u00e4":tx._("{time} minuuttia j\u00e4ljell\u00e4",{time:d});}else if(b)c="Arvio j\u00e4ljell\u00e4 olevasta ajasta";var e='';if(b){e=tx._("{uploaded}\/{total} ladattu",{total:this._controller.getImagesSelected(),uploaded:this._controller.getImagesUploaded()});}else e="Ladattu";var f=c?e+' \u00b7 '+c:e;Tooltip.set(this._progressWrap,f);DocumentTitle.set(e);},setHiRes:function(a){if(a==this.getHiRes())return;this.parent.setHiRes(a);if(a){this._overallProgressBar.setPosition(this._controller.getPercentComplete());this.updateButtonState();}this.updateOverallProgress();for(var b in this._photos){var c=this._photos[b];this.updateHiResStatus(c);}},updateButtonState:function(){Button.setEnabled(this._doneButton,(!this._controller.isUploading()&&!this.inEmptyState()&&this._controller.isRecognitionFinished()));},showNextEditablePhoto:function(a){var b=this._editor.getPlaceholder().getRoot().nextSibling;if(b&&CSS.hasClass(b,'editablePhoto'))DOM.remove(b);CSS.show(a);this.updatePlaceholder();this.repositionFixedElements();this.updateOverallProgress();},updatePlaceholder:function(){var a=this._editor.getPlaceholder(),b=a.getProgressBar().setCompleteHandler(null).setPosition(0),c=this._controller,d=c.getImagesFailed()+c.getImagesUploaded();if(d>=c.getImagesSelected()){a.hide();return;}var e=count(this._photos)+c.getImagesFailed();if(e==c.getImagesSelected()){a.hide();return;}var f=c.getStats().estimatedTimeToNextTarget;if(f===null)f=20000;b.setTarget(95,f);},updateOverallProgress:function(){var a=this._controller.getStats(),b=this._controller.isUploading();if(b){var c=a.estimatedTimeToNextTarget;if(c===null)c=20000;if(c>0)this._overallProgressBar.setTarget(a.nextPercentTarget,c).setCompleteHandler(this.logDeadProgressBar.bind(this));this.updateStatusText();}else if(!this._waitingForEditablePhoto)this._overallProgressBar.setCompleteHandler(function(){this._overallProgressBar.setCompleteHandler(null);this.updateStatusText();}.bind(this)).setTarget(100,500);},updateForm:function(){var a=true;for(var b in this._photosWithUntaggedFaces)if(this._photosWithUntaggedFaces[b]){a=false;break;}var c={id:this._owner,tid:this._targetId,frecId:this._frecId,skipClustering:a,qn:this._qn,success:this._controller.getImagesUploaded(),hide_from_newsfeed:this._hideFromNewsfeed,failure:0};if(this._photoSetToken){c.set=this._photoSetToken;}else c.aid=this._aid;if(this._backdatedTime)c.backdated_date=this._backdatedTime;Form.createHiddenInputs(c,Parent.byTag(this._doneButton,'form'));if(this._createNewSet)new AsyncRequest().setURI('/ajax/photos/upload/flash/set/finish/').setData({set:this._photoSetToken,target:this._targetId}).setAllowCrossPageTransition(true).send();},handlePhotoDeleted:function(a,b){this.repositionFixedElements();var c=b.getPhotoData().fbid;this._controller.markDeleted(c);delete this._photos[c];if(this.inEmptyState()){this.updateButtonState();CSS.addClass(this._overlay.getRoot(),'showEmptyState');}},inEmptyState:function(){return (is_empty(this._photos)&&!this._controller.isUploading()&&!this._waitingForEditablePhoto);},cancelAddPhotosToAlbumOrSet:function(){var a=this._photoSetToken;if(!a)a=['a',this._fbid,this._aid,this._owner].join('.');var b=[];for(var c in this._photos)b.push(c);new AsyncRequest().setURI('/ajax/photos/multi_delete').setData({set:a,photo_ids:b}).setHandler(curry(goURI,window.location.href,true)).send();},setShowConfirmAlbumDelete:function(){this._showConfirmAlbumDelete=true;},showCancelNewAlbumOrSetDialog:function(){var a=[Dialog.newButton('delete_album',"Poista albumi",'',this.cancelNewAlbumOrSet.bind(this)),Dialog.newButton('keep_album',"S\u00e4ilyt\u00e4 albumi",'inputaux',this.cancelAddPhotosToAlbumOrSet.bind(this))],b=new Dialog().setBody("Oletko varma, ett\u00e4 haluat poistaa t\u00e4m\u00e4n albumin? Kaikki albumin sis\u00e4lt\u00e4m\u00e4t kuvat poistetaan.").setTitle("Poista albumi").setButtons(a).setModal(true).show();},showCancelDialog:function(){var a="Pid\u00e4 kuvat",b="Delete Photos",c=[Dialog.newButton('delete_photos',b,'',function(){e.hide();this._overlay.hide();this.cancelUpload();if(this._created){if(this._showConfirmAlbumDelete){this.showCancelNewAlbumOrSetDialog();}else this.cancelNewAlbumOrSet();}else this.cancelAddPhotosToAlbumOrSet();}.bind(this)),Dialog.newButton('keep_photos',a,'inputaux',function(){this.cancelUpload();this.updateForm();Parent.byTag(this._doneButton,'form').submit();}.bind(this))],d="Joidenkin kuvien lataus onnistui, ennen kuin peruutit lataamisen. Voit poistaa n\u00e4m\u00e4 kuvat tai s\u00e4ilytt\u00e4\u00e4 ja julkaista ne my\u00f6hemmin.",e=new Dialog().setBody(d).setTitle("Mit\u00e4 haluat tehd\u00e4?").setButtons(c).setModal(true).show();}});
__d("ControlledReferer",["event-extensions","URI"],function(a,b,c,d,e,f){b('event-extensions');var g=b('URI'),h={useFacebookReferer:function(i,j,k){var l=false;function m(){if(l)return;l=true;i.contentWindow.document.body.style.margin=0;j();}var n;if(document.domain!=='facebook.com'){n='/intern/common/referer_frame.php';}else if(g().isSecure()){n='https://s-static.ak.facebook.com/common/referer_frame.php';}else n='http://static.ak.facebook.com/common/referer_frame.php';if(k)n+='?fb_source='+k;Event.listen(i,'load',m);i.src=n;},useFacebookRefererHtml:function(i,j,k){h.useFacebookReferer(i,function(){i.contentWindow.document.body.innerHTML=j;},k);}};e.exports=h;});
__d("swfobject",["AsyncRequest","Bootloader","ControlledReferer","copyProperties","DOM","function-extensions","StringEscape"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Bootloader'),i=b('ControlledReferer'),j=b('copyProperties'),k=b('DOM');b('function-extensions');var l=b('StringEscape');if(typeof m=="undefined")var m={};if(typeof m.util=="undefined")m.util={};if(typeof m.SWFObjectUtil=="undefined")m.SWFObjectUtil={};m.SWFObject=function(s,t,u,v,w,x,y,z,aa,ba){if(!document.getElementById)return;this.DETECT_KEY=ba?ba:'detectflash';this.skipDetect=m.util.getRequestParameter(this.DETECT_KEY);this.params={};this.variables={};this.attributes=[];this.fallback_html='';this.fallback_js_fcn=function(){};if(s)this.setAttribute('swf',s);if(t)this.setAttribute('id',t);if(u)this.setAttribute('width',u);if(v)this.setAttribute('height',v);this.installedVer=m.SWFObjectUtil.getPlayerVersion();if(w){if(!(w instanceof Array))w=[w];var ca;w.forEach(function(fa){ca=new m.PlayerVersion(fa.toString().split('.'));if(ca.major==this.installedVer.major){this.setAttribute('version',ca);return;}else if(!this.getAttribute('version')||ca.major<this.getAttribute('version').major)this.setAttribute('version',ca);}.bind(this));}if(!window.opera&&document.all&&this.installedVer.major>7)if(!m.unloadSet){m.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",m.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",m.SWFObjectUtil.prepUnload);m.unloadSet=true;}if(x)this.addParam('bgcolor',x);var da=y?y:'high';this.addParam('quality',da);this.setAttribute('useExpressInstall',false);this.setAttribute('doExpressInstall',false);var ea=(z)?z:window.location;this.setAttribute('xiRedirectUrl',ea);this.setAttribute('redirectUrl','');if(aa)this.setAttribute('redirectUrl',aa);this.setAttribute('useIframe',false);};m.SWFObject.ieWorkaroundApplied=false;m.SWFObject.ensureIEWorkaroundAttached=function(){if(!m.SWFObject.ieWorkaroundApplied&&document.attachEvent){m.SWFObject.ieWorkaroundApplied=true;document.attachEvent('onpropertychange',m.SWFObject.onDocumentPropertyChange);}};m.SWFObject.onDocumentPropertyChange=function(event){if(event.propertyName=="title"){var s=document.title;if(s!=null&&s.indexOf('#!')!=-1){s=s.substring(0,s.indexOf('#!'));document.title=s;}}};j(m.SWFObject.prototype,{useExpressInstall:function(s){this.xiSWFPath=!s?"/swf/expressinstall.swf":s;this.setAttribute('useExpressInstall',true);},setAttribute:function(s,t){this.attributes[s]=t;},getAttribute:function(s){return this.attributes[s]||"";},addParam:function(s,t){this.params[s]=t;},getParams:function(){return this.params;},addVariable:function(s,t){this.variables[s]=t;},getVariable:function(s){return this.variables[s]||"";},getVariables:function(){return this.variables;},getVariablePairs:function(){var s=[],t,u=this.getVariables();for(t in u)s[s.length]=t+"="+u[t];return s.join('&');},getSWFHTML:function(){var s,t,u;if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute('swf',this.xiSWFPath);}t={type:'application/x-shockwave-flash',src:this.getAttribute('swf'),width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;',id:this.getAttribute('id'),name:this.getAttribute('id')};var v=this.getParams();for(var w in v)t[w]=v[w];u=this.getVariablePairs();if(u)t.flashvars=u;s=r('embed',t,null);}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute('swf',this.xiSWFPath);}t={id:this.getAttribute('id'),classid:'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000',width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;'};var x=r('param',{name:'movie',value:this.getAttribute('swf')},null),v=this.getParams();for(var w in v)x+=r('param',{name:w,value:v[w]},null);u=this.getVariablePairs();if(u)x+=r('param',{name:'flashvars',value:u},null);s=r('object',t,x);}return s;},write:function(s){if(this.getAttribute('useExpressInstall')){var t=new m.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(t)&&!this.installedVer.versionIsValid(this.getAttribute('version'))){this.setAttribute('doExpressInstall',true);this.addVariable("MMredirectURL",escape(this.getAttribute('xiRedirectUrl')));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}var u=(typeof s=='string')?document.getElementById(s):s;if(!u)return false;CSS.addClass(u,'swfObject');u.setAttribute('data-swfid',this.getAttribute('id'));if(this.skipDetect||this.getAttribute('doExpressInstall')||this.installedVer.versionIsValid(this.getAttribute('version'))){if(!this.getAttribute('useIframe')){m.SWFObject.ensureIEWorkaroundAttached();u.innerHTML=this.getSWFHTML();}else this._createIframe(u);return true;}else{if(this.getAttribute('redirectUrl')!="")document.location.replace(this.getAttribute('redirectUrl'));var v=this.getAttribute('version').major+'.'+this.getAttribute('version').minor+'.'+this.getAttribute('version').rev,w=this.installedVer.major+'.'+this.installedVer.minor+'.'+this.installedVer.rev;this.fallback_js_fcn(w,v);u.innerHTML=this.fallback_html;}return false;},_createIframe:function(s){var t=$N('iframe',{width:this.getAttribute('width'),height:this.getAttribute('height'),frameBorder:0});k.empty(s);s.appendChild(t);i.useFacebookRefererHtml.bind(null,t,this.getSWFHTML(),this.getAttribute('iframeSource')).defer();}});m.SWFObjectUtil.getPlayerVersion=function(){var s=new m.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){for(var t=0;t<navigator.plugins.length;t++)try{var v=navigator.plugins[t];if(v.name=='Shockwave Flash'){PlayerVersion_tmp=new m.PlayerVersion(v.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+(r|d)|\s+b[0-9]+)/,".").split("."));if(typeof s=='undefined'||PlayerVersion_tmp.major>s.major||(PlayerVersion_tmp.major==s.major&&(PlayerVersion_tmp.minor>s.minor||(PlayerVersion_tmp.minor==s.minor&&PlayerVersion_tmp.rev>s.rev))))s=PlayerVersion_tmp;}}catch(u){}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var w=1,x=3;while(w)try{x++;w=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+x);s=new m.PlayerVersion([x,0,0]);}catch(y){w=null;}}else{try{var w=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(z){try{var w=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");s=new m.PlayerVersion([6,0,21]);w.AllowScriptAccess="always";}catch(aa){if(s.major==6)return s;}try{w=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(ba){}}if(w!=null)s=new m.PlayerVersion(w.GetVariable("$version").split(" ")[1].split(","));}return s;};m.PlayerVersion=function(s){this.major=s[0]!=null?parseInt(s[0]):0;this.minor=s[1]!=null?parseInt(s[1]):0;this.rev=s[2]!=null?parseInt(s[2]):0;};m.PlayerVersion.prototype.versionIsValid=function(s){if(this.major<s.major)return false;if(this.major>s.major)return true;if(this.minor<s.minor)return false;if(this.minor>s.minor)return true;if(this.rev<s.rev)return false;return true;};m.util={getRequestParameter:function(s){var t=document.location.search||document.location.hash;if(s==null)return t;if(t){var u=t.substring(1).split("&");for(var v=0;v<u.length;v++)if(u[v].substring(0,u[v].indexOf("="))==s)return u[v].substring((u[v].indexOf("=")+1));}return "";}};m.SWFObjectUtil.cleanupSWFs=function(){var s=document.getElementsByTagName("OBJECT");for(var t=s.length-1;t>=0;t--){s[t].style.display='none';for(var u in s[t])if(typeof s[t][u]=='function')s[t][u]=function(){};}};if(!document.getElementById&&document.all)document.getElementById=function(s){return document.all[s];};var n=m.util.getRequestParameter,o=m.SWFObject,p=m.SWFObject;m.spawn_flash_update_dialog=function(){new g().setURI('/ajax/flash_update_dialog.php').setMethod('GET').setReadOnly(true).send();};function q(s,t){var u=ge(s),v=m.SWFObjectUtil.getPlayerVersion(),w;t.forEach(function(z){z=new m.PlayerVersion(z.toString().split('.'));if(z.major==v.major){w=z;return;}else if(typeof w=='undefined'||z.major<w.major)w=z;}.bind(this));if(u&&v.major>0){var x=v.major+'.'+v.minor+'.'+v.rev,y=w.major+'.'+w.minor+'.'+w.rev;u.innerHTML=tx._("Flash {required-version} vaaditaan t\u00e4m\u00e4n sis\u00e4ll\u00f6n katseluun. Nykyinen versiosi on {current-version}. Lataa uusin Flash Player.",{'required-version':y,'current-version':x});}}m.showFlashErrorDialog=function(s,t){h.loadModules(['ErrorDialog'],function(u){u.show(s,t);});};function r(s,t,u){var v=/^[A-Za-z0-9\-]+$/;if(!s.match(v))throw new Error('Invalid tag '+s);var w='<'+s;for(var x in t){if(!x.match(v))throw new Error('Invalid attr '+x);w+=' '+x+'="'+l.htmlSpecialChars(t[x])+'"';}if(u===null){return w+'/>';}else return w+'>'+u+'</'+s+'>';}e.exports=a.deconcept||m;});
__d("SoundPlayer",["Arbiter","Env","swfobject","URI","createArrayFrom"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Env'),i=b('swfobject').SWFObject,j=b('URI'),k=b('createArrayFrom'),l={},m=null,n=false,o=null,p='so_sound_player',q=null;function r(z){var aa=j(z);if(!aa.getDomain())return j(h.static_base).setPath(aa.getPath()).toString();return z;}function s(z){if(/\.mp3$/.test(z))return 'audio/mpeg';if(/\.og[ga]$/.test(z))return 'audio/ogg';return '';}function t(){if(!h.html5_audio)return null;if(!q){var z=document.createElement('audio');if(!z||!z.canPlayType)return null;z.setAttribute('preload','auto');document.body.appendChild(z);q=z;}return q;}function u(){var z=document[p]||window[p];if(z)if(!z.playSound&&z.length)z=z[0];return (z&&z.playSound&&z.loopSound)?z:null;}function v(){return n;}function w(z,aa,ba){m={path:z,sync:aa,loop:ba};}function x(){n=true;if(m){var z=u();if(m.loop){z.loopSound(m.path,m.sync);}else z.playSound(m.path,m.sync);}o.unsubscribe();o=null;}var y={init:function(z){z=k(z);var aa;for(var ba=0;ba<z.length;++ba){aa=z[ba];if(l[aa])return;}var ca=t();for(ba=0;ca&&ba<z.length;++ba){aa=z[ba];if(ca.canPlayType(aa)){l[aa]=true;return;}}l['audio/mpeg']=true;if(u())return;try{o=g.subscribe('sound/ready',x);var ea=document.createElement('div');ea.id='sound_player_holder';document.body.appendChild(ea);var fa=new i('/swf/SoundPlayerHater.swf',p,'1px','1px',['9.0.159.0','10.0.22.87'],'#ffffff');fa.addParam('allowscriptaccess','always');fa.addParam('wmode','transparent');fa.addVariable('swf_id',p);fa.fallback_html=' ';fa.write(ea.id);window[p]=fa;}catch(da){}},play:function(z,aa){z=k(z);var ba=t(),ca,da;for(var ea=0;ba&&ea<z.length;++ea){ca=z[ea];da=s(ca);if(!ba.canPlayType(da))continue;y.init([da]);ba.src=r(ca);if(aa){ba.setAttribute('loop','');}else ba.removeAttribute('loop');ba.play();return;}for(ea=0;ea<z.length;++ea){ca=r(z[ea]);da=s(ca);if(da!='audio/mpeg')continue;y.init([da]);var fa=u();if(!v()){w(ca,true,aa);return;}else if(fa){if(aa){fa.loopSound(ca,true);}else fa.playSound(ca,true);return;}}},stop:function(z){z=k(z);for(var aa=0;aa<z.length;++aa){var ba=r(z[aa]),ca=t(),da=u();if(ca&&ca.src==ba){ca.pause();ca.src=undefined;}else da&&da.stopSound(ba);}}};e.exports=y;});
__d("SoundSynchronizer",["event-extensions","hasArrayNature","SoundPlayer","createArrayFrom"],function(a,b,c,d,e,f){b('event-extensions');var g=b('hasArrayNature'),h=b('SoundPlayer'),i=b('createArrayFrom'),j='fb_sounds_playing3';function k(){if(window.localStorage)try{var p=window.localStorage[j];if(p){p=JSON.parse(p);if(g(p))return p;}}catch(o){}return [];}function l(o){if(window.localStorage){var p=k();p.push(o);while(p.length>5)p.shift();try{window.localStorage[j]=JSON.stringify(p);}catch(q){}}}function m(o){return k().some(function(p){return p===o;});}var n={play:function(o,p,q){o=i(o);p=p||(o[0]+Math.floor(Date.now()/1000));if(m(p))return;h.play(o,q);l(p);},isSupported:function(){return !!window.localStorage;}};e.exports=n;});
__d("SoundRPC",["event-extensions","SoundSynchronizer"],function(a,b,c,d,e,f){b('event-extensions');var g=b('SoundSynchronizer');function h(j,k,l){g.play(j,k,l);}var i={playLocal:h,playRemote:function(j,k,l,m){var n={paths:k,sync:l,loop:m};j.postMessage(JSON.stringify(n),'*');},supportsRPC:function(){return !!window.postMessage;},_listen:function(){Event.listen(window,'message',function(j){if(!/\.facebook.com$/.test(j.origin))return;var k=JSON.parse(j.data);h(k.paths,k.sync,k.loop);});}};e.exports=i;});
__d("legacy:swfobject",["swfobject"],function(a,b,c,d){var e=b('swfobject');a.deconcept=e;a.SWFObject=e.SWFObject;a.showFlashErrorDialog=e.showFlashErrorDialog;},3);
function AlbumScroller(){}copy_properties(AlbumScroller.prototype,{init:function(a,b){this.photoGroups={};this.scrollListener={};if(a.length){var c=a.shift(),d=c,e=0,f=c.id;while(d){if(!this.photoGroups[f])this.photoGroups[f]=[];var g=DOM.scry(d,'a.uiScrollableThumb');if(g.length>0)this.photoGroups[f].push(g[0]);d=this.getNextPhotoCell(d);if(++e%b==0){this.scrollListener[f]=new OnVisible(c,this.showPage.bind(this,c));c=a.shift();if(c)f=c.id;}}if(c)this.scrollListener[f]=new OnVisible(c,this.showPage.bind(this,c));}},showPage:function(a){var b=this.photoGroups[a.id];if(b)for(var c=0,d=b.length;c<d;c++)DOM.find(b[c],'i').style.backgroundImage='url('+b[c].getAttribute('data-src')+')';},getNextPhotoCell:function(a){var b=null;if(a.nextSibling){b=a.nextSibling;}else if(a.parentNode.nextSibling)b=a.parentNode.nextSibling.firstChild;if(b&&b.childElementCount!==0)return b;return null;}});
function BulkTagLoader(){}copy_properties(BulkTagLoader,{_requested:false,loadForSet:function(a){if(!BulkTagLoader._requested){BulkTagLoader._requested=true;new AsyncRequest('/ajax/photos/sets/tags_fetch.php').setHandler(bagofholding).setData({set:a}).send();}},loadForAlbum:function(a){if(!BulkTagLoader._requested){BulkTagLoader._requested=true;new AsyncRequest('/ajax/photos/album/tags_fetch.php').setHandler(bagofholding).setData({fbid:a}).send();}},reset:function(){BulkTagLoader._requested=false;}});
var MediaSetLikeButtonController={submit:function(){$('mediaSetUfiLikeLink').firstChild.click();CSS.hide($('mediaSetLikeButton'));}};