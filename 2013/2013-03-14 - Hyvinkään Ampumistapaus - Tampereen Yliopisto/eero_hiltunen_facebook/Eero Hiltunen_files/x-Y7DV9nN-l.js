/*1337576487,169776069*/

if (window.CavalryLogger) { CavalryLogger.start_js(["bEQ+K"]); }

__d("GenderConst",[],function(a,b,c,d,e,f){var g={UNKNOWN:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11};e.exports=g;});
__d("CanvasAppRequestUpdater",["Arbiter","CSS","ChannelConstants","DOM","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('ChannelConstants'),j=b('DOM'),k=b('copyProperties');function l(m){this._root=m;g.subscribe(i.getArbiterType('app_request_create'),function(n,o){var p=j.scry(this._root,".item_"+o.obj.appid)[0],q=p&&j.scry(p,".requestsList")[0];q&&j.appendContent(q,o.obj.request);p&&this._updateBookmark(p,1);}.bind(this));g.subscribe(i.getArbiterType('app_request_delete'),function(n,o){var p=j.scry(this._root,".item_"+o.obj.appid)[0],q=p&&j.scry(p,"[data-requestid='"+o.obj.requestid+"']")[0];q&&j.remove(q.parentElement);p&&this._updateBookmark(p,-1);}.bind(this));}k(l.prototype,{_updateBookmark:function(m,n){var o=j.find(m,".flyout"),p=j.find(m,".countValue"),q=parseInt(j.getText(p),10),r=Math.max(0,q+n);j.setContent(p,r);if(r<1){h.hide(p.parentElement);h.hide(o);}else{h.show(p.parentElement);h.show(o);}}});e.exports=l;});
__d("CanvasFlyoutLoader",["AsyncRequest"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h={endpoint:'/ajax/canvas/flyouts',init:function(i,j,k){this.root=i;this.largeApps=j;this.seeAllApps=k;this.handler=Event.listen(i,'mouseenter',this.loadFlyouts.shield(this));},loadFlyouts:function(){this.handler.remove();this.handler=null;var i={items:this.largeApps,all_apps:this.seeAllApps};new g().setURI(this.endpoint).setRelativeTo(this.root).setMethod('post').setReadOnly(true).setData(i).setAllowCrossPageTransition(true).send();}};e.exports=h;});
__d("IntlDateFormats",[],function(a,b,c,d,e,f){var g={},h={setFormats:function(i,j){g=j;},getFormat:function(i){if(!(i in g))return i;return g[i];}};e.exports=h;});
__d("date-extensions",["IntlDateFormats","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('IntlDateFormats'),h=b('copyProperties'),i=b('tx'),j=["su","ma","ti","ke","to","pe","la"],k=["sunnuntai","maanantai","tiistai","keskiviikko","torstai","perjantai","lauantai"],l=["tammi","helmi","maalis","huhti","touko","kes\u00e4","hein\u00e4","elo","syys","loka","marras","joulu"],m=["tammikuu","helmikuu","maaliskuu","huhtikuu","toukokuu","kes\u00e4kuu","hein\u00e4kuu","elokuu","syyskuu","lokakuu","marraskuu","joulukuu"];function n(o,p){p=p||2;o=''+o;while(o.length<p)o='0'+o;return o;}Date.format=function(o,p,q){var r=p?new Date(p*1000):new Date();return r.format(o,q);};h(Date.prototype,{format:function(o,p){if(!o)return '';var q=[],r=null,s=null,t=(p?'getUTC':'get'),u=this[t+'Date'](),v=this[t+'Day'](),w=this[t+'Month'](),x=this[t+'FullYear'](),y=this[t+'Hours'](),z=this[t+'Minutes'](),aa=this[t+'Seconds'](),ba=this[t+'Milliseconds']();for(var ca=0;ca<o.length;ca++){s=o.charAt(ca);if(s=='\\'){ca++;q.push(o.charAt(ca));continue;}switch(s){case 'd':r=n(u);break;case 'D':r=j[v];break;case 'j':r=u;break;case 'l':r=k[v];break;case 'F':r=m[w];break;case 'm':r=n(w+1);break;case 'M':r=l[w];break;case 'n':r=w+1;break;case 'Y':r=x;break;case 'y':r=(''+x).slice(2);break;case 'a':r=y<12?'am':'pm';break;case 'A':r=y<12?'AM':'PM';break;case 'g':r=(y==0||y==12)?12:y%12;break;case 'G':r=y;break;case 'h':r=(y==0||y==12)?12:n(y%12);break;case 'H':r=n(y);break;case 'i':r=n(z);break;case 's':r=n(aa);break;case 'S':r=n(ba,3);break;default:r=s;}q.push(r);}return q.join('');}});a.IntlDateFormats=g;},3);
__d("Sound",["SoundPlayer","SoundRPC","SoundSynchronizer","UserAgent"],function(a,b,c,d,e,f){var g=b('SoundPlayer'),h=b('SoundRPC'),i=b('SoundSynchronizer'),j=b('UserAgent'),k=null,l={init:function(o){if(!k)g.init(o);},play:function(o,p,q){if(k){h.playRemote(k.contentWindow,o,p,false);}else h.playLocal(o,p,q);},stop:function(o){if(!k)g.stop(o);}},m=location.host.replace(/^[^.]+/,'www');function n(){if(j.ie()<9)return false;return i.isSupported()&&h.supportsRPC();}if(location.host!==m&&n()){k=document.createElement('iframe');k.setAttribute('src','//'+m+'/sound_iframe.php');k.style.display='none';document.body.appendChild(k);}e.exports=l;});
__d("htmlHyperlink",["Env","StringEscape","UntrustedLink","URLScraper"],function(a,b,c,d,e,f){var g=b('Env'),h=b('StringEscape'),i=b('UntrustedLink'),j=b('URLScraper');function k(l,m,n,o){if(typeof l==='undefined'||!l.toString)return '';if(typeof m!=='function')m=h.htmlize;if(typeof n!=='function')n=h.htmlize;var l=l.toString(),p=[],q;while((q=j.match(l))){var r=l.indexOf(q);if(r>=0)p.push(m(l.substring(0,r)));var s=n(q),t=q.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(q)))t='http://'+t;p.push('<a target="_blank" rel="nofollow" href="'+t+'"');if(o){a.UntrustedLink=i;p.push(' onmousedown="UntrustedLink.bootstrap(this, \''+g.lhsh+'\', event)"');}p.push('>'+s+'</a>');l=l.substring(r+q.length);}l&&p.push(m(l));return p.join('');}e.exports=k;});
__d("legacy:string-escape",["StringEscape"],function(a,b,c,d){var e=b('StringEscape');a.escape_js_quotes=e.escapeJSQuotes;a.htmlspecialchars=e.htmlSpecialChars;a.htmlize=e.htmlize;},3);
__d("legacy:control-textarea",["TextAreaControl"],function(a,b,c,d){a.TextAreaControl=b('TextAreaControl');},3);
function OpenIDRequest(){var a=new AsyncRequest().setReadOnly(true).setHandler(this.asyncResponseHandler.bind(this)).setErrorHandler(this.asyncErrorHandler.bind(this));copy_properties(this,{openidUrl:null,requestId:OpenIDRequest.maxRequestId++,successResponseHandler:null,cancelHandler:null,intermediateHandler:null,immediateMode:false,useExtensions:true,thirdPartyLogin:false,popupWindow:null,asyncRequest:a,retryCount:0});OpenIDRequest.requests[this.requestId]=this;}OpenIDRequest.getRequestById=function(a){return OpenIDRequest.requests[a];};OpenIDRequest.prototype.setOpenIDUrl=function(a){this.openidUrl=a;return this;};OpenIDRequest.prototype.setSuccessHandler=function(a){this.successResponseHandler=a;return this;};OpenIDRequest.prototype.setErrorHandler=function(a){this.errorHandler=a;return this;};OpenIDRequest.prototype.setCancelHandler=function(a){this.cancelHandler=a;return this;};OpenIDRequest.prototype.setImmediateMode=function(a){this.immediateMode=a;return this;};OpenIDRequest.prototype.setUseExtensions=function(a){this.useExtensions=a;return this;};OpenIDRequest.prototype.setIntermediateHandler=function(a){this.intermediateHandler=a;return this;};OpenIDRequest.prototype.setThirdPartyLogin=function(a){this.thirdPartyLogin=a;return this;};OpenIDRequest.prototype.send=function(){if(!this.openidUrl)throw "openidUrl is a required parameter. Call setOpenIDUrl()";uri=this.calculateRedirectUrl();if(!uri){this.logMetrics('redirectUrlNotFound');return;}if(this.immediateMode){this.createHiddenIframe(uri);}else{if(this.popupWindow)throw "OpenID popup is already in progress";this.showPopup(uri);}this.logMetrics('requestSent');};OpenIDRequest.prototype.calculateRedirectUrl=function(a){var b=this.immediateMode?'checkid_immediate':'checkid_setup',c={'openid.mode':b},d;if(!OpenIDRequest.cache[this.openidUrl])return null;d=OpenIDRequest.cache[this.openidUrl].url;var e=URI(URI(d).getQueryData()['openid.return_to']);e.addQueryData({context:OpenIDRequest.context,request_id:this.requestId});c['openid.return_to']=e.toString();c.third_party_login=this.thirdPartyLogin;return URI(d).addQueryData(c).getQualifiedURI();};OpenIDRequest.prototype.createHiddenIframe=function(a){var b='openid_request_'+this.requestId,c=document.body.appendChild(document.createElement('div')),d=function(){c.innerHTML=('<iframe name="'+b+'"'+' src="'+a.toString()+'"'+' scrolling="no" '+' frameborder="0" class="hidden_elem"></iframe>');};if(ua.ie()){c.innerHTML='<iframe src="javascript:false"></iframe>';d.defer();}else d();};OpenIDRequest.prototype.showPopup=function(a){if(OpenIDRequest.cache[this.openidUrl])popupDimensions=OpenIDRequest.cache[this.openidUrl].popup_dimensions;if(typeof(popupDimensions)=="undefined"||!popupDimensions||!popupDimensions.height||!popupDimensions.width)popupDimensions={height:'580',width:'790'};var b={x:coalesce(window.screenX,window.screenLeft),y:coalesce(window.screenY,window.screenTop),width:coalesce(window.outerWidth,document.body.clientWidth),height:coalesce(window.outerHeight,document.body.clientHeight)},c=b.x+((b.width-popupDimensions.width)/2),d=b.y+((b.height-popupDimensions.height)/2),e=["location=yes","scrollbars=1","left="+c,"top="+d,"resizable=yes","height="+popupDimensions.height,"width="+popupDimensions.width].join(",");this.popupWindow=window.open(a.toString(),'_blank',e);this.popupPollInterval=setInterval(this.pollPopupWindow.bind(this),100);this.popupWindow.focus();};OpenIDRequest.prototype.pollPopupWindow=function(){if(!(this.popupPollInterval&&this.popupWindow))return;if(this.popupWindow.closed){clearInterval(this.popupPollInterval);this.cancel();}};OpenIDRequest.prototype.closePopupIfOpen=function(){if(this.popupWindow){if(this.popupPollInterval)clearInterval(this.popupPollInterval);this.popupWindow.close();}this.popupWindow=null;};OpenIDRequest.prototype.cancel=function(){this.closePopupIfOpen();if(this.cancelHandler)this.cancelHandler();this.logMetrics('requestCanceled');};OpenIDRequest.prototype.logMetrics=function(a){new AsyncSignal('/ajax/openid/metrics.php',{metric:a,immediate:this.immediateMode,context:OpenIDRequest.context,openid_url:this.openidUrl}).send();};OpenIDRequest.prototype.triggerCompleteAuthAsync=function(a){if(a.charAt(0)=='?'||a.charAt(0)=='&')a=a.substr(1);var b=URI.explodeQuery(a);this.closePopupIfOpen();if(b['openid.mode']=='cancel'){this.cancel();return;}if(this.intermediateHandler)this.intermediateHandler();this.asyncRequest.setData({openid_params:b}).send();};OpenIDRequest.prototype.asyncResponseHandler=function(a){var b=a.getPayload();if(this.successResponseHandler)this.successResponseHandler(b);this.closePopupIfOpen();};OpenIDRequest.prototype.cleanHandleResponse=function(a){if(a.css)a.css=$A(a.css);this.asyncRequest.handleResponse(a);};OpenIDRequest.prototype.asyncErrorHandler=function(a){this.closePopupIfOpen();if(a.error==1428010||a.error==1428011){this.cancel();return;}if(this.errorHandler)this.errorHandler(a);};OpenIDRequest.prototype.retry=function(){++this.retryCount;this.requestId=OpenIDRequest.maxRequestId++;this.send();};OpenIDRequest.prototype.setProviderCache=function(a){OpenIDRequest.cache=a;return this;};OpenIDRequest.cache={};OpenIDRequest.requests=[];OpenIDRequest.maxRequestId=0;OpenIDRequest.context='default';
__d("isRTL",[],function(a,b,c,d,e,f){function g(h){for(var i=0;i<h.length;i++){var j=h.charCodeAt(i);if(j>=48)return j>=1470&&j<=1920;}return false;}e.exports=g;});
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatAvailabilityTabSheet","ChatNoListenersTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatTabSheetView","ChatUserBlockedTabSheet","copyProperties","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('ChatAddFriendsTabSheet'),h=b('ChatAvailabilityTabSheet'),i=b('ChatNoListenersTabSheet'),j=b('ChatNoRecipientsTabSheet'),k=b('ChatOfflineTabSheet'),l=b('ChatTabSheetView'),m=b('ChatUserBlockedTabSheet'),n=b('copyProperties'),o=b('MercuryServerRequests'),p=b('MercuryThreads'),q=function(r,s,t){this._sheetView=new l(r,s,t);this._addFriendsTabSheet=new g(r,s,this._sheetView);this._userBlockedTabSheet=new m(r,s,this._sheetView);this._offlineTabSheet=new k(r,s,this._sheetView);this._availabilityTabSheets=h.createSheets(r,s,this._sheetView);if(p.isMultichatThread(r)){this._noRecipientsTabSheet=new j(r,s,this._sheetView);}else if(p.isLiveListenThread(r))this._noListenersTabSheet=new i(r,s,this._sheetView);};n(q.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},destroy:function(){this._sheetView.destroy();}});e.exports=q;});
__d("legacy:input-selection",["InputSelection","copyProperties"],function(a,b,c,d){var e=b('InputSelection'),f=b('copyProperties');f(a.Input||(a.Input={}),{getSelection:e.get,setSelection:e.set});},3);
__d("ChatTabModel",["function-extensions","Arbiter","ArbiterMixin","ChatBehavior","ChatConfig","copyProperties","JSLogger","math-extensions","MercuryAssert","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker","PresenceState","PresenceUtil","areObjectsEqual","PresenceInitialData"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatBehavior'),j=b('ChatConfig'),k=b('copyProperties'),l=b('JSLogger'),m=b('math-extensions'),n=b('MercuryAssert'),o=b('MercuryServerRequests'),p=b('MercuryThreads'),q=b('MercuryTimestampTracker'),r=c('PresenceInitialData'),s=b('PresenceState'),t=b('PresenceUtil'),u=b('areObjectsEqual'),v=[],w=null,x=null,y=null,z=null;function aa(){return parseInt(r.serverTime,10);}var ba=j.get('tab_max_load_age')||3600000,ca=aa()-ba,da=0,ea=20,fa=l.create('chat_tab_model'),ga=false;function ha(ya){var za=m.verifyNumber(ya.uct2);if(!za||typeof za!=='number'){fa.warn('bad_cookie_version',ya.uct2);return null;}if(za<=da||za<ca)return null;return za;}function ia(ya){var za=ha(ya);if(!za){var ab={};ab.old_tabs=ya&&ya.t2&&JSON.stringify(ya.t2);ab.old_promoted=ya&&ya.lm2;ab.old_time=ya&&ya.uct2;ab.old_reason=ya&&ya.tr;ab.old_window=ya&&ya.tw;var bb;if(x&&ya.t2)for(var cb=0;cb<ya.t2.length;cb++){var db=ya.t2[cb];if(db.i===x)bb=db.r;}var eb=[];v.forEach(function(fb){if(!fb.fragile){var gb={i:fb.id,si:fb.server_id};if(fb.raised||(fb.id===x&&bb))gb.r=1;eb.push(gb);}});ya.t2=eb;ya.uct2=da;ya.lm2=w;ya.tr=z;ya.tw=t.getSessionID();ab.new_tabs=JSON.stringify(ya.t2);ab.new_promoted=ya.lm2;ab.new_time=ya.uct2;ab.new_reason=ya.tr;ab.new_window=ya.tw;fa.debug('store',ab);}return ya;}function ja(ya){if(ya){var za=ha(ya);if(za){var ab={};ab.old_tabs=JSON.stringify(v);ab.old_promoted=w;ab.old_time=da;ab.old_reason=z;ab.window_id=t.getSessionID();ab.cookie_tabs=ya&&ya.t2&&JSON.stringify(ya.t2);ab.cookie_promoted=ya&&ya.lm2;ab.cookie_time=ya&&ya.uct2;ab.cookie_reason=ya&&ya.tr;ab.cookie_window=ya&&ya.tw;da=za;z='load';var bb=ka(ya.t2,ya.lm2||null);ab.load_result=bb;ab.new_tabs=JSON.stringify(v);ab.new_promoted=w;ab.new_time=da;ab.new_reason=z;var event='load';if(!ga)event+='_init';fa.log(event,ab);return bb;}}return false;}function ka(ya,za){if(la(ya,za)){var ab=v.filter(function(db){return db.fragile;}),bb={};w=null;v=ya.map(function(db){var eb={id:db.i,server_id:db.si};if(eb.id==za)w=eb.id;if(x==db.i){var fb=qa(x);if(fb!=-1){eb.raised=v[fb].raised;return eb;}else return null;}if(db.r)eb.raised=true;bb[eb.id]=eb;return eb;});v=v.filter(function(db){return db!=null;});if(y)for(var cb in y)if(!bb[cb]||!bb[cb].raised)delete y[cb];ab=ab.filter(function(db){return !bb[db.id];});v=v.concat(ab);pa();return true;}return false;}function la(ya,za){if(za!=w)return true;var ab=v.filter(function(db){return !db.fragile;});if(ya.length!=ab.length)return true;for(var bb=0,cb=ya.length;bb<cb;bb++){if(ya[bb].id===x)continue;if(!u(ya[bb],ab[bb]))return true;}return false;}function ma(ya,za,ab){var bb=ja(s.get());if(za===undefined||za>da){if(ya()){bb=true;z=ab||null;oa(za);}}else fa.error('rejected',{change_time:za,state_time:da});bb&&na();}function na(){if(ga)wa.inform('chat/tabs-changed',wa.get());}function oa(ya){if(ya===undefined)ya=Math.max(q.getLastUserMessageTimestamp()||1,da+1);da=ya;s.doSync();}function pa(){var ya=v.length-ea;if(ya>0)v=v.filter(function(za){return za.raised||ya--<=0;});}function qa(ya){for(var za=0;za<v.length;za++)if(v[za].id==ya)return za;return -1;}function ra(ya){var za=p.getThreadMetaNow(ya);if(!za)return false;if(za.is_canonical_user||za.is_canonical_group||za.is_canonical_live_listen){return ta(ya);}else{var ab=sa(ya);if(ab)o.getServerThreadID(ya,function(bb){if(ua(ya,bb)){oa();na();}});return ab;}}function sa(ya){if(qa(ya)===-1){v.push({id:ya,fragile:true});fa.log('open_fragile_tab',{tabs:JSON.stringify(v),opened:ya,window_id:t.getSessionID()});return true;}return false;}function ta(ya){var za=qa(ya);if(za!=-1)if(v[za].fragile){v.splice(za,1);}else return false;for(var ab=0;ab<=v.length;ab++)if(ab==v.length||v[ab].fragile){v.splice(ab,0,{id:ya});pa();fa.log('open_tab',{tabs:JSON.stringify(v),opened:ya,window_id:t.getSessionID()});return true;}}function ua(ya,za){var ab=qa(ya);if(ab!=-1&&v[ab].fragile){var bb=v[ab];bb.fragile=false;bb.server_id=za;var cb=[];v.forEach(function(db){if(db.id!=ya){if(bb&&db.fragile){cb.push(bb);bb=null;}cb.push(db);}});if(bb)cb.push(bb);v=cb;fa.log('make_permanent',{tabs:JSON.stringify(v),tab_id:ya,window_id:t.getSessionID()});return true;}return false;}function va(ya){var za=qa(ya);if(ya==w)w=null;if(za!=-1){v.splice(za,1);fa.log('close_tab',{tabs:JSON.stringify(v),closed:ya,window_id:t.getSessionID()});return true;}return false;}s.registerStateStorer(ia);s.registerStateLoader(function(ya){if(ja(ya))na();});function wa(){}k(wa,h,{indexOf:function(ya){return qa(ya);},getTab:function(ya){n.isThreadID(ya);var za=this.indexOf(ya);if(za>-1){var ab=v[za];return k({},ab);}return null;},closeAllTabs:function(){if(v.length){fa.log('close_all_tabs',{closed_tabs:JSON.stringify(v),window_id:t.getSessionID()});v=[];w=null;if(y)y={};oa();na();}},closeFragileTabs:function(){var ya=[];for(var za=0;za<v.length;za++)if(v[za].fragile){ya.push(v[za]);v.splice(za);na();break;}fa.log('close_fragile_tabs',{tabs:JSON.stringify(v),fragile_closed:ya,window_id:t.getSessionID()});},closeTab:function(ya,za){n.isThreadID(ya);var ab=false;if(y){delete y[ya];ab=true;}ma(function(){if(va(ya))ab=true;return ab;},undefined,za);},closeTabAndDemote:function(ya,za,ab){n.isThreadID(ya);var bb=false;if(y){delete y[ya];bb=true;}ma(function(){if(va(ya)){if(w){var cb=qa(w);if(cb>za){var db=v.splice(cb,1)[0];v.splice(za,0,db);w=null;}}bb=true;}return bb;},undefined,ab);},raiseTab:function(ya,za){n.isThreadID(ya);var ab=false;if(y&&za){y[ya]=true;ab=true;}if(!za&&ya===x){ab&&na();return;}ma(function(){if(ra(ya))ab=true;var bb=qa(ya);if(bb!=-1&&!v[bb].raised){v[bb].raised=true;ab=true;fa.log('raise_tab',{tabs:JSON.stringify(v),raised:ya,window_id:t.getSessionID()});}return ab;});},get:function(){var ya=v.map(function(za){var ab=k({},za);delete ab.fragile;if(y)ab.raised=y[ab.id];return ab;});return {tabs:ya,promoted:w};},openFragileTab:function(ya){n.isThreadID(ya);if(sa(ya))na();},openTab:function(ya){n.isThreadID(ya);ma(ra.curry(ya));},lowerTab:function(ya){n.isThreadID(ya);var za=false;if(y){delete y[ya];za=true;}ma(function(){var ab=qa(ya);if(ab!=-1&&v[ab].raised){delete v[ab].raised;fa.log('lower_tab',{tabs:JSON.stringify(v),lowered:ya,window_id:t.getSessionID()});za=true;}return za;});},raiseAndPromoteTab:function(ya,za,ab,bb){n.isThreadID(ya);var cb=false;if(y&&za){y[ya]=true;cb=true;}if(!za&&ya===x){cb&&na();return;}ma(function(){if(ra(ya))cb=true;var db=qa(ya);if(db!=-1&&(!v[db].raised||w!=ya)){v[db].raised=true;w=ya;cb=true;fa.log('raise_and_promote_tab',{tabs:JSON.stringify(v),promoted:ya,window_id:t.getSessionID()});}return cb;},ab,bb);},squelchTab:function(ya){n.isThreadID(ya);x=ya;this.lowerTab(ya);fa.log('squelch_tab',{squelched:ya,tabs:JSON.stringify(v),window_id:t.getSessionID()});},clearSquelchedTab:function(){if(x)fa.log('unsquelch_tab',{squelched:x,tabs:JSON.stringify(v),window_id:t.getSessionID()});x=null;}});g.subscribe(l.DUMP_EVENT,function(ya,za){za.chat_tabs={promoted:w,tabs:v.map(function(ab){return k({},ab);}),time:da,max_load_age:ba};});function xa(){var ya=i.ignoresRemoteTabRaise();if(ya&&!y){fa.log('start_ignore_remote_raise');y={};na();}else if(!ya&&y){fa.log('stop_ignore_remote_raise');y=null;na();}}i.subscribe(i.ON_CHANGED,xa);xa();ja(s.getInitial(),true);if(da===0)da=aa()-600000;ga=true;e.exports=wa;});
__d("TextInputControl",["event-extensions","function-extensions","Class","DOMControl","Input","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Class'),h=b('DOMControl'),i=b('Input'),j=b('copyProperties');function k(l){this.parent.construct(this,l);var m=this.getRoot(),n=function(){this.update.bind(this).defer();}.bind(this);Event.listen(m,{keydown:n,paste:n});}g.extend(k,h);j(k.prototype,{setMaxLength:function(l){i.setMaxLength(this.getRoot(),l);return this;},getValue:function(){return i.getValue(this.getRoot());},isEmpty:function(){return i.isEmpty(this.getRoot());},setValue:function(l){i.setValue(this.getRoot(),l);this.update();return this;},clear:function(){return this.setValue('');},setPlaceholderText:function(l){i.setPlaceholder(this.getRoot(),l);return this;}});e.exports=k;});
__d("TextMetrics",["array-extensions","DOM","debounce","Style","UserAgent"],function(a,b,c,d,e,f){b('array-extensions');var g=b('DOM'),h=b('debounce'),i=b('Style'),j=b('UserAgent'),k;function l(){if(typeof k==='undefined'){var n=g.create('div',{className:'webkitZoomTest'}),o=function(){g.appendContent(document.body,n);k=100/n.clientHeight;g.remove(n);};Event.listen(window,'resize',h(o,100));o();}return k;}function m(n){this._node=n;this._shadow=g.create('textarea',{className:'textMetrics'});var o=['fontSize','fontStyle','fontWeight','fontFamily','wordWrap'];o.forEach(function(q){i.set(this._shadow,q,i.get(n,q));}.bind(this));var p=i.get(n,'lineHeight');if(j.chrome()||j.safari())p=Math.round(parseInt(p,10)*l())+'px';i.set(this._shadow,'lineHeight',p);document.body.appendChild(this._shadow);}m.prototype.measure=function(){var n=this._node,o=this._shadow,p=n.clientWidth-i.getFloat(n,'paddingLeft')-i.getFloat(n,'paddingRight');i.set(o,'width',p+'px');o.value=n.value+'...';return {width:o.scrollWidth,height:o.scrollHeight};};m.prototype.destroy=function(){g.remove(this._shadow);};e.exports=m;});
__d("TextAreaControl",["event-extensions","Arbiter","ArbiterMixin","Class","CSS","DOMControl","Style","TextInputControl","TextMetrics","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DOMControl'),l=b('Style'),m=b('TextInputControl'),n=b('TextMetrics'),o=b('copyProperties');function p(q){this.autogrow=j.hasClass(q,'uiTextareaAutogrow');this.parent.construct(this,q);this.width=null;Event.listen(q,'focus',this._handleFocus.bind(this));}i.extend(p,m);o(p.prototype,h,{setAutogrow:function(q){this.autogrow=q;return this;},onupdate:function(){this.parent.onupdate();if(this.autogrow){var q=this.getRoot();if(!this.metrics)this.metrics=new n(q);if(typeof this.initialHeight==='undefined'){this.isBorderBox=l.get(q,'box-sizing')==='border-box'||l.get(q,'-moz-box-sizing')==='border-box'||l.get(q,'-webkit-box-sizing')==='border-box';this.borderBoxOffset=l.getFloat(q,'padding-top')+l.getFloat(q,'padding-bottom')+l.getFloat(q,'border-top-width')+l.getFloat(q,'border-bottom-width');this.initialHeight=q.offsetHeight-this.borderBoxOffset;}var r=this.metrics.measure(),s=Math.max(this.initialHeight,r.height);if(this.isBorderBox)s+=this.borderBoxOffset;if(s!==this.height){this.height=s;l.set(q,'height',s+'px');g.inform('reflow');this.inform('resize');}}else if(this.metrics){this.metrics.destroy();this.metrics=null;}},resetHeight:function(){this.height=-1;this.update();},_handleFocus:function(){this.width=null;}});p.getInstance=function(q){return k.getInstance(q)||new p(q);};e.exports=p;});
__d("TypingDetector",["event-extensions","function-extensions","ArbiterMixin","Class","Input","Run","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('Input'),j=b('Run'),k=b('copyProperties'),l=b('createObjectFrom');function m(n){this._input=n;this._ignoreKeys={};}m.INACTIVE=0;m.TYPING=1;m.QUITTING=2;k(m.prototype,g,{_timeout:7000,_currentState:m.INACTIVE,init:function(){this.init=bagofholding;this.reset();Event.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=m.INACTIVE;},setIgnoreKeys:function(n){this._ignoreKeys=l(n);},_onunload:function(){if(this._currentState==m.TYPING)this._transition(m.QUITTING);},_update:function(event){var n=Event.getKeyCode(event),o=this._currentState;if(!this._ignoreKeys[n])if(i.getValue(this._input).trim().length===0){if(o==m.TYPING)this._transition(m.INACTIVE);}else if(o==m.TYPING){this._recordKeystroke();}else if(o==m.INACTIVE){this._transition(m.TYPING);this._recordKeystroke();}},_transition:function(n){this.reset();this._currentState=n;this.inform('change',n);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=this._checkTyping.bind(this).defer(this._timeout);},_checkTyping:function(){var n=this._lastKeystrokeTime+this._timeout,o=Date.now();if(o>n){this._transition(m.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=this._checkTyping.bind(this).defer(n-o+10);}}});e.exports=m;});
__d("MercuryUnreadState",["Arbiter","copyProperties","MercuryFolders","JSLogger","KeyedCallbackManager","createObjectFrom","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('MercuryFolders'),j=b('JSLogger'),k=b('KeyedCallbackManager'),l=b('createObjectFrom'),m=b('MercuryServerRequests'),n=b('MercuryThreadInformer'),o=b('MercuryThreads'),p=c('MercuryConstants'),q={},r={},s={};(i.getSupportedFolders()||[]).forEach(function(ka){q[ka]=0;r[ka]=false;s[ka]=new k();});var t='unread_thread_hash',u='unseen_thread_list',v=p.MercuryThreadlistConstants.MAX_UNREAD_COUNT,w=j.create('mercury_unread_state'),x={getUnreadCount:function(ka){if(this.exceedsMaxCount(ka)){w.error('unguarded_unread_count_fetch',{});return 0;}return ba(ka);},exceedsMaxCount:function(ka){return r[ka]||(ba(ka)>v);}};function y(ka,la){s[ka].setResource(t,la);s[ka].setResource(u,Object.keys(la));}function z(ka,la){var ma=s[ka].executeOrEnqueue(t,la),na=s[ka].getUnavailableResources(ma);if(na.length)m.fetchUnreadThreadIDs(ka);}function aa(ka){return s[ka].getResource(t);}function ba(ka){var la=s[ka].getResource(u);if(la){return la.length;}else return q[ka];}function ca(ka){var la;if(ka.unread_thread_ids){ka.unread_thread_ids.forEach(function(na){la=na.folder;if(!i.isSupportedFolder(la))return;var oa=ha(na.thread_ids);y(la,l(oa,true));if(oa.length>v)r[la]=true;n.updatedUnreadState();});}else if(ja(ka)){ka.message_counts.forEach(function(na){la=na.folder;if(na.unread_count>v){r[la]=true;y(la,{});n.updatedUnreadState();}else{q[la]=na.unread_count;if(q[la]===0)y(la,{});n.updatedUnreadState();}});}else{var ma=ka.actions;if(!ma||!(ma.length))return;ma.forEach(function(na){if(na.is_forward)return;var oa=p.MercuryActionType,pa=na.thread_id?na.thread_id:na.server_thread_id;if(na.action_type==oa.DELETE_THREAD){i.getSupportedFolders().forEach(function(ra){fa(ra,pa);});}else if(na.action_type==oa.CHANGE_ARCHIVED_STATUS||na.action_type==oa.CHANGE_FOLDER){var qa=o.getThreadMetaNow(na.thread_id);la=i.getFromMeta(qa);if(i.isSupportedFolder(la)&&qa.unread_count>0)ea(la,pa);i.getSupportedFolders().forEach(function(ra){if(ra!=la)fa(ra,pa);});}else{la=na.folder;if(!i.isSupportedFolder(la))return;if(na.action_type==oa.CHANGE_READ_STATUS){da(la,pa,na.mark_as_read);}else if(na.action_type==oa.USER_GENERATED_MESSAGE||na.action_type==oa.LOG_MESSAGE)if(na.is_unread)ea(la,pa);}});}}function da(ka,la,ma){if(ma){fa(ka,la);}else ea(ka,la);}function ea(ka,la){if(r[ka])return;z(ka,function(ma){if(!ma[la]){ma[la]=true;y(ka,ma);n.updatedUnreadState();}});}function fa(ka,la){if(r[ka])return;z(ka,function(ma){if(ma[la]){delete ma[la];y(ka,ma);n.updatedUnreadState();}});}function ga(ka){r[ka]=false;y(ka,{});n.updatedUnreadState();}function ha(ka){return ka.map(m.convertThreadIDIfAvailable);}function ia(ka){i.getSupportedFolders().forEach(function(la){var ma=aa(la);if(!ma)return;for(var na in ka){var oa=ka[na];if(ma[na]){ma[oa]=ma[na];delete ma[na];}}y(la,ma);});}m.subscribe('update-unread',function(ka,la){ca(la);var ma=la.global_actions||[];for(var na=0;na<ma.length;na++){var oa=ma[na];if(oa.action_type==p.MercuryGlobalActionType.MARK_ALL_READ)ga(p.MessagingTag.INBOX,oa.action_id);}});function ja(ka){var la=(ka.message_counts||[]);for(var ma=0;ma<la.length;ma++)if(la[ma].unread_count)return true;return false;}m.subscribe('update-thread-ids',function(ka,la){ia(la);});g.subscribe(j.DUMP_EVENT,function(ka,la){la.messaging=la.messaging||{};la.messaging.unread={};la.messaging.unread_max_count={};i.getSupportedFolders().forEach(function(ma){la.messaging.unread[ma]=h({},aa(ma));la.messaging.unread_max_count[ma]=r[ma];});});e.exports=x;});
__d("MercuryLeftNavCountControl",["Arbiter","CSS","DOM","URI","MercuryUnreadState","MercuryServerRequests","MercuryThreadInformer","copyProperties","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('URI'),k=b('MercuryUnreadState'),l=b('MercuryServerRequests'),m=b('MercuryThreadInformer'),n=c('MercuryConstants'),o=b('copyProperties'),p,q,r=function(s,t){p=s;q=t;this.render();this.listenerToken=m.subscribe('unread-updated',this.render.bind(this));this.subscriptions=[g.subscribe('onload/exit',this.cleanup.bind(this))];};o(r.prototype,{render:function(){var s=k.exceedsMaxCount(n.MessagingTag.INBOX);if(s){i.setContent(p,n.MercuryThreadlistConstants.MAX_UNREAD_COUNT);}else{var t=k.getUnreadCount(n.MessagingTag.INBOX);i.setContent(p,t.toString());h.conditionClass(p.parentNode,'hidden_elem',t<=0);}i.setContent(q,s?'+':'');},cleanup:function(){this.subscriptions.forEach(g.unsubscribe);m.unsubscribe(this.listenerToken);}});e.exports=r;});
__d("MercuryLeftNav",["DOM","MercuryServerRequests","MercuryLeftNavCountControl"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryServerRequests'),i=b('MercuryLeftNavCountControl');e.exports=function(j,k){h.handleUpdate(k);var l=g.scry(j,'span.countValue')[0],m=g.scry(j,'span.maxCountIndicator')[0],n=new i(l,m);};});
__d("legacy:CounterDisplay",["CounterDisplay"],function(a,b,c,d){a.CounterDisplay=b('CounterDisplay');},3);
function startMessagingNavCountUpdater(a){var b=FutureSideNav.getInstance().getNodeForKey('inbox');if(!b)return;var c=FutureSideNav.getInstance().getNodeForKey('other'),d=DOM.scry(c,'span.count')[0],e=DOM.scry(d,'span.countValue')[0],f=DOM.scry(d,'span.maxCountIndicator')[0];new CounterMaxDisplay('other_unseen',e,d,null,null,true).setMaxCounter(a,f);}function CounterMaxDisplay(){this._maxValue=null;this._maxIndicatorNode=null;var a=[this].concat($A(arguments));return this.parent.construct.apply(this.parent,a);}Class.extend(CounterMaxDisplay,'CounterDisplay');copy_properties(CounterMaxDisplay.prototype,{setMaxCounter:function(a,b){this._maxValue=a;this._maxIndicatorNode=b;},paint:function(){var a=this._maxValue&&this._count>this._maxValue,b=a?this._maxValue:this._count;if(this._maxIndicatorNode){DOM.setContent(this._maxIndicatorNode,a?'+':'');}else if(a)b=b+'+';DOM.setContent(this._valueNode,b);this._toggleNodes();}});
__d("ComposerAudienceSelector",["DynamicIconSelector","CustomPrivacyOption","PrivacyConst","Selector"],function(a,b,c,d,e,f){b('DynamicIconSelector');var g=b('CustomPrivacyOption'),h=b('PrivacyConst'),i=b('Selector'),j={},k={},l={syncSelector:function(m){j[m]&&i.setSelected(m,j[m]);if(j[m]==h.BaseValue.CUSTOM&&k[m]){var n=i.getOption(m,h.BaseValue.CUSTOM+''),o=k[m];(function(){g.update(n.id,o.data,o.audience,o.tooltip);}).defer();}}};e.exports=l;});
__d("legacy:ComposerAudienceSelector",["ComposerAudienceSelector"],function(a,b,c,d){a.ComposerAudienceSelector=b('ComposerAudienceSelector');},3);
function FriendsPrivacyOption(){this.parent.construct(this);}Class.extend(FriendsPrivacyOption,'OnlyMePrivacyOption');FriendsPrivacyOption.prototype.init=function(a,b){this._hasRestricted=b;this._plusLabel=DOM.find(a,'.plusLabel');this.parent.init(a);};FriendsPrivacyOption.prototype._getChangedData=function(){return {tags:this._taggedIDs,privacy:PrivacyFriendsValue.ALL_FRIENDS};};FriendsPrivacyOption.prototype._recalculateTooltipAndLabel=function(){var a=this._tags.length,b=this._tooltip,c=this._label;if(a>2){this._tooltip=this._hasRestricted?"Kaverisi ja kaikkien merkittyjen kaverit; paitsi: Rajoitettu":"Kaverisi ja kaikkien merkittyjen kaverit";}else if(a==2){if(this._hasRestricted){this._tooltip=tx._("Kaverisi, k\u00e4ytt\u00e4j\u00e4n {user} kaverit ja k\u00e4ytt\u00e4j\u00e4n {user2} kaverit; paitsi: Rajoitettu",{user:this._tags[0],user2:this._tags[1]});}else this._tooltip=tx._("Sinun kaverisi sek\u00e4 k\u00e4ytt\u00e4jien {user} ja {user2} kaverit",{user:this._tags[0],user2:this._tags[1]});}else if(a==1){if(this._hasRestricted){this._tooltip=tx._("Kaverisi ja k\u00e4ytt\u00e4j\u00e4n {user} kaverit; paitsi: Rajoitettu",{user:this._tags[0]});}else this._tooltip=tx._("Omat kaverisi ja henkil\u00f6n {user} kaverit",{user:this._tags[0]});}else this._tooltip=this._hasRestricted?"Kaverisi; paitsi: Rajoitettu":"Kaverisi";CSS.conditionShow(this._plusLabel,this._tags.length);this._label=this._elem.getAttribute('data-label');if(this._tags.length)this._label+=' (+)';return (b!=this._tooltip)||(c!=this._label);};
__d("legacy:LayerDestroyOnHide",["LayerDestroyOnHide"],function(a,b,c,d){a.LayerDestroyOnHide=b('LayerDestroyOnHide');},3);
function MetaComposerEdDialog(){}copy_properties(MetaComposerEdDialog.prototype,{init:function(a,b,c,d,e){MetaComposerEdDialog.timesTagEduShown=c;MetaComposerEdDialog.timesStickyEduShown=e;if(MetaComposerEdDialog.singleton){a.destroy();return;}MetaComposerEdDialog.singleton=this;this._dialog=a;if(d)Arbiter.subscribe('composer/mutate',function(f,g){this._sendEducationRequest({sticky_num:MetaComposerEdDialog.timesStickyEduShown},'/ajax/composer/audience/sticky_education');}.bind(this));if(b)Arbiter.subscribe('SelectedPrivacyOption/changed',function(f,g){this._sendEducationRequest({ids:g.tags,type:g.privacy,tag_num:MetaComposerEdDialog.timesTagEduShown},'/ajax/composer/audience/tag_education');}.bind(this));Selector.subscribe('open',this._killAnim.bind(this));},_sendEducationRequest:function(a,b){if(!this._updateDialogContext())return;this._async&&this._async.abort();this._async=new AsyncRequest(b);this._async.setData(a).setHandler(this._handler.bind(this)).send();},_updateDialogContext:function(){var a=DOM.scry(document.body,'div.composerAudienceWrapper')[0],b=Vector2.getElementPosition(a);if(a&&b.x>0&&b.y>0){this._dialog.setContext(a);return true;}return false;},_handler:function(a){var b=a.payload;if(!b||!this._updateDialogContext())return;var c=this._dialog.getContent();DOM.setContent(c,b);this._dialog.disableBehavior(LayerDestroyOnHide).show();var d=Parent.byClass(c,'metaComposerUserEd');if(this._anim){this._anim.stop();this._anim=animation(d);}else this._anim=animation(d).from('opacity',0);this._anim.by('opacity',1).checkpoint().duration(3500).checkpoint().to('opacity',0).checkpoint().ondone(this._killAnim.bind(this)).go();},_killAnim:function(a,b){if(this._anim){this._anim.stop();this._dialog.hide(false);this._anim=null;}}});
function TimelineStickyHeaderComposer(){}copy_properties(TimelineStickyHeaderComposer,{_instances:{},getInstance:function(a){return TimelineStickyHeaderComposer._instances[a];}});copy_properties(TimelineStickyHeaderComposer.prototype,{init:function(a){TimelineStickyHeaderComposer._instances[a]=this;var b=$(a);this._container=Parent.byClass(b,'fbTimelineStickyHeaderComposer');this._tokens=[];Arbiter.subscribe('xhpc/construct/'+a,function(c,d){this._composer=d;this._tokens=[TimelineComposerUtilities.listenToPublish(this._composer,this._close.bind(this)),TimelineComposerUtilities.listenToAnotherComposerOpen(this._composer,this._close.bind(this)),TimelineComposerUtilities.listenToSetEstimatedDate(this._composer,TimelineContentLoader.capsuleForCurrentSection),Arbiter.subscribe("PhotoSnowlift.OPEN",this._close.bind(this)),Arbiter.subscribe('TimelineMLE/mleFlyoutShown',function(e,f){if(Composer.getInstance(f.getContext())===this._composer){this._closeComposerAttachment();}else this._close();}.bind(this)),Arbiter.subscribe('TimelineMLE/mleFlyoutHidden',function(e,f){if(f.context&&!f.new_flyout&&Composer.getInstance(f.context)===this._composer)this._close();}.bind(this)),this._composer.subscribeToMutate(this._closeMLE.bind(this)),this._composer.subscribeToMutate(this._registerClickToDismiss.bind(this)),Arbiter.subscribe(TimelineStickyHeader.ADJUST_WIDTH,this._toggleNarrowMode.bind(this))];}.bind(this));this._clickCancelToken=TimelineComposerUtilities.listenToCancel(b,this._close.bind(this));onleaveRegister(function(){this._tokens.forEach(Arbiter.unsubscribe.bind(Arbiter));this._tokens=[];this._clickCancelToken.remove();this._clickCancelToken=null;this._clearClickDismissToken();}.bind(this));},_toggleNarrowMode:function(event,a){Bootloader.loadComponents('Tooltip',function(){var b=Vector2.getElementDimensions(a).x>400,c=DOM.scry(this._composer.root,'a.attachmentLink');CSS.conditionClass(this._composer.root.parentNode,'narrowStickyHeaderComposer',b);for(var d=0;d<c.length;d++){var e=c[d],f=DOM.getText(e);if(b){Tooltip.set(e,f);}else Tooltip.remove(e);}}.bind(this));return false;},_registerClickToDismiss:function(){var a=DOM.find(this._composer.root,'span.lifeEventAttachment');if(!CSS.hasClass(a,'uiComposerAttachmentSelected')){this._clearClickDismissToken();return;}this._clickDismissToken=Event.listen(document.body,'click',function(event){var b=event.getTarget();if(!Parent.byClass(b,'fbTimelineStickyHeaderComposer')){this._close();this._clearClickDismissToken();}}.bind(this));},_clearClickDismissToken:function(){if(this._clickDismissToken){this._clickDismissToken.remove();this._clickDismissToken=null;}},_close:function(){this._closeComposerAttachment();this._closeMLE();},_closeComposerAttachment:function(){this._clearClickDismissToken();this._composer.reset();CSS.removeClass(this._composer.root,'uiComposerOpen');},_closeMLE:function(){Bootloader.loadComponents('TimelineMLE',function(){var a=TimelineMLE.getFlyout();if(a&&Composer.getInstance(a.getContext())===this._composer)TimelineMLE.hideFlyout();}.bind(this));}});
var QuestionsOpinionPollForm={replaceRow:function(a,b,c){var d='.pollRow_'+b;DOM.scry(a,d).map(function(e){DOM.replace(e,c);});}};